{"remainingRequest":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\babel-loader\\lib\\index.js!E:\\SmartFitness\\smart-fitness-view\\node_modules\\@coze\\api\\dist\\cjs\\index.js","dependencies":[{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\@coze\\api\\dist\\cjs\\index.js","mtime":499162500000},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749639512193},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1749639511518}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:InVzZSBzdHJpY3QiOyAvLyBUaGUgcmVxdWlyZSBzY29wZQoKdmFyIF9fd2VicGFja19yZXF1aXJlX18gPSB7fTsKLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KLy8gd2VicGFjay9ydW50aW1lL2NvbXBhdF9nZXRfZGVmYXVsdF9leHBvcnQKCigoKSA9PiB7CiAgLy8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1FU00gbW9kdWxlcwogIF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uIChtb2R1bGUpIHsKICAgIHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgPyBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsKICAgIH0gOiBmdW5jdGlvbiAoKSB7CiAgICAgIHJldHVybiBtb2R1bGU7CiAgICB9OwoKICAgIF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsIHsKICAgICAgYTogZ2V0dGVyCiAgICB9KTsKCiAgICByZXR1cm4gZ2V0dGVyOwogIH07Cn0pKCk7IC8vIHdlYnBhY2svcnVudGltZS9kZWZpbmVfcHJvcGVydHlfZ2V0dGVycwoKCigoKSA9PiB7CiAgX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24gKGV4cG9ydHMxLCBkZWZpbml0aW9uKSB7CiAgICBmb3IgKHZhciBrZXkgaW4gZGVmaW5pdGlvbikgaWYgKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0czEsIGtleSkpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzMSwga2V5LCB7CiAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgIGdldDogZGVmaW5pdGlvbltrZXldCiAgICB9KTsKICB9Owp9KSgpOyAvLyB3ZWJwYWNrL3J1bnRpbWUvaGFzX293bl9wcm9wZXJ0eQoKCigoKSA9PiB7CiAgX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24gKG9iaiwgcHJvcCkgewogICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApOwogIH07Cn0pKCk7IC8vIHdlYnBhY2svcnVudGltZS9tYWtlX25hbWVzcGFjZV9vYmplY3QKCgooKCkgPT4gewogIC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHMKICBfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbiAoZXhwb3J0czEpIHsKICAgIGlmICgndW5kZWZpbmVkJyAhPSB0eXBlb2YgU3ltYm9sICYmIFN5bWJvbC50b1N0cmluZ1RhZykgT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMxLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsKICAgICAgdmFsdWU6ICdNb2R1bGUnCiAgICB9KTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzMSwgJ19fZXNNb2R1bGUnLCB7CiAgICAgIHZhbHVlOiB0cnVlCiAgICB9KTsKICB9Owp9KSgpOwovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwoKCnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0ge307IC8vIEVTTSBDT01QQVQgRkxBRwoKX193ZWJwYWNrX3JlcXVpcmVfXy5yKF9fd2VicGFja19leHBvcnRzX18pOyAvLyBFWFBPUlRTCgoKX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sIHsKICBUcmFuc2NyaXB0aW9uczogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIFRyYW5zY3JpcHRpb25zLAogIEludGVybmFsU2VydmVyRXJyb3I6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBJbnRlcm5hbFNlcnZlckVycm9yLAogIGZldGNoQVBJOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgZmV0Y2hBUEksCiAgQ09aRV9DTl9CQVNFX1dTX1VSTDogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIENPWkVfQ05fQkFTRV9XU19VUkwsCiAgQVBJRXJyb3I6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBBUElFcnJvciwKICBLbm93bGVkZ2U6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBLbm93bGVkZ2UsCiAgQ296ZUFQSTogKCkgPT4KICAvKiBiaW5kaW5nICovCiAgQ296ZUFQSSwKICBPbGREb2N1bWVudHM6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBEb2N1bWVudHMsCiAgUE9MTF9JTlRFUlZBTDogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIFBPTExfSU5URVJWQUwsCiAgV2ViU29ja2V0QVBJOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgV2ViU29ja2V0QVBJLAogIFdlYnNvY2tldHM6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBXZWJzb2NrZXRzLAogIGhhbmRsZUFkZGl0aW9uYWxNZXNzYWdlczogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIGhhbmRsZUFkZGl0aW9uYWxNZXNzYWdlcywKICBEb2N1bWVudHM6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBkb2N1bWVudHNfRG9jdW1lbnRzLAogIGdldEpXVFRva2VuOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgZ2V0SldUVG9rZW4sCiAgQXVkaW86ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBBdWRpbywKICBGaWxlczogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIEZpbGVzLAogIGdldERldmljZVRva2VuOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgZ2V0RGV2aWNlVG9rZW4sCiAgQ2hhdEV2ZW50VHlwZTogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIGNoYXRfQ2hhdEV2ZW50VHlwZSwKICBDaGF0U3RhdHVzOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgY2hhdF9DaGF0U3RhdHVzLAogIE5vdEZvdW5kRXJyb3I6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBOb3RGb3VuZEVycm9yLAogIEFQSUNvbm5lY3Rpb25FcnJvcjogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIEFQSUNvbm5lY3Rpb25FcnJvciwKICBDT1pFX0NPTV9CQVNFX1dTX1VSTDogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIENPWkVfQ09NX0JBU0VfV1NfVVJMLAogIFJvb21zOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgUm9vbXMsCiAgV29ya1NwYWNlczogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIFdvcmtTcGFjZXMsCiAgSlNPTlBhcnNlRXJyb3I6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBKU09OUGFyc2VFcnJvciwKICBjYXN0VG9FcnJvcjogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIGNhc3RUb0Vycm9yLAogIGdldFBLQ0VPQXV0aFRva2VuOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgZ2V0UEtDRU9BdXRoVG9rZW4sCiAgZ2V0RGV2aWNlQ29kZTogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIGdldERldmljZUNvZGUsCiAgZ2V0V2ViQXV0aGVudGljYXRpb25Vcmw6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBnZXRXZWJBdXRoZW50aWNhdGlvblVybCwKICBoYW5kbGVQYXJhbWV0ZXJzOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgaGFuZGxlUGFyYW1ldGVycywKICBDT1pFX0NPTV9CQVNFX1VSTDogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIENPWkVfQ09NX0JBU0VfVVJMLAogIEF1dGhlbnRpY2F0aW9uRXJyb3I6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBBdXRoZW50aWNhdGlvbkVycm9yLAogIENPWkVfQ05fQkFTRV9VUkw6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBDT1pFX0NOX0JBU0VfVVJMLAogIGdldFBLQ0VBdXRoZW50aWNhdGlvblVybDogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIGdldFBLQ0VBdXRoZW50aWNhdGlvblVybCwKICBUZW1wbGF0ZUVudGl0eVR5cGU6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICB0ZW1wbGF0ZXNfVGVtcGxhdGVFbnRpdHlUeXBlLAogIENvbnZlcnNhdGlvbnM6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBDb252ZXJzYXRpb25zLAogIFdvcmtmbG93czogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIFdvcmtmbG93cywKICBHYXRld2F5RXJyb3I6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBHYXRld2F5RXJyb3IsCiAgUGVybWlzc2lvbkRlbmllZEVycm9yOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgUGVybWlzc2lvbkRlbmllZEVycm9yLAogIEFQSVVzZXJBYm9ydEVycm9yOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgQVBJVXNlckFib3J0RXJyb3IsCiAgQm90czogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIEJvdHMsCiAgQ2hhdDogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIENoYXQsCiAgUmF0ZUxpbWl0RXJyb3I6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBSYXRlTGltaXRFcnJvciwKICBSdW5zOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgUnVucywKICBfZ2V0SldUVG9rZW46ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBfZ2V0SldUVG9rZW4sCiAgVGltZW91dEVycm9yOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgVGltZW91dEVycm9yLAogIFdlYnNvY2tldHNFdmVudFR5cGU6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICB0eXBlc19XZWJzb2NrZXRzRXZlbnRUeXBlLAogIFBLQ0VBdXRoRXJyb3JUeXBlOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgYXV0aF9QS0NFQXV0aEVycm9yVHlwZSwKICBNQVhfUE9MTF9JTlRFUlZBTDogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIE1BWF9QT0xMX0lOVEVSVkFMLAogIFdvcmtmbG93Q2hhdDogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIFdvcmtmbG93Q2hhdCwKICBXb3JrZmxvd0V2ZW50VHlwZTogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIHJ1bnNfV29ya2Zsb3dFdmVudFR5cGUsCiAgVGVtcGxhdGVzOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgVGVtcGxhdGVzLAogIGdldFdlYk9BdXRoVG9rZW46ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBnZXRXZWJPQXV0aFRva2VuLAogIHJlZnJlc2hPQXV0aFRva2VuOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgcmVmcmVzaE9BdXRoVG9rZW4sCiAgSW1hZ2VzOiAoKSA9PgogIC8qIHJlZXhwb3J0ICovCiAgSW1hZ2VzLAogIEJhZFJlcXVlc3RFcnJvcjogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIEJhZFJlcXVlc3RFcnJvciwKICBDb3plRXJyb3I6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBDb3plRXJyb3IsCiAgUm9sZVR5cGU6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBjaGF0X1JvbGVUeXBlLAogIFZvaWNlczogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIFZvaWNlcywKICBNZXNzYWdlczogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIG1lc3NhZ2VzX01lc3NhZ2VzLAogIFdvcmtmbG93RXZlbnQ6ICgpID0+CiAgLyogcmVleHBvcnQgKi8KICBXb3JrZmxvd0V2ZW50LAogIGFkYXB0ZXJGZXRjaDogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIGFkYXB0ZXJGZXRjaCwKICBEYXRhc2V0czogKCkgPT4KICAvKiByZWV4cG9ydCAqLwogIERhdGFzZXRzCn0pOwoKY2xhc3MgQVBJUmVzb3VyY2UgewogIGNvbnN0cnVjdG9yKGNsaWVudCkgewogICAgdGhpcy5fY2xpZW50ID0gY2xpZW50OwogIH0KCn0KLyogZXNsaW50LWRpc2FibGUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5hbWVzcGFjZSAqLwoKCmNsYXNzIEJvdHMgZXh0ZW5kcyBBUElSZXNvdXJjZSB7CiAgLyoqCiAgKiBDcmVhdGUgYSBuZXcgYWdlbnQuIHwg6LCD55So5o6l5Y+j5Yib5bu65LiA5Liq5paw55qE5pm66IO95L2T44CCCiAgKiBAZG9jcyBlbjpodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvY3JlYXRlX2JvdD9fbGFuZz1lbgogICogQGRvY3Mgemg6aHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvY3JlYXRlX2JvdD9fbGFuZz16aAogICogQHBhcmFtIHBhcmFtcyAtIFJlcXVpcmVkIFRoZSBwYXJhbWV0ZXJzIGZvciBjcmVhdGluZyBhIGJvdC4gfCDliJvlu7ogQm90IOeahOWPguaVsOOAggogICogQHBhcmFtIHBhcmFtcy5zcGFjZV9pZCAtIFJlcXVpcmVkIFRoZSBTcGFjZSBJRCBvZiB0aGUgc3BhY2Ugd2hlcmUgdGhlIGFnZW50IGlzIGxvY2F0ZWQuIHwgQm90IOaJgOWcqOeahOepuumXtOeahCBTcGFjZSBJROOAggogICogQHBhcmFtIHBhcmFtcy5uYW1lIC0gUmVxdWlyZWQgVGhlIG5hbWUgb2YgdGhlIGFnZW50LiBJdCBzaG91bGQgYmUgMSB0byAyMCBjaGFyYWN0ZXJzIGxvbmcuIHwgQm90IOeahOWQjeensOOAggogICogQHBhcmFtIHBhcmFtcy5kZXNjcmlwdGlvbiAtIE9wdGlvbmFsIFRoZSBkZXNjcmlwdGlvbiBvZiB0aGUgYWdlbnQuIEl0IGNhbiBiZSAwIHRvIDUwMCBjaGFyYWN0ZXJzIGxvbmcuIHwgQm90IOeahOaPj+i/sOS/oeaBr+OAggogICogQHBhcmFtIHBhcmFtcy5pY29uX2ZpbGVfaWQgLSBPcHRpb25hbCBUaGUgZmlsZSBJRCBmb3IgdGhlIGFnZW50J3MgYXZhdGFyLiB8IOS9nOS4uuaZuuiDveS9k+WktOWDj+eahOaWh+S7tiBJROOAggogICogQHBhcmFtIHBhcmFtcy5wcm9tcHRfaW5mbyAtIE9wdGlvbmFsIFRoZSBwZXJzb25hbGl0eSBhbmQgcmVwbHkgbG9naWMgb2YgdGhlIGFnZW50LiB8IEJvdCDnmoTmj5DnpLror43phY3nva7jgIIKICAqIEBwYXJhbSBwYXJhbXMub25ib2FyZGluZ19pbmZvIC0gT3B0aW9uYWwgVGhlIHNldHRpbmdzIHJlbGF0ZWQgdG8gdGhlIGFnZW50J3Mgb3BlbmluZyByZW1hcmtzLiB8IEJvdCDnmoTlvIDlnLrnmb3phY3nva7jgIIKICAqIEByZXR1cm5zIEluZm9ybWF0aW9uIGFib3V0IHRoZSBjcmVhdGVkIGJvdC4gfCDliJvlu7rnmoQgQm90IOS/oeaBr+OAggogICovCiAgYXN5bmMgY3JlYXRlKHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy92MS9ib3QvY3JlYXRlJzsKICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzdWx0LmRhdGE7CiAgfQogIC8qKgogICogVXBkYXRlIHRoZSBjb25maWd1cmF0aW9uIG9mIGFuIGFnZW50LiB8IOiwg+eUqOaOpeWPo+S/ruaUueaZuuiDveS9k+eahOmFjee9ruOAggogICogQGRvY3MgZW46aHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL3VwZGF0ZV9ib3Q/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOmh0dHBzOi8vd3d3LmNvemUuY24vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL3VwZGF0ZV9ib3Q/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMgLSBSZXF1aXJlZCBUaGUgcGFyYW1ldGVycyBmb3IgdXBkYXRpbmcgYSBib3QuIHwg5L+u5pS5IEJvdCDnmoTlj4LmlbDjgIIKICAqIEBwYXJhbSBwYXJhbXMuYm90X2lkIC0gUmVxdWlyZWQgVGhlIElEIG9mIHRoZSBhZ2VudCB0aGF0IHRoZSBBUEkgaW50ZXJhY3RzIHdpdGguIHwg5b6F5L+u5pS56YWN572u55qE5pm66IO95L2TSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMubmFtZSAtIE9wdGlvbmFsIFRoZSBuYW1lIG9mIHRoZSBhZ2VudC4gfCBCb3Qg55qE5ZCN56ew44CCCiAgKiBAcGFyYW0gcGFyYW1zLmRlc2NyaXB0aW9uIC0gT3B0aW9uYWwgVGhlIGRlc2NyaXB0aW9uIG9mIHRoZSBhZ2VudC4gfCBCb3Qg55qE5o+P6L+w5L+h5oGv44CCCiAgKiBAcGFyYW0gcGFyYW1zLmljb25fZmlsZV9pZCAtIE9wdGlvbmFsIFRoZSBmaWxlIElEIGZvciB0aGUgYWdlbnQncyBhdmF0YXIuIHwg5L2c5Li65pm66IO95L2T5aS05YOP55qE5paH5Lu2IElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLnByb21wdF9pbmZvIC0gT3B0aW9uYWwgVGhlIHBlcnNvbmFsaXR5IGFuZCByZXBseSBsb2dpYyBvZiB0aGUgYWdlbnQuIHwgQm90IOeahOaPkOekuuivjemFjee9ruOAggogICogQHBhcmFtIHBhcmFtcy5vbmJvYXJkaW5nX2luZm8gLSBPcHRpb25hbCBUaGUgc2V0dGluZ3MgcmVsYXRlZCB0byB0aGUgYWdlbnQncyBvcGVuaW5nIHJlbWFya3MuIHwgQm90IOeahOW8gOWcuueZvemFjee9ruOAggogICogQHBhcmFtIHBhcmFtcy5rbm93bGVkZ2UgLSBPcHRpb25hbCBLbm93bGVkZ2UgY29uZmlndXJhdGlvbnMgb2YgdGhlIGFnZW50LiB8IEJvdCDnmoTnn6Xor4blupPphY3nva7jgIIKICAqIEByZXR1cm5zIFVuZGVmaW5lZCB8IOaXoOi/lOWbnuWAvAogICovCgoKICBhc3luYyB1cGRhdGUocGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL3YxL2JvdC91cGRhdGUnOwogICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBvcHRpb25zKTsKICAgIHJldHVybiByZXN1bHQuZGF0YTsKICB9CiAgLyoqCiAgKiBHZXQgdGhlIGFnZW50cyBwdWJsaXNoZWQgYXMgQVBJIHNlcnZpY2UuIHwg6LCD55So5o6l5Y+j5p+l55yL5oyH5a6a56m66Ze05Y+R5biD5YiwIEFnZW50IGFzIEFQSSDmuKDpgZPnmoTmmbrog73kvZPliJfooajjgIIKICAqIEBkb2NzIGVuOmh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9wdWJsaXNoZWRfYm90c19saXN0P19sYW5nPWVuCiAgKiBAZG9jcyB6aDpodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9wdWJsaXNoZWRfYm90c19saXN0P19sYW5nPXpoCiAgKiBAcGFyYW0gcGFyYW1zIC0gUmVxdWlyZWQgVGhlIHBhcmFtZXRlcnMgZm9yIGxpc3RpbmcgYm90cy4gfCDliJflh7ogQm90IOeahOWPguaVsOOAggogICogQHBhcmFtIHBhcmFtcy5zcGFjZV9pZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUgc3BhY2UuIHwgQm90IOaJgOWcqOeahOepuumXtOeahCBTcGFjZSBJROOAggogICogQHBhcmFtIHBhcmFtcy5wYWdlX3NpemUgLSBPcHRpb25hbCBQYWdpbmF0aW9uIHNpemUuIHwg5YiG6aG15aSn5bCP44CCCiAgKiBAcGFyYW0gcGFyYW1zLnBhZ2VfaW5kZXggLSBPcHRpb25hbCBQYWdlIG51bWJlciBmb3IgcGFnaW5hdGVkIHF1ZXJpZXMuIHwg5YiG6aG15p+l6K+i5pe255qE6aG156CB44CCCiAgKiBAcmV0dXJucyBMaXN0IG9mIHB1Ymxpc2hlZCBib3RzLiB8IOW3suWPkeW4g+eahCBCb3Qg5YiX6KGo44CCCiAgKi8KCgogIGFzeW5jIGxpc3QocGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL3YxL3NwYWNlL3B1Ymxpc2hlZF9ib3RzX2xpc3QnOwogICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5fY2xpZW50LmdldChhcGlVcmwsIHBhcmFtcywgZmFsc2UsIG9wdGlvbnMpOwogICAgcmV0dXJuIHJlc3VsdC5kYXRhOwogIH0KICAvKioKICAqIFB1Ymxpc2ggdGhlIHNwZWNpZmllZCBhZ2VudCBhcyBhbiBBUEkgc2VydmljZS4gfCDosIPnlKjmjqXlj6PliJvlu7rkuIDkuKrmlrDnmoTmmbrog73kvZPjgIIKICAqIEBkb2NzIGVuOmh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9wdWJsaXNoX2JvdD9fbGFuZz1lbgogICogQGRvY3Mgemg6aHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvcHVibGlzaF9ib3Q/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMgLSBSZXF1aXJlZCBUaGUgcGFyYW1ldGVycyBmb3IgcHVibGlzaGluZyBhIGJvdC4gfCDlj5HluIMgQm90IOeahOWPguaVsOOAggogICogQHBhcmFtIHBhcmFtcy5ib3RfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGFnZW50IHRoYXQgdGhlIEFQSSBpbnRlcmFjdHMgd2l0aC4gfCDopoHlj5HluIPnmoTmmbrog73kvZNJROOAggogICogQHBhcmFtIHBhcmFtcy5jb25uZWN0b3JfaWRzIC0gUmVxdWlyZWQgVGhlIGxpc3Qgb2YgcHVibGlzaGluZyBjaGFubmVsIElEcyBmb3IgdGhlIGFnZW50LiB8IOaZuuiDveS9k+eahOWPkeW4g+a4oOmBkyBJRCDliJfooajjgIIKICAqIEByZXR1cm5zIFVuZGVmaW5lZCB8IOaXoOi/lOWbnuWAvAogICovCgoKICBhc3luYyBwdWJsaXNoKHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy92MS9ib3QvcHVibGlzaCc7CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLl9jbGllbnQucG9zdChhcGlVcmwsIHBhcmFtcywgZmFsc2UsIG9wdGlvbnMpOwogICAgcmV0dXJuIHJlc3VsdC5kYXRhOwogIH0KICAvKioKICAqIEdldCB0aGUgY29uZmlndXJhdGlvbiBpbmZvcm1hdGlvbiBvZiB0aGUgYWdlbnQuIHwg6I635Y+W5oyH5a6a5pm66IO95L2T55qE6YWN572u5L+h5oGv44CCCiAgKiBAZG9jcyBlbjpodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvZ2V0X21ldGFkYXRhP19sYW5nPWVuCiAgKiBAZG9jcyB6aDpodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9nZXRfbWV0YWRhdGE/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMgLSBSZXF1aXJlZCBUaGUgcGFyYW1ldGVycyBmb3IgcmV0cmlldmluZyBhIGJvdC4gfCDojrflj5YgQm90IOeahOWPguaVsOOAggogICogQHBhcmFtIHBhcmFtcy5ib3RfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGFnZW50IHRoYXQgdGhlIEFQSSBpbnRlcmFjdHMgd2l0aC4gfCDopoHmn6XnnIvnmoTmmbrog73kvZNJROOAggogICogQHJldHVybnMgSW5mb3JtYXRpb24gYWJvdXQgdGhlIGJvdC4gfCBCb3Qg55qE6YWN572u5L+h5oGv44CCCiAgKi8KCgogIGFzeW5jIHJldHJpZXZlKHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy92MS9ib3QvZ2V0X29ubGluZV9pbmZvJzsKICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuX2NsaWVudC5nZXQoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBvcHRpb25zKTsKICAgIHJldHVybiByZXN1bHQuZGF0YTsKICB9Cgp9Ci8qIGVzbGludC1kaXNhYmxlIHNlY3VyaXR5L2RldGVjdC1vYmplY3QtaW5qZWN0aW9uICovCgovKiBlc2xpbnQtZGlzYWJsZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55ICovCgoKZnVuY3Rpb24gc2FmZUpzb25QYXJzZShqc29uU3RyaW5nKSB7CiAgbGV0IGRlZmF1bHRWYWx1ZSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIHZvaWQgMCAhPT0gYXJndW1lbnRzWzFdID8gYXJndW1lbnRzWzFdIDogJyc7CgogIHRyeSB7CiAgICByZXR1cm4gSlNPTi5wYXJzZShqc29uU3RyaW5nKTsKICB9IGNhdGNoIChlcnJvcikgewogICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKICB9Cn0KCmZ1bmN0aW9uIHNsZWVwKG1zKSB7CiAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4gewogICAgc2V0VGltZW91dChyZXNvbHZlLCBtcyk7CiAgfSk7Cn0KCmZ1bmN0aW9uIGlzVW5pQXBwKCkgewogIHJldHVybiAndW5kZWZpbmVkJyAhPSB0eXBlb2YgdW5pOwp9CgpmdW5jdGlvbiBpc0Jyb3dzZXIoKSB7CiAgcmV0dXJuICd1bmRlZmluZWQnICE9IHR5cGVvZiB3aW5kb3c7Cn0KCmZ1bmN0aW9uIGlzUGxhaW5PYmplY3Qob2JqKSB7CiAgaWYgKCdvYmplY3QnICE9IHR5cGVvZiBvYmogfHwgbnVsbCA9PT0gb2JqKSByZXR1cm4gZmFsc2U7CiAgY29uc3QgcHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKTsKICBpZiAobnVsbCA9PT0gcHJvdG8pIHJldHVybiB0cnVlOwogIGxldCBiYXNlUHJvdG8gPSBwcm90bzsKCiAgd2hpbGUgKG51bGwgIT09IE9iamVjdC5nZXRQcm90b3R5cGVPZihiYXNlUHJvdG8pKSBiYXNlUHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoYmFzZVByb3RvKTsKCiAgcmV0dXJuIHByb3RvID09PSBiYXNlUHJvdG87Cn0KCmZ1bmN0aW9uIG1lcmdlQ29uZmlnKCkgewogIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBvYmplY3RzID0gbmV3IEFycmF5KF9sZW4pLCBfa2V5ID0gMDsgX2tleSA8IF9sZW47IF9rZXkrKykgb2JqZWN0c1tfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTsKCiAgcmV0dXJuIG9iamVjdHMucmVkdWNlKChyZXN1bHQsIG9iaikgPT4gewogICAgaWYgKHZvaWQgMCA9PT0gb2JqKSByZXR1cm4gcmVzdWx0IHx8IHt9OwoKICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsKICAgICAgaWYgKGlzUGxhaW5PYmplY3Qob2JqW2tleV0pICYmICFBcnJheS5pc0FycmF5KG9ialtrZXldKSkgcmVzdWx0W2tleV0gPSBtZXJnZUNvbmZpZyhyZXN1bHRba2V5XSB8fCB7fSwgb2JqW2tleV0pO2Vsc2UgcmVzdWx0W2tleV0gPSBvYmpba2V5XTsKICAgIH0KCiAgICByZXR1cm4gcmVzdWx0OwogIH0sIHt9KTsKfQoKZnVuY3Rpb24gaXNQZXJzb25hbEFjY2Vzc1Rva2VuKHRva2VuKSB7CiAgcmV0dXJuIG51bGwgPT0gdG9rZW4gPyB2b2lkIDAgOiB0b2tlbi5zdGFydHNXaXRoKCdwYXRfJyk7Cn0KCmZ1bmN0aW9uIGJ1aWxkV2Vic29ja2V0VXJsKHBhdGgsIHBhcmFtcykgewogIGNvbnN0IHF1ZXJ5U3RyaW5nID0gT2JqZWN0LmVudHJpZXMocGFyYW1zKS5maWx0ZXIocGFyYW0gPT4gewogICAgbGV0IFtfLCB2YWx1ZV0gPSBwYXJhbTsKICAgIHJldHVybiBudWxsICE9IHZhbHVlICYmICcnICE9PSB2YWx1ZTsKICB9KS5tYXAocGFyYW0gPT4gewogICAgbGV0IFtrZXksIHZhbHVlXSA9IHBhcmFtOwogICAgcmV0dXJuIGAke2tleX09JHt2YWx1ZX1gOwogIH0pLmpvaW4oJyYnKTsKICByZXR1cm4gYCR7cGF0aH0/JHtxdWVyeVN0cmluZ31gOwp9Ci8qIGVzbGludC1kaXNhYmxlIG1heC1wYXJhbXMgKi8KCgpjbGFzcyBDb3plRXJyb3IgZXh0ZW5kcyBFcnJvciB7fQoKY2xhc3MgQVBJRXJyb3IgZXh0ZW5kcyBDb3plRXJyb3IgewogIHN0YXRpYyBtYWtlTWVzc2FnZShzdGF0dXMsIGVycm9yQm9keSwgbWVzc2FnZSwgaGVhZGVycykgewogICAgaWYgKCFlcnJvckJvZHkgJiYgbWVzc2FnZSkgcmV0dXJuIG1lc3NhZ2U7CgogICAgaWYgKGVycm9yQm9keSkgewogICAgICBjb25zdCBsaXN0ID0gW107CiAgICAgIGNvbnN0IHsKICAgICAgICBjb2RlLAogICAgICAgIG1zZywKICAgICAgICBlcnJvcgogICAgICB9ID0gZXJyb3JCb2R5OwogICAgICBpZiAoY29kZSkgbGlzdC5wdXNoKGBjb2RlOiAke2NvZGV9YCk7CiAgICAgIGlmIChtc2cpIGxpc3QucHVzaChgbXNnOiAke21zZ31gKTsKICAgICAgaWYgKChudWxsID09IGVycm9yID8gdm9pZCAwIDogZXJyb3IuZGV0YWlsKSAmJiBtc2cgIT09IGVycm9yLmRldGFpbCkgbGlzdC5wdXNoKGBkZXRhaWw6ICR7ZXJyb3IuZGV0YWlsfWApOwogICAgICBjb25zdCBsb2dJZCA9IChudWxsID09IGVycm9yID8gdm9pZCAwIDogZXJyb3IubG9naWQpIHx8IChudWxsID09IGhlYWRlcnMgPyB2b2lkIDAgOiBoZWFkZXJzWyd4LXR0LWxvZ2lkJ10pOwogICAgICBpZiAobG9nSWQpIGxpc3QucHVzaChgbG9naWQ6ICR7bG9nSWR9YCk7CiAgICAgIHJldHVybiBsaXN0LmpvaW4oJywgJyk7CiAgICB9CgogICAgaWYgKHN0YXR1cykgcmV0dXJuIGBodHRwIHN0YXR1cyBjb2RlOiAke3N0YXR1c30gKG5vIGJvZHkpYDsKICAgIHJldHVybiAnKG5vIHN0YXR1cyBjb2RlIG9yIGJvZHkpJzsKICB9CgogIHN0YXRpYyBnZW5lcmF0ZShzdGF0dXMsIGVycm9yUmVzcG9uc2UsIG1lc3NhZ2UsIGhlYWRlcnMpIHsKICAgIGlmICghc3RhdHVzKSByZXR1cm4gbmV3IEFQSUNvbm5lY3Rpb25FcnJvcih7CiAgICAgIGNhdXNlOiBjYXN0VG9FcnJvcihlcnJvclJlc3BvbnNlKQogICAgfSk7CiAgICBjb25zdCBlcnJvciA9IGVycm9yUmVzcG9uc2U7IC8vIGh0dHBzOi8vd3d3LmNvemUuY24vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2NvemVfZXJyb3JfY29kZXMKCiAgICBpZiAoNDAwID09PSBzdGF0dXMgfHwgKG51bGwgPT0gZXJyb3IgPyB2b2lkIDAgOiBlcnJvci5jb2RlKSA9PT0gNDAwMCkgcmV0dXJuIG5ldyBCYWRSZXF1ZXN0RXJyb3Ioc3RhdHVzLCBlcnJvciwgbWVzc2FnZSwgaGVhZGVycyk7CiAgICBpZiAoNDAxID09PSBzdGF0dXMgfHwgKG51bGwgPT0gZXJyb3IgPyB2b2lkIDAgOiBlcnJvci5jb2RlKSA9PT0gNDEwMCkgcmV0dXJuIG5ldyBBdXRoZW50aWNhdGlvbkVycm9yKHN0YXR1cywgZXJyb3IsIG1lc3NhZ2UsIGhlYWRlcnMpOwogICAgaWYgKDQwMyA9PT0gc3RhdHVzIHx8IChudWxsID09IGVycm9yID8gdm9pZCAwIDogZXJyb3IuY29kZSkgPT09IDQxMDEpIHJldHVybiBuZXcgUGVybWlzc2lvbkRlbmllZEVycm9yKHN0YXR1cywgZXJyb3IsIG1lc3NhZ2UsIGhlYWRlcnMpOwogICAgaWYgKDQwNCA9PT0gc3RhdHVzIHx8IChudWxsID09IGVycm9yID8gdm9pZCAwIDogZXJyb3IuY29kZSkgPT09IDQyMDApIHJldHVybiBuZXcgTm90Rm91bmRFcnJvcihzdGF0dXMsIGVycm9yLCBtZXNzYWdlLCBoZWFkZXJzKTsKICAgIGlmICg0MjkgPT09IHN0YXR1cyB8fCAobnVsbCA9PSBlcnJvciA/IHZvaWQgMCA6IGVycm9yLmNvZGUpID09PSA0MDEzKSByZXR1cm4gbmV3IFJhdGVMaW1pdEVycm9yKHN0YXR1cywgZXJyb3IsIG1lc3NhZ2UsIGhlYWRlcnMpOwogICAgaWYgKDQwOCA9PT0gc3RhdHVzKSByZXR1cm4gbmV3IFRpbWVvdXRFcnJvcihzdGF0dXMsIGVycm9yLCBtZXNzYWdlLCBoZWFkZXJzKTsKICAgIGlmICg1MDIgPT09IHN0YXR1cykgcmV0dXJuIG5ldyBHYXRld2F5RXJyb3Ioc3RhdHVzLCBlcnJvciwgbWVzc2FnZSwgaGVhZGVycyk7CiAgICBpZiAoc3RhdHVzID49IDUwMCkgcmV0dXJuIG5ldyBJbnRlcm5hbFNlcnZlckVycm9yKHN0YXR1cywgZXJyb3IsIG1lc3NhZ2UsIGhlYWRlcnMpOwogICAgcmV0dXJuIG5ldyBBUElFcnJvcihzdGF0dXMsIGVycm9yLCBtZXNzYWdlLCBoZWFkZXJzKTsKICB9CgogIGNvbnN0cnVjdG9yKHN0YXR1cywgZXJyb3IsIG1lc3NhZ2UsIGhlYWRlcnMpIHsKICAgIHZhciBfZXJyb3JfZGV0YWlsLCBfZXJyb3JfZXJyb3I7CgogICAgc3VwZXIoYCR7QVBJRXJyb3IubWFrZU1lc3NhZ2Uoc3RhdHVzLCBlcnJvciwgbWVzc2FnZSwgaGVhZGVycyl9YCk7CiAgICB0aGlzLnN0YXR1cyA9IHN0YXR1czsKICAgIHRoaXMuaGVhZGVycyA9IGhlYWRlcnM7CiAgICB0aGlzLmxvZ2lkID0gKG51bGwgPT0gZXJyb3IgPyB2b2lkIDAgOiBudWxsID09PSAoX2Vycm9yX2RldGFpbCA9IGVycm9yLmRldGFpbCkgfHwgdm9pZCAwID09PSBfZXJyb3JfZGV0YWlsID8gdm9pZCAwIDogX2Vycm9yX2RldGFpbC5sb2dpZCkgfHwgKG51bGwgPT0gaGVhZGVycyA/IHZvaWQgMCA6IGhlYWRlcnNbJ3gtdHQtbG9naWQnXSk7IC8vIHRoaXMuZXJyb3IgPSBlcnJvcjsKCiAgICB0aGlzLmNvZGUgPSBudWxsID09IGVycm9yID8gdm9pZCAwIDogZXJyb3IuY29kZTsKICAgIHRoaXMubXNnID0gbnVsbCA9PSBlcnJvciA/IHZvaWQgMCA6IGVycm9yLm1zZzsKICAgIHRoaXMuZGV0YWlsID0gbnVsbCA9PSBlcnJvciA/IHZvaWQgMCA6IG51bGwgPT09IChfZXJyb3JfZXJyb3IgPSBlcnJvci5lcnJvcikgfHwgdm9pZCAwID09PSBfZXJyb3JfZXJyb3IgPyB2b2lkIDAgOiBfZXJyb3JfZXJyb3IuZGV0YWlsOwogICAgdGhpcy5yYXdFcnJvciA9IGVycm9yOwogIH0KCn0KCmNsYXNzIEFQSUNvbm5lY3Rpb25FcnJvciBleHRlbmRzIEFQSUVycm9yIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBtZXNzYWdlCiAgfSkgewogICAgc3VwZXIodm9pZCAwLCB2b2lkIDAsIG1lc3NhZ2UgfHwgJ0Nvbm5lY3Rpb24gZXJyb3IuJywgdm9pZCAwKSwgdGhpcy5zdGF0dXMgPSB2b2lkIDA7IC8vIGlmIChjYXVzZSkgewogICAgLy8gICB0aGlzLmNhdXNlID0gY2F1c2U7CiAgICAvLyB9CiAgfQoKfQoKY2xhc3MgQVBJVXNlckFib3J0RXJyb3IgZXh0ZW5kcyBBUElFcnJvciB7CiAgY29uc3RydWN0b3IobWVzc2FnZSkgewogICAgc3VwZXIodm9pZCAwLCB2b2lkIDAsIG1lc3NhZ2UgfHwgJ1JlcXVlc3Qgd2FzIGFib3J0ZWQuJywgdm9pZCAwKSwgdGhpcy5uYW1lID0gJ1VzZXJBYm9ydEVycm9yJywgdGhpcy5zdGF0dXMgPSB2b2lkIDA7CiAgfQoKfQoKY2xhc3MgQmFkUmVxdWVzdEVycm9yIGV4dGVuZHMgQVBJRXJyb3IgewogIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHsKICAgIHN1cGVyKC4uLmFyZ3MpLCB0aGlzLm5hbWUgPSAnQmFkUmVxdWVzdEVycm9yJywgdGhpcy5zdGF0dXMgPSA0MDA7CiAgfQoKfQoKY2xhc3MgQXV0aGVudGljYXRpb25FcnJvciBleHRlbmRzIEFQSUVycm9yIHsKICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7CiAgICBzdXBlciguLi5hcmdzKSwgdGhpcy5uYW1lID0gJ0F1dGhlbnRpY2F0aW9uRXJyb3InLCB0aGlzLnN0YXR1cyA9IDQwMTsKICB9Cgp9CgpjbGFzcyBQZXJtaXNzaW9uRGVuaWVkRXJyb3IgZXh0ZW5kcyBBUElFcnJvciB7CiAgY29uc3RydWN0b3IoLi4uYXJncykgewogICAgc3VwZXIoLi4uYXJncyksIHRoaXMubmFtZSA9ICdQZXJtaXNzaW9uRGVuaWVkRXJyb3InLCB0aGlzLnN0YXR1cyA9IDQwMzsKICB9Cgp9CgpjbGFzcyBOb3RGb3VuZEVycm9yIGV4dGVuZHMgQVBJRXJyb3IgewogIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHsKICAgIHN1cGVyKC4uLmFyZ3MpLCB0aGlzLm5hbWUgPSAnTm90Rm91bmRFcnJvcicsIHRoaXMuc3RhdHVzID0gNDA0OwogIH0KCn0KCmNsYXNzIFRpbWVvdXRFcnJvciBleHRlbmRzIEFQSUVycm9yIHsKICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7CiAgICBzdXBlciguLi5hcmdzKSwgdGhpcy5uYW1lID0gJ1RpbWVvdXRFcnJvcicsIHRoaXMuc3RhdHVzID0gNDA4OwogIH0KCn0KCmNsYXNzIFJhdGVMaW1pdEVycm9yIGV4dGVuZHMgQVBJRXJyb3IgewogIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHsKICAgIHN1cGVyKC4uLmFyZ3MpLCB0aGlzLm5hbWUgPSAnUmF0ZUxpbWl0RXJyb3InLCB0aGlzLnN0YXR1cyA9IDQyOTsKICB9Cgp9CgpjbGFzcyBJbnRlcm5hbFNlcnZlckVycm9yIGV4dGVuZHMgQVBJRXJyb3IgewogIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHsKICAgIHN1cGVyKC4uLmFyZ3MpLCB0aGlzLm5hbWUgPSAnSW50ZXJuYWxTZXJ2ZXJFcnJvcicsIHRoaXMuc3RhdHVzID0gNTAwOwogIH0KCn0KCmNsYXNzIEdhdGV3YXlFcnJvciBleHRlbmRzIEFQSUVycm9yIHsKICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7CiAgICBzdXBlciguLi5hcmdzKSwgdGhpcy5uYW1lID0gJ0dhdGV3YXlFcnJvcicsIHRoaXMuc3RhdHVzID0gNTAyOwogIH0KCn0KCmNvbnN0IGNhc3RUb0Vycm9yID0gZXJyID0+IHsKICBpZiAoZXJyIGluc3RhbmNlb2YgRXJyb3IpIHJldHVybiBlcnI7CiAgcmV0dXJuIG5ldyBFcnJvcihlcnIpOwp9OwoKY2xhc3MgSlNPTlBhcnNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7CiAgY29uc3RydWN0b3IoewogICAgbWVzc2FnZSwKICAgIGNhdXNlCiAgfSkgewogICAgc3VwZXIobWVzc2FnZSk7CiAgICB0aGlzLmNhdXNlID0gY2F1c2U7CiAgfQoKfQoKY2xhc3MgTWVzc2FnZXMgZXh0ZW5kcyBBUElSZXNvdXJjZSB7CiAgLyoqCiAgKiBHZXQgdGhlIGxpc3Qgb2YgbWVzc2FnZXMgaW4gYSBjaGF0LiB8IOiOt+WPluWvueivneS4reeahOa2iOaBr+WIl+ihqOOAggogICogQGRvY3MgZW46aHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2NoYXRfbWVzc2FnZV9saXN0P19sYW5nPWVuCiAgKiBAZG9jcyB6aDpodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9jaGF0X21lc3NhZ2VfbGlzdD9fbGFuZz16aAogICogQHBhcmFtIGNvbnZlcnNhdGlvbl9pZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUgY29udmVyc2F0aW9uLiB8IOS8muivnSBJROOAggogICogQHBhcmFtIGNoYXRfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGNoYXQuIHwg5a+56K+dIElE44CCCiAgKiBAcmV0dXJucyBBbiBhcnJheSBvZiBjaGF0IG1lc3NhZ2VzLiB8IOWvueivnea2iOaBr+aVsOe7hOOAggogICovCiAgYXN5bmMgbGlzdChjb252ZXJzYXRpb25faWQsIGNoYXRfaWQsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9IGAvdjMvY2hhdC9tZXNzYWdlL2xpc3Q/Y29udmVyc2F0aW9uX2lkPSR7Y29udmVyc2F0aW9uX2lkfSZjaGF0X2lkPSR7Y2hhdF9pZH1gOwogICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5fY2xpZW50LmdldChhcGlVcmwsIHZvaWQgMCwgZmFsc2UsIG9wdGlvbnMpOwogICAgcmV0dXJuIHJlc3VsdC5kYXRhOwogIH0KCn0KCmNvbnN0IHV1aWQgPSAoKSA9PiAoTWF0aC5yYW5kb20oKSAqIG5ldyBEYXRlKCkuZ2V0VGltZSgpKS50b1N0cmluZygpOwoKY29uc3QgaGFuZGxlQWRkaXRpb25hbE1lc3NhZ2VzID0gYWRkaXRpb25hbF9tZXNzYWdlcyA9PiBudWxsID09IGFkZGl0aW9uYWxfbWVzc2FnZXMgPyB2b2lkIDAgOiBhZGRpdGlvbmFsX21lc3NhZ2VzLm1hcChpID0+ICh7IC4uLmksCiAgY29udGVudDogJ29iamVjdCcgPT0gdHlwZW9mIGkuY29udGVudCA/IEpTT04uc3RyaW5naWZ5KGkuY29udGVudCkgOiBpLmNvbnRlbnQKfSkpOwoKY29uc3QgaGFuZGxlUGFyYW1ldGVycyA9IHBhcmFtZXRlcnMgPT4gewogIGlmIChwYXJhbWV0ZXJzKSB7CiAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhwYXJhbWV0ZXJzKSkgaWYgKCdvYmplY3QnID09IHR5cGVvZiB2YWx1ZSkgcGFyYW1ldGVyc1trZXldID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpOwogIH0KCiAgcmV0dXJuIHBhcmFtZXRlcnM7Cn07CgpjbGFzcyBDaGF0IGV4dGVuZHMgQVBJUmVzb3VyY2UgewogIC8qKgogICogQ2FsbCB0aGUgQ2hhdCBBUEkgdG8gc2VuZCBtZXNzYWdlcyB0byBhIHB1Ymxpc2hlZCBDb3plIGFnZW50LiB8IOiwg+eUqOatpOaOpeWPo+WPkei1t+S4gOasoeWvueivne+8jOaUr+aMgea3u+WKoOS4iuS4i+aWhwogICogQGRvY3MgZW46aHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2NoYXRfdjM/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOmh0dHBzOi8vd3d3LmNvemUuY24vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2NoYXRfdjM/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMgLSBSZXF1aXJlZCBUaGUgcGFyYW1ldGVycyBmb3IgY3JlYXRpbmcgYSBjaGF0IHNlc3Npb24uIHwg5Yib5bu65Lya6K+d55qE5Y+C5pWw44CCCiAgKiBAcGFyYW0gcGFyYW1zLmJvdF9pZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUgYWdlbnQuIHwg6KaB6L+b6KGM5Lya6K+d6IGK5aSp55qEIEJvdCBJROOAggogICogQHBhcmFtIHBhcmFtcy51c2VyX2lkIC0gT3B0aW9uYWwgVGhlIElEIG9mIHRoZSB1c2VyIGludGVyYWN0aW5nIHdpdGggdGhlIEJvdC4gfCDmoIfor4blvZPliY3kuI4gQm90IOS6pOS6kueahOeUqOaIt+OAggogICogQHBhcmFtIHBhcmFtcy5hZGRpdGlvbmFsX21lc3NhZ2VzIC0gT3B0aW9uYWwgQWRkaXRpb25hbCBtZXNzYWdlcyBmb3IgdGhlIGNvbnZlcnNhdGlvbi4gfCDlr7nor53nmoTpmYTliqDkv6Hmga/jgIIKICAqIEBwYXJhbSBwYXJhbXMuY3VzdG9tX3ZhcmlhYmxlcyAtIE9wdGlvbmFsIFZhcmlhYmxlcyBkZWZpbmVkIGluIHRoZSBCb3QuIHwgQm90IOS4reWumuS5ieWPmOmHj+OAggogICogQHBhcmFtIHBhcmFtcy5hdXRvX3NhdmVfaGlzdG9yeSAtIE9wdGlvbmFsIFdoZXRoZXIgdG8gYXV0b21hdGljYWxseSBzYXZlIHRoZSBjb252ZXJzYXRpb24gaGlzdG9yeS4gfCDmmK/lkKboh6rliqjkv53lrZjljoblj7Llr7nor53orrDlvZXjgIIKICAqIEBwYXJhbSBwYXJhbXMubWV0YV9kYXRhIC0gT3B0aW9uYWwgQWRkaXRpb25hbCBtZXRhZGF0YSBmb3IgdGhlIG1lc3NhZ2UuIHwg5Yib5bu65raI5oGv5pe255qE6ZmE5Yqg5raI5oGv44CCCiAgKiBAcGFyYW0gcGFyYW1zLmNvbnZlcnNhdGlvbl9pZCAtIE9wdGlvbmFsIFRoZSBJRCBvZiB0aGUgY29udmVyc2F0aW9uLiB8IOagh+ivhuWvueivneWPkeeUn+WcqOWTquS4gOasoeS8muivneS4reOAggogICogQHBhcmFtIHBhcmFtcy5leHRyYV9wYXJhbXMgLSBPcHRpb25hbCBFeHRyYSBwYXJhbWV0ZXJzIGZvciB0aGUgY29udmVyc2F0aW9uLiB8IOmZhOWKoOWPguaVsOOAggogICogQHJldHVybnMgVGhlIGRhdGEgb2YgdGhlIGNyZWF0ZWQgY2hhdC4gfCDliJvlu7rnmoTlr7nor53mlbDmja7jgIIKICAqLwogIGFzeW5jIGNyZWF0ZShwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGlmICghcGFyYW1zLnVzZXJfaWQpIHBhcmFtcy51c2VyX2lkID0gdXVpZCgpOwogICAgY29uc3QgewogICAgICBjb252ZXJzYXRpb25faWQsCiAgICAgIC4uLnJlc3QKICAgIH0gPSBwYXJhbXM7CiAgICBjb25zdCBhcGlVcmwgPSBgL3YzL2NoYXQke2NvbnZlcnNhdGlvbl9pZCA/IGA/Y29udmVyc2F0aW9uX2lkPSR7Y29udmVyc2F0aW9uX2lkfWAgOiAnJ31gOwogICAgY29uc3QgcGF5bG9hZCA9IHsgLi4ucmVzdCwKICAgICAgYWRkaXRpb25hbF9tZXNzYWdlczogaGFuZGxlQWRkaXRpb25hbE1lc3NhZ2VzKHBhcmFtcy5hZGRpdGlvbmFsX21lc3NhZ2VzKSwKICAgICAgc2hvcnRjdXRfY29tbWFuZDogcGFyYW1zLnNob3J0Y3V0X2NvbW1hbmQgPyB7IC4uLnBhcmFtcy5zaG9ydGN1dF9jb21tYW5kLAogICAgICAgIHBhcmFtZXRlcnM6IGhhbmRsZVBhcmFtZXRlcnMocGFyYW1zLnNob3J0Y3V0X2NvbW1hbmQucGFyYW1ldGVycykKICAgICAgfSA6IHZvaWQgMCwKICAgICAgc3RyZWFtOiBmYWxzZQogICAgfTsKICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGF5bG9hZCwgZmFsc2UsIG9wdGlvbnMpOwogICAgcmV0dXJuIHJlc3VsdC5kYXRhOwogIH0KICAvKioKICAqIENhbGwgdGhlIENoYXQgQVBJIHRvIHNlbmQgbWVzc2FnZXMgdG8gYSBwdWJsaXNoZWQgQ296ZSBhZ2VudC4gfCDosIPnlKjmraTmjqXlj6Plj5HotbfkuIDmrKHlr7nor53vvIzmlK/mjIHmt7vliqDkuIrkuIvmlocKICAqIEBkb2NzIGVuOmh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9jaGF0X3YzP19sYW5nPWVuCiAgKiBAZG9jcyB6aDpodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9jaGF0X3YzP19sYW5nPXpoCiAgKiBAcGFyYW0gcGFyYW1zIC0gUmVxdWlyZWQgVGhlIHBhcmFtZXRlcnMgZm9yIGNyZWF0aW5nIGEgY2hhdCBzZXNzaW9uLiB8IOWIm+W7uuS8muivneeahOWPguaVsOOAggogICogQHBhcmFtIHBhcmFtcy5ib3RfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGFnZW50LiB8IOimgei/m+ihjOS8muivneiBiuWkqeeahCBCb3QgSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMudXNlcl9pZCAtIE9wdGlvbmFsIFRoZSBJRCBvZiB0aGUgdXNlciBpbnRlcmFjdGluZyB3aXRoIHRoZSBCb3QuIHwg5qCH6K+G5b2T5YmN5LiOIEJvdCDkuqTkupLnmoTnlKjmiLfjgIIKICAqIEBwYXJhbSBwYXJhbXMuYWRkaXRpb25hbF9tZXNzYWdlcyAtIE9wdGlvbmFsIEFkZGl0aW9uYWwgbWVzc2FnZXMgZm9yIHRoZSBjb252ZXJzYXRpb24uIHwg5a+56K+d55qE6ZmE5Yqg5L+h5oGv44CCCiAgKiBAcGFyYW0gcGFyYW1zLmN1c3RvbV92YXJpYWJsZXMgLSBPcHRpb25hbCBWYXJpYWJsZXMgZGVmaW5lZCBpbiB0aGUgQm90LiB8IEJvdCDkuK3lrprkuYnnmoTlj5jph4/jgIIKICAqIEBwYXJhbSBwYXJhbXMuYXV0b19zYXZlX2hpc3RvcnkgLSBPcHRpb25hbCBXaGV0aGVyIHRvIGF1dG9tYXRpY2FsbHkgc2F2ZSB0aGUgY29udmVyc2F0aW9uIGhpc3RvcnkuIHwg5piv5ZCm6Ieq5Yqo5L+d5a2Y5Y6G5Y+y5a+56K+d6K6w5b2V44CCCiAgKiBAcGFyYW0gcGFyYW1zLm1ldGFfZGF0YSAtIE9wdGlvbmFsIEFkZGl0aW9uYWwgbWV0YWRhdGEgZm9yIHRoZSBtZXNzYWdlLiB8IOWIm+W7uua2iOaBr+aXtueahOmZhOWKoOa2iOaBr+OAggogICogQHBhcmFtIHBhcmFtcy5jb252ZXJzYXRpb25faWQgLSBPcHRpb25hbCBUaGUgSUQgb2YgdGhlIGNvbnZlcnNhdGlvbi4gfCDmoIfor4blr7nor53lj5HnlJ/lnKjlk6rkuIDmrKHkvJror53kuK3jgIIKICAqIEBwYXJhbSBwYXJhbXMuZXh0cmFfcGFyYW1zIC0gT3B0aW9uYWwgRXh0cmEgcGFyYW1ldGVycyBmb3IgdGhlIGNvbnZlcnNhdGlvbi4gfCDpmYTliqDlj4LmlbDjgIIKICAqIEByZXR1cm5zCiAgKi8KCgogIGFzeW5jIGNyZWF0ZUFuZFBvbGwocGFyYW1zLCBvcHRpb25zKSB7CiAgICBpZiAoIXBhcmFtcy51c2VyX2lkKSBwYXJhbXMudXNlcl9pZCA9IHV1aWQoKTsKICAgIGNvbnN0IHsKICAgICAgY29udmVyc2F0aW9uX2lkLAogICAgICAuLi5yZXN0CiAgICB9ID0gcGFyYW1zOwogICAgY29uc3QgYXBpVXJsID0gYC92My9jaGF0JHtjb252ZXJzYXRpb25faWQgPyBgP2NvbnZlcnNhdGlvbl9pZD0ke2NvbnZlcnNhdGlvbl9pZH1gIDogJyd9YDsKICAgIGNvbnN0IHBheWxvYWQgPSB7IC4uLnJlc3QsCiAgICAgIGFkZGl0aW9uYWxfbWVzc2FnZXM6IGhhbmRsZUFkZGl0aW9uYWxNZXNzYWdlcyhwYXJhbXMuYWRkaXRpb25hbF9tZXNzYWdlcyksCiAgICAgIHNob3J0Y3V0X2NvbW1hbmQ6IHBhcmFtcy5zaG9ydGN1dF9jb21tYW5kID8geyAuLi5wYXJhbXMuc2hvcnRjdXRfY29tbWFuZCwKICAgICAgICBwYXJhbWV0ZXJzOiBoYW5kbGVQYXJhbWV0ZXJzKHBhcmFtcy5zaG9ydGN1dF9jb21tYW5kLnBhcmFtZXRlcnMpCiAgICAgIH0gOiB2b2lkIDAsCiAgICAgIHN0cmVhbTogZmFsc2UKICAgIH07CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLl9jbGllbnQucG9zdChhcGlVcmwsIHBheWxvYWQsIGZhbHNlLCBvcHRpb25zKTsKICAgIGNvbnN0IGNoYXRJZCA9IHJlc3VsdC5kYXRhLmlkOwogICAgY29uc3QgY29udmVyc2F0aW9uSWQgPSByZXN1bHQuZGF0YS5jb252ZXJzYXRpb25faWQ7CiAgICBsZXQgY2hhdDsKCiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBhd2FpdCBzbGVlcCgxMDApOwogICAgICBjaGF0ID0gYXdhaXQgdGhpcy5yZXRyaWV2ZShjb252ZXJzYXRpb25JZCwgY2hhdElkKTsKICAgICAgaWYgKCdjb21wbGV0ZWQnID09PSBjaGF0LnN0YXR1cyB8fCAnZmFpbGVkJyA9PT0gY2hhdC5zdGF0dXMgfHwgJ3JlcXVpcmVzX2FjdGlvbicgPT09IGNoYXQuc3RhdHVzKSBicmVhazsKICAgIH0KCiAgICBjb25zdCBtZXNzYWdlTGlzdCA9IGF3YWl0IHRoaXMubWVzc2FnZXMubGlzdChjb252ZXJzYXRpb25JZCwgY2hhdElkKTsKICAgIHJldHVybiB7CiAgICAgIGNoYXQsCiAgICAgIG1lc3NhZ2VzOiBtZXNzYWdlTGlzdAogICAgfTsKICB9CiAgLyoqCiAgKiBDYWxsIHRoZSBDaGF0IEFQSSB0byBzZW5kIG1lc3NhZ2VzIHRvIGEgcHVibGlzaGVkIENvemUgYWdlbnQgd2l0aCBzdHJlYW1pbmcgcmVzcG9uc2UuIHwg6LCD55So5q2k5o6l5Y+j5Y+R6LW35LiA5qyh5a+56K+d77yM5pSv5oyB5rWB5byP5ZON5bqU44CCCiAgKiBAZG9jcyBlbjpodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvY2hhdF92Mz9fbGFuZz1lbgogICogQGRvY3Mgemg6aHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvY2hhdF92Mz9fbGFuZz16aAogICogQHBhcmFtIHBhcmFtcyAtIFJlcXVpcmVkIFRoZSBwYXJhbWV0ZXJzIGZvciBzdHJlYW1pbmcgYSBjaGF0IHNlc3Npb24uIHwg5rWB5byP5Lya6K+d55qE5Y+C5pWw44CCCiAgKiBAcGFyYW0gcGFyYW1zLmJvdF9pZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUgYWdlbnQuIHwg6KaB6L+b6KGM5Lya6K+d6IGK5aSp55qEIEJvdCBJROOAggogICogQHBhcmFtIHBhcmFtcy51c2VyX2lkIC0gT3B0aW9uYWwgVGhlIElEIG9mIHRoZSB1c2VyIGludGVyYWN0aW5nIHdpdGggdGhlIEJvdC4gfCDmoIfor4blvZPliY3kuI4gQm90IOS6pOS6kueahOeUqOaIt+OAggogICogQHBhcmFtIHBhcmFtcy5hZGRpdGlvbmFsX21lc3NhZ2VzIC0gT3B0aW9uYWwgQWRkaXRpb25hbCBtZXNzYWdlcyBmb3IgdGhlIGNvbnZlcnNhdGlvbi4gfCDlr7nor53nmoTpmYTliqDkv6Hmga/jgIIKICAqIEBwYXJhbSBwYXJhbXMuY3VzdG9tX3ZhcmlhYmxlcyAtIE9wdGlvbmFsIFZhcmlhYmxlcyBkZWZpbmVkIGluIHRoZSBCb3QuIHwgQm90IOS4reWumuS5ieeahOWPmOmHj+OAggogICogQHBhcmFtIHBhcmFtcy5hdXRvX3NhdmVfaGlzdG9yeSAtIE9wdGlvbmFsIFdoZXRoZXIgdG8gYXV0b21hdGljYWxseSBzYXZlIHRoZSBjb252ZXJzYXRpb24gaGlzdG9yeS4gfCDmmK/lkKboh6rliqjkv53lrZjljoblj7Llr7nor53orrDlvZXjgIIKICAqIEBwYXJhbSBwYXJhbXMubWV0YV9kYXRhIC0gT3B0aW9uYWwgQWRkaXRpb25hbCBtZXRhZGF0YSBmb3IgdGhlIG1lc3NhZ2UuIHwg5Yib5bu65raI5oGv5pe255qE6ZmE5Yqg5raI5oGv44CCCiAgKiBAcGFyYW0gcGFyYW1zLmNvbnZlcnNhdGlvbl9pZCAtIE9wdGlvbmFsIFRoZSBJRCBvZiB0aGUgY29udmVyc2F0aW9uLiB8IOagh+ivhuWvueivneWPkeeUn+WcqOWTquS4gOasoeS8muivneS4reOAggogICogQHBhcmFtIHBhcmFtcy5leHRyYV9wYXJhbXMgLSBPcHRpb25hbCBFeHRyYSBwYXJhbWV0ZXJzIGZvciB0aGUgY29udmVyc2F0aW9uLiB8IOmZhOWKoOWPguaVsOOAggogICogQHJldHVybnMgQSBzdHJlYW0gb2YgY2hhdCBkYXRhLiB8IOWvueivneaVsOaNrua1geOAggogICovCgoKICBhc3luYyAqc3RyZWFtKHBhcmFtcywgb3B0aW9ucykgewogICAgaWYgKCFwYXJhbXMudXNlcl9pZCkgcGFyYW1zLnVzZXJfaWQgPSB1dWlkKCk7CiAgICBjb25zdCB7CiAgICAgIGNvbnZlcnNhdGlvbl9pZCwKICAgICAgLi4ucmVzdAogICAgfSA9IHBhcmFtczsKICAgIGNvbnN0IGFwaVVybCA9IGAvdjMvY2hhdCR7Y29udmVyc2F0aW9uX2lkID8gYD9jb252ZXJzYXRpb25faWQ9JHtjb252ZXJzYXRpb25faWR9YCA6ICcnfWA7CiAgICBjb25zdCBwYXlsb2FkID0geyAuLi5yZXN0LAogICAgICBhZGRpdGlvbmFsX21lc3NhZ2VzOiBoYW5kbGVBZGRpdGlvbmFsTWVzc2FnZXMocGFyYW1zLmFkZGl0aW9uYWxfbWVzc2FnZXMpLAogICAgICBzaG9ydGN1dF9jb21tYW5kOiBwYXJhbXMuc2hvcnRjdXRfY29tbWFuZCA/IHsgLi4ucGFyYW1zLnNob3J0Y3V0X2NvbW1hbmQsCiAgICAgICAgcGFyYW1ldGVyczogaGFuZGxlUGFyYW1ldGVycyhwYXJhbXMuc2hvcnRjdXRfY29tbWFuZC5wYXJhbWV0ZXJzKQogICAgICB9IDogdm9pZCAwLAogICAgICBzdHJlYW06IHRydWUKICAgIH07CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLl9jbGllbnQucG9zdChhcGlVcmwsIHBheWxvYWQsIHRydWUsIG9wdGlvbnMpOwoKICAgIGZvciBhd2FpdCAoY29uc3QgbWVzc2FnZSBvZiByZXN1bHQpIGlmICgiZG9uZSIgPT09IG1lc3NhZ2UuZXZlbnQpIHsKICAgICAgY29uc3QgcmV0ID0gewogICAgICAgIGV2ZW50OiBtZXNzYWdlLmV2ZW50LAogICAgICAgIGRhdGE6ICdbRE9ORV0nCiAgICAgIH07CiAgICAgIHlpZWxkIHJldDsKICAgIH0gZWxzZSB0cnkgewogICAgICBjb25zdCByZXQgPSB7CiAgICAgICAgZXZlbnQ6IG1lc3NhZ2UuZXZlbnQsCiAgICAgICAgZGF0YTogSlNPTi5wYXJzZShtZXNzYWdlLmRhdGEpCiAgICAgIH07CiAgICAgIHlpZWxkIHJldDsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIHRocm93IG5ldyBDb3plRXJyb3IoYENvdWxkIG5vdCBwYXJzZSBtZXNzYWdlIGludG8gSlNPTjoke21lc3NhZ2UuZGF0YX1gKTsKICAgIH0KICB9CiAgLyoqCiAgKiBHZXQgdGhlIGRldGFpbGVkIGluZm9ybWF0aW9uIG9mIHRoZSBjaGF0LiB8IOafpeeci+WvueivneeahOivpue7huS/oeaBr+OAggogICogQGRvY3MgZW46aHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL3JldHJpZXZlX2NoYXQ/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOmh0dHBzOi8vd3d3LmNvemUuY24vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL3JldHJpZXZlX2NoYXQ/X2xhbmc9emgKICAqIEBwYXJhbSBjb252ZXJzYXRpb25faWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGNvbnZlcnNhdGlvbi4gfCDkvJror50gSUTjgIIKICAqIEBwYXJhbSBjaGF0X2lkIC0gUmVxdWlyZWQgVGhlIElEIG9mIHRoZSBjaGF0LiB8IOWvueivnSBJROOAggogICogQHJldHVybnMgVGhlIGRhdGEgb2YgdGhlIHJldHJpZXZlZCBjaGF0LiB8IOajgOe0ouWIsOeahOWvueivneaVsOaNruOAggogICovCgoKICBhc3luYyByZXRyaWV2ZShjb252ZXJzYXRpb25faWQsIGNoYXRfaWQsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9IGAvdjMvY2hhdC9yZXRyaWV2ZT9jb252ZXJzYXRpb25faWQ9JHtjb252ZXJzYXRpb25faWR9JmNoYXRfaWQ9JHtjaGF0X2lkfWA7CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLl9jbGllbnQucG9zdChhcGlVcmwsIHZvaWQgMCwgZmFsc2UsIG9wdGlvbnMpOwogICAgcmV0dXJuIHJlc3VsdC5kYXRhOwogIH0KICAvKioKICAqIENhbmNlbCBhIGNoYXQgc2Vzc2lvbi4gfCDlj5bmtojlr7nor53kvJror53jgIIKICAqIEBkb2NzIGVuOmh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9jYW5jZWxfY2hhdD9fbGFuZz1lbgogICogQGRvY3Mgemg6aHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvY2FuY2VsX2NoYXQ/X2xhbmc9emgKICAqIEBwYXJhbSBjb252ZXJzYXRpb25faWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGNvbnZlcnNhdGlvbi4gfCDkvJror50gSUTjgIIKICAqIEBwYXJhbSBjaGF0X2lkIC0gUmVxdWlyZWQgVGhlIElEIG9mIHRoZSBjaGF0LiB8IOWvueivnSBJROOAggogICogQHJldHVybnMgVGhlIGRhdGEgb2YgdGhlIGNhbmNlbGVkIGNoYXQuIHwg5Y+W5raI55qE5a+56K+d5pWw5o2u44CCCiAgKi8KCgogIGFzeW5jIGNhbmNlbChjb252ZXJzYXRpb25faWQsIGNoYXRfaWQsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9ICcvdjMvY2hhdC9jYW5jZWwnOwogICAgY29uc3QgcGF5bG9hZCA9IHsKICAgICAgY29udmVyc2F0aW9uX2lkLAogICAgICBjaGF0X2lkCiAgICB9OwogICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCBwYXlsb2FkLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzdWx0LmRhdGE7CiAgfQogIC8qKgogICogU3VibWl0IHRvb2wgb3V0cHV0cyBmb3IgYSBjaGF0IHNlc3Npb24uIHwg5o+Q5Lqk5a+56K+d5Lya6K+d55qE5bel5YW36L6T5Ye644CCCiAgKiBAZG9jcyBlbjpodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvY2hhdF9zdWJtaXRfdG9vbF9vdXRwdXRzP19sYW5nPWVuCiAgKiBAZG9jcyB6aDpodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9jaGF0X3N1Ym1pdF90b29sX291dHB1dHM/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMgLSBSZXF1aXJlZCBQYXJhbWV0ZXJzIGZvciBzdWJtaXR0aW5nIHRvb2wgb3V0cHV0cy4gfCDmj5DkuqTlt6XlhbfovpPlh7rnmoTlj4LmlbDjgIIKICAqIEBwYXJhbSBwYXJhbXMuY29udmVyc2F0aW9uX2lkIC0gUmVxdWlyZWQgVGhlIElEIG9mIHRoZSBjb252ZXJzYXRpb24uIHwg5Lya6K+dIElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLmNoYXRfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGNoYXQuIHwg5a+56K+dIElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLnRvb2xfb3V0cHV0cyAtIFJlcXVpcmVkIFRoZSBvdXRwdXRzIG9mIHRoZSB0b29sLiB8IOW3peWFt+eahOi+k+WHuuOAggogICogQHBhcmFtIHBhcmFtcy5zdHJlYW0gLSBPcHRpb25hbCBXaGV0aGVyIHRvIHVzZSBzdHJlYW1pbmcgcmVzcG9uc2UuIHwg5piv5ZCm5L2/55So5rWB5byP5ZON5bqU44CCCiAgKiBAcmV0dXJucyBUaGUgZGF0YSBvZiB0aGUgc3VibWl0dGVkIHRvb2wgb3V0cHV0cyBvciBhIHN0cmVhbSBvZiBjaGF0IGRhdGEuIHwg5o+Q5Lqk55qE5bel5YW36L6T5Ye65pWw5o2u5oiW5a+56K+d5pWw5o2u5rWB44CCCiAgKi8KCgogIGFzeW5jICpzdWJtaXRUb29sT3V0cHV0cyhwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGNvbnN0IHsKICAgICAgY29udmVyc2F0aW9uX2lkLAogICAgICBjaGF0X2lkLAogICAgICAuLi5yZXN0CiAgICB9ID0gcGFyYW1zOwogICAgY29uc3QgYXBpVXJsID0gYC92My9jaGF0L3N1Ym1pdF90b29sX291dHB1dHM/Y29udmVyc2F0aW9uX2lkPSR7cGFyYW1zLmNvbnZlcnNhdGlvbl9pZH0mY2hhdF9pZD0ke3BhcmFtcy5jaGF0X2lkfWA7CiAgICBjb25zdCBwYXlsb2FkID0geyAuLi5yZXN0CiAgICB9OwoKICAgIGlmIChmYWxzZSA9PT0gcGFyYW1zLnN0cmVhbSkgewogICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGF5bG9hZCwgZmFsc2UsIG9wdGlvbnMpOwogICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgIH0KCiAgICB7CiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGF5bG9hZCwgdHJ1ZSwgb3B0aW9ucyk7CgogICAgICBmb3IgYXdhaXQgKGNvbnN0IG1lc3NhZ2Ugb2YgcmVzdWx0KSBpZiAoImRvbmUiID09PSBtZXNzYWdlLmV2ZW50KSB7CiAgICAgICAgY29uc3QgcmV0ID0gewogICAgICAgICAgZXZlbnQ6IG1lc3NhZ2UuZXZlbnQsCiAgICAgICAgICBkYXRhOiAnW0RPTkVdJwogICAgICAgIH07CiAgICAgICAgeWllbGQgcmV0OwogICAgICB9IGVsc2UgdHJ5IHsKICAgICAgICBjb25zdCByZXQgPSB7CiAgICAgICAgICBldmVudDogbWVzc2FnZS5ldmVudCwKICAgICAgICAgIGRhdGE6IEpTT04ucGFyc2UobWVzc2FnZS5kYXRhKQogICAgICAgIH07CiAgICAgICAgeWllbGQgcmV0OwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIHRocm93IG5ldyBDb3plRXJyb3IoYENvdWxkIG5vdCBwYXJzZSBtZXNzYWdlIGludG8gSlNPTjoke21lc3NhZ2UuZGF0YX1gKTsKICAgICAgfQogICAgfQogIH0KCiAgY29uc3RydWN0b3IoLi4uYXJncykgewogICAgc3VwZXIoLi4uYXJncyksIHRoaXMubWVzc2FnZXMgPSBuZXcgTWVzc2FnZXModGhpcy5fY2xpZW50KTsKICB9Cgp9Cgp2YXIgY2hhdF9DaGF0U3RhdHVzID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChDaGF0U3RhdHVzKSB7CiAgQ2hhdFN0YXR1c1siQ1JFQVRFRCJdID0gImNyZWF0ZWQiOwogIENoYXRTdGF0dXNbIklOX1BST0dSRVNTIl0gPSAiaW5fcHJvZ3Jlc3MiOwogIENoYXRTdGF0dXNbIkNPTVBMRVRFRCJdID0gImNvbXBsZXRlZCI7CiAgQ2hhdFN0YXR1c1siRkFJTEVEIl0gPSAiZmFpbGVkIjsKICBDaGF0U3RhdHVzWyJSRVFVSVJFU19BQ1RJT04iXSA9ICJyZXF1aXJlc19hY3Rpb24iOwogIENoYXRTdGF0dXNbIkNBTkNFTEVEIl0gPSAiY2FuY2VsZWQiOwogIHJldHVybiBDaGF0U3RhdHVzOwp9KHt9KTsKCnZhciBjaGF0X0NoYXRFdmVudFR5cGUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKENoYXRFdmVudFR5cGUpIHsKICBDaGF0RXZlbnRUeXBlWyJDT05WRVJTQVRJT05fQ0hBVF9DUkVBVEVEIl0gPSAiY29udmVyc2F0aW9uLmNoYXQuY3JlYXRlZCI7CiAgQ2hhdEV2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX0NIQVRfSU5fUFJPR1JFU1MiXSA9ICJjb252ZXJzYXRpb24uY2hhdC5pbl9wcm9ncmVzcyI7CiAgQ2hhdEV2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX0NIQVRfQ09NUExFVEVEIl0gPSAiY29udmVyc2F0aW9uLmNoYXQuY29tcGxldGVkIjsKICBDaGF0RXZlbnRUeXBlWyJDT05WRVJTQVRJT05fQ0hBVF9GQUlMRUQiXSA9ICJjb252ZXJzYXRpb24uY2hhdC5mYWlsZWQiOwogIENoYXRFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9DSEFUX1JFUVVJUkVTX0FDVElPTiJdID0gImNvbnZlcnNhdGlvbi5jaGF0LnJlcXVpcmVzX2FjdGlvbiI7CiAgQ2hhdEV2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX01FU1NBR0VfREVMVEEiXSA9ICJjb252ZXJzYXRpb24ubWVzc2FnZS5kZWx0YSI7CiAgQ2hhdEV2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX01FU1NBR0VfQ09NUExFVEVEIl0gPSAiY29udmVyc2F0aW9uLm1lc3NhZ2UuY29tcGxldGVkIjsKICBDaGF0RXZlbnRUeXBlWyJDT05WRVJTQVRJT05fQVVESU9fREVMVEEiXSA9ICJjb252ZXJzYXRpb24uYXVkaW8uZGVsdGEiOwogIENoYXRFdmVudFR5cGVbIkRPTkUiXSA9ICJkb25lIjsKICBDaGF0RXZlbnRUeXBlWyJFUlJPUiJdID0gImVycm9yIjsKICByZXR1cm4gQ2hhdEV2ZW50VHlwZTsKfSh7fSk7Cgp2YXIgY2hhdF9Sb2xlVHlwZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoUm9sZVR5cGUpIHsKICBSb2xlVHlwZVsiVXNlciJdID0gInVzZXIiOwogIFJvbGVUeXBlWyJBc3Npc3RhbnQiXSA9ICJhc3Npc3RhbnQiOwogIHJldHVybiBSb2xlVHlwZTsKfSh7fSk7CgpjbGFzcyBtZXNzYWdlc19NZXNzYWdlcyBleHRlbmRzIEFQSVJlc291cmNlIHsKICAvKioKICAqIENyZWF0ZSBhIG1lc3NhZ2UgYW5kIGFkZCBpdCB0byB0aGUgc3BlY2lmaWVkIGNvbnZlcnNhdGlvbi4gfCDliJvlu7rkuIDmnaHmtojmga/vvIzlubblsIblhbbmt7vliqDliLDmjIflrprnmoTkvJror53kuK3jgIIKICAqIEBkb2NzIGVuOiBodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvY3JlYXRlX21lc3NhZ2U/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9jcmVhdGVfbWVzc2FnZT9fbGFuZz16aAogICogQHBhcmFtIGNvbnZlcnNhdGlvbl9pZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUgY29udmVyc2F0aW9uLiB8IENvbnZlcnNhdGlvbiBJRO+8jOWNs+S8muivneeahOWUr+S4gOagh+ivhuOAggogICogQHBhcmFtIHBhcmFtcyAtIFJlcXVpcmVkIFRoZSBwYXJhbWV0ZXJzIGZvciBjcmVhdGluZyBhIG1lc3NhZ2UgfCDliJvlu7rmtojmga/miYDpnIDnmoTlj4LmlbAKICAqIEBwYXJhbSBwYXJhbXMucm9sZSAtIFJlcXVpcmVkIFRoZSBlbnRpdHkgdGhhdCBzZW50IHRoaXMgbWVzc2FnZS4gUG9zc2libGUgdmFsdWVzOiB1c2VyLCBhc3Npc3RhbnQuIHwg5Y+R6YCB6L+Z5p2h5raI5oGv55qE5a6e5L2T44CC5Y+W5YC877yadXNlciwgYXNzaXN0YW5044CCCiAgKiBAcGFyYW0gcGFyYW1zLmNvbnRlbnQgLSBSZXF1aXJlZCBUaGUgY29udGVudCBvZiB0aGUgbWVzc2FnZS4gfCDmtojmga/nmoTlhoXlrrnjgIIKICAqIEBwYXJhbSBwYXJhbXMuY29udGVudF90eXBlIC0gUmVxdWlyZWQgVGhlIHR5cGUgb2YgdGhlIG1lc3NhZ2UgY29udGVudC4gfCDmtojmga/lhoXlrrnnmoTnsbvlnovjgIIKICAqIEBwYXJhbSBwYXJhbXMubWV0YV9kYXRhIC0gT3B0aW9uYWwgQWRkaXRpb25hbCBpbmZvcm1hdGlvbiB3aGVuIGNyZWF0aW5nIGEgbWVzc2FnZS4gfCDliJvlu7rmtojmga/ml7bnmoTpmYTliqDmtojmga/jgIIKICAqIEByZXR1cm5zIEluZm9ybWF0aW9uIGFib3V0IHRoZSBuZXcgbWVzc2FnZS4gfCDmtojmga/or6bmg4XjgIIKICAqLwogIGFzeW5jIGNyZWF0ZShjb252ZXJzYXRpb25faWQsIHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gYC92MS9jb252ZXJzYXRpb24vbWVzc2FnZS9jcmVhdGU/Y29udmVyc2F0aW9uX2lkPSR7Y29udmVyc2F0aW9uX2lkfWA7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICB9CiAgLyoqCiAgKiBNb2RpZnkgYSBtZXNzYWdlLCBzdXBwb3J0aW5nIHRoZSBtb2RpZmljYXRpb24gb2YgbWVzc2FnZSBjb250ZW50LCBhZGRpdGlvbmFsIGNvbnRlbnQsIGFuZCBtZXNzYWdlIHR5cGUuIHwg5L+u5pS55LiA5p2h5raI5oGv77yM5pSv5oyB5L+u5pS55raI5oGv5YaF5a6544CB6ZmE5Yqg5YaF5a655ZKM5raI5oGv57G75Z6L44CCCiAgKiBAZG9jcyBlbjogaHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL21vZGlmeV9tZXNzYWdlP19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvbW9kaWZ5X21lc3NhZ2U/X2xhbmc9emgKICAqIEBwYXJhbSBjb252ZXJzYXRpb25faWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGNvbnZlcnNhdGlvbi4gfCBDb252ZXJzYXRpb24gSUTvvIzljbPkvJror53nmoTllK/kuIDmoIfor4bjgIIKICAqIEBwYXJhbSBtZXNzYWdlX2lkIC0gUmVxdWlyZWQgVGhlIElEIG9mIHRoZSBtZXNzYWdlLiB8IE1lc3NhZ2UgSUTvvIzljbPmtojmga/nmoTllK/kuIDmoIfor4bjgIIKICAqIEBwYXJhbSBwYXJhbXMgLSBSZXF1aXJlZCBUaGUgcGFyYW1ldGVycyBmb3IgbW9kaWZ5aW5nIGEgbWVzc2FnZSB8IOS/ruaUuea2iOaBr+aJgOmcgOeahOWPguaVsAogICogQHBhcmFtIHBhcmFtcy5tZXRhX2RhdGEgLSBPcHRpb25hbCBBZGRpdGlvbmFsIGluZm9ybWF0aW9uIHdoZW4gbW9kaWZ5aW5nIGEgbWVzc2FnZS4gfCDkv67mlLnmtojmga/ml7bnmoTpmYTliqDmtojmga/jgIIKICAqIEBwYXJhbSBwYXJhbXMuY29udGVudCAtIE9wdGlvbmFsIFRoZSBjb250ZW50IG9mIHRoZSBtZXNzYWdlLiB8IOa2iOaBr+eahOWGheWuueOAggogICogQHBhcmFtIHBhcmFtcy5jb250ZW50X3R5cGUgLSBPcHRpb25hbCBUaGUgdHlwZSBvZiB0aGUgbWVzc2FnZSBjb250ZW50LiB8IOa2iOaBr+WGheWuueeahOexu+Wei+OAggogICogQHJldHVybnMgSW5mb3JtYXRpb24gYWJvdXQgdGhlIG1vZGlmaWVkIG1lc3NhZ2UuIHwg5raI5oGv6K+m5oOF44CCCiAgKi8KICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtcwoKCiAgYXN5bmMgdXBkYXRlKGNvbnZlcnNhdGlvbl9pZCwgbWVzc2FnZV9pZCwgcGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSBgL3YxL2NvbnZlcnNhdGlvbi9tZXNzYWdlL21vZGlmeT9jb252ZXJzYXRpb25faWQ9JHtjb252ZXJzYXRpb25faWR9Jm1lc3NhZ2VfaWQ9JHttZXNzYWdlX2lkfWA7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2UubWVzc2FnZTsKICB9CiAgLyoqCiAgKiBHZXQgdGhlIGRldGFpbGVkIGluZm9ybWF0aW9uIG9mIHNwZWNpZmllZCBtZXNzYWdlLiB8IOafpeeci+aMh+Wumua2iOaBr+eahOivpue7huS/oeaBr+OAggogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9yZXRyaWV2ZV9tZXNzYWdlP19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvcmV0cmlldmVfbWVzc2FnZT9fbGFuZz16aAogICogQHBhcmFtIGNvbnZlcnNhdGlvbl9pZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUgY29udmVyc2F0aW9uLiB8IENvbnZlcnNhdGlvbiBJRO+8jOWNs+S8muivneeahOWUr+S4gOagh+ivhuOAggogICogQHBhcmFtIG1lc3NhZ2VfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIG1lc3NhZ2UuIHwgTWVzc2FnZSBJRO+8jOWNs+a2iOaBr+eahOWUr+S4gOagh+ivhuOAggogICogQHJldHVybnMgSW5mb3JtYXRpb24gYWJvdXQgdGhlIG1lc3NhZ2UuIHwg5raI5oGv6K+m5oOF44CCCiAgKi8KCgogIGFzeW5jIHJldHJpZXZlKGNvbnZlcnNhdGlvbl9pZCwgbWVzc2FnZV9pZCwgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gYC92MS9jb252ZXJzYXRpb24vbWVzc2FnZS9yZXRyaWV2ZT9jb252ZXJzYXRpb25faWQ9JHtjb252ZXJzYXRpb25faWR9Jm1lc3NhZ2VfaWQ9JHttZXNzYWdlX2lkfWA7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5nZXQoYXBpVXJsLCBudWxsLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICB9CiAgLyoqCiAgKiBMaXN0IG1lc3NhZ2VzIGluIGEgY29udmVyc2F0aW9uLiB8IOWIl+WHuuS8muivneS4reeahOa2iOaBr+OAggogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9tZXNzYWdlX2xpc3Q/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9tZXNzYWdlX2xpc3Q/X2xhbmc9emgKICAqIEBwYXJhbSBjb252ZXJzYXRpb25faWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGNvbnZlcnNhdGlvbi4gfCBDb252ZXJzYXRpb24gSUTvvIzljbPkvJror53nmoTllK/kuIDmoIfor4bjgIIKICAqIEBwYXJhbSBwYXJhbXMgLSBPcHRpb25hbCBUaGUgcGFyYW1ldGVycyBmb3IgbGlzdGluZyBtZXNzYWdlcyB8IOWIl+WHuua2iOaBr+aJgOmcgOeahOWPguaVsAogICogQHBhcmFtIHBhcmFtcy5vcmRlciAtIE9wdGlvbmFsIFRoZSBvcmRlciBvZiB0aGUgbWVzc2FnZXMuIHwg5raI5oGv55qE6aG65bqP44CCCiAgKiBAcGFyYW0gcGFyYW1zLmNoYXRfaWQgLSBPcHRpb25hbCBUaGUgSUQgb2YgdGhlIGNoYXQuIHwg6IGK5aSpIElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLmJlZm9yZV9pZCAtIE9wdGlvbmFsIFRoZSBJRCBvZiB0aGUgbWVzc2FnZSBiZWZvcmUgd2hpY2ggdG8gbGlzdC4gfCDliJflh7rmraTmtojmga/kuYvliY3nmoTmtojmga8gSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMuYWZ0ZXJfaWQgLSBPcHRpb25hbCBUaGUgSUQgb2YgdGhlIG1lc3NhZ2UgYWZ0ZXIgd2hpY2ggdG8gbGlzdC4gfCDliJflh7rmraTmtojmga/kuYvlkI7nmoTmtojmga8gSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMubGltaXQgLSBPcHRpb25hbCBUaGUgbWF4aW11bSBudW1iZXIgb2YgbWVzc2FnZXMgdG8gcmV0dXJuLiB8IOi/lOWbnueahOacgOWkp+a2iOaBr+aVsOOAggogICogQHJldHVybnMgQSBsaXN0IG9mIG1lc3NhZ2VzLiB8IOa2iOaBr+WIl+ihqOOAggogICovCgoKICBhc3luYyBsaXN0KGNvbnZlcnNhdGlvbl9pZCwgcGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSBgL3YxL2NvbnZlcnNhdGlvbi9tZXNzYWdlL2xpc3Q/Y29udmVyc2F0aW9uX2lkPSR7Y29udmVyc2F0aW9uX2lkfWA7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2U7CiAgfQogIC8qKgogICogQ2FsbCB0aGUgQVBJIHRvIGRlbGV0ZSBhIG1lc3NhZ2Ugd2l0aGluIGEgc3BlY2lmaWVkIGNvbnZlcnNhdGlvbi4gfCDosIPnlKjmjqXlj6PlnKjmjIflrprkvJror53kuK3liKDpmaTmtojmga/jgIIKICAqIEBkb2NzIGVuOiBodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvZGVsZXRlX21lc3NhZ2U/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9kZWxldGVfbWVzc2FnZT9fbGFuZz16aAogICogQHBhcmFtIGNvbnZlcnNhdGlvbl9pZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUgY29udmVyc2F0aW9uLiB8IENvbnZlcnNhdGlvbiBJRO+8jOWNs+S8muivneeahOWUr+S4gOagh+ivhuOAggogICogQHBhcmFtIG1lc3NhZ2VfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIG1lc3NhZ2UuIHwgTWVzc2FnZSBJRO+8jOWNs+a2iOaBr+eahOWUr+S4gOagh+ivhuOAggogICogQHJldHVybnMgRGV0YWlscyBvZiB0aGUgZGVsZXRlZCBtZXNzYWdlLiB8IOW3suWIoOmZpOeahOa2iOaBr+ivpuaDheOAggogICovCgoKICBhc3luYyBkZWxldGUoY29udmVyc2F0aW9uX2lkLCBtZXNzYWdlX2lkLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSBgL3YxL2NvbnZlcnNhdGlvbi9tZXNzYWdlL2RlbGV0ZT9jb252ZXJzYXRpb25faWQ9JHtjb252ZXJzYXRpb25faWR9Jm1lc3NhZ2VfaWQ9JHttZXNzYWdlX2lkfWA7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgdm9pZCAwLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICB9Cgp9CgpjbGFzcyBDb252ZXJzYXRpb25zIGV4dGVuZHMgQVBJUmVzb3VyY2UgewogIC8qKgogICogQ3JlYXRlIGEgY29udmVyc2F0aW9uLiBDb252ZXJzYXRpb24gaXMgYW4gaW50ZXJhY3Rpb24gYmV0d2VlbiBhbiBhZ2VudCBhbmQgYSB1c2VyLCBpbmNsdWRpbmcgb25lIG9yIG1vcmUgbWVzc2FnZXMuIHwg6LCD55So5o6l5Y+j5Yib5bu65LiA5Liq5Lya6K+d44CCCiAgKiBAZG9jcyBlbjogaHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2NyZWF0ZV9jb252ZXJzYXRpb24/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9jcmVhdGVfY29udmVyc2F0aW9uP19sYW5nPXpoCiAgKiBAcGFyYW0gcGFyYW1zIC0gUmVxdWlyZWQgVGhlIHBhcmFtZXRlcnMgZm9yIGNyZWF0aW5nIGEgY29udmVyc2F0aW9uIHwg5Yib5bu65Lya6K+d5omA6ZyA55qE5Y+C5pWwCiAgKiBAcGFyYW0gcGFyYW1zLm1lc3NhZ2VzIC0gT3B0aW9uYWwgTWVzc2FnZXMgaW4gdGhlIGNvbnZlcnNhdGlvbi4gfCDkvJror53kuK3nmoTmtojmga/lhoXlrrnjgIIKICAqIEBwYXJhbSBwYXJhbXMubWV0YV9kYXRhIC0gT3B0aW9uYWwgQWRkaXRpb25hbCBpbmZvcm1hdGlvbiB3aGVuIGNyZWF0aW5nIGEgbWVzc2FnZS4gfCDliJvlu7rmtojmga/ml7bnmoTpmYTliqDmtojmga/jgIIKICAqIEBwYXJhbSBwYXJhbXMuYm90X2lkIC0gT3B0aW9uYWwgQmluZCBhbmQgaXNvbGF0ZSBjb252ZXJzYXRpb24gb24gZGlmZmVyZW50IGJvdHMuIHwg57uR5a6a5ZKM6ZqU56a75LiN5ZCMQm9055qE5Lya6K+d44CCCiAgKiBAcmV0dXJucyBJbmZvcm1hdGlvbiBhYm91dCB0aGUgY3JlYXRlZCBjb252ZXJzYXRpb24uIHwg5Lya6K+d55qE5Z+656GA5L+h5oGv44CCCiAgKi8KICBhc3luYyBjcmVhdGUocGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL3YxL2NvbnZlcnNhdGlvbi9jcmVhdGUnOwogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLl9jbGllbnQucG9zdChhcGlVcmwsIHBhcmFtcywgZmFsc2UsIG9wdGlvbnMpOwogICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgfQogIC8qKgogICogR2V0IHRoZSBpbmZvcm1hdGlvbiBvZiBzcGVjaWZpYyBjb252ZXJzYXRpb24uIHwg6YCa6L+H5Lya6K+dIElEIOafpeeci+S8muivneS/oeaBr+OAggogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9yZXRyaWV2ZV9jb252ZXJzYXRpb24/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9yZXRyaWV2ZV9jb252ZXJzYXRpb24/X2xhbmc9emgKICAqIEBwYXJhbSBjb252ZXJzYXRpb25faWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGNvbnZlcnNhdGlvbi4gfCBDb252ZXJzYXRpb24gSUTvvIzljbPkvJror53nmoTllK/kuIDmoIfor4bjgIIKICAqIEByZXR1cm5zIEluZm9ybWF0aW9uIGFib3V0IHRoZSBjb252ZXJzYXRpb24uIHwg5Lya6K+d55qE5Z+656GA5L+h5oGv44CCCiAgKi8KCgogIGFzeW5jIHJldHJpZXZlKGNvbnZlcnNhdGlvbl9pZCwgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gYC92MS9jb252ZXJzYXRpb24vcmV0cmlldmU/Y29udmVyc2F0aW9uX2lkPSR7Y29udmVyc2F0aW9uX2lkfWA7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5nZXQoYXBpVXJsLCBudWxsLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICB9CiAgLyoqCiAgKiBMaXN0IGFsbCBjb252ZXJzYXRpb25zLiB8IOWIl+WHuiBCb3Qg5LiL5omA5pyJ5Lya6K+d44CCCiAgKiBAcGFyYW0gcGFyYW1zCiAgKiBAcGFyYW0gcGFyYW1zLmJvdF9pZCAtIFJlcXVpcmVkIEJvdCBJRC4gfCBCb3QgSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMucGFnZV9udW0gLSBPcHRpb25hbCBUaGUgcGFnZSBudW1iZXIuIHwg6aG156CB77yM6buY6K6k5YC85Li6IDHjgIIKICAqIEBwYXJhbSBwYXJhbXMucGFnZV9zaXplIC0gT3B0aW9uYWwgVGhlIG51bWJlciBvZiBjb252ZXJzYXRpb25zIHBlciBwYWdlLiB8IOavj+mhteeahOS8muivneaVsOmHj++8jOm7mOiupOWAvOS4uiA1MOOAggogICogQHJldHVybnMgSW5mb3JtYXRpb24gYWJvdXQgdGhlIGNvbnZlcnNhdGlvbnMuIHwg5Lya6K+d55qE5L+h5oGv44CCCiAgKi8KCgogIGFzeW5jIGxpc3QocGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL3YxL2NvbnZlcnNhdGlvbnMnOwogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLl9jbGllbnQuZ2V0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICB9CiAgLyoqCiAgKiBDbGVhciBhIGNvbnZlcnNhdGlvbi4gfCDmuIXnqbrkvJror53jgIIKICAqIEBwYXJhbSBjb252ZXJzYXRpb25faWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGNvbnZlcnNhdGlvbi4gfCBDb252ZXJzYXRpb24gSUTvvIzljbPkvJror53nmoTllK/kuIDmoIfor4bjgIIKICAqIEByZXR1cm5zIEluZm9ybWF0aW9uIGFib3V0IHRoZSBjb252ZXJzYXRpb24gc2Vzc2lvbi4gfCDkvJror53nmoTkvJror50gSUTjgIIKICAqLwoKCiAgYXN5bmMgY2xlYXIoY29udmVyc2F0aW9uX2lkLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSBgL3YxL2NvbnZlcnNhdGlvbnMvJHtjb252ZXJzYXRpb25faWR9L2NsZWFyYDsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCBudWxsLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICB9CgogIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHsKICAgIHN1cGVyKC4uLmFyZ3MpLCB0aGlzLm1lc3NhZ2VzID0gbmV3IG1lc3NhZ2VzX01lc3NhZ2VzKHRoaXMuX2NsaWVudCk7CiAgfQoKfQoKY29uc3QgZXh0ZXJuYWxfYXhpb3NfbmFtZXNwYWNlT2JqZWN0ID0gcmVxdWlyZSgiYXhpb3MiKTsKCnZhciBleHRlcm5hbF9heGlvc19kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihleHRlcm5hbF9heGlvc19uYW1lc3BhY2VPYmplY3QpOwoKY2xhc3MgRmlsZXMgZXh0ZW5kcyBBUElSZXNvdXJjZSB7CiAgLyoqCiAgKiBVcGxvYWQgZmlsZXMgdG8gQ296ZSBwbGF0Zm9ybS4gfCDosIPnlKjmjqXlj6PkuIrkvKDmlofku7bliLDmiaPlrZDjgIIKICAqIEBkb2NzIGVuOiBodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvdXBsb2FkX2ZpbGVzP19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvdXBsb2FkX2ZpbGVzP19sYW5nPXpoCiAgKiBAcGFyYW0gcGFyYW1zIC0gUmVxdWlyZWQgVGhlIHBhcmFtZXRlcnMgZm9yIGZpbGUgdXBsb2FkIHwg5LiK5Lyg5paH5Lu25omA6ZyA55qE5Y+C5pWwCiAgKiBAcGFyYW0gcGFyYW1zLmZpbGUgLSBSZXF1aXJlZCBUaGUgZmlsZSB0byBiZSB1cGxvYWRlZC4gfCDpnIDopoHkuIrkvKDnmoTmlofku7bjgIIKICAqIEByZXR1cm5zIEluZm9ybWF0aW9uIGFib3V0IHRoZSBuZXcgZmlsZS4gfCDlt7LkuIrkvKDnmoTmlofku7bkv6Hmga/jgIIKICAqLwogIGFzeW5jIHVwbG9hZChwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9ICcvdjEvZmlsZXMvdXBsb2FkJzsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCAoMCwgZXh0ZXJuYWxfYXhpb3NfbmFtZXNwYWNlT2JqZWN0LnRvRm9ybURhdGEpKHBhcmFtcyksIGZhbHNlLCBvcHRpb25zKTsKICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogIH0KICAvKioKICAqIEdldCB0aGUgaW5mb3JtYXRpb24gb2YgdGhlIHNwZWNpZmljIGZpbGUgdXBsb2FkZWQgdG8gQ296ZSBwbGF0Zm9ybS4gfCDmn6XnnIvlt7LkuIrkvKDnmoTmlofku7bor6bmg4XjgIIKICAqIEBkb2NzIGVuOiBodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvcmV0cmlldmVfZmlsZXM/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9yZXRyaWV2ZV9maWxlcz9fbGFuZz16aAogICogQHBhcmFtIGZpbGVfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIHVwbG9hZGVkIGZpbGUuIHwg5bey5LiK5Lyg55qE5paH5Lu2IElE44CCCiAgKiBAcmV0dXJucyBJbmZvcm1hdGlvbiBhYm91dCB0aGUgdXBsb2FkZWQgZmlsZS4gfCDlt7LkuIrkvKDnmoTmlofku7bkv6Hmga/jgIIKICAqLwoKCiAgYXN5bmMgcmV0cmlldmUoZmlsZV9pZCwgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gYC92MS9maWxlcy9yZXRyaWV2ZT9maWxlX2lkPSR7ZmlsZV9pZH1gOwogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLl9jbGllbnQuZ2V0KGFwaVVybCwgbnVsbCwgZmFsc2UsIG9wdGlvbnMpOwogICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgfQoKfQoKY2xhc3MgUnVucyBleHRlbmRzIEFQSVJlc291cmNlIHsKICAvKioKICAqIEluaXRpYXRlcyBhIHdvcmtmbG93IHJ1bi4gfCDlkK/liqjlt6XkvZzmtYHov5DooYzjgIIKICAqIEBkb2NzIGVuOiBodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvd29ya2Zsb3dfcnVuP19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvd29ya2Zsb3dfcnVuP19sYW5nPXpoCiAgKiBAcGFyYW0gcGFyYW1zLndvcmtmbG93X2lkIC0gUmVxdWlyZWQgVGhlIElEIG9mIHRoZSB3b3JrZmxvdyB0byBydW4uIHwg5b+F6YCJIOimgei/kOihjOeahOW3peS9nOa1gSBJROOAggogICogQHBhcmFtIHBhcmFtcy5ib3RfaWQgLSBPcHRpb25hbCBUaGUgSUQgb2YgdGhlIGJvdCBhc3NvY2lhdGVkIHdpdGggdGhlIHdvcmtmbG93LiB8IOWPr+mAiSDkuI7lt6XkvZzmtYHlhbPogZTnmoTmnLrlmajkurogSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMucGFyYW1ldGVycyAtIE9wdGlvbmFsIFBhcmFtZXRlcnMgZm9yIHRoZSB3b3JrZmxvdyBleGVjdXRpb24uIHwg5Y+v6YCJIOW3peS9nOa1geaJp+ihjOeahOWPguaVsOOAggogICogQHBhcmFtIHBhcmFtcy5leHQgLSBPcHRpb25hbCBBZGRpdGlvbmFsIGluZm9ybWF0aW9uIGZvciB0aGUgd29ya2Zsb3cgZXhlY3V0aW9uLiB8IOWPr+mAiSDlt6XkvZzmtYHmiafooYznmoTpmYTliqDkv6Hmga/jgIIKICAqIEBwYXJhbSBwYXJhbXMuZXhlY3V0ZV9tb2RlIC0gT3B0aW9uYWwgVGhlIG1vZGUgaW4gd2hpY2ggdG8gZXhlY3V0ZSB0aGUgd29ya2Zsb3cuIHwg5Y+v6YCJIOW3peS9nOa1geaJp+ihjOeahOaooeW8j+OAggogICogQHBhcmFtIHBhcmFtcy5jb25uZWN0b3JfaWQgLSBPcHRpb25hbCBUaGUgSUQgb2YgdGhlIGNvbm5lY3RvciB0byB1c2UgZm9yIHRoZSB3b3JrZmxvdy4gfCDlj6/pgIkg55So5LqO5bel5L2c5rWB55qE6L+e5o6l5ZmoIElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLmFwcF9pZCAtIE9wdGlvbmFsIFRoZSBJRCBvZiB0aGUgYXBwLiAgfCDlj6/pgIkg6KaB6L+b6KGM5Lya6K+d6IGK5aSp55qEIEFwcCBJRAogICogQHJldHVybnMgUnVuV29ya2Zsb3dEYXRhIHwg5bel5L2c5rWB6L+Q6KGM5pWw5o2uCiAgKi8KICBhc3luYyBjcmVhdGUocGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL3YxL3dvcmtmbG93L3J1bic7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2U7CiAgfQogIC8qKgogICogU3RyZWFtcyB0aGUgd29ya2Zsb3cgcnVuIGV2ZW50cy4gfCDmtYHlvI/kvKDovpPlt6XkvZzmtYHov5DooYzkuovku7bjgIIKICAqIEBkb2NzIGVuOiBodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvd29ya2Zsb3dfc3RyZWFtX3J1bj9fbGFuZz1lbgogICogQGRvY3Mgemg6IGh0dHBzOi8vd3d3LmNvemUuY24vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL3dvcmtmbG93X3N0cmVhbV9ydW4/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMud29ya2Zsb3dfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIHdvcmtmbG93IHRvIHJ1bi4gfCDlv4XpgIkg6KaB6L+Q6KGM55qE5bel5L2c5rWBIElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLmJvdF9pZCAtIE9wdGlvbmFsIFRoZSBJRCBvZiB0aGUgYm90IGFzc29jaWF0ZWQgd2l0aCB0aGUgd29ya2Zsb3cuIHwg5Y+v6YCJIOS4juW3peS9nOa1geWFs+iBlOeahOacuuWZqOS6uiBJROOAggogICogQHBhcmFtIHBhcmFtcy5wYXJhbWV0ZXJzIC0gT3B0aW9uYWwgUGFyYW1ldGVycyBmb3IgdGhlIHdvcmtmbG93IGV4ZWN1dGlvbi4gfCDlj6/pgIkg5bel5L2c5rWB5omn6KGM55qE5Y+C5pWw44CCCiAgKiBAcGFyYW0gcGFyYW1zLmV4dCAtIE9wdGlvbmFsIEFkZGl0aW9uYWwgaW5mb3JtYXRpb24gZm9yIHRoZSB3b3JrZmxvdyBleGVjdXRpb24uIHwg5Y+v6YCJIOW3peS9nOa1geaJp+ihjOeahOmZhOWKoOS/oeaBr+OAggogICogQHBhcmFtIHBhcmFtcy5leGVjdXRlX21vZGUgLSBPcHRpb25hbCBUaGUgbW9kZSBpbiB3aGljaCB0byBleGVjdXRlIHRoZSB3b3JrZmxvdy4gfCDlj6/pgIkg5bel5L2c5rWB5omn6KGM55qE5qih5byP44CCCiAgKiBAcGFyYW0gcGFyYW1zLmNvbm5lY3Rvcl9pZCAtIE9wdGlvbmFsIFRoZSBJRCBvZiB0aGUgY29ubmVjdG9yIHRvIHVzZSBmb3IgdGhlIHdvcmtmbG93LiB8IOWPr+mAiSDnlKjkuo7lt6XkvZzmtYHnmoTov57mjqXlmaggSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMuYXBwX2lkIC0gT3B0aW9uYWwgVGhlIElEIG9mIHRoZSBhcHAuICB8IOWPr+mAiSDopoHov5vooYzkvJror53ogYrlpKnnmoQgQXBwIElECiAgKiBAcmV0dXJucyBTdHJlYW08V29ya2Zsb3dFdmVudCwgeyBpZDogc3RyaW5nOyBldmVudDogc3RyaW5nOyBkYXRhOiBzdHJpbmcgfT4gfCDlt6XkvZzmtYHkuovku7bmtYEKICAqLwoKCiAgYXN5bmMgKnN0cmVhbShwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9ICcvdjEvd29ya2Zsb3cvc3RyZWFtX3J1bic7CiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLl9jbGllbnQucG9zdChhcGlVcmwsIHBhcmFtcywgdHJ1ZSwgb3B0aW9ucyk7CgogICAgZm9yIGF3YWl0IChjb25zdCBtZXNzYWdlIG9mIHJlc3VsdCkgdHJ5IHsKICAgICAgaWYgKCJEb25lIiA9PT0gbWVzc2FnZS5ldmVudCkgeWllbGQgbmV3IFdvcmtmbG93RXZlbnQoTnVtYmVyKG1lc3NhZ2UuaWQpLCAiRG9uZSIpO2Vsc2UgeWllbGQgbmV3IFdvcmtmbG93RXZlbnQoTnVtYmVyKG1lc3NhZ2UuaWQpLCBtZXNzYWdlLmV2ZW50LCBKU09OLnBhcnNlKG1lc3NhZ2UuZGF0YSkpOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgdGhyb3cgbmV3IENvemVFcnJvcihgQ291bGQgbm90IHBhcnNlIG1lc3NhZ2UgaW50byBKU09OOiR7bWVzc2FnZS5kYXRhfWApOwogICAgfQogIH0KICAvKioKICAqIFJlc3VtZXMgYSBwYXVzZWQgd29ya2Zsb3cgcnVuLiB8IOaBouWkjeaaguWBnOeahOW3peS9nOa1gei/kOihjOOAggogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy93b3JrZmxvd19yZXN1bWU/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy93b3JrZmxvd19yZXN1bWU/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMud29ya2Zsb3dfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIHdvcmtmbG93IHRvIHJlc3VtZS4gfCDlv4XpgIkg6KaB5oGi5aSN55qE5bel5L2c5rWBIElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLmV2ZW50X2lkIC0gUmVxdWlyZWQgVGhlIElEIG9mIHRoZSBldmVudCB0byByZXN1bWUgZnJvbS4gfCDlv4XpgIkg6KaB5LuO5Lit5oGi5aSN55qE5LqL5Lu2IElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLnJlc3VtZV9kYXRhIC0gUmVxdWlyZWQgRGF0YSBuZWVkZWQgdG8gcmVzdW1lIHRoZSB3b3JrZmxvdy4gfCDlv4XpgIkg5oGi5aSN5bel5L2c5rWB5omA6ZyA55qE5pWw5o2u44CCCiAgKiBAcGFyYW0gcGFyYW1zLmludGVycnVwdF90eXBlIC0gUmVxdWlyZWQgVGhlIHR5cGUgb2YgaW50ZXJydXB0aW9uIHRvIHJlc3VtZSBmcm9tLiB8IOW/hemAiSDopoHmgaLlpI3nmoTkuK3mlq3nsbvlnovjgIIKICAqIEByZXR1cm5zIHsgaWQ6IHN0cmluZzsgZXZlbnQ6IFdvcmtmbG93RXZlbnRUeXBlOyBkYXRhOiBXb3JrZmxvd0V2ZW50TWVzc2FnZSB8IFdvcmtmbG93RXZlbnRJbnRlcnJ1cHQgfCBXb3JrZmxvd0V2ZW50RXJyb3IgfCBudWxsIH0gfCDmgaLlpI3nmoTlt6XkvZzmtYHkuovku7bmlbDmja4KICAqLwoKCiAgYXN5bmMgcmVzdW1lKHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy92MS93b3JrZmxvdy9zdHJlYW1fcmVzdW1lJzsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBvcHRpb25zKTsKICAgIHJldHVybiByZXNwb25zZTsKICB9CiAgLyoqCiAgKiBHZXQgdGhlIHdvcmtmbG93IHJ1biBoaXN0b3J5IHwg5bel5L2c5rWB5byC5q2l6L+Q6KGM5ZCO77yM5p+l55yL5omn6KGM57uT5p6cCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9vcGVuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy93b3JrZmxvd19oaXN0b3J5CiAgKiBAcGFyYW0gd29ya2Zsb3dJZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUgd29ya2Zsb3cuIHwg5b+F6YCJIOW3peS9nOa1gSBJROOAggogICogQHBhcmFtIGV4ZWN1dGVJZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUgd29ya2Zsb3cgZXhlY3V0aW9uLiB8IOW/hemAiSDlt6XkvZzmtYHmiafooYwgSUTjgIIKICAqIEByZXR1cm5zIFdvcmtmbG93RXhlY3V0ZUhpc3RvcnlbXSB8IOW3peS9nOa1geaJp+ihjOWOhuWPsgogICovCgoKICBhc3luYyBoaXN0b3J5KHdvcmtmbG93SWQsIGV4ZWN1dGVJZCwgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gYC92MS93b3JrZmxvd3MvJHt3b3JrZmxvd0lkfS9ydW5faGlzdG9yaWVzLyR7ZXhlY3V0ZUlkfWA7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5nZXQoYXBpVXJsLCB2b2lkIDAsIGZhbHNlLCBvcHRpb25zKTsKICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogIH0KCn0KCnZhciBydW5zX1dvcmtmbG93RXZlbnRUeXBlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChXb3JrZmxvd0V2ZW50VHlwZSkgewogIC8vIFRoZSBvdXRwdXQgbWVzc2FnZSBmcm9tIHRoZSB3b3JrZmxvdyBub2RlLCBzdWNoIGFzIHRoZSBvdXRwdXQgbWVzc2FnZSBmcm9tCiAgLy8gdGhlIG1lc3NhZ2Ugbm9kZSBvciBlbmQgbm9kZS4gWW91IGNhbiB2aWV3IHRoZSBzcGVjaWZpYyBtZXNzYWdlIGNvbnRlbnQgaW4gZGF0YS4KICBXb3JrZmxvd0V2ZW50VHlwZVsiTUVTU0FHRSJdID0gIk1lc3NhZ2UiOyAvLyBBbiBlcnJvciBoYXMgb2NjdXJyZWQuIFlvdSBjYW4gdmlldyB0aGUgZXJyb3JfY29kZSBhbmQgZXJyb3JfbWVzc2FnZSBpbiBkYXRhIHRvCiAgLy8gdHJvdWJsZXNob290IHRoZSBpc3N1ZS4KICAvLyDmiqXplJnjgILlj6/ku6XlnKggZGF0YSDkuK3mn6XnnIsgZXJyb3JfY29kZSDlkowgZXJyb3JfbWVzc2FnZe+8jOaOkuafpemXrumimOOAggoKICBXb3JrZmxvd0V2ZW50VHlwZVsiRVJST1IiXSA9ICJFcnJvciI7IC8vIEVuZC4gSW5kaWNhdGVzIHRoZSBlbmQgb2YgdGhlIHdvcmtmbG93IGV4ZWN1dGlvbiwgd2hlcmUgZGF0YSBpcyBlbXB0eS4KICAvLyDnu5PmnZ/jgILooajnpLrlt6XkvZzmtYHmiafooYznu5PmnZ/vvIzmraTml7YgZGF0YSDkuLrnqbrjgIIKCiAgV29ya2Zsb3dFdmVudFR5cGVbIkRPTkUiXSA9ICJEb25lIjsgLy8gSW50ZXJydXB0aW9uLiBJbmRpY2F0ZXMgdGhlIHdvcmtmbG93IGhhcyBiZWVuIGludGVycnVwdGVkLCB3aGVyZSB0aGUgZGF0YSBmaWVsZAogIC8vIGNvbnRhaW5zIHNwZWNpZmljIGludGVycnVwdGlvbiBpbmZvcm1hdGlvbi4KICAvLyDkuK3mlq3jgILooajnpLrlt6XkvZzmtYHkuK3mlq3vvIzmraTml7YgZGF0YSDlrZfmrrXkuK3ljIXlkKvlhbfkvZPnmoTkuK3mlq3kv6Hmga/jgIIKCiAgV29ya2Zsb3dFdmVudFR5cGVbIklOVEVSUlVQVCJdID0gIkludGVycnVwdCI7CiAgcmV0dXJuIFdvcmtmbG93RXZlbnRUeXBlOwp9KHt9KTsKCmNsYXNzIFdvcmtmbG93RXZlbnQgewogIGNvbnN0cnVjdG9yKGlkLCBldmVudCwgZGF0YSkgewogICAgdGhpcy5pZCA9IGlkOwogICAgdGhpcy5ldmVudCA9IGV2ZW50OwogICAgdGhpcy5kYXRhID0gZGF0YTsKICB9Cgp9CgpjbGFzcyBXb3JrZmxvd0NoYXQgZXh0ZW5kcyBBUElSZXNvdXJjZSB7CiAgLyoqCiAgKiBFeGVjdXRlIGEgY2hhdCB3b3JrZmxvdy4gfCDmiafooYzlr7nor53mtYEKICAqIEBkb2NzIGVuOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy93b3JrZmxvd19jaGF0P19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvd29ya2Zsb3dfY2hhdD9fbGFuZz16aAogICogQHBhcmFtIHBhcmFtcy53b3JrZmxvd19pZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUgd29ya2Zsb3cgdG8gY2hhdCB3aXRoLiB8IOW/hemAiSDopoHlr7nor53nmoTlt6XkvZzmtYEgSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMuYWRkaXRpb25hbF9tZXNzYWdlcyAtIFJlcXVpcmVkIEFycmF5IG9mIG1lc3NhZ2VzIGZvciB0aGUgY2hhdC4gfCDlv4XpgIkg5a+56K+d55qE5raI5oGv5pWw57uE44CCCiAgKiBAcGFyYW0gcGFyYW1zLnBhcmFtZXRlcnMgLSBPcHRpb25hbCAgUGFyYW1ldGVycyBmb3IgdGhlIHdvcmtmbG93IGV4ZWN1dGlvbi4gfCDlv4XpgIkg5bel5L2c5rWB5omn6KGM55qE5Y+C5pWw44CCCiAgKiBAcGFyYW0gcGFyYW1zLmFwcF9pZCAtIE9wdGlvbmFsIFRoZSBJRCBvZiB0aGUgYXBwLiB8IOWPr+mAiSDlupTnlKggSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMuYm90X2lkIC0gT3B0aW9uYWwgVGhlIElEIG9mIHRoZSBib3QuIHwg5Y+v6YCJIEJvdCBJROOAggogICogQHBhcmFtIHBhcmFtcy5jb252ZXJzYXRpb25faWQgLSBPcHRpb25hbCBUaGUgSUQgb2YgdGhlIGNvbnZlcnNhdGlvbi4gfCDlj6/pgIkg5Lya6K+dIElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLmV4dCAtIE9wdGlvbmFsIEFkZGl0aW9uYWwgaW5mb3JtYXRpb24gZm9yIHRoZSBjaGF0LiB8IOWPr+mAiSDlr7nor53nmoTpmYTliqDkv6Hmga/jgIIKICAqIEByZXR1cm5zIEFzeW5jR2VuZXJhdG9yPFN0cmVhbUNoYXREYXRhPiB8IOWvueivneaVsOaNrua1gQogICovCiAgYXN5bmMgKnN0cmVhbShwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9ICcvdjEvd29ya2Zsb3dzL2NoYXQnOwogICAgY29uc3QgcGF5bG9hZCA9IHsgLi4ucGFyYW1zLAogICAgICBhZGRpdGlvbmFsX21lc3NhZ2VzOiBoYW5kbGVBZGRpdGlvbmFsTWVzc2FnZXMocGFyYW1zLmFkZGl0aW9uYWxfbWVzc2FnZXMpCiAgICB9OwogICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCBwYXlsb2FkLCB0cnVlLCBvcHRpb25zKTsKCiAgICBmb3IgYXdhaXQgKGNvbnN0IG1lc3NhZ2Ugb2YgcmVzdWx0KSBpZiAobWVzc2FnZS5ldmVudCA9PT0gY2hhdF9DaGF0RXZlbnRUeXBlLkRPTkUpIHsKICAgICAgY29uc3QgcmV0ID0gewogICAgICAgIGV2ZW50OiBtZXNzYWdlLmV2ZW50LAogICAgICAgIGRhdGE6ICdbRE9ORV0nCiAgICAgIH07CiAgICAgIHlpZWxkIHJldDsKICAgIH0gZWxzZSB0cnkgewogICAgICBjb25zdCByZXQgPSB7CiAgICAgICAgZXZlbnQ6IG1lc3NhZ2UuZXZlbnQsCiAgICAgICAgZGF0YTogSlNPTi5wYXJzZShtZXNzYWdlLmRhdGEpCiAgICAgIH07CiAgICAgIHlpZWxkIHJldDsKICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgIHRocm93IG5ldyBDb3plRXJyb3IoYENvdWxkIG5vdCBwYXJzZSBtZXNzYWdlIGludG8gSlNPTjoke21lc3NhZ2UuZGF0YX1gKTsKICAgIH0KICB9Cgp9CgpjbGFzcyBXb3JrZmxvd3MgZXh0ZW5kcyBBUElSZXNvdXJjZSB7CiAgY29uc3RydWN0b3IoLi4uYXJncykgewogICAgc3VwZXIoLi4uYXJncyksIHRoaXMucnVucyA9IG5ldyBSdW5zKHRoaXMuX2NsaWVudCksIHRoaXMuY2hhdCA9IG5ldyBXb3JrZmxvd0NoYXQodGhpcy5fY2xpZW50KTsKICB9Cgp9CgpjbGFzcyBXb3JrU3BhY2VzIGV4dGVuZHMgQVBJUmVzb3VyY2UgewogIC8qKgogICogVmlldyB0aGUgbGlzdCBvZiB3b3Jrc3BhY2VzIHRoYXQgdGhlIGN1cnJlbnQgQ296ZSB1c2VyIGhhcyBqb2luZWQuIHwg5p+l55yL5b2T5YmN5omj5a2Q55So5oi35Yqg5YWl55qE56m66Ze05YiX6KGo44CCCiAgKiBAZG9jcyBlbjogaHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2xpc3Rfd29ya3NwYWNlP19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvbGlzdF93b3Jrc3BhY2U/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMucGFnZV9udW0gLSBPcHRpb25hbCBUaGUgcGFnZSBudW1iZXIgZm9yIHBhZ2luYXRlZCBxdWVyaWVzLiBEZWZhdWx0IGlzIDEuCiAgKiB8IOWPr+mAiSDliIbpobXmn6Xor6Lml7bnmoTpobXnoIHjgILpu5jorqTkuLogMe+8jOWNs+S7juesrOS4gOmhteaVsOaNruW8gOWni+i/lOWbnuOAggogICogQHBhcmFtIHBhcmFtcy5wYWdlX3NpemUgLSBPcHRpb25hbCBUaGUgc2l6ZSBvZiBwYWdpbmF0aW9uLiBEZWZhdWx0IGlzIDEwLiBNYXhpbXVtIGlzIDUwLiB8IOWPr+mAiSDliIbpobXlpKflsI/jgILpu5jorqTkuLogMTDvvIzmnIDlpKfkuLogNTDjgIIKICAqIEByZXR1cm5zIE9wZW5TcGFjZURhdGEgfCDlt6XkvZznqbrpl7TliJfooagKICAqLwogIGFzeW5jIGxpc3QocGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL3YxL3dvcmtzcGFjZXMnOwogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLl9jbGllbnQuZ2V0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gc2FmZUpzb25QYXJzZShyZXNwb25zZSwgcmVzcG9uc2UpLmRhdGE7CiAgfQoKfSAvLyBSZXF1aXJlZCBoZWFkZXIgZm9yIGtub3dsZWRnZSBBUElzCgoKY29uc3QgZG9jdW1lbnRzX2hlYWRlcnMgPSB7CiAgJ2Fndy1qcy1jb252JzogJ3N0cicKfTsKCmNsYXNzIERvY3VtZW50cyBleHRlbmRzIEFQSVJlc291cmNlIHsKICAvKioKICAqIEBkZXByZWNhdGVkICBUaGUgbWV0aG9kIGlzIGRlcHJlY2F0ZWQgYW5kIHdpbGwgYmUgcmVtb3ZlZCBpbiBhIGZ1dHVyZSB2ZXJzaW9uLiBQbGVhc2UgdXNlICdjbGllbnQuZGF0YXNldHMuZG9jdW1lbnRzLmxpc3QnIGluc3RlYWQuCiAgKgogICogVmlldyB0aGUgZmlsZSBsaXN0IG9mIGEgc3BlY2lmaWVkIGtub3dsZWRnZSBiYXNlLCB3aGljaCBpbmNsdWRlcyBsaXN0cyBvZiBkb2N1bWVudHMsIHNwcmVhZHNoZWV0cywgb3IgaW1hZ2VzLgogICogfCDosIPnlKjmjqXlj6Pmn6XnnIvmjIflrprnn6Xor4blupPnmoTlhoXlrrnliJfooajvvIzljbPmlofku7bjgIHooajmoLzmiJblm77lg4/liJfooajjgIIKICAqIEBkb2NzIGVuOiBodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvbGlzdF9rbm93bGVkZ2VfZmlsZXM/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9saXN0X2tub3dsZWRnZV9maWxlcz9fbGFuZz16aAogICogQHBhcmFtIHBhcmFtcy5kYXRhc2V0X2lkIC0gUmVxdWlyZWQgVGhlIElEIG9mIHRoZSBrbm93bGVkZ2UgYmFzZS4gfCDlv4XpgIkg5b6F5p+l55yL5paH5Lu255qE55+l6K+G5bqTIElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLnBhZ2UgLSBPcHRpb25hbCBUaGUgcGFnZSBudW1iZXIgZm9yIHBhZ2luYXRlZCBxdWVyaWVzLiBEZWZhdWx0IGlzIDEuIHwg5Y+v6YCJIOWIhumhteafpeivouaXtueahOmhteeggeOAgum7mOiupOS4uiAx44CCCiAgKiBAcGFyYW0gcGFyYW1zLnBhZ2Vfc2l6ZSAtIE9wdGlvbmFsIFRoZSBzaXplIG9mIHBhZ2luYXRpb24uIERlZmF1bHQgaXMgMTAuIHwg5Y+v6YCJIOWIhumhteWkp+Wwj+OAgum7mOiupOS4uiAxMOOAggogICogQHJldHVybnMgTGlzdERvY3VtZW50RGF0YSB8IOefpeivhuW6k+aWh+S7tuWIl+ihqAogICovCiAgbGlzdChwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9ICcvb3Blbl9hcGkva25vd2xlZGdlL2RvY3VtZW50L2xpc3QnOwoKICAgIGNvbnN0IHJlc3BvbnNlID0gdGhpcy5fY2xpZW50LmdldChhcGlVcmwsIHBhcmFtcywgZmFsc2UsIG1lcmdlQ29uZmlnKG9wdGlvbnMsIHsKICAgICAgaGVhZGVyczogZG9jdW1lbnRzX2hlYWRlcnMKICAgIH0pKTsKCiAgICByZXR1cm4gcmVzcG9uc2U7CiAgfQogIC8qKgogICogQGRlcHJlY2F0ZWQgIFRoZSBtZXRob2QgaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIHZlcnNpb24uIFBsZWFzZSB1c2UgJ2NsaWVudC5kYXRhc2V0cy5kb2N1bWVudHMuY3JlYXRlJyBpbnN0ZWFkLgogICoKICAqIFVwbG9hZCBmaWxlcyB0byB0aGUgc3BlY2lmaWMga25vd2xlZGdlLiB8IOiwg+eUqOatpOaOpeWPo+WQkeaMh+WumuefpeivhuW6k+S4reS4iuS8oOaWh+S7tuOAggogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9jcmVhdGVfa25vd2xlZGdlX2ZpbGVzP19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvY3JlYXRlX2tub3dsZWRnZV9maWxlcz9fbGFuZz16aAogICogQHBhcmFtIHBhcmFtcy5kYXRhc2V0X2lkIC0gUmVxdWlyZWQgVGhlIElEIG9mIHRoZSBrbm93bGVkZ2UuIHwg5b+F6YCJIOefpeivhuW6kyBJROOAggogICogQHBhcmFtIHBhcmFtcy5kb2N1bWVudF9iYXNlcyAtIFJlcXVpcmVkIFRoZSBtZXRhZGF0YSBpbmZvcm1hdGlvbiBvZiB0aGUgZmlsZXMgYXdhaXRpbmcgdXBsb2FkLiB8IOW/hemAiSDlvoXkuIrkvKDmlofku7bnmoTlhYPmlbDmja7kv6Hmga/jgIIKICAqIEBwYXJhbSBwYXJhbXMuY2h1bmtfc3RyYXRlZ3kgLSBSZXF1aXJlZCB3aGVuIHVwbG9hZGluZyBmaWxlcyB0byBhIG5ldyBrbm93bGVkZ2UgZm9yIHRoZSBmaXJzdCB0aW1lLiBDaHVuayBzdHJhdGVneS4KICAqIHwg5ZCR5paw55+l6K+G5bqT6aaW5qyh5LiK5Lyg5paH5Lu25pe25b+F6YCJIOWIhuauteinhOWImeOAggogICogQHJldHVybnMgRG9jdW1lbnRJbmZvW10gfCDlt7LkuIrkvKDmlofku7bnmoTln7rmnKzkv6Hmga8KICAqLwoKCiAgYXN5bmMgY3JlYXRlKHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy9vcGVuX2FwaS9rbm93bGVkZ2UvZG9jdW1lbnQvY3JlYXRlJzsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBtZXJnZUNvbmZpZyhvcHRpb25zLCB7CiAgICAgIGhlYWRlcnM6IGRvY3VtZW50c19oZWFkZXJzCiAgICB9KSk7CiAgICByZXR1cm4gcmVzcG9uc2UuZG9jdW1lbnRfaW5mb3M7CiAgfQogIC8qKgogICogQGRlcHJlY2F0ZWQgIFRoZSBtZXRob2QgaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIHZlcnNpb24uIFBsZWFzZSB1c2UgJ2NsaWVudC5kYXRhc2V0cy5kb2N1bWVudHMuZGVsZXRlJyBpbnN0ZWFkLgogICoKICAqIERlbGV0ZSB0ZXh0LCBpbWFnZXMsIHNoZWV0cywgYW5kIG90aGVyIGZpbGVzIGluIHRoZSBrbm93bGVkZ2UgYmFzZSwgc3VwcG9ydGluZyBiYXRjaCBkZWxldGlvbi4KICAqIHwg5Yig6Zmk55+l6K+G5bqT5Lit55qE5paH5pys44CB5Zu+5YOP44CB6KGo5qC8562J5paH5Lu277yM5pSv5oyB5om56YeP5Yig6Zmk44CCCiAgKiBAZG9jcyBlbjogaHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2RlbGV0ZV9rbm93bGVkZ2VfZmlsZXM/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9kZWxldGVfa25vd2xlZGdlX2ZpbGVzP19sYW5nPXpoCiAgKiBAcGFyYW0gcGFyYW1zLmRvY3VtZW50X2lkcyAtIFJlcXVpcmVkIFRoZSBsaXN0IG9mIGtub3dsZWRnZSBiYXNlIGZpbGVzIHRvIGJlIGRlbGV0ZWQuIHwg5b+F6YCJIOW+heWIoOmZpOeahOaWh+S7tiBJROOAggogICogQHJldHVybnMgdm9pZCB8IOaXoOi/lOWbngogICovCgoKICBhc3luYyBkZWxldGUocGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL29wZW5fYXBpL2tub3dsZWRnZS9kb2N1bWVudC9kZWxldGUnOwogICAgYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBtZXJnZUNvbmZpZyhvcHRpb25zLCB7CiAgICAgIGhlYWRlcnM6IGRvY3VtZW50c19oZWFkZXJzCiAgICB9KSk7CiAgfQogIC8qKgogICogQGRlcHJlY2F0ZWQgIFRoZSBtZXRob2QgaXMgZGVwcmVjYXRlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIHZlcnNpb24uIFBsZWFzZSB1c2UgJ2NsaWVudC5kYXRhc2V0cy5kb2N1bWVudHMudXBkYXRlJyBpbnN0ZWFkLgogICoKICAqIE1vZGlmeSB0aGUga25vd2xlZGdlIGJhc2UgZmlsZSBuYW1lIGFuZCB1cGRhdGUgc3RyYXRlZ3kuIHwg6LCD55So5o6l5Y+j5L+u5pS555+l6K+G5bqT5paH5Lu25ZCN56ew5ZKM5pu05paw562W55Wl44CCCiAgKiBAZG9jcyBlbjogaHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL21vZGlmeV9rbm93bGVkZ2VfZmlsZXM/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9tb2RpZnlfa25vd2xlZGdlX2ZpbGVzP19sYW5nPXpoCiAgKiBAcGFyYW0gcGFyYW1zLmRvY3VtZW50X2lkIC0gUmVxdWlyZWQgVGhlIElEIG9mIHRoZSBrbm93bGVkZ2UgYmFzZSBmaWxlLiB8IOW/hemAiSDlvoXkv67mlLnnmoTnn6Xor4blupPmlofku7YgSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMuZG9jdW1lbnRfbmFtZSAtIE9wdGlvbmFsIFRoZSBuZXcgbmFtZSBvZiB0aGUga25vd2xlZGdlIGJhc2UgZmlsZS4gfCDlj6/pgIkg55+l6K+G5bqT5paH5Lu255qE5paw5ZCN56ew44CCCiAgKiBAcGFyYW0gcGFyYW1zLnVwZGF0ZV9ydWxlIC0gT3B0aW9uYWwgVGhlIHVwZGF0ZSBzdHJhdGVneSBmb3Igb25saW5lIHdlYiBwYWdlcy4gfCDlj6/pgIkg5Zyo57q/572R6aG15pu05paw562W55Wl44CCCiAgKiBAcmV0dXJucyB2b2lkIHwg5peg6L+U5ZueCiAgKi8KCgogIGFzeW5jIHVwZGF0ZShwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9ICcvb3Blbl9hcGkva25vd2xlZGdlL2RvY3VtZW50L3VwZGF0ZSc7CiAgICBhd2FpdCB0aGlzLl9jbGllbnQucG9zdChhcGlVcmwsIHBhcmFtcywgZmFsc2UsIG1lcmdlQ29uZmlnKG9wdGlvbnMsIHsKICAgICAgaGVhZGVyczogZG9jdW1lbnRzX2hlYWRlcnMKICAgIH0pKTsKICB9Cgp9CgpjbGFzcyBLbm93bGVkZ2UgZXh0ZW5kcyBBUElSZXNvdXJjZSB7CiAgY29uc3RydWN0b3IoLi4uYXJncykgewogICAgc3VwZXIoLi4uYXJncyksCiAgICAvKioKICAgICogQGRlcHJlY2F0ZWQKICAgICovCiAgICB0aGlzLmRvY3VtZW50cyA9IG5ldyBEb2N1bWVudHModGhpcy5fY2xpZW50KTsKICB9Cgp9IC8vIFJlcXVpcmVkIGhlYWRlciBmb3Iga25vd2xlZGdlIEFQSXMKCgpjb25zdCBkb2N1bWVudHNfZG9jdW1lbnRzX2hlYWRlcnMgPSB7CiAgJ2Fndy1qcy1jb252JzogJ3N0cicKfTsKCmNsYXNzIGRvY3VtZW50c19Eb2N1bWVudHMgZXh0ZW5kcyBBUElSZXNvdXJjZSB7CiAgLyoqCiAgKiBWaWV3IHRoZSBmaWxlIGxpc3Qgb2YgYSBzcGVjaWZpZWQga25vd2xlZGdlIGJhc2UsIHdoaWNoIGluY2x1ZGVzIGxpc3RzIG9mIGRvY3VtZW50cywgc3ByZWFkc2hlZXRzLCBvciBpbWFnZXMuCiAgKiB8IOiwg+eUqOaOpeWPo+afpeeci+aMh+WumuefpeivhuW6k+eahOWGheWuueWIl+ihqO+8jOWNs+aWh+S7tuOAgeihqOagvOaIluWbvuWDj+WIl+ihqOOAggogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9saXN0X2tub3dsZWRnZV9maWxlcz9fbGFuZz1lbgogICogQGRvY3Mgemg6IGh0dHBzOi8vd3d3LmNvemUuY24vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2xpc3Rfa25vd2xlZGdlX2ZpbGVzP19sYW5nPXpoCiAgKiBAcGFyYW0gcGFyYW1zLmRhdGFzZXRfaWQgLSBSZXF1aXJlZCBUaGUgSUQgb2YgdGhlIGtub3dsZWRnZSBiYXNlLiB8IOW/hemAiSDlvoXmn6XnnIvmlofku7bnmoTnn6Xor4blupMgSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMucGFnZSAtIE9wdGlvbmFsIFRoZSBwYWdlIG51bWJlciBmb3IgcGFnaW5hdGVkIHF1ZXJpZXMuIERlZmF1bHQgaXMgMS4gfCDlj6/pgIkg5YiG6aG15p+l6K+i5pe255qE6aG156CB44CC6buY6K6k5Li6IDHjgIIKICAqIEBwYXJhbSBwYXJhbXMucGFnZV9zaXplIC0gT3B0aW9uYWwgVGhlIHNpemUgb2YgcGFnaW5hdGlvbi4gRGVmYXVsdCBpcyAxMC4gfCDlj6/pgIkg5YiG6aG15aSn5bCP44CC6buY6K6k5Li6IDEw44CCCiAgKiBAcmV0dXJucyBMaXN0RG9jdW1lbnREYXRhIHwg55+l6K+G5bqT5paH5Lu25YiX6KGoCiAgKi8KICBhc3luYyBsaXN0KHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy9vcGVuX2FwaS9rbm93bGVkZ2UvZG9jdW1lbnQvbGlzdCc7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgbWVyZ2VDb25maWcob3B0aW9ucywgewogICAgICBoZWFkZXJzOiBkb2N1bWVudHNfZG9jdW1lbnRzX2hlYWRlcnMKICAgIH0pKTsKICAgIHJldHVybiByZXNwb25zZTsKICB9CiAgLyoqCiAgKiBVcGxvYWQgZmlsZXMgdG8gdGhlIHNwZWNpZmljIGtub3dsZWRnZS4gfCDosIPnlKjmraTmjqXlj6PlkJHmjIflrprnn6Xor4blupPkuK3kuIrkvKDmlofku7bjgIIKICAqIEBkb2NzIGVuOiBodHRwczovL3d3dy5jb3plLmNvbS9kb2NzL2RldmVsb3Blcl9ndWlkZXMvY3JlYXRlX2tub3dsZWRnZV9maWxlcz9fbGFuZz1lbgogICogQGRvY3Mgemg6IGh0dHBzOi8vd3d3LmNvemUuY24vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2NyZWF0ZV9rbm93bGVkZ2VfZmlsZXM/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMuZGF0YXNldF9pZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUga25vd2xlZGdlLiB8IOW/hemAiSDnn6Xor4blupMgSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMuZG9jdW1lbnRfYmFzZXMgLSBSZXF1aXJlZCBUaGUgbWV0YWRhdGEgaW5mb3JtYXRpb24gb2YgdGhlIGZpbGVzIGF3YWl0aW5nIHVwbG9hZC4gfCDlv4XpgIkg5b6F5LiK5Lyg5paH5Lu255qE5YWD5pWw5o2u5L+h5oGv44CCCiAgKiBAcGFyYW0gcGFyYW1zLmNodW5rX3N0cmF0ZWd5IC0gUmVxdWlyZWQgd2hlbiB1cGxvYWRpbmcgZmlsZXMgdG8gYSBuZXcga25vd2xlZGdlIGZvciB0aGUgZmlyc3QgdGltZS4gQ2h1bmsgc3RyYXRlZ3kuCiAgKiB8IOWQkeaWsOefpeivhuW6k+mmluasoeS4iuS8oOaWh+S7tuaXtuW/hemAiSDliIbmrrXop4TliJnjgIIKICAqIEByZXR1cm5zIERvY3VtZW50SW5mb1tdIHwg5bey5LiK5Lyg5paH5Lu255qE5Z+65pys5L+h5oGvCiAgKi8KCgogIGFzeW5jIGNyZWF0ZShwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9ICcvb3Blbl9hcGkva25vd2xlZGdlL2RvY3VtZW50L2NyZWF0ZSc7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgbWVyZ2VDb25maWcob3B0aW9ucywgewogICAgICBoZWFkZXJzOiBkb2N1bWVudHNfZG9jdW1lbnRzX2hlYWRlcnMKICAgIH0pKTsKICAgIHJldHVybiByZXNwb25zZS5kb2N1bWVudF9pbmZvczsKICB9CiAgLyoqCiAgKiBEZWxldGUgdGV4dCwgaW1hZ2VzLCBzaGVldHMsIGFuZCBvdGhlciBmaWxlcyBpbiB0aGUga25vd2xlZGdlIGJhc2UsIHN1cHBvcnRpbmcgYmF0Y2ggZGVsZXRpb24uCiAgKiB8IOWIoOmZpOefpeivhuW6k+S4reeahOaWh+acrOOAgeWbvuWDj+OAgeihqOagvOetieaWh+S7tu+8jOaUr+aMgeaJuemHj+WIoOmZpOOAggogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9kZWxldGVfa25vd2xlZGdlX2ZpbGVzP19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvZGVsZXRlX2tub3dsZWRnZV9maWxlcz9fbGFuZz16aAogICogQHBhcmFtIHBhcmFtcy5kb2N1bWVudF9pZHMgLSBSZXF1aXJlZCBUaGUgbGlzdCBvZiBrbm93bGVkZ2UgYmFzZSBmaWxlcyB0byBiZSBkZWxldGVkLiB8IOW/hemAiSDlvoXliKDpmaTnmoTmlofku7YgSUTjgIIKICAqIEByZXR1cm5zIHZvaWQgfCDml6Dov5Tlm54KICAqLwoKCiAgYXN5bmMgZGVsZXRlKHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy9vcGVuX2FwaS9rbm93bGVkZ2UvZG9jdW1lbnQvZGVsZXRlJzsKICAgIGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgbWVyZ2VDb25maWcob3B0aW9ucywgewogICAgICBoZWFkZXJzOiBkb2N1bWVudHNfZG9jdW1lbnRzX2hlYWRlcnMKICAgIH0pKTsKICB9CiAgLyoqCiAgKiBNb2RpZnkgdGhlIGtub3dsZWRnZSBiYXNlIGZpbGUgbmFtZSBhbmQgdXBkYXRlIHN0cmF0ZWd5LiB8IOiwg+eUqOaOpeWPo+S/ruaUueefpeivhuW6k+aWh+S7tuWQjeensOWSjOabtOaWsOetlueVpeOAggogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9tb2RpZnlfa25vd2xlZGdlX2ZpbGVzP19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvbW9kaWZ5X2tub3dsZWRnZV9maWxlcz9fbGFuZz16aAogICogQHBhcmFtIHBhcmFtcy5kb2N1bWVudF9pZCAtIFJlcXVpcmVkIFRoZSBJRCBvZiB0aGUga25vd2xlZGdlIGJhc2UgZmlsZS4gfCDlv4XpgIkg5b6F5L+u5pS555qE55+l6K+G5bqT5paH5Lu2IElE44CCCiAgKiBAcGFyYW0gcGFyYW1zLmRvY3VtZW50X25hbWUgLSBPcHRpb25hbCBUaGUgbmV3IG5hbWUgb2YgdGhlIGtub3dsZWRnZSBiYXNlIGZpbGUuIHwg5Y+v6YCJIOefpeivhuW6k+aWh+S7tueahOaWsOWQjeensOOAggogICogQHBhcmFtIHBhcmFtcy51cGRhdGVfcnVsZSAtIE9wdGlvbmFsIFRoZSB1cGRhdGUgc3RyYXRlZ3kgZm9yIG9ubGluZSB3ZWIgcGFnZXMuIHwg5Y+v6YCJIOWcqOe6v+e9kemhteabtOaWsOetlueVpeOAggogICogQHJldHVybnMgdm9pZCB8IOaXoOi/lOWbngogICovCgoKICBhc3luYyB1cGRhdGUocGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL29wZW5fYXBpL2tub3dsZWRnZS9kb2N1bWVudC91cGRhdGUnOwogICAgYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBtZXJnZUNvbmZpZyhvcHRpb25zLCB7CiAgICAgIGhlYWRlcnM6IGRvY3VtZW50c19kb2N1bWVudHNfaGVhZGVycwogICAgfSkpOwogIH0KCn0KCmNsYXNzIEltYWdlcyBleHRlbmRzIEFQSVJlc291cmNlIHsKICAvKioKICAqIFVwZGF0ZSB0aGUgZGVzY3JpcHRpb24gb2YgYW4gaW1hZ2UgaW4gdGhlIGtub3dsZWRnZSBiYXNlIHwg5pu05paw55+l6K+G5bqT5Lit55qE5Zu+54mH5o+P6L+wCiAgKiBAZG9jcyBlbjogaHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2RldmVsb3Blcl9ndWlkZXMvdXBkYXRlX2ltYWdlX2NhcHRpb24/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9kZXZlbG9wZXJfZ3VpZGVzL3VwZGF0ZV9pbWFnZV9jYXB0aW9uP19sYW5nPXpoCiAgKiBAcGFyYW0gZGF0YXNldElkIC0gVGhlIElEIG9mIHRoZSBkYXRhc2V0IHwg5b+F6YCJIOefpeivhuW6kyBJRAogICogQHBhcmFtIGRvY3VtZW50SWQgLSBUaGUgSUQgb2YgdGhlIGRvY3VtZW50IHwg5b+F6YCJIOefpeivhuW6k+aWh+S7tiBJRAogICogQHBhcmFtIHBhcmFtcyAtIFRoZSBwYXJhbWV0ZXJzIGZvciB1cGRhdGluZyB0aGUgaW1hZ2UKICAqIEBwYXJhbSBwYXJhbXMuY2FwdGlvbiAtIFJlcXVpcmVkLiBUaGUgZGVzY3JpcHRpb24gb2YgdGhlIGltYWdlIHwg5b+F6YCJIOWbvueJh+eahOaPj+i/sOS/oeaBrwogICogQHJldHVybnMgdW5kZWZpbmVkCiAgKi8KICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtcwogIGFzeW5jIHVwZGF0ZShkYXRhc2V0SWQsIGRvY3VtZW50SWQsIHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gYC92MS9kYXRhc2V0cy8ke2RhdGFzZXRJZH0vaW1hZ2VzLyR7ZG9jdW1lbnRJZH1gOwogICAgYXdhaXQgdGhpcy5fY2xpZW50LnB1dChhcGlVcmwsIHBhcmFtcywgZmFsc2UsIG9wdGlvbnMpOwogIH0KICAvKioKICAqIExpc3QgaW1hZ2VzIGluIHRoZSBrbm93bGVkZ2UgYmFzZSB8IOWIl+WHuuefpeivhuW6k+S4reeahOWbvueJhwogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9kZXZlbG9wZXJfZ3VpZGVzL2dldF9pbWFnZXM/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9kZXZlbG9wZXJfZ3VpZGVzL2dldF9pbWFnZXM/X2xhbmc9emgKICAqIEBwYXJhbSBkYXRhc2V0SWQgLSBUaGUgSUQgb2YgdGhlIGRhdGFzZXQgfCDlv4XpgIkg55+l6K+G5bqTIElECiAgKiBAcGFyYW0gcGFyYW1zIC0gVGhlIHBhcmFtZXRlcnMgZm9yIGxpc3RpbmcgaW1hZ2VzCiAgKiBAcGFyYW0gcGFyYW1zLnBhZ2VfbnVtIC0gT3B0aW9uYWwuIFBhZ2UgbnVtYmVyIGZvciBwYWdpbmF0aW9uLCBtaW5pbXVtIHZhbHVlIGlzIDEsIGRlZmF1bHRzIHRvIDEgfCDlj6/pgIkg5YiG6aG15p+l6K+i5pe255qE6aG156CB44CC6buY6K6k5Li6IDHjgIIKICAqIEBwYXJhbSBwYXJhbXMucGFnZV9zaXplIC0gT3B0aW9uYWwuIE51bWJlciBvZiBpdGVtcyBwZXIgcGFnZSwgcmFuZ2UgMS0yOTksIGRlZmF1bHRzIHRvIDEwIHwg5Y+v6YCJIOWIhumhteWkp+Wwj+OAgum7mOiupOS4uiAxMOOAggogICogQHBhcmFtIHBhcmFtcy5rZXl3b3JkIC0gT3B0aW9uYWwuIFNlYXJjaCBrZXl3b3JkIGZvciBpbWFnZSBkZXNjcmlwdGlvbnMgfCDlj6/pgIkg5Zu+54mH5o+P6L+w55qE5pCc57Si5YWz6ZSu6K+N44CCCiAgKiBAcGFyYW0gcGFyYW1zLmhhc19jYXB0aW9uIC0gT3B0aW9uYWwuIEZpbHRlciBmb3IgaW1hZ2VzIHdpdGgvd2l0aG91dCBjYXB0aW9ucyB8IOWPr+mAiSDmmK/lkKbov4fmu6TmnIkv5peg5o+P6L+w55qE5Zu+54mH44CCCiAgKi8KCgogIGFzeW5jIGxpc3QoZGF0YXNldElkLCBwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9IGAvdjEvZGF0YXNldHMvJHtkYXRhc2V0SWR9L2ltYWdlc2A7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5nZXQoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBvcHRpb25zKTsKICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogIH0KCn0KCmNsYXNzIERhdGFzZXRzIGV4dGVuZHMgQVBJUmVzb3VyY2UgewogIC8qKgogICogQ3JlYXRlcyBhIG5ldyBkYXRhc2V0IHwg5Yib5bu65pWw5o2u6ZuGCiAgKiBAZG9jcyBlbjogaHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2NyZWF0ZV9kYXRhc2V0P19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvY3JlYXRlX2RhdGFzZXQ/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMgLSBUaGUgcGFyYW1ldGVycyBmb3IgY3JlYXRpbmcgYSBkYXRhc2V0CiAgKiBAcGFyYW0ge3N0cmluZ30gcGFyYW1zLm5hbWUgLSBSZXF1aXJlZC4gRGF0YXNldCBuYW1lLCBtYXhpbXVtIGxlbmd0aCBvZiAxMDAgY2hhcmFjdGVycyB8IOW/hemAiSDmlbDmja7pm4blkI3np7DvvIzmnIDlpKfplb/luqbkuLogMTAwIOS4quWtl+espgogICogQHBhcmFtIHtzdHJpbmd9IHBhcmFtcy5zcGFjZV9pZCAtIFJlcXVpcmVkLiBTcGFjZSBJRCB3aGVyZSB0aGUgZGF0YXNldCBiZWxvbmdzIHwg5b+F6YCJIOaVsOaNrumbhuaJgOWxnueahOepuumXtCBJRAogICogQHBhcmFtIHtudW1iZXJ9IHBhcmFtcy5mb3JtYXRfdHlwZSAtIFJlcXVpcmVkLiBEYXRhc2V0IHR5cGUgKDA6IFRleHQgdHlwZSwgMjogSW1hZ2UgdHlwZSkgfCDlv4XpgIkg5pWw5o2u6ZuG57G75Z6LICgwOiDmlofmnKznsbvlnossIDI6IOWbvueJh+exu+WeiykKICAqIEBwYXJhbSB7c3RyaW5nfSBbcGFyYW1zLmRlc2NyaXB0aW9uXSAtIE9wdGlvbmFsLiBEYXRhc2V0IGRlc2NyaXB0aW9uIHwg5Y+v6YCJIOaVsOaNrumbhuaPj+i/sAogICogQHBhcmFtIHtzdHJpbmd9IFtwYXJhbXMuZmlsZV9pZF0gLSBPcHRpb25hbC4gRGF0YXNldCBpY29uIGZpbGUgSUQgZnJvbSBmaWxlIHVwbG9hZAogICovCiAgYXN5bmMgY3JlYXRlKHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy92MS9kYXRhc2V0cyc7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICB9CiAgLyoqCiAgKiBMaXN0cyBhbGwgZGF0YXNldHMgaW4gYSBzcGFjZSB8IOWIl+WHuuepuumXtOS4reeahOaJgOacieaVsOaNrumbhgogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9saXN0X2RhdGFzZXQ/X2xhbmc9ZW4KICAqIEBkb2NzIHpoOiBodHRwczovL3d3dy5jb3plLmNuL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9saXN0X2RhdGFzZXQ/X2xhbmc9emgKICAqIEBwYXJhbSBwYXJhbXMgLSBUaGUgcGFyYW1ldGVycyBmb3IgbGlzdGluZyBkYXRhc2V0cyB8IOWIl+WHuuaVsOaNrumbhueahOWPguaVsAogICogQHBhcmFtIHtzdHJpbmd9IHBhcmFtcy5zcGFjZV9pZCAtIFJlcXVpcmVkLiBTcGFjZSBJRCB3aGVyZSB0aGUgZGF0YXNldHMgYmVsb25nIHwg5b+F6YCJIOaVsOaNrumbhuaJgOWxnueahOepuumXtCBJRAogICogQHBhcmFtIHtzdHJpbmd9IFtwYXJhbXMubmFtZV0gLSBPcHRpb25hbC4gRGF0YXNldCBuYW1lIGZvciBmdXp6eSBzZWFyY2ggfCDlj6/pgIkg5pWw5o2u6ZuG5ZCN56ew55So5LqO5qih57OK5pCc57SiCiAgKiBAcGFyYW0ge251bWJlcn0gW3BhcmFtcy5mb3JtYXRfdHlwZV0gLSBPcHRpb25hbC4gRGF0YXNldCB0eXBlICgwOiBUZXh0IHR5cGUsIDI6IEltYWdlIHR5cGUpIHwg5Y+v6YCJIOaVsOaNrumbhuexu+WeiyAoMDog5paH5pys57G75Z6LLCAyOiDlm77niYfnsbvlnospCiAgKiBAcGFyYW0ge251bWJlcn0gW3BhcmFtcy5wYWdlX251bV0gLSBPcHRpb25hbC4gUGFnZSBudW1iZXIgZm9yIHBhZ2luYXRpb24gKGRlZmF1bHQ6IDEpIHwg5Y+v6YCJIOWIhumhteafpeivouaXtueahOmhteeggeOAgum7mOiupOS4uiAx44CCCiAgKiBAcGFyYW0ge251bWJlcn0gW3BhcmFtcy5wYWdlX3NpemVdIC0gT3B0aW9uYWwuIE51bWJlciBvZiBpdGVtcyBwZXIgcGFnZSAoZGVmYXVsdDogMTApIHwg5Y+v6YCJIOWIhumhteWkp+Wwj+OAgum7mOiupOS4uiAxMOOAggogICovCgoKICBhc3luYyBsaXN0KHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy92MS9kYXRhc2V0cyc7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5nZXQoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBvcHRpb25zKTsKICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogIH0KICAvKioKICAqIFVwZGF0ZXMgYSBkYXRhc2V0IHwg5pu05paw5pWw5o2u6ZuGCiAgKiBAZG9jcyBlbjogaHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL3VwZGF0ZV9kYXRhc2V0P19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvdXBkYXRlX2RhdGFzZXQ/X2xhbmc9emgKICAqIEBwYXJhbSBkYXRhc2V0X2lkIC0gUmVxdWlyZWQuIFRoZSBJRCBvZiB0aGUgZGF0YXNldCB0byB1cGRhdGUgfCDlv4XpgIkg5pWw5o2u6ZuGIElECiAgKiBAcGFyYW0gcGFyYW1zIC0gUmVxdWlyZWQuIFRoZSBwYXJhbWV0ZXJzIGZvciB1cGRhdGluZyB0aGUgZGF0YXNldCB8IOW/hemAiSDmm7TmlrDmlbDmja7pm4bnmoTlj4LmlbAKICAqIEBwYXJhbSBwYXJhbXMubmFtZSAtIFJlcXVpcmVkLiBEYXRhc2V0IG5hbWUsIG1heGltdW0gbGVuZ3RoIG9mIDEwMCBjaGFyYWN0ZXJzLiB8IOW/hemAiSDmlbDmja7pm4blkI3np7DvvIzmnIDlpKfplb/luqbkuLogMTAwIOS4quWtl+espuOAggogICogQHBhcmFtIHBhcmFtcy5maWxlX2lkIC0gT3B0aW9uYWwuIERhdGFzZXQgaWNvbiwgc2hvdWxkIHBhc3MgdGhlIGZpbGVfaWQgb2J0YWluZWQgZnJvbSB0aGUgZmlsZSB1cGxvYWQgaW50ZXJmYWNlLiB8IOWPr+mAiSDmlbDmja7pm4blm77moIfvvIzlupTkvKDpgJLku47mlofku7bkuIrkvKDmjqXlj6Pojrflj5bnmoQgZmlsZV9pZOOAggogICogQHBhcmFtIHBhcmFtcy5kZXNjcmlwdGlvbiAtIE9wdGlvbmFsLiBEYXRhc2V0IGRlc2NyaXB0aW9uLiB8IOWPr+mAiSDmlbDmja7pm4bmj4/ov7DjgIIKICAqLwoKCiAgYXN5bmMgdXBkYXRlKGRhdGFzZXRfaWQsIHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gYC92MS9kYXRhc2V0cy8ke2RhdGFzZXRfaWR9YDsKICAgIGF3YWl0IHRoaXMuX2NsaWVudC5wdXQoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBvcHRpb25zKTsKICB9CiAgLyoqCiAgKiBEZWxldGVzIGEgZGF0YXNldCB8IOWIoOmZpOaVsOaNrumbhgogICogQGRvY3MgZW46IGh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9kZWxldGVfZGF0YXNldD9fbGFuZz1lbgogICogQGRvY3Mgemg6IGh0dHBzOi8vd3d3LmNvemUuY24vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2RlbGV0ZV9kYXRhc2V0P19sYW5nPXpoCiAgKiBAcGFyYW0gZGF0YXNldF9pZCAtIFJlcXVpcmVkLiBUaGUgSUQgb2YgdGhlIGRhdGFzZXQgdG8gZGVsZXRlIHwg5b+F6YCJIOaVsOaNrumbhiBJRAogICovCgoKICBhc3luYyBkZWxldGUoZGF0YXNldF9pZCwgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gYC92MS9kYXRhc2V0cy8ke2RhdGFzZXRfaWR9YDsKICAgIGF3YWl0IHRoaXMuX2NsaWVudC5kZWxldGUoYXBpVXJsLCBmYWxzZSwgb3B0aW9ucyk7CiAgfQogIC8qKgogICogVmlld3MgdGhlIHByb2dyZXNzIG9mIGRhdGFzZXQgdXBsb2FkIHwg5p+l55yL5pWw5o2u6ZuG5LiK5Lyg6L+b5bqmCiAgKiBAZG9jcyBlbjogaHR0cHM6Ly93d3cuY296ZS5jb20vZG9jcy9kZXZlbG9wZXJfZ3VpZGVzL2dldF9kYXRhc2V0X3Byb2dyZXNzP19sYW5nPWVuCiAgKiBAZG9jcyB6aDogaHR0cHM6Ly93d3cuY296ZS5jbi9kb2NzL2RldmVsb3Blcl9ndWlkZXMvZ2V0X2RhdGFzZXRfcHJvZ3Jlc3M/X2xhbmc9emgKICAqIEBwYXJhbSBkYXRhc2V0X2lkIC0gUmVxdWlyZWQuIFRoZSBJRCBvZiB0aGUgZGF0YXNldCB0byBwcm9jZXNzIHwg5b+F6YCJIOaVsOaNrumbhiBJRAogICogQHBhcmFtIHBhcmFtcyAtIFJlcXVpcmVkLiBUaGUgcGFyYW1ldGVycyBmb3IgcHJvY2Vzc2luZyB0aGUgZGF0YXNldCB8IOW/hemAiSDlpITnkIbmlbDmja7pm4bnmoTlj4LmlbAKICAqIEBwYXJhbSBwYXJhbXMuZGF0YXNldF9pZHMgLSBSZXF1aXJlZC4gTGlzdCBvZiBkYXRhc2V0IElEcyB8IOW/hemAiSDmlbDmja7pm4YgSUQg5YiX6KGoCiAgKi8KCgogIGFzeW5jIHByb2Nlc3MoZGF0YXNldF9pZCwgcGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSBgL3YxL2RhdGFzZXRzLyR7ZGF0YXNldF9pZH0vcHJvY2Vzc2A7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5wb3N0KGFwaVVybCwgcGFyYW1zLCBmYWxzZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICB9CgogIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHsKICAgIHN1cGVyKC4uLmFyZ3MpLCB0aGlzLmRvY3VtZW50cyA9IG5ldyBkb2N1bWVudHNfRG9jdW1lbnRzKHRoaXMuX2NsaWVudCksIHRoaXMuaW1hZ2VzID0gbmV3IEltYWdlcyh0aGlzLl9jbGllbnQpOwogIH0KCn0KCmNsYXNzIFZvaWNlcyBleHRlbmRzIEFQSVJlc291cmNlIHsKICAvKioKICAqIEBkZXNjcmlwdGlvbiBDbG9uZSBhIHZvaWNlIHwg6Z+z6Imy5YWL6ZqGCiAgKiBAcGFyYW0gcGFyYW1zCiAgKiBAcGFyYW0gcGFyYW1zLnZvaWNlX25hbWUgLSBSZXF1aXJlZC4gVm9pY2UgbmFtZSwgY2Fubm90IGJlIGVtcHR5IGFuZCBtdXN0IGJlIGxvbmdlciB0aGFuIDYgY2hhcmFjdGVycwogICogfCDlpI3liLvnmoTpn7PoibLlkI3np7DvvIzkuI3og73kuLrnqbrvvIzplb/luqblpKfkuo4gNgogICogQHBhcmFtIHBhcmFtcy5maWxlIC0gUmVxdWlyZWQuIEF1ZGlvIGZpbGUgfCDpn7PpopHmlofku7YKICAqIEBwYXJhbSBwYXJhbXMuYXVkaW9fZm9ybWF0IC0gUmVxdWlyZWQuIE9ubHkgc3VwcG9ydHMgIndhdiIsICJtcDMiLCAib2dnIiwgIm00YSIsICJhYWMiLCAicGNtIiBmb3JtYXRzCiAgKiB8IOWPquaUr+aMgSAid2F2IiwgIm1wMyIsICJvZ2ciLCAibTRhIiwgImFhYyIsICJwY20iIOagvOW8jwogICogQHBhcmFtIHBhcmFtcy5sYW5ndWFnZSAtIE9wdGlvbmFsLiBPbmx5IHN1cHBvcnRzICJ6aCIsICJlbiIgImphIiAiZXMiICJpZCIgInB0IiBsYW5ndWFnZXMKICAqIHwg5Y+q5pSv5oyBICJ6aCIsICJlbiIgImphIiAiZXMiICJpZCIgInB0IiDor63np40KICAqIEBwYXJhbSBwYXJhbXMudm9pY2VfaWQgLSBPcHRpb25hbC4gSWYgcHJvdmlkZWQsIHdpbGwgdHJhaW4gb24gZXhpc3Rpbmcgdm9pY2UgYW5kIG92ZXJyaWRlIHByZXZpb3VzIHRyYWluaW5nCiAgKiB8IOS8oOWFpeeahOivneWwseS8muWcqOWOn+acieeahOmfs+iJsuS4iuWOu+iuree7g++8jOimhuebluWJjemdouiuree7g+WlveeahOmfs+iJsgogICogQHBhcmFtIHBhcmFtcy5wcmV2aWV3X3RleHQgLSBPcHRpb25hbC4gSWYgcHJvdmlkZWQsIHdpbGwgZ2VuZXJhdGUgcHJldmlldyBhdWRpbyBiYXNlZCBvbiB0aGlzIHRleHQsIG90aGVyd2lzZSB1c2VzIGRlZmF1bHQgdGV4dAogICogfCDlpoLmnpzkvKDlhaXkvJrln7rkuo7or6XmlofmnKznlJ/miJDpooTop4jpn7PpopHvvIzlkKbliJnkvb/nlKjpu5jorqTnmoTmlofmnKwKICAqIEBwYXJhbSBwYXJhbXMudGV4dCAtIE9wdGlvbmFsLiBVc2VycyBjYW4gcmVhZCB0aGlzIHRleHQsIHNlcnZpY2Ugd2lsbCBjb21wYXJlIGF1ZGlvIHdpdGggdGV4dC4gUmV0dXJucyBlcnJvciBpZiBkaWZmZXJlbmNlIGlzIHRvbyBsYXJnZQogICogfCDlj6/ku6XorqnnlKjmiLfmjInnhafor6XmlofmnKzlv7Xor7XvvIzmnI3liqHkvJrlr7nmr5Tpn7PpopHkuI7or6XmlofmnKznmoTlt67lvILjgILoi6Xlt67lvILov4flpKfkvJrov5Tlm57plJnor68KICAqIEBwYXJhbSBwYXJhbXMuc3BhY2VfaWQgLSBPcHRpb25hbC4gIFRoZSBzcGFjZSBpZCBvZiB0aGUgdm9pY2UuIHwg56m66Ze0SUQKICAqIEBwYXJhbSBwYXJhbXMuZGVzY3JpcHRpb24tIE9wdGlvbmFsLiBUaGUgZGVzY3JpcHRpb24gb2YgdGhlIHZvaWNlLiB8IOmfs+iJsuaPj+i/sAogICogQHBhcmFtIG9wdGlvbnMgLSBSZXF1ZXN0IG9wdGlvbnMKICAqIEByZXR1cm5zIENsb25lIHZvaWNlIGRhdGEKICAqLwogIGFzeW5jIGNsb25lKHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy92MS9hdWRpby92b2ljZXMvY2xvbmUnOwogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLl9jbGllbnQucG9zdChhcGlVcmwsICgwLCBleHRlcm5hbF9heGlvc19uYW1lc3BhY2VPYmplY3QudG9Gb3JtRGF0YSkocGFyYW1zKSwgZmFsc2UsIG9wdGlvbnMpOwogICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgfQogIC8qKgogICogQGRlc2NyaXB0aW9uIExpc3Qgdm9pY2VzIHwg6I635Y+W6Z+z6Imy5YiX6KGoCiAgKiBAcGFyYW0gcGFyYW1zCiAgKiBAcGFyYW0gcGFyYW1zLmZpbHRlcl9zeXN0ZW1fdm9pY2UgLSBPcHRpb25hbC4gV2hldGhlciB0byBmaWx0ZXIgc3lzdGVtIHZvaWNlcywgZGVmYXVsdCBpcyBmYWxzZQogICogfCDmmK/lkKbov4fmu6Tns7vnu5/pn7PoibIsIOm7mOiupOS4jei/h+a7pAogICogQHBhcmFtIHBhcmFtcy5wYWdlX251bSAtIE9wdGlvbmFsLiBTdGFydHMgZnJvbSAxIGJ5IGRlZmF1bHQsIHZhbHVlIG11c3QgYmUgPiAwCiAgKiB8IOS4jeS8oOm7mOiupOS7jiAxIOW8gOWni++8jOS8oOWAvOmcgOimgSA+IDAKICAqIEBwYXJhbSBwYXJhbXMucGFnZV9zaXplIC0gT3B0aW9uYWwuIERlZmF1bHQgaXMgMTAwLCB2YWx1ZSBtdXN0IGJlICgwLCAxMDBdCiAgKiB8IOS4jeS8oOm7mOiupCAxMDDvvIzkvKDlgLzpnIDopoEgKDAsIDEwMF0KICAqIEBwYXJhbSBvcHRpb25zIC0gUmVxdWVzdCBvcHRpb25zCiAgKiBAcmV0dXJucyBMaXN0IHZvaWNlcyBkYXRhCiAgKi8KCgogIGFzeW5jIGxpc3QocGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL3YxL2F1ZGlvL3ZvaWNlcyc7CiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMuX2NsaWVudC5nZXQoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBvcHRpb25zKTsKICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogIH0KCn0KCmNsYXNzIFRyYW5zY3JpcHRpb25zIGV4dGVuZHMgQVBJUmVzb3VyY2UgewogIC8qKgogICogQVNSIHZvaWNlIHRvIHRleHQgfCBBU1Ig6K+t6Z+z6L2s5paH5pysCiAgKiBAcGFyYW0gcGFyYW1zIC0gUmVxdWlyZWQgVGhlIHBhcmFtZXRlcnMgZm9yIGZpbGUgdXBsb2FkIHwg5LiK5Lyg5paH5Lu25omA6ZyA55qE5Y+C5pWwCiAgKiBAcGFyYW0gcGFyYW1zLmZpbGUgLSBSZXF1aXJlZCBUaGUgYXVkaW8gZmlsZSB0byBiZSB1cGxvYWRlZC4gfCDpnIDopoHkuIrkvKDnmoTpn7PpopHmlofku7bjgIIKICAqLwogIGFzeW5jIGNyZWF0ZShwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9ICcvdjEvYXVkaW8vdHJhbnNjcmlwdGlvbnMnOwogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLl9jbGllbnQucG9zdChhcGlVcmwsICgwLCBleHRlcm5hbF9heGlvc19uYW1lc3BhY2VPYmplY3QudG9Gb3JtRGF0YSkocGFyYW1zKSwgZmFsc2UsIG9wdGlvbnMpOwogICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgfQoKfQoKY2xhc3MgU3BlZWNoIGV4dGVuZHMgQVBJUmVzb3VyY2UgewogIC8qKgogICogQGRlc2NyaXB0aW9uIFNwZWVjaCBzeW50aGVzaXMgfCDor63pn7PlkIjmiJAKICAqIEBwYXJhbSBwYXJhbXMKICAqIEBwYXJhbSBwYXJhbXMuaW5wdXQgLSBSZXF1aXJlZC4gVGV4dCB0byBnZW5lcmF0ZSBhdWRpbyB8IOimgeS4uuWFtueUn+aIkOmfs+mikeeahOaWh+acrAogICogQHBhcmFtIHBhcmFtcy52b2ljZV9pZCAtIFJlcXVpcmVkLiBWb2ljZSBJRCB8IOeUn+aIkOmfs+mikeeahOmfs+iJsiBJRAogICogQHBhcmFtIHBhcmFtcy5yZXNwb25zZV9mb3JtYXQgLSBPcHRpb25hbC4gQXVkaW8gZW5jb2RpbmcgZm9ybWF0LAogICogc3VwcG9ydHMgIndhdiIsICJwY20iLCAib2dnIiwgIm9wdXMiLCAibXAzIiwgZGVmYXVsdCBpcyAibXAzIgogICogfCDpn7PpopHnvJbnoIHmoLzlvI/vvIzmlK/mjIEgIndhdiIsICJwY20iLCAib2dnIiwgIm9wdXMiLCAibXAzIu+8jOm7mOiupOaYryAibXAzIgogICogQHBhcmFtIG9wdGlvbnMgLSBSZXF1ZXN0IG9wdGlvbnMKICAqIEByZXR1cm5zIFNwZWVjaCBzeW50aGVzaXMgZGF0YQogICovCiAgYXN5bmMgY3JlYXRlKHBhcmFtcywgb3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy92MS9hdWRpby9zcGVlY2gnOwogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLl9jbGllbnQucG9zdChhcGlVcmwsIHsgLi4ucGFyYW1zLAogICAgICBzYW1wbGVfcmF0ZTogcGFyYW1zLnNhbXBsZV9yYXRlIHx8IDI0MDAwCiAgICB9LCBmYWxzZSwgbWVyZ2VDb25maWcob3B0aW9ucywgewogICAgICByZXNwb25zZVR5cGU6ICdhcnJheWJ1ZmZlcicKICAgIH0pKTsKICAgIHJldHVybiByZXNwb25zZTsKICB9Cgp9CgpjbGFzcyBSb29tcyBleHRlbmRzIEFQSVJlc291cmNlIHsKICBhc3luYyBjcmVhdGUocGFyYW1zLCBvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL3YxL2F1ZGlvL3Jvb21zJzsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBvcHRpb25zKTsKICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogIH0KCn0KCmNsYXNzIEF1ZGlvIGV4dGVuZHMgQVBJUmVzb3VyY2UgewogIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHsKICAgIHN1cGVyKC4uLmFyZ3MpLCB0aGlzLnJvb21zID0gbmV3IFJvb21zKHRoaXMuX2NsaWVudCksIHRoaXMudm9pY2VzID0gbmV3IFZvaWNlcyh0aGlzLl9jbGllbnQpLCB0aGlzLnNwZWVjaCA9IG5ldyBTcGVlY2godGhpcy5fY2xpZW50KSwgdGhpcy50cmFuc2NyaXB0aW9ucyA9IG5ldyBUcmFuc2NyaXB0aW9ucyh0aGlzLl9jbGllbnQpOwogIH0KCn0KCmNsYXNzIFRlbXBsYXRlcyBleHRlbmRzIEFQSVJlc291cmNlIHsKICAvKioKICAqIER1cGxpY2F0ZSBhIHRlbXBsYXRlLiB8IOWkjeWItuS4gOS4quaooeadv+OAggogICogQHBhcmFtIHRlbXBsYXRlSWQgLSBSZXF1aXJlZC4gVGhlIElEIG9mIHRoZSB0ZW1wbGF0ZSB0byBkdXBsaWNhdGUuIHwg6KaB5aSN5Yi255qE5qih5p2/55qEIElE44CCCiAgKiBAcGFyYW0gcGFyYW1zIC0gT3B0aW9uYWwuIFRoZSBwYXJhbWV0ZXJzIGZvciB0aGUgZHVwbGljYXRlIG9wZXJhdGlvbi4gfCDlj6/pgInlj4LmlbDvvIznlKjkuo7lpI3liLbmk43kvZzjgIIKICAqIEBwYXJhbSBwYXJhbXMud29ya3NwYWNlX2lkIC0gUmVxdWlyZWQuIFRoZSBJRCBvZiB0aGUgd29ya3NwYWNlIHRvIGR1cGxpY2F0ZSB0aGUgdGVtcGxhdGUgaW50by4gfCDopoHlpI3liLbliLDnmoTnm67moIflt6XkvZznqbrpl7TnmoQgSUTjgIIKICAqIEBwYXJhbSBwYXJhbXMubmFtZSAtIE9wdGlvbmFsLiBUaGUgbmFtZSBvZiB0aGUgbmV3IHRlbXBsYXRlLiB8IOaWsOaooeadv+eahOWQjeensOOAggogICogQHJldHVybnMgVGVtcGxhdGVEdXBsaWNhdGVSZXMgfCDlpI3liLbmqKHmnb/nu5PmnpwKICAqLwogIGFzeW5jIGR1cGxpY2F0ZSh0ZW1wbGF0ZUlkLCBwYXJhbXMsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9IGAvdjEvdGVtcGxhdGVzLyR7dGVtcGxhdGVJZH0vZHVwbGljYXRlYDsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdGhpcy5fY2xpZW50LnBvc3QoYXBpVXJsLCBwYXJhbXMsIGZhbHNlLCBvcHRpb25zKTsKICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogIH0KCn0KCnZhciB0ZW1wbGF0ZXNfVGVtcGxhdGVFbnRpdHlUeXBlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChUZW1wbGF0ZUVudGl0eVR5cGUpIHsKICBUZW1wbGF0ZUVudGl0eVR5cGVbIkFHRU5UIl0gPSAiYWdlbnQiOwogIHJldHVybiBUZW1wbGF0ZUVudGl0eVR5cGU7Cn0oe30pOwoKY2xhc3MgY2hhdF9DaGF0IGV4dGVuZHMgQVBJUmVzb3VyY2UgewogIGFzeW5jIGNyZWF0ZShyZXEsIG9wdGlvbnMpIHsKICAgIGNvbnN0IGFwaVVybCA9IGJ1aWxkV2Vic29ja2V0VXJsKCcvdjEvY2hhdCcsIHJlcSk7CiAgICByZXR1cm4gYXdhaXQgdGhpcy5fY2xpZW50Lm1ha2VXZWJzb2NrZXQoYXBpVXJsLCBvcHRpb25zKTsKICB9Cgp9CgpjbGFzcyB0cmFuc2NyaXB0aW9uc19UcmFuc2NyaXB0aW9ucyBleHRlbmRzIEFQSVJlc291cmNlIHsKICBhc3luYyBjcmVhdGUob3B0aW9ucykgewogICAgY29uc3QgYXBpVXJsID0gJy92MS9hdWRpby90cmFuc2NyaXB0aW9ucyc7CiAgICByZXR1cm4gYXdhaXQgdGhpcy5fY2xpZW50Lm1ha2VXZWJzb2NrZXQoYXBpVXJsLCBvcHRpb25zKTsKICB9Cgp9CgpjbGFzcyBzcGVlY2hfU3BlZWNoIGV4dGVuZHMgQVBJUmVzb3VyY2UgewogIGFzeW5jIGNyZWF0ZShvcHRpb25zKSB7CiAgICBjb25zdCBhcGlVcmwgPSAnL3YxL2F1ZGlvL3NwZWVjaCc7CiAgICByZXR1cm4gYXdhaXQgdGhpcy5fY2xpZW50Lm1ha2VXZWJzb2NrZXQoYXBpVXJsLCBvcHRpb25zKTsKICB9Cgp9CgpjbGFzcyBhdWRpb19BdWRpbyBleHRlbmRzIEFQSVJlc291cmNlIHsKICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7CiAgICBzdXBlciguLi5hcmdzKSwgdGhpcy5zcGVlY2ggPSBuZXcgc3BlZWNoX1NwZWVjaCh0aGlzLl9jbGllbnQpLCB0aGlzLnRyYW5zY3JpcHRpb25zID0gbmV3IHRyYW5zY3JpcHRpb25zX1RyYW5zY3JpcHRpb25zKHRoaXMuX2NsaWVudCk7CiAgfQoKfSAvLyBDb21tb24gdHlwZXMgKG5vdCBleHBvcnRlZCkKLy8gS2VlcCBhbGwgZXhpc3RpbmcgZXhwb3J0cyBidXQgdXNlIHRoZSBiYXNlIHR5cGVzIHdoZXJlIGFwcGxpY2FibGUKCgp2YXIgdHlwZXNfV2Vic29ja2V0c0V2ZW50VHlwZSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoV2Vic29ja2V0c0V2ZW50VHlwZSkgewogIC8vIENvbW1vbgoKICAvKiogU0RLIGVycm9yICovCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiQ0xJRU5UX0VSUk9SIl0gPSAiY2xpZW50X2Vycm9yIjsKICAvKiogQ29ubmVjdGlvbiBjbG9zZWQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiQ0xPU0VEIl0gPSAiY2xvc2VkIjsKICAvKiogQWxsIGV2ZW50cyAqLwoKICBXZWJzb2NrZXRzRXZlbnRUeXBlWyJBTEwiXSA9ICJhbGwiOyAvLyBFcnJvcgoKICAvKiogUmVjZWl2ZWQgZXJyb3IgZXZlbnQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiRVJST1IiXSA9ICJlcnJvciI7IC8vIHYxL2F1ZGlvL3NwZWVjaAoKICAvKiogU2VuZCB0ZXh0IHRvIHNlcnZlciAqLwoKICBXZWJzb2NrZXRzRXZlbnRUeXBlWyJJTlBVVF9URVhUX0JVRkZFUl9BUFBFTkQiXSA9ICJpbnB1dF90ZXh0X2J1ZmZlci5hcHBlbmQiOwogIC8qKiBObyB0ZXh0IHRvIHNlbmQsIGFmdGVyIGF1ZGlvIGFsbCByZWNlaXZlZCwgY2FuIGNsb3NlIGNvbm5lY3Rpb24gKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiSU5QVVRfVEVYVF9CVUZGRVJfQ09NUExFVEUiXSA9ICJpbnB1dF90ZXh0X2J1ZmZlci5jb21wbGV0ZSI7CiAgLyoqIFNlbmQgc3BlZWNoIGNvbmZpZyB0byBzZXJ2ZXIgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiU1BFRUNIX1VQREFURSJdID0gInNwZWVjaC51cGRhdGUiOwogIC8qKiBSZWNlaXZlZCBgc3BlZWNoLnVwZGF0ZWRgIGV2ZW50ICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIlNQRUVDSF9VUERBVEVEIl0gPSAic3BlZWNoLnVwZGF0ZWQiOwogIC8qKiBBZnRlciBzcGVlY2ggY3JlYXRlZCAqLwoKICBXZWJzb2NrZXRzRXZlbnRUeXBlWyJTUEVFQ0hfQ1JFQVRFRCJdID0gInNwZWVjaC5jcmVhdGVkIjsKICAvKiogUmVjZWl2ZWQgYGlucHV0X3RleHRfYnVmZmVyLmNvbXBsZXRlYCBldmVudCAqLwoKICBXZWJzb2NrZXRzRXZlbnRUeXBlWyJJTlBVVF9URVhUX0JVRkZFUl9DT01QTEVURUQiXSA9ICJpbnB1dF90ZXh0X2J1ZmZlci5jb21wbGV0ZWQiOwogIC8qKiBSZWNlaXZlZCBgc3BlZWNoLnVwZGF0ZWAgZXZlbnQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiU1BFRUNIX0FVRElPX1VQREFURSJdID0gInNwZWVjaC5hdWRpby51cGRhdGUiOwogIC8qKiBBbGwgYXVkaW8gcmVjZWl2ZWQsIGNhbiBjbG9zZSBjb25uZWN0aW9uICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIlNQRUVDSF9BVURJT19DT01QTEVURUQiXSA9ICJzcGVlY2guYXVkaW8uY29tcGxldGVkIjsgLy8gdjEvYXVkaW8vdHJhbnNjcmlwdGlvbnMKCiAgLyoqIFNlbmQgYXVkaW8gdG8gc2VydmVyICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIklOUFVUX0FVRElPX0JVRkZFUl9BUFBFTkQiXSA9ICJpbnB1dF9hdWRpb19idWZmZXIuYXBwZW5kIjsKICAvKiogTm8gYXVkaW8gdG8gc2VuZCwgYWZ0ZXIgdGV4dCBhbGwgcmVjZWl2ZWQsIGNhbiBjbG9zZSBjb25uZWN0aW9uICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIklOUFVUX0FVRElPX0JVRkZFUl9DT01QTEVURSJdID0gImlucHV0X2F1ZGlvX2J1ZmZlci5jb21wbGV0ZSI7CiAgLyoqIFNlbmQgdHJhbnNjcmlwdGlvbnMgY29uZmlnIHRvIHNlcnZlciAqLwoKICBXZWJzb2NrZXRzRXZlbnRUeXBlWyJUUkFOU0NSSVBUSU9OU19VUERBVEUiXSA9ICJ0cmFuc2NyaXB0aW9ucy51cGRhdGUiOwogIC8qKiBTZW5kIGBpbnB1dF9hdWRpb19idWZmZXIuY2xlYXJgIGV2ZW50ICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIklOUFVUX0FVRElPX0JVRkZFUl9DTEVBUiJdID0gImlucHV0X2F1ZGlvX2J1ZmZlci5jbGVhciI7CiAgLyoqIEFmdGVyIHRyYW5zY3JpcHRpb25zIGNyZWF0ZWQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiVFJBTlNDUklQVElPTlNfQ1JFQVRFRCJdID0gInRyYW5zY3JpcHRpb25zLmNyZWF0ZWQiOwogIC8qKiBSZWNlaXZlZCBgaW5wdXRfYXVkaW9fYnVmZmVyLmNvbXBsZXRlYCBldmVudCAqLwoKICBXZWJzb2NrZXRzRXZlbnRUeXBlWyJJTlBVVF9BVURJT19CVUZGRVJfQ09NUExFVEVEIl0gPSAiaW5wdXRfYXVkaW9fYnVmZmVyLmNvbXBsZXRlZCI7CiAgLyoqIFJlY2VpdmVkIGB0cmFuc2NyaXB0aW9ucy51cGRhdGVgIGV2ZW50ICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIlRSQU5TQ1JJUFRJT05TX01FU1NBR0VfVVBEQVRFIl0gPSAidHJhbnNjcmlwdGlvbnMubWVzc2FnZS51cGRhdGUiOwogIC8qKiBBbGwgYXVkaW8gcmVjZWl2ZWQsIGNhbiBjbG9zZSBjb25uZWN0aW9uICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIlRSQU5TQ1JJUFRJT05TX01FU1NBR0VfQ09NUExFVEVEIl0gPSAidHJhbnNjcmlwdGlvbnMubWVzc2FnZS5jb21wbGV0ZWQiOwogIC8qKiBSZWNlaXZlZCBgaW5wdXRfYXVkaW9fYnVmZmVyLmNsZWFyZWRgIGV2ZW50ICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIklOUFVUX0FVRElPX0JVRkZFUl9DTEVBUkVEIl0gPSAiaW5wdXRfYXVkaW9fYnVmZmVyLmNsZWFyZWQiOwogIC8qKiBSZWNlaXZlZCBgdHJhbnNjcmlwdGlvbnMudXBkYXRlZGAgZXZlbnQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiVFJBTlNDUklQVElPTlNfVVBEQVRFRCJdID0gInRyYW5zY3JpcHRpb25zLnVwZGF0ZWQiOyAvLyB2MS9jaGF0CgogIC8qKiBTZW5kIGNoYXQgY29uZmlnIHRvIHNlcnZlciAqLwoKICBXZWJzb2NrZXRzRXZlbnRUeXBlWyJDSEFUX1VQREFURSJdID0gImNoYXQudXBkYXRlIjsKICAvKiogU2VuZCB0b29sIG91dHB1dHMgdG8gc2VydmVyICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9DSEFUX1NVQk1JVF9UT09MX09VVFBVVFMiXSA9ICJjb252ZXJzYXRpb24uY2hhdC5zdWJtaXRfdG9vbF9vdXRwdXRzIjsKICAvKiogQWZ0ZXIgY2hhdCBjcmVhdGVkICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNIQVRfQ1JFQVRFRCJdID0gImNoYXQuY3JlYXRlZCI7CiAgLyoqIEFmdGVyIGNoYXQgdXBkYXRlZCAqLwoKICBXZWJzb2NrZXRzRXZlbnRUeXBlWyJDSEFUX1VQREFURUQiXSA9ICJjaGF0LnVwZGF0ZWQiOwogIC8qKiBBdWRpbyBBU1QgY29tcGxldGVkLCBjaGF0IHN0YXJ0ZWQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX0NIQVRfQ1JFQVRFRCJdID0gImNvbnZlcnNhdGlvbi5jaGF0LmNyZWF0ZWQiOwogIC8qKiBNZXNzYWdlIGNyZWF0ZWQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX01FU1NBR0VfQ1JFQVRFIl0gPSAiY29udmVyc2F0aW9uLm1lc3NhZ2UuY3JlYXRlIjsKICAvKiogQ2xlYXIgY29udmVyc2F0aW9uICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9DTEVBUiJdID0gImNvbnZlcnNhdGlvbi5jbGVhciI7CiAgLyoqIENoYXQgaW4gcHJvZ3Jlc3MgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX0NIQVRfSU5fUFJPR1JFU1MiXSA9ICJjb252ZXJzYXRpb24uY2hhdC5pbl9wcm9ncmVzcyI7CiAgLyoqIEdldCBhZ2VudCB0ZXh0IG1lc3NhZ2UgdXBkYXRlICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9NRVNTQUdFX0RFTFRBIl0gPSAiY29udmVyc2F0aW9uLm1lc3NhZ2UuZGVsdGEiOwogIC8qKiBOZWVkIHBsdWdpbiBzdWJtaXQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX0NIQVRfUkVRVUlSRVNfQUNUSU9OIl0gPSAiY29udmVyc2F0aW9uLmNoYXQucmVxdWlyZXNfYWN0aW9uIjsKICAvKiogTWVzc2FnZSBjb21wbGV0ZWQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX01FU1NBR0VfQ09NUExFVEVEIl0gPSAiY29udmVyc2F0aW9uLm1lc3NhZ2UuY29tcGxldGVkIjsKICAvKiogR2V0IGFnZW50IGF1ZGlvIG1lc3NhZ2UgdXBkYXRlICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9BVURJT19ERUxUQSJdID0gImNvbnZlcnNhdGlvbi5hdWRpby5kZWx0YSI7CiAgLyoqIEF1ZGlvIG1lc3NhZ2UgY29tcGxldGVkICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9BVURJT19DT01QTEVURUQiXSA9ICJjb252ZXJzYXRpb24uYXVkaW8uY29tcGxldGVkIjsKICAvKiogQWxsIG1lc3NhZ2UgcmVjZWl2ZWQsIGNhbiBjbG9zZSBjb25uZWN0aW9uICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9DSEFUX0NPTVBMRVRFRCJdID0gImNvbnZlcnNhdGlvbi5jaGF0LmNvbXBsZXRlZCI7CiAgLyoqIENoYXQgZmFpbGVkICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9DSEFUX0ZBSUxFRCJdID0gImNvbnZlcnNhdGlvbi5jaGF0LmZhaWxlZCI7CiAgLyoqIFJlY2VpdmVkIGBjb252ZXJzYXRpb24uY2xlYXJlZGAgZXZlbnQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX0NMRUFSRUQiXSA9ICJjb252ZXJzYXRpb24uY2xlYXJlZCI7CiAgLyoqIFNwZWVjaCBzdGFydGVkICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIklOUFVUX0FVRElPX0JVRkZFUl9TUEVFQ0hfU1RBUlRFRCJdID0gImlucHV0X2F1ZGlvX2J1ZmZlci5zcGVlY2hfc3RhcnRlZCI7CiAgLyoqIFNwZWVjaCBzdG9wcGVkICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIklOUFVUX0FVRElPX0JVRkZFUl9TUEVFQ0hfU1RPUFBFRCJdID0gImlucHV0X2F1ZGlvX2J1ZmZlci5zcGVlY2hfc3RvcHBlZCI7CiAgLyoqIENoYXQgaW50ZXJydXB0ZWQgYnkgY2xpZW50ICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9DSEFUX0NBTkNFTCJdID0gImNvbnZlcnNhdGlvbi5jaGF0LmNhbmNlbCI7CiAgLyoqIENoYXQgY2FuY2VsZWQgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiQ09OVkVSU0FUSU9OX0NIQVRfQ0FOQ0VMRUQiXSA9ICJjb252ZXJzYXRpb24uY2hhdC5jYW5jZWxlZCI7CiAgLyoqIEF1ZGlvIHRyYW5zY3JpcHQgdXBkYXRlICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9BVURJT19UUkFOU0NSSVBUX1VQREFURSJdID0gImNvbnZlcnNhdGlvbi5hdWRpb190cmFuc2NyaXB0LnVwZGF0ZSI7CiAgLyoqIEF1ZGlvIHRyYW5zY3JpcHQgY29tcGxldGVkICovCgogIFdlYnNvY2tldHNFdmVudFR5cGVbIkNPTlZFUlNBVElPTl9BVURJT19UUkFOU0NSSVBUX0NPTVBMRVRFRCJdID0gImNvbnZlcnNhdGlvbi5hdWRpb190cmFuc2NyaXB0LmNvbXBsZXRlZCI7CiAgLyoqIEF1ZGlvIGR1bXAgKi8KCiAgV2Vic29ja2V0c0V2ZW50VHlwZVsiRFVNUF9BVURJTyJdID0gImR1bXAuYXVkaW8iOwogIHJldHVybiBXZWJzb2NrZXRzRXZlbnRUeXBlOwp9KHt9KTsKCmNsYXNzIFdlYnNvY2tldHMgZXh0ZW5kcyBBUElSZXNvdXJjZSB7CiAgY29uc3RydWN0b3IoLi4uYXJncykgewogICAgc3VwZXIoLi4uYXJncyksIHRoaXMuYXVkaW8gPSBuZXcgYXVkaW9fQXVkaW8odGhpcy5fY2xpZW50KSwgdGhpcy5jaGF0ID0gbmV3IGNoYXRfQ2hhdCh0aGlzLl9jbGllbnQpOwogIH0KCn0KCmNvbnN0IGV4dGVybmFsX3dzX25hbWVzcGFjZU9iamVjdCA9IHJlcXVpcmUoIndzIik7Cgp2YXIgZXh0ZXJuYWxfd3NfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oZXh0ZXJuYWxfd3NfbmFtZXNwYWNlT2JqZWN0KTsKCmNvbnN0IGV4dGVybmFsX3JlY29ubmVjdGluZ193ZWJzb2NrZXRfbmFtZXNwYWNlT2JqZWN0ID0gcmVxdWlyZSgicmVjb25uZWN0aW5nLXdlYnNvY2tldCIpOwoKdmFyIGV4dGVybmFsX3JlY29ubmVjdGluZ193ZWJzb2NrZXRfZGVmYXVsdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm4oZXh0ZXJuYWxfcmVjb25uZWN0aW5nX3dlYnNvY2tldF9uYW1lc3BhY2VPYmplY3QpOwoKY2xhc3MgV2ViU29ja2V0QVBJIHsKICAvLyBTdGFuZGFyZCBXZWJTb2NrZXQgcHJvcGVydGllcwogIGdldCByZWFkeVN0YXRlKCkgewogICAgcmV0dXJuIHRoaXMucndzLnJlYWR5U3RhdGU7CiAgfSAvLyBTdGFuZGFyZCBXZWJTb2NrZXQgbWV0aG9kcwoKCiAgc2VuZChkYXRhKSB7CiAgICByZXR1cm4gdGhpcy5yd3Muc2VuZChKU09OLnN0cmluZ2lmeShkYXRhKSk7CiAgfQoKICBjbG9zZShjb2RlLCByZWFzb24pIHsKICAgIHJldHVybiB0aGlzLnJ3cy5jbG9zZShjb2RlLCByZWFzb24pOwogIH0KCiAgcmVjb25uZWN0KGNvZGUsIHJlYXNvbikgewogICAgcmV0dXJuIHRoaXMucndzLnJlY29ubmVjdChjb2RlLCByZWFzb24pOwogIH0gLy8gRXZlbnQgbGlzdGVuZXIgbWV0aG9kcwoKCiAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgdGhpcy5yd3MuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcik7CiAgfQoKICByZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKSB7CiAgICB0aGlzLnJ3cy5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGxpc3RlbmVyKTsKICB9CgogIGNvbnN0cnVjdG9yKHVybCwgb3B0aW9ucyA9IHt9KSB7CiAgICAvLyBFdmVudCBoYW5kbGVyIG1ldGhvZHMKICAgIHRoaXMub25tZXNzYWdlID0gbnVsbDsKICAgIHRoaXMub25vcGVuID0gbnVsbDsKICAgIHRoaXMub25jbG9zZSA9IG51bGw7CiAgICB0aGlzLm9uZXJyb3IgPSBudWxsOwogICAgY29uc3Qgc2VwYXJhdG9yID0gdXJsLmluY2x1ZGVzKCc/JykgPyAnJicgOiAnPyc7CiAgICBjb25zdCB7CiAgICAgIGF1dGhvcml6YXRpb24KICAgIH0gPSBvcHRpb25zLmhlYWRlcnMgfHwge307CiAgICB0aGlzLnJ3cyA9IG5ldyAoZXh0ZXJuYWxfcmVjb25uZWN0aW5nX3dlYnNvY2tldF9kZWZhdWx0KCkpKGAke3VybH0ke3NlcGFyYXRvcn1hdXRob3JpemF0aW9uPSR7YXV0aG9yaXphdGlvbn1gLCBbXSwgewogICAgICBXZWJTb2NrZXQ6IGlzQnJvd3NlcigpID8gd2luZG93LldlYlNvY2tldCA6IGNsYXNzIGV4dGVuZHMgZXh0ZXJuYWxfd3NfZGVmYXVsdCgpIHsKICAgICAgICBjb25zdHJ1Y3Rvcih1cmwyLCBwcm90b2NvbHMpIHsKICAgICAgICAgIHN1cGVyKHVybDIsIHByb3RvY29scywgewogICAgICAgICAgICBoZWFkZXJzOiBvcHRpb25zLmhlYWRlcnMKICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgIH0sCiAgICAgIC4uLm9wdGlvbnMKICAgIH0pOwogICAgdGhpcy5yd3MuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGV2ZW50ID0+IHsKICAgICAgdHJ5IHsKICAgICAgICB2YXIgX3RoaXNfb25tZXNzYWdlLCBfdGhpczsKCiAgICAgICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UoZXZlbnQuZGF0YSk7CiAgICAgICAgbnVsbCA9PT0gKF90aGlzX29ubWVzc2FnZSA9IChfdGhpcyA9IHRoaXMpLm9ubWVzc2FnZSkgfHwgdm9pZCAwID09PSBfdGhpc19vbm1lc3NhZ2UgfHwgX3RoaXNfb25tZXNzYWdlLmNhbGwoX3RoaXMsIGRhdGEsIGV2ZW50KTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmVycm9yKCdXZWJTb2NrZXRBUEkgb25tZXNzYWdlIGVycm9yJywgZXJyb3IpOwogICAgICB9CiAgICB9KTsKICAgIHRoaXMucndzLmFkZEV2ZW50TGlzdGVuZXIoJ29wZW4nLCBldmVudCA9PiB7CiAgICAgIHZhciBfdGhpc19vbm9wZW4sIF90aGlzOwoKICAgICAgbnVsbCA9PT0gKF90aGlzX29ub3BlbiA9IChfdGhpcyA9IHRoaXMpLm9ub3BlbikgfHwgdm9pZCAwID09PSBfdGhpc19vbm9wZW4gfHwgX3RoaXNfb25vcGVuLmNhbGwoX3RoaXMsIGV2ZW50KTsKICAgIH0pOwogICAgdGhpcy5yd3MuYWRkRXZlbnRMaXN0ZW5lcignY2xvc2UnLCBldmVudCA9PiB7CiAgICAgIHZhciBfdGhpc19vbmNsb3NlLCBfdGhpczsKCiAgICAgIG51bGwgPT09IChfdGhpc19vbmNsb3NlID0gKF90aGlzID0gdGhpcykub25jbG9zZSkgfHwgdm9pZCAwID09PSBfdGhpc19vbmNsb3NlIHx8IF90aGlzX29uY2xvc2UuY2FsbChfdGhpcywgZXZlbnQpOwogICAgfSk7CiAgICB0aGlzLnJ3cy5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGV2ZW50ID0+IHsKICAgICAgdmFyIF9ldmVudF90YXJnZXRfX3JlcV9yZXMsIF9ldmVudF90YXJnZXRfX3JlcSwgX2V2ZW50X3RhcmdldCwgX2V2ZW50X3RhcmdldF9fcmVxX3JlczEsIF9ldmVudF90YXJnZXRfX3JlcTEsIF9ldmVudF90YXJnZXQxLCBfdGhpc19vbmVycm9yLCBfdGhpczsKCiAgICAgIGNvbnN0IHsKICAgICAgICByZWFkeVN0YXRlCiAgICAgIH0gPSB0aGlzLnJ3czsKICAgICAgaWYgKDMgPT09IHJlYWR5U3RhdGUpIHJldHVybjsKICAgICAgY29uc3Qgc3RhdHVzQ29kZSA9IG51bGwgPT09IChfZXZlbnRfdGFyZ2V0ID0gZXZlbnQudGFyZ2V0KSB8fCB2b2lkIDAgPT09IF9ldmVudF90YXJnZXQgPyB2b2lkIDAgOiBudWxsID09PSAoX2V2ZW50X3RhcmdldF9fcmVxID0gX2V2ZW50X3RhcmdldC5fcmVxKSB8fCB2b2lkIDAgPT09IF9ldmVudF90YXJnZXRfX3JlcSA/IHZvaWQgMCA6IG51bGwgPT09IChfZXZlbnRfdGFyZ2V0X19yZXFfcmVzID0gX2V2ZW50X3RhcmdldF9fcmVxLnJlcykgfHwgdm9pZCAwID09PSBfZXZlbnRfdGFyZ2V0X19yZXFfcmVzID8gdm9pZCAwIDogX2V2ZW50X3RhcmdldF9fcmVxX3Jlcy5zdGF0dXNDb2RlOwogICAgICBjb25zdCByYXdIZWFkZXJzID0gKG51bGwgPT09IChfZXZlbnRfdGFyZ2V0MSA9IGV2ZW50LnRhcmdldCkgfHwgdm9pZCAwID09PSBfZXZlbnRfdGFyZ2V0MSA/IHZvaWQgMCA6IG51bGwgPT09IChfZXZlbnRfdGFyZ2V0X19yZXExID0gX2V2ZW50X3RhcmdldDEuX3JlcSkgfHwgdm9pZCAwID09PSBfZXZlbnRfdGFyZ2V0X19yZXExID8gdm9pZCAwIDogbnVsbCA9PT0gKF9ldmVudF90YXJnZXRfX3JlcV9yZXMxID0gX2V2ZW50X3RhcmdldF9fcmVxMS5yZXMpIHx8IHZvaWQgMCA9PT0gX2V2ZW50X3RhcmdldF9fcmVxX3JlczEgPyB2b2lkIDAgOiBfZXZlbnRfdGFyZ2V0X19yZXFfcmVzMS5yYXdIZWFkZXJzKSB8fCBbXTsKICAgICAgY29uc3QgbG9naWRJbmRleCA9IHJhd0hlYWRlcnMuZmluZEluZGV4KGhlYWRlciA9PiAnWC1UdC1Mb2dpZCcgPT09IGhlYWRlcik7CiAgICAgIGNvbnN0IGxvZ2lkID0gLTEgIT09IGxvZ2lkSW5kZXggPyByYXdIZWFkZXJzW2xvZ2lkSW5kZXggKyAxXSA6IHZvaWQgMDsKICAgICAgY29uc3QgZXJyb3IgPSB7CiAgICAgICAgaWQ6ICcwJywKICAgICAgICBldmVudF90eXBlOiB0eXBlc19XZWJzb2NrZXRzRXZlbnRUeXBlLkVSUk9SLAogICAgICAgIGRhdGE6IHsKICAgICAgICAgIGNvZGU6IC0xLAogICAgICAgICAgbXNnOiAnV2ViU29ja2V0IGVycm9yJwogICAgICAgIH0sCiAgICAgICAgZGV0YWlsOiB7CiAgICAgICAgICBsb2dpZAogICAgICAgIH0KICAgICAgfTsKCiAgICAgIGlmICg0MDEgPT09IHN0YXR1c0NvZGUpIHsKICAgICAgICBlcnJvci5kYXRhLmNvZGUgPSA0MDE7CiAgICAgICAgZXJyb3IuZGF0YS5tc2cgPSAnVW5hdXRob3JpemVkJzsKICAgICAgfSBlbHNlIGlmICg0MDMgPT09IHN0YXR1c0NvZGUpIHsKICAgICAgICBlcnJvci5kYXRhLmNvZGUgPSA0MDM7CiAgICAgICAgZXJyb3IuZGF0YS5tc2cgPSAnRm9yYmlkZGVuJzsKICAgICAgfSBlbHNlIHsKICAgICAgICBlcnJvci5kYXRhLmNvZGUgPSA1MDA7CgogICAgICAgIHZhciBfZXZlbnRfZXJyb3I7CgogICAgICAgIGVycm9yLmRhdGEubXNnID0gU3RyaW5nKG51bGwgIT09IChfZXZlbnRfZXJyb3IgPSBudWxsID09IGV2ZW50ID8gdm9pZCAwIDogZXZlbnQuZXJyb3IpICYmIHZvaWQgMCAhPT0gX2V2ZW50X2Vycm9yID8gX2V2ZW50X2Vycm9yIDogJycpIHx8ICdXZWJTb2NrZXQgZXJyb3InOwogICAgICB9CgogICAgICBudWxsID09PSAoX3RoaXNfb25lcnJvciA9IChfdGhpcyA9IHRoaXMpLm9uZXJyb3IpIHx8IHZvaWQgMCA9PT0gX3RoaXNfb25lcnJvciB8fCBfdGhpc19vbmVycm9yLmNhbGwoX3RoaXMsIGVycm9yLCBldmVudCk7CiAgICB9KTsKICB9Cgp9Cgpjb25zdCBleHRlcm5hbF9vc19uYW1lc3BhY2VPYmplY3QgPSByZXF1aXJlKCJvcyIpOwoKdmFyIGV4dGVybmFsX29zX2RlZmF1bHQgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy5uKGV4dGVybmFsX29zX25hbWVzcGFjZU9iamVjdCk7Cgp2YXIgcGFja2FnZV9uYW1lc3BhY2VPYmplY3QgPSBKU09OLnBhcnNlKCd7Im5hbWUiOiJAY296ZS9hcGkiLCJ2ZXJzaW9uIjoiMS4yLjAiLCJkZXNjcmlwdGlvbiI6Ik9mZmljaWFsIENvemUgTm9kZS5qcyBTREsgZm9yIHNlYW1sZXNzIEFJIGludGVncmF0aW9uIGludG8geW91ciBhcHBsaWNhdGlvbnMgfCDmiaPlrZDlrpjmlrkgTm9kZS5qcyBTREvvvIzliqnmgqjovbvmnb7pm4bmiJAgQUkg6IO95Yqb5Yiw5bqU55So5LitIiwia2V5d29yZHMiOlsiY296ZSIsImFpIiwibm9kZWpzIiwic2RrIiwiY2hhdGJvdCIsInR5cGVzY3JpcHQiXSwiaG9tZXBhZ2UiOiJodHRwczovL2dpdGh1Yi5jb20vY296ZS1kZXYvY296ZS1qcy90cmVlL21haW4vcGFja2FnZXMvY296ZS1qcyIsImJ1Z3MiOnsidXJsIjoiaHR0cHM6Ly9naXRodWIuY29tL2NvemUtZGV2L2NvemUtanMvaXNzdWVzIn0sInJlcG9zaXRvcnkiOnsidHlwZSI6ImdpdCIsInVybCI6Imh0dHBzOi8vZ2l0aHViLmNvbS9jb3plLWRldi9jb3plLWpzLmdpdCIsImRpcmVjdG9yeSI6InBhY2thZ2VzL2NvemUtanMifSwibGljZW5zZSI6Ik1JVCIsImF1dGhvciI6IkxlZWlnaHQgPGxlZWlnaHRAZ21haWwuY29tPiIsImV4cG9ydHMiOnsiLiI6eyJyZXF1aXJlIjoiLi9kaXN0L2Nqcy9pbmRleC5qcyIsImltcG9ydCI6Ii4vZGlzdC9lc20vaW5kZXgubWpzIiwidHlwZXMiOiIuL2Rpc3QvdHlwZXMvaW5kZXguZC50cyJ9LCIuL3dzLXRvb2xzIjp7InJlcXVpcmUiOiIuL2Rpc3QvY2pzL3dzLXRvb2xzL2luZGV4LmpzIiwiaW1wb3J0IjoiLi9kaXN0L2VzbS93cy10b29scy9pbmRleC5tanMiLCJ0eXBlcyI6Ii4vZGlzdC90eXBlcy93cy10b29scy93cy10b29scy9pbmRleC5kLnRzIn19LCJtYWluIjoiZGlzdC9janMvaW5kZXguanMiLCJ1bnBrZyI6ImRpc3QvdW1kL2luZGV4LmpzIiwibW9kdWxlIjoiZGlzdC9lc20vaW5kZXgubWpzIiwiYnJvd3NlciI6eyJjcnlwdG8iOmZhbHNlLCJvcyI6ZmFsc2UsImpzb253ZWJ0b2tlbiI6ZmFsc2UsIm5vZGUtZmV0Y2giOmZhbHNlLCJ3cyI6ZmFsc2V9LCJ0eXBlc1ZlcnNpb25zIjp7IioiOnsiLiI6WyJkaXN0L3R5cGVzL2luZGV4LmQudHMiXSwid3MtdG9vbHMiOlsiZGlzdC90eXBlcy93cy10b29scy93cy10b29scy9pbmRleC5kLnRzIl19fSwiZmlsZXMiOlsiZGlzdCIsIkxJQ0VOU0UiLCJSRUFETUUubWQiLCJSRUFETUUuemgtQ04ubWQiXSwic2NyaXB0cyI6eyJidWlsZCI6InJzbGliIGJ1aWxkIiwiZm9ybWF0IjoicHJldHRpZXIgLS13cml0ZSAuIiwibGludCI6ImVzbGludCAuLyAtLWNhY2hlIC0tcXVpZXQiLCJzdGFydCI6InJzbGliIGJ1aWxkIC13IiwidGVzdCI6InZpdGVzdCIsInRlc3Q6Y292Ijoidml0ZXN0IC0tY292ZXJhZ2UgLS1ydW4ifSwiZGVwZW5kZW5jaWVzIjp7ImFnb3JhLWV4dGVuc2lvbi1haS1kZW5vaXNlciI6Il4xLjAuMCIsImFnb3JhLXJ0Yy1zZGstbmciOiJeNC4yMy4yIiwiYWdvcmEtcnRlLWV4dGVuc2lvbiI6Il4xLjIuNCIsImpzb253ZWJ0b2tlbiI6Il45LjAuMiIsIm5vZGUtZmV0Y2giOiJeMi54IiwicmVjb25uZWN0aW5nLXdlYnNvY2tldCI6Il40LjQuMCIsInV1aWQiOiJeMTAuMC4wIiwid3MiOiJeOC4xMS4wIn0sImRldkRlcGVuZGVuY2llcyI6eyJAY296ZS1pbmZyYS9lc2xpbnQtY29uZmlnIjoid29ya3NwYWNlOioiLCJAY296ZS1pbmZyYS90cy1jb25maWciOiJ3b3Jrc3BhY2U6KiIsIkBjb3plLWluZnJhL3ZpdGVzdC1jb25maWciOiJ3b3Jrc3BhY2U6KiIsIkByc2xpYi9jb3JlIjoiMC4wLjE4IiwiQHN3Yy9jb3JlIjoiXjEuMy4xNCIsIkB0eXBlcy9qc29ud2VidG9rZW4iOiJeOS4wLjAiLCJAdHlwZXMvbm9kZSI6Il4yMCIsIkB0eXBlcy9ub2RlLWZldGNoIjoiXjIueCIsIkB0eXBlcy91dWlkIjoiXjkuMC4xIiwiQHR5cGVzL3doYXR3Zy1mZXRjaCI6Il4wLjAuMzMiLCJAdHlwZXMvd3MiOiJeOC41LjEiLCJAdml0ZXN0L2NvdmVyYWdlLXY4IjoifjIuMS40IiwiYXhpb3MiOiJeMS43LjciLCJ0eXBlc2NyaXB0IjoiXjUuNS4zIiwidml0ZXN0IjoifjIuMS40In0sInBlZXJEZXBlbmRlbmNpZXMiOnsiYXhpb3MiOiJeMS43LjEifSwiY296ZVB1Ymxpc2hDb25maWciOnsiZXhwb3J0cyI6eyIuIjp7InJlcXVpcmUiOiIuL2Rpc3QvY2pzL2luZGV4LmpzIiwiaW1wb3J0IjoiLi9kaXN0L2VzbS9pbmRleC5tanMiLCJ0eXBlcyI6Ii4vZGlzdC90eXBlcy9pbmRleC5kLnRzIn0sIi4vd3MtdG9vbHMiOnsicmVxdWlyZSI6Ii4vZGlzdC9janMvd3MtdG9vbHMvaW5kZXguanMiLCJpbXBvcnQiOiIuL2Rpc3QvZXNtL3dzLXRvb2xzL2luZGV4Lm1qcyIsInR5cGVzIjoiLi9kaXN0L3R5cGVzL3dzLXRvb2xzL3dzLXRvb2xzL2luZGV4LmQudHMifX0sIm1haW4iOiJkaXN0L2Nqcy9pbmRleC5qcyIsIm1vZHVsZSI6ImRpc3QvZXNtL2luZGV4Lm1qcyIsInR5cGVzIjoiZGlzdC90eXBlcy9pbmRleC5kLnRzIn0sInR5cGVzIjoiZGlzdC90eXBlcy9pbmRleC5kLnRzIn0nKTsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvdmVyc2lvbi50cwoKY29uc3QgewogIHZlcnNpb246IHZlcnNpb25fdmVyc2lvbgp9ID0gcGFja2FnZV9uYW1lc3BhY2VPYmplY3Q7Cgpjb25zdCBnZXRFbnYgPSAoKSA9PiB7CiAgY29uc3Qgbm9kZVZlcnNpb24gPSBwcm9jZXNzLnZlcnNpb24uc2xpY2UoMSk7IC8vIFJlbW92ZSAndicgcHJlZml4CgogIGNvbnN0IHsKICAgIHBsYXRmb3JtCiAgfSA9IHByb2Nlc3M7CiAgbGV0IG9zTmFtZSA9IHBsYXRmb3JtLnRvTG93ZXJDYXNlKCk7CiAgbGV0IG9zVmVyc2lvbiA9IGV4dGVybmFsX29zX2RlZmF1bHQoKS5yZWxlYXNlKCk7CgogIGlmICgnZGFyd2luJyA9PT0gcGxhdGZvcm0pIHsKICAgIG9zTmFtZSA9ICdtYWNvcyc7IC8vIFRyeSB0byBwYXJzZSB0aGUgbWFjT1MgdmVyc2lvbgoKICAgIHRyeSB7CiAgICAgIGNvbnN0IGRhcndpblZlcnNpb24gPSBleHRlcm5hbF9vc19kZWZhdWx0KCkucmVsZWFzZSgpLnNwbGl0KCcuJyk7CgogICAgICBpZiAoZGFyd2luVmVyc2lvbi5sZW5ndGggPj0gMikgewogICAgICAgIGNvbnN0IG1ham9yVmVyc2lvbiA9IHBhcnNlSW50KGRhcndpblZlcnNpb25bMF0sIDEwKTsKCiAgICAgICAgaWYgKCFpc05hTihtYWpvclZlcnNpb24pICYmIG1ham9yVmVyc2lvbiA+PSA5KSB7CiAgICAgICAgICBjb25zdCBtYWNWZXJzaW9uID0gbWFqb3JWZXJzaW9uIC0gOTsKICAgICAgICAgIG9zVmVyc2lvbiA9IGAxMC4ke21hY1ZlcnNpb259LiR7ZGFyd2luVmVyc2lvblsxXX1gOwogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoZXJyb3IpIHsvLyBLZWVwIHRoZSBkZWZhdWx0IG9zLnJlbGVhc2UoKSB2YWx1ZSBpZiBwYXJzaW5nIGZhaWxzCiAgICB9CiAgfSBlbHNlIGlmICgnd2luMzInID09PSBwbGF0Zm9ybSkgewogICAgb3NOYW1lID0gJ3dpbmRvd3MnOwogICAgb3NWZXJzaW9uID0gZXh0ZXJuYWxfb3NfZGVmYXVsdCgpLnJlbGVhc2UoKTsKICB9IGVsc2UgaWYgKCdsaW51eCcgPT09IHBsYXRmb3JtKSB7CiAgICBvc05hbWUgPSAnbGludXgnOwogICAgb3NWZXJzaW9uID0gZXh0ZXJuYWxfb3NfZGVmYXVsdCgpLnJlbGVhc2UoKTsKICB9CgogIHJldHVybiB7CiAgICBvc05hbWUsCiAgICBvc1ZlcnNpb24sCiAgICBub2RlVmVyc2lvbgogIH07Cn07Cgpjb25zdCBnZXRVc2VyQWdlbnQgPSAoKSA9PiB7CiAgY29uc3QgewogICAgbm9kZVZlcnNpb24sCiAgICBvc05hbWUsCiAgICBvc1ZlcnNpb24KICB9ID0gZ2V0RW52KCk7CiAgcmV0dXJuIGBjb3plLWpzLyR7dmVyc2lvbl92ZXJzaW9ufSBub2RlLyR7bm9kZVZlcnNpb259ICR7b3NOYW1lfS8ke29zVmVyc2lvbn1gLnRvTG93ZXJDYXNlKCk7Cn07Cgpjb25zdCBnZXROb2RlQ2xpZW50VXNlckFnZW50ID0gKCkgPT4gewogIGNvbnN0IHsKICAgIG9zVmVyc2lvbiwKICAgIG5vZGVWZXJzaW9uLAogICAgb3NOYW1lCiAgfSA9IGdldEVudigpOwogIGNvbnN0IHVhID0gewogICAgdmVyc2lvbjogdmVyc2lvbl92ZXJzaW9uLAogICAgbGFuZzogJ25vZGUnLAogICAgbGFuZ192ZXJzaW9uOiBub2RlVmVyc2lvbiwKICAgIG9zX25hbWU6IG9zTmFtZSwKICAgIG9zX3ZlcnNpb246IG9zVmVyc2lvbgogIH07CiAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHVhKTsKfTsKCmNvbnN0IGdldEJyb3dzZXJDbGllbnRVc2VyQWdlbnQgPSAoKSA9PiB7CiAgY29uc3QgYnJvd3NlckluZm8gPSB7CiAgICBuYW1lOiAndW5rbm93bicsCiAgICB2ZXJzaW9uOiAndW5rbm93bicKICB9OwogIGNvbnN0IG9zSW5mbyA9IHsKICAgIG5hbWU6ICd1bmtub3duJywKICAgIHZlcnNpb246ICd1bmtub3duJwogIH07CiAgY29uc3QgewogICAgdXNlckFnZW50CiAgfSA9IG5hdmlnYXRvcjsgLy8g5qOA5rWL5pON5L2c57O757uf5Y+K54mI5pysCgogIGlmICh1c2VyQWdlbnQuaW5kZXhPZignV2luZG93cycpID4gLTEpIHsKICAgIHZhciBfdXNlckFnZW50X21hdGNoOwoKICAgIG9zSW5mby5uYW1lID0gJ3dpbmRvd3MnOwogICAgY29uc3Qgd2luZG93c1ZlcnNpb24gPSAobnVsbCA9PT0gKF91c2VyQWdlbnRfbWF0Y2ggPSB1c2VyQWdlbnQubWF0Y2goL1dpbmRvd3MgTlQgKFswLTkuXSspLykpIHx8IHZvaWQgMCA9PT0gX3VzZXJBZ2VudF9tYXRjaCA/IHZvaWQgMCA6IF91c2VyQWdlbnRfbWF0Y2hbMV0pIHx8ICd1bmtub3duJzsKICAgIG9zSW5mby52ZXJzaW9uID0gd2luZG93c1ZlcnNpb247CiAgfSBlbHNlIGlmICh1c2VyQWdlbnQuaW5kZXhPZignTWFjIE9TIFgnKSA+IC0xKSB7CiAgICB2YXIgX3VzZXJBZ2VudF9tYXRjaDE7CgogICAgb3NJbmZvLm5hbWUgPSAnbWFjb3MnOyAvLyDlsIYgMTBfMTVfNyDmoLzlvI/ovazmjaLkuLogMTAuMTUuNwoKICAgIG9zSW5mby52ZXJzaW9uID0gKChudWxsID09PSAoX3VzZXJBZ2VudF9tYXRjaDEgPSB1c2VyQWdlbnQubWF0Y2goL01hYyBPUyBYIChbMC05X10rKS8pKSB8fCB2b2lkIDAgPT09IF91c2VyQWdlbnRfbWF0Y2gxID8gdm9pZCAwIDogX3VzZXJBZ2VudF9tYXRjaDFbMV0pIHx8ICd1bmtub3duJykucmVwbGFjZSgvXy9nLCAnLicpOwogIH0gZWxzZSBpZiAodXNlckFnZW50LmluZGV4T2YoJ0xpbnV4JykgPiAtMSkgewogICAgdmFyIF91c2VyQWdlbnRfbWF0Y2gyOwoKICAgIG9zSW5mby5uYW1lID0gJ2xpbnV4JzsKICAgIG9zSW5mby52ZXJzaW9uID0gKG51bGwgPT09IChfdXNlckFnZW50X21hdGNoMiA9IHVzZXJBZ2VudC5tYXRjaCgvTGludXggKFswLTkuXSspLykpIHx8IHZvaWQgMCA9PT0gX3VzZXJBZ2VudF9tYXRjaDIgPyB2b2lkIDAgOiBfdXNlckFnZW50X21hdGNoMlsxXSkgfHwgJ3Vua25vd24nOwogIH0gLy8g5qOA5rWL5rWP6KeI5Zmo5Y+K54mI5pysCgoKICBpZiAodXNlckFnZW50LmluZGV4T2YoJ0Nocm9tZScpID4gLTEpIHsKICAgIHZhciBfdXNlckFnZW50X21hdGNoMzsKCiAgICBicm93c2VySW5mby5uYW1lID0gJ2Nocm9tZSc7CiAgICBicm93c2VySW5mby52ZXJzaW9uID0gKG51bGwgPT09IChfdXNlckFnZW50X21hdGNoMyA9IHVzZXJBZ2VudC5tYXRjaCgvQ2hyb21lXC8oWzAtOS5dKykvKSkgfHwgdm9pZCAwID09PSBfdXNlckFnZW50X21hdGNoMyA/IHZvaWQgMCA6IF91c2VyQWdlbnRfbWF0Y2gzWzFdKSB8fCAndW5rbm93bic7CiAgfSBlbHNlIGlmICh1c2VyQWdlbnQuaW5kZXhPZignRmlyZWZveCcpID4gLTEpIHsKICAgIHZhciBfdXNlckFnZW50X21hdGNoNDsKCiAgICBicm93c2VySW5mby5uYW1lID0gJ2ZpcmVmb3gnOwogICAgYnJvd3NlckluZm8udmVyc2lvbiA9IChudWxsID09PSAoX3VzZXJBZ2VudF9tYXRjaDQgPSB1c2VyQWdlbnQubWF0Y2goL0ZpcmVmb3hcLyhbMC05Ll0rKS8pKSB8fCB2b2lkIDAgPT09IF91c2VyQWdlbnRfbWF0Y2g0ID8gdm9pZCAwIDogX3VzZXJBZ2VudF9tYXRjaDRbMV0pIHx8ICd1bmtub3duJzsKICB9IGVsc2UgaWYgKHVzZXJBZ2VudC5pbmRleE9mKCdTYWZhcmknKSA+IC0xKSB7CiAgICB2YXIgX3VzZXJBZ2VudF9tYXRjaDU7CgogICAgYnJvd3NlckluZm8ubmFtZSA9ICdzYWZhcmknOwogICAgYnJvd3NlckluZm8udmVyc2lvbiA9IChudWxsID09PSAoX3VzZXJBZ2VudF9tYXRjaDUgPSB1c2VyQWdlbnQubWF0Y2goL1ZlcnNpb25cLyhbMC05Ll0rKS8pKSB8fCB2b2lkIDAgPT09IF91c2VyQWdlbnRfbWF0Y2g1ID8gdm9pZCAwIDogX3VzZXJBZ2VudF9tYXRjaDVbMV0pIHx8ICd1bmtub3duJzsKICB9CgogIGNvbnN0IHVhID0gewogICAgdmVyc2lvbjogdmVyc2lvbl92ZXJzaW9uLAogICAgYnJvd3NlcjogYnJvd3NlckluZm8ubmFtZSwKICAgIGJyb3dzZXJfdmVyc2lvbjogYnJvd3NlckluZm8udmVyc2lvbiwKICAgIG9zX25hbWU6IG9zSW5mby5uYW1lLAogICAgb3NfdmVyc2lvbjogb3NJbmZvLnZlcnNpb24KICB9OwogIHJldHVybiBKU09OLnN0cmluZ2lmeSh1YSk7Cn07IC8vIEdldCBVbmlBcHAgY2xpZW50IHVzZXIgYWdlbnQKCgpjb25zdCBnZXRVbmlBcHBDbGllbnRVc2VyQWdlbnQgPSAoKSA9PiB7CiAgLy8gR2V0IHN5c3RlbSBpbmZvCiAgY29uc3Qgc3lzdGVtSW5mbyA9IHVuaS5nZXRTeXN0ZW1JbmZvU3luYygpOwogIGNvbnN0IHBsYXRmb3JtSW5mbyA9IHsKICAgIG5hbWU6ICd1bmtub3duJywKICAgIHZlcnNpb246ICd1bmtub3duJwogIH07CiAgY29uc3Qgb3NJbmZvID0gewogICAgbmFtZTogJ3Vua25vd24nLAogICAgdmVyc2lvbjogJ3Vua25vd24nCiAgfTsgLy8gSGFuZGxlIG9wZXJhdGluZyBzeXN0ZW0gaW5mbwoKICBpZiAoJ2FuZHJvaWQnID09PSBzeXN0ZW1JbmZvLnBsYXRmb3JtKSB7CiAgICBvc0luZm8ubmFtZSA9ICdhbmRyb2lkJzsKICAgIG9zSW5mby52ZXJzaW9uID0gc3lzdGVtSW5mby5zeXN0ZW0gfHwgJ3Vua25vd24nOwogIH0gZWxzZSBpZiAoJ2lvcycgPT09IHN5c3RlbUluZm8ucGxhdGZvcm0pIHsKICAgIG9zSW5mby5uYW1lID0gJ2lvcyc7CiAgICBvc0luZm8udmVyc2lvbiA9IHN5c3RlbUluZm8uc3lzdGVtIHx8ICd1bmtub3duJzsKICB9IGVsc2UgaWYgKCd3aW5kb3dzJyA9PT0gc3lzdGVtSW5mby5wbGF0Zm9ybSkgewogICAgb3NJbmZvLm5hbWUgPSAnd2luZG93cyc7CiAgICBvc0luZm8udmVyc2lvbiA9IHN5c3RlbUluZm8uc3lzdGVtIHx8ICd1bmtub3duJzsKICB9IGVsc2UgaWYgKCdtYWMnID09PSBzeXN0ZW1JbmZvLnBsYXRmb3JtKSB7CiAgICBvc0luZm8ubmFtZSA9ICdtYWNvcyc7CiAgICBvc0luZm8udmVyc2lvbiA9IHN5c3RlbUluZm8uc3lzdGVtIHx8ICd1bmtub3duJzsKICB9IGVsc2UgewogICAgLy8gT3RoZXIgcGxhdGZvcm1zIHVzZSBwbGF0Zm9ybSBuYW1lIGRpcmVjdGx5CiAgICBvc0luZm8ubmFtZSA9IHN5c3RlbUluZm8ucGxhdGZvcm07CiAgICBvc0luZm8udmVyc2lvbiA9IHN5c3RlbUluZm8uc3lzdGVtIHx8ICd1bmtub3duJzsKICB9IC8vIEhhbmRsZSBhcHAvcGxhdGZvcm0gaW5mbwoKCiAgaWYgKHN5c3RlbUluZm8uQXBwUGxhdGZvcm0pIHsKICAgIC8vIEFwcCBlbnZpcm9ubWVudAogICAgcGxhdGZvcm1JbmZvLm5hbWUgPSBzeXN0ZW1JbmZvLkFwcFBsYXRmb3JtLnRvTG93ZXJDYXNlKCk7CiAgICBwbGF0Zm9ybUluZm8udmVyc2lvbiA9IHN5c3RlbUluZm8uYXBwVmVyc2lvbiB8fCAndW5rbm93bic7CiAgfSBlbHNlIGlmIChzeXN0ZW1JbmZvLnVuaVBsYXRmb3JtKSB7CiAgICAvLyBVbmlBcHAgcmVjb2duaXplZCBwbGF0Zm9ybQogICAgcGxhdGZvcm1JbmZvLm5hbWUgPSBzeXN0ZW1JbmZvLnVuaVBsYXRmb3JtOwogICAgcGxhdGZvcm1JbmZvLnZlcnNpb24gPSBzeXN0ZW1JbmZvLlNES1ZlcnNpb24gfHwgJ3Vua25vd24nOwogIH0gZWxzZSB7CiAgICAvLyBUcnkgdG8gZGV0ZXJtaW5lIHBsYXRmb3JtIHR5cGUgZnJvbSBlbnZpcm9ubWVudAogICAgY29uc3QgewogICAgICBhcHBOYW1lLAogICAgICBhcHBWZXJzaW9uCiAgICB9ID0gc3lzdGVtSW5mbzsKCiAgICBpZiAoYXBwTmFtZSkgewogICAgICBwbGF0Zm9ybUluZm8ubmFtZSA9IGFwcE5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgcGxhdGZvcm1JbmZvLnZlcnNpb24gPSBhcHBWZXJzaW9uIHx8ICd1bmtub3duJzsKICAgIH0KICB9CgogIGNvbnN0IHVhID0gewogICAgdmVyc2lvbjogdmVyc2lvbl92ZXJzaW9uLAogICAgZnJhbWV3b3JrOiAndW5pYXBwJywKICAgIHBsYXRmb3JtOiBwbGF0Zm9ybUluZm8ubmFtZSwKICAgIHBsYXRmb3JtX3ZlcnNpb246IHBsYXRmb3JtSW5mby52ZXJzaW9uLAogICAgb3NfbmFtZTogb3NJbmZvLm5hbWUsCiAgICBvc192ZXJzaW9uOiBvc0luZm8udmVyc2lvbiwKICAgIHNjcmVlbl93aWR0aDogc3lzdGVtSW5mby5zY3JlZW5XaWR0aCwKICAgIHNjcmVlbl9oZWlnaHQ6IHN5c3RlbUluZm8uc2NyZWVuSGVpZ2h0LAogICAgZGV2aWNlX21vZGVsOiBzeXN0ZW1JbmZvLm1vZGVsLAogICAgZGV2aWNlX2JyYW5kOiBzeXN0ZW1JbmZvLmJyYW5kCiAgfTsKICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodWEpOwp9OwoKY29uc3QgZXh0ZXJuYWxfbm9kZV9mZXRjaF9uYW1lc3BhY2VPYmplY3QgPSByZXF1aXJlKCJub2RlLWZldGNoIik7Cgp2YXIgZXh0ZXJuYWxfbm9kZV9mZXRjaF9kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihleHRlcm5hbF9ub2RlX2ZldGNoX25hbWVzcGFjZU9iamVjdCk7Ci8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkgKi8KCgpjb25zdCBoYW5kbGVFcnJvciA9IGVycm9yID0+IHsKICBpZiAoIWVycm9yLmlzQXhpb3NFcnJvciAmJiAoIWVycm9yLmNvZGUgfHwgIWVycm9yLm1lc3NhZ2UpKSByZXR1cm4gbmV3IENvemVFcnJvcihgVW5leHBlY3RlZCBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApOwoKICBpZiAoJ0VDT05OQUJPUlRFRCcgPT09IGVycm9yLmNvZGUgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygndGltZW91dCcpIHx8ICdFVElNRURPVVQnID09PSBlcnJvci5jb2RlKSB7CiAgICB2YXIgX2Vycm9yX3Jlc3BvbnNlOwoKICAgIHJldHVybiBuZXcgVGltZW91dEVycm9yKDQwOCwgdm9pZCAwLCBgUmVxdWVzdCB0aW1lZCBvdXQ6ICR7ZXJyb3IubWVzc2FnZX1gLCBudWxsID09PSAoX2Vycm9yX3Jlc3BvbnNlID0gZXJyb3IucmVzcG9uc2UpIHx8IHZvaWQgMCA9PT0gX2Vycm9yX3Jlc3BvbnNlID8gdm9pZCAwIDogX2Vycm9yX3Jlc3BvbnNlLmhlYWRlcnMpOwogIH0KCiAgaWYgKCdFUlJfQ0FOQ0VMRUQnID09PSBlcnJvci5jb2RlKSByZXR1cm4gbmV3IEFQSVVzZXJBYm9ydEVycm9yKGVycm9yLm1lc3NhZ2UpO2Vsc2UgewogICAgdmFyIF9lcnJvcl9yZXNwb25zZTEsIF9lcnJvcl9yZXNwb25zZTIsIF9lcnJvcl9yZXNwb25zZTM7CgogICAgcmV0dXJuIEFQSUVycm9yLmdlbmVyYXRlKChudWxsID09PSAoX2Vycm9yX3Jlc3BvbnNlMSA9IGVycm9yLnJlc3BvbnNlKSB8fCB2b2lkIDAgPT09IF9lcnJvcl9yZXNwb25zZTEgPyB2b2lkIDAgOiBfZXJyb3JfcmVzcG9uc2UxLnN0YXR1cykgfHwgNTAwLCBudWxsID09PSAoX2Vycm9yX3Jlc3BvbnNlMiA9IGVycm9yLnJlc3BvbnNlKSB8fCB2b2lkIDAgPT09IF9lcnJvcl9yZXNwb25zZTIgPyB2b2lkIDAgOiBfZXJyb3JfcmVzcG9uc2UyLmRhdGEsIGVycm9yLm1lc3NhZ2UsIG51bGwgPT09IChfZXJyb3JfcmVzcG9uc2UzID0gZXJyb3IucmVzcG9uc2UpIHx8IHZvaWQgMCA9PT0gX2Vycm9yX3Jlc3BvbnNlMyA/IHZvaWQgMCA6IF9lcnJvcl9yZXNwb25zZTMuaGVhZGVycyk7CiAgfQp9OyAvLyBub2RlLWZldGNoIGlzIHVzZWQgZm9yIHN0cmVhbWluZyByZXF1ZXN0cwoKCmNvbnN0IGFkYXB0ZXJGZXRjaCA9IGFzeW5jIG9wdGlvbnMgPT4gewogIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZXh0ZXJuYWxfbm9kZV9mZXRjaF9kZWZhdWx0KCkob3B0aW9ucy51cmwsIHsKICAgIGJvZHk6IG9wdGlvbnMuZGF0YSwKICAgIC4uLm9wdGlvbnMKICB9KTsKICByZXR1cm4gewogICAgZGF0YTogcmVzcG9uc2UuYm9keSwKICAgIC4uLnJlc3BvbnNlCiAgfTsKfTsKCmNvbnN0IGlzU3VwcG9ydE5hdGl2ZUZldGNoID0gKCkgPT4gewogIGlmIChpc0Jyb3dzZXIoKSB8fCBpc1VuaUFwcCgpKSByZXR1cm4gdHJ1ZTsgLy8gbmF0aXZlIGZldGNoIGlzIHN1cHBvcnRlZCBpbiBub2RlIDE4LjAuMCBvciBoaWdoZXIKCiAgY29uc3QgdmVyc2lvbiA9IHByb2Nlc3MudmVyc2lvbi5zbGljZSgxKTsKICByZXR1cm4gY29tcGFyZVZlcnNpb25zKHZlcnNpb24sICcxOC4wLjAnKSA+PSAwOwp9OwoKYXN5bmMgZnVuY3Rpb24gZmV0Y2hBUEkodXJsKSB7CiAgbGV0IG9wdGlvbnMgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiB2b2lkIDAgIT09IGFyZ3VtZW50c1sxXSA/IGFyZ3VtZW50c1sxXSA6IHt9OwogIGNvbnN0IGF4aW9zSW5zdGFuY2UgPSBvcHRpb25zLmF4aW9zSW5zdGFuY2UgfHwgZXh0ZXJuYWxfYXhpb3NfZGVmYXVsdCgpOyAvLyBBZGQgdmVyc2lvbiBjaGVjayBmb3Igc3RyZWFtaW5nIHJlcXVlc3RzCgogIGlmIChvcHRpb25zLmlzU3RyZWFtaW5nICYmIGlzQXhpb3NTdGF0aWMoYXhpb3NJbnN0YW5jZSkpIHsKICAgIGNvbnN0IGF4aW9zVmVyc2lvbiA9IGF4aW9zSW5zdGFuY2UuVkVSU0lPTiB8fCBleHRlcm5hbF9heGlvc19kZWZhdWx0KCkuVkVSU0lPTjsKICAgIGlmICghYXhpb3NWZXJzaW9uIHx8IGNvbXBhcmVWZXJzaW9ucyhheGlvc1ZlcnNpb24sICcxLjcuMScpIDwgMCkgdGhyb3cgbmV3IENvemVFcnJvcignU3RyZWFtaW5nIHJlcXVlc3RzIHJlcXVpcmUgYXhpb3MgdmVyc2lvbiAxLjcuMSBvciBoaWdoZXIuIFBsZWFzZSB1cGdyYWRlIHlvdXIgYXhpb3MgdmVyc2lvbi4nKTsKICB9CgogIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXhpb3NJbnN0YW5jZSh7CiAgICB1cmwsCiAgICByZXNwb25zZVR5cGU6IG9wdGlvbnMuaXNTdHJlYW1pbmcgPyAnc3RyZWFtJyA6ICdqc29uJywKICAgIGFkYXB0ZXI6IG9wdGlvbnMuaXNTdHJlYW1pbmcgPyBpc1N1cHBvcnROYXRpdmVGZXRjaCgpID8gJ2ZldGNoJyA6IGFkYXB0ZXJGZXRjaCA6IHZvaWQgMCwKICAgIC4uLm9wdGlvbnMKICB9KS5jYXRjaChlcnJvciA9PiB7CiAgICB0aHJvdyBoYW5kbGVFcnJvcihlcnJvcik7CiAgfSk7CiAgcmV0dXJuIHsKICAgIGFzeW5jICpzdHJlYW0oKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3Qgc3RyZWFtID0gcmVzcG9uc2UuZGF0YTsKICAgICAgICBjb25zdCByZWFkZXIgPSBzdHJlYW1bU3ltYm9sLmFzeW5jSXRlcmF0b3JdID8gc3RyZWFtW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSgpIDogc3RyZWFtLmdldFJlYWRlcigpOwogICAgICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTsKICAgICAgICBjb25zdCBmaWVsZFZhbHVlcyA9IHt9OwogICAgICAgIGxldCBidWZmZXIgPSAnJzsKCiAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgZG9uZSwKICAgICAgICAgICAgdmFsdWUKICAgICAgICAgIH0gPSBhd2FpdCAocmVhZGVyLm5leHQgPyByZWFkZXIubmV4dCgpIDogcmVhZGVyLnJlYWQoKSk7CgogICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgaWYgKGJ1ZmZlcikgewogICAgICAgICAgICAgIC8vIElmIHRoZSBzdHJlYW0gZW5kcyB3aXRob3V0IGEgbmV3bGluZSwgaXQgbWVhbnMgYW4gZXJyb3Igb2NjdXJyZWQKICAgICAgICAgICAgICBmaWVsZFZhbHVlcy5ldmVudCA9ICdlcnJvcic7CiAgICAgICAgICAgICAgZmllbGRWYWx1ZXMuZGF0YSA9IGJ1ZmZlcjsKICAgICAgICAgICAgICB5aWVsZCBmaWVsZFZhbHVlczsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYnVmZmVyICs9IGRlY29kZXIuZGVjb2RlKHZhbHVlLCB7CiAgICAgICAgICAgIHN0cmVhbTogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgICBjb25zdCBsaW5lcyA9IGJ1ZmZlci5zcGxpdCgnXG4nKTsKCiAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgICBjb25zdCBsaW5lID0gbGluZXNbaV07CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gbGluZS5pbmRleE9mKCc6Jyk7CgogICAgICAgICAgICBpZiAoLTEgIT09IGluZGV4KSB7CiAgICAgICAgICAgICAgY29uc3QgZmllbGQgPSBsaW5lLnN1YnN0cmluZygwLCBpbmRleCkudHJpbSgpOwogICAgICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBsaW5lLnN1YnN0cmluZyhpbmRleCArIDEpLnRyaW0oKTsKICAgICAgICAgICAgICBmaWVsZFZhbHVlc1tmaWVsZF0gPSBjb250ZW50OwogICAgICAgICAgICAgIGlmICgnZGF0YScgPT09IGZpZWxkKSB5aWVsZCBmaWVsZFZhbHVlczsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGJ1ZmZlciA9IGxpbmVzW2xpbmVzLmxlbmd0aCAtIDFdOyAvLyBLZWVwIHRoZSBsYXN0IGluY29tcGxldGUgbGluZSBpbiB0aGUgYnVmZmVyCiAgICAgICAgfQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGhhbmRsZUVycm9yKGVycm9yKTsKICAgICAgfQogICAgfSwKCiAgICBqc29uOiAoKSA9PiByZXNwb25zZS5kYXRhLAogICAgcmVzcG9uc2UKICB9Owp9IC8vIEFkZCB2ZXJzaW9uIGNvbXBhcmlzb24gdXRpbGl0eQoKCmZ1bmN0aW9uIGNvbXBhcmVWZXJzaW9ucyh2MSwgdjIpIHsKICBjb25zdCB2MVBhcnRzID0gdjEuc3BsaXQoJy4nKS5tYXAoTnVtYmVyKTsKICBjb25zdCB2MlBhcnRzID0gdjIuc3BsaXQoJy4nKS5tYXAoTnVtYmVyKTsKCiAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgIGNvbnN0IHBhcnQxID0gdjFQYXJ0c1tpXSB8fCAwOwogICAgY29uc3QgcGFydDIgPSB2MlBhcnRzW2ldIHx8IDA7CiAgICBpZiAocGFydDEgPiBwYXJ0MikgcmV0dXJuIDE7CiAgICBpZiAocGFydDEgPCBwYXJ0MikgcmV0dXJuIC0xOwogIH0KCiAgcmV0dXJuIDA7Cn0KCmZ1bmN0aW9uIGlzQXhpb3NTdGF0aWMoaW5zdGFuY2UpIHsKICByZXR1cm4gISEobnVsbCA9PSBpbnN0YW5jZSA/IHZvaWQgMCA6IGluc3RhbmNlLkF4aW9zKTsKfQovKioKICogZGVmYXVsdCBjb3plICBiYXNlIFVSTCBpcyBhcGkuY296ZS5jb20KICovCgoKY29uc3QgQ09aRV9DT01fQkFTRV9VUkwgPSAnaHR0cHM6Ly9hcGkuY296ZS5jb20nOwovKioKICogY2hhbmdlIHRvIGFwaS5jb3plLmNuIGlmIHlvdSB1c2UgaHR0cHM6Ly9jb3plLmNuCiAqLwoKY29uc3QgQ09aRV9DTl9CQVNFX1VSTCA9ICdodHRwczovL2FwaS5jb3plLmNuJzsKLyoqCiAqIGRlZmF1bHQgYmFzZSB3ZWJzb2NrZXQgVVJMIGlzIHdzczovL3dzLmNvemUuY29tCiAqLwoKY29uc3QgQ09aRV9DT01fQkFTRV9XU19VUkwgPSAnd3NzOi8vd3MuY296ZS5jb20nOwovKioKICogY2hhbmdlIHRvIHdzczovL3dzLmNvemUuY24gaWYgeW91IHVzZSBodHRwczovL2NvemUuY24KICovCgpjb25zdCBDT1pFX0NOX0JBU0VfV1NfVVJMID0gJ3dzczovL3dzLmNvemUuY24nOwpjb25zdCBQT0xMX0lOVEVSVkFMID0gNTAwMDsKY29uc3QgTUFYX1BPTExfSU5URVJWQUwgPSAzMDAwMDsKLyogZXNsaW50LWRpc2FibGUgbWF4LXBhcmFtcyAqLwoKY2xhc3MgQVBJQ2xpZW50IHsKICBhc3luYyBnZXRUb2tlbigpIHsKICAgIGlmICgnZnVuY3Rpb24nID09IHR5cGVvZiB0aGlzLnRva2VuKSByZXR1cm4gYXdhaXQgdGhpcy50b2tlbigpOwogICAgcmV0dXJuIHRoaXMudG9rZW47CiAgfQoKICBhc3luYyBidWlsZE9wdGlvbnMobWV0aG9kLCBib2R5LCBvcHRpb25zKSB7CiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IHRoaXMuZ2V0VG9rZW4oKTsKICAgIGNvbnN0IGhlYWRlcnMgPSB7CiAgICAgIGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gCiAgICB9OwogICAgaWYgKGlzVW5pQXBwKCkpIGhlYWRlcnNbJ1gtQ296ZS1DbGllbnQtVXNlci1BZ2VudCddID0gZ2V0VW5pQXBwQ2xpZW50VXNlckFnZW50KCk7ZWxzZSBpZiAoaXNCcm93c2VyKCkpIGhlYWRlcnNbJ1gtQ296ZS1DbGllbnQtVXNlci1BZ2VudCddID0gZ2V0QnJvd3NlckNsaWVudFVzZXJBZ2VudCgpO2Vsc2UgewogICAgICBoZWFkZXJzWydVc2VyLUFnZW50J10gPSBnZXRVc2VyQWdlbnQoKTsKICAgICAgaGVhZGVyc1snWC1Db3plLUNsaWVudC1Vc2VyLUFnZW50J10gPSBnZXROb2RlQ2xpZW50VXNlckFnZW50KCk7CiAgICB9CiAgICBjb25zdCBjb25maWcgPSBtZXJnZUNvbmZpZyh0aGlzLmF4aW9zT3B0aW9ucywgb3B0aW9ucywgewogICAgICBoZWFkZXJzCiAgICB9LCB7CiAgICAgIGhlYWRlcnM6IHRoaXMuaGVhZGVycyB8fCB7fQogICAgfSk7CiAgICBjb25maWcubWV0aG9kID0gbWV0aG9kOwogICAgY29uZmlnLmRhdGEgPSBib2R5OwogICAgcmV0dXJuIGNvbmZpZzsKICB9CgogIGFzeW5jIGJ1aWxkV2Vic29ja2V0T3B0aW9ucyhvcHRpb25zKSB7CiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IHRoaXMuZ2V0VG9rZW4oKTsKICAgIGNvbnN0IGhlYWRlcnMgPSB7CiAgICAgIGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gCiAgICB9OwogICAgaWYgKGlzQnJvd3NlcigpKSBoZWFkZXJzWydYLUNvemUtQ2xpZW50LVVzZXItQWdlbnQnXSA9IGdldEJyb3dzZXJDbGllbnRVc2VyQWdlbnQoKTtlbHNlIHsKICAgICAgaGVhZGVyc1snVXNlci1BZ2VudCddID0gZ2V0VXNlckFnZW50KCk7CiAgICAgIGhlYWRlcnNbJ1gtQ296ZS1DbGllbnQtVXNlci1BZ2VudCddID0gZ2V0Tm9kZUNsaWVudFVzZXJBZ2VudCgpOwogICAgfQoKICAgIHZhciBfdGhpc19fY29uZmlnX2RlYnVnOwoKICAgIGNvbnN0IGNvbmZpZyA9IG1lcmdlQ29uZmlnKHsKICAgICAgZGVidWc6IG51bGwgIT09IChfdGhpc19fY29uZmlnX2RlYnVnID0gdGhpcy5fY29uZmlnLmRlYnVnKSAmJiB2b2lkIDAgIT09IF90aGlzX19jb25maWdfZGVidWcgJiYgX3RoaXNfX2NvbmZpZ19kZWJ1ZwogICAgfSwgdGhpcy5fY29uZmlnLndlYnNvY2tldE9wdGlvbnMsIG9wdGlvbnMsIHsKICAgICAgaGVhZGVycwogICAgfSwgewogICAgICBoZWFkZXJzOiB0aGlzLmhlYWRlcnMgfHwge30KICAgIH0pOwogICAgcmV0dXJuIGNvbmZpZzsKICB9CgogIGFzeW5jIG1ha2VSZXF1ZXN0KGFwaVVybCwgbWV0aG9kLCBib2R5LCBpc1N0cmVhbSwgb3B0aW9ucykgewogICAgY29uc3QgZnVsbFVybCA9IGAke3RoaXMuYmFzZVVSTH0ke2FwaVVybH1gOwogICAgY29uc3QgZmV0Y2hPcHRpb25zID0gYXdhaXQgdGhpcy5idWlsZE9wdGlvbnMobWV0aG9kLCBib2R5LCBvcHRpb25zKTsKICAgIGZldGNoT3B0aW9ucy5pc1N0cmVhbWluZyA9IGlzU3RyZWFtOwogICAgZmV0Y2hPcHRpb25zLmF4aW9zSW5zdGFuY2UgPSB0aGlzLmF4aW9zSW5zdGFuY2U7CiAgICB0aGlzLmRlYnVnTG9nKG51bGwgPT0gb3B0aW9ucyA/IHZvaWQgMCA6IG9wdGlvbnMuZGVidWcsIGAtLS0gcmVxdWVzdCB1cmw6ICR7ZnVsbFVybH1gKTsKICAgIHRoaXMuZGVidWdMb2cobnVsbCA9PSBvcHRpb25zID8gdm9pZCAwIDogb3B0aW9ucy5kZWJ1ZywgJy0tLSByZXF1ZXN0IG9wdGlvbnM6JywgZmV0Y2hPcHRpb25zKTsKICAgIGNvbnN0IHsKICAgICAgcmVzcG9uc2UsCiAgICAgIHN0cmVhbSwKICAgICAganNvbgogICAgfSA9IGF3YWl0IGZldGNoQVBJKGZ1bGxVcmwsIGZldGNoT3B0aW9ucyk7CiAgICB0aGlzLmRlYnVnTG9nKG51bGwgPT0gb3B0aW9ucyA/IHZvaWQgMCA6IG9wdGlvbnMuZGVidWcsIGAtLS0gcmVzcG9uc2Ugc3RhdHVzOiAke3Jlc3BvbnNlLnN0YXR1c31gKTsKICAgIHRoaXMuZGVidWdMb2cobnVsbCA9PSBvcHRpb25zID8gdm9pZCAwIDogb3B0aW9ucy5kZWJ1ZywgJy0tLSByZXNwb25zZSBoZWFkZXJzOiAnLCByZXNwb25zZS5oZWFkZXJzKTsKCiAgICB2YXIgX3Jlc3BvbnNlX2hlYWRlcnM7IC8vIFRhcm8gdXNlIGBoZWFkZXJgCgoKICAgIGNvbnN0IGNvbnRlbnRUeXBlID0gKG51bGwgIT09IChfcmVzcG9uc2VfaGVhZGVycyA9IHJlc3BvbnNlLmhlYWRlcnMpICYmIHZvaWQgMCAhPT0gX3Jlc3BvbnNlX2hlYWRlcnMgPyBfcmVzcG9uc2VfaGVhZGVycyA6IHJlc3BvbnNlLmhlYWRlcilbJ2NvbnRlbnQtdHlwZSddOwoKICAgIGlmIChpc1N0cmVhbSkgewogICAgICBpZiAoY29udGVudFR5cGUgJiYgY29udGVudFR5cGUuaW5jbHVkZXMoJ2FwcGxpY2F0aW9uL2pzb24nKSkgewogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGpzb24oKTsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBjb2RlLAogICAgICAgICAgbXNnCiAgICAgICAgfSA9IHJlc3VsdDsKICAgICAgICBpZiAoMCAhPT0gY29kZSAmJiB2b2lkIDAgIT09IGNvZGUpIHRocm93IEFQSUVycm9yLmdlbmVyYXRlKHJlc3BvbnNlLnN0YXR1cywgcmVzdWx0LCBtc2csIHJlc3BvbnNlLmhlYWRlcnMpOwogICAgICB9CgogICAgICByZXR1cm4gc3RyZWFtKCk7CiAgICB9CgogICAgaWYgKCEoY29udGVudFR5cGUgJiYgY29udGVudFR5cGUuaW5jbHVkZXMoJ2FwcGxpY2F0aW9uL2pzb24nKSkpIHJldHVybiBhd2FpdCByZXNwb25zZS5kYXRhOwogICAgewogICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBqc29uKCk7CiAgICAgIGNvbnN0IHsKICAgICAgICBjb2RlLAogICAgICAgIG1zZwogICAgICB9ID0gcmVzdWx0OwogICAgICBpZiAoMCAhPT0gY29kZSAmJiB2b2lkIDAgIT09IGNvZGUpIHRocm93IEFQSUVycm9yLmdlbmVyYXRlKHJlc3BvbnNlLnN0YXR1cywgcmVzdWx0LCBtc2csIHJlc3BvbnNlLmhlYWRlcnMpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogIH0KCiAgYXN5bmMgcG9zdChhcGlVcmwsIGJvZHkpIHsKICAgIGxldCBpc1N0cmVhbSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIHZvaWQgMCAhPT0gYXJndW1lbnRzWzJdICYmIGFyZ3VtZW50c1syXSwKICAgICAgICBvcHRpb25zID0gYXJndW1lbnRzLmxlbmd0aCA+IDMgPyBhcmd1bWVudHNbM10gOiB2b2lkIDA7CiAgICByZXR1cm4gdGhpcy5tYWtlUmVxdWVzdChhcGlVcmwsICdQT1NUJywgYm9keSwgaXNTdHJlYW0sIG9wdGlvbnMpOwogIH0KCiAgYXN5bmMgZ2V0KGFwaVVybCwgcGFyYW0sIGlzU3RyZWFtLCBvcHRpb25zKSB7CiAgICAvLyDmi7zmjqXlj4LmlbAKICAgIGNvbnN0IHF1ZXJ5U3RyaW5nID0gT2JqZWN0LmVudHJpZXMocGFyYW0gfHwge30pLm1hcChwYXJhbSA9PiB7CiAgICAgIGxldCBba2V5LCB2YWx1ZV0gPSBwYXJhbTsKICAgICAgcmV0dXJuIGAke2tleX09JHt2YWx1ZX1gOwogICAgfSkuam9pbignJicpOwogICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3QocXVlcnlTdHJpbmcgPyBgJHthcGlVcmx9JHthcGlVcmwuaW5jbHVkZXMoJz8nKSA/ICcmJyA6ICc/J30ke3F1ZXJ5U3RyaW5nfWAgOiBhcGlVcmwsICdHRVQnLCB2b2lkIDAsIGlzU3RyZWFtLCBvcHRpb25zKTsKICB9CgogIGFzeW5jIHB1dChhcGlVcmwsIGJvZHksIGlzU3RyZWFtLCBvcHRpb25zKSB7CiAgICByZXR1cm4gdGhpcy5tYWtlUmVxdWVzdChhcGlVcmwsICdQVVQnLCBib2R5LCBpc1N0cmVhbSwgb3B0aW9ucyk7CiAgfQoKICBhc3luYyBkZWxldGUoYXBpVXJsLCBpc1N0cmVhbSwgb3B0aW9ucykgewogICAgcmV0dXJuIHRoaXMubWFrZVJlcXVlc3QoYXBpVXJsLCAnREVMRVRFJywgdm9pZCAwLCBpc1N0cmVhbSwgb3B0aW9ucyk7CiAgfQoKICBhc3luYyBtYWtlV2Vic29ja2V0KGFwaVVybCwgb3B0aW9ucykgewogICAgY29uc3QgZnVsbFVybCA9IGAke3RoaXMuYmFzZVdzVVJMfSR7YXBpVXJsfWA7CiAgICBjb25zdCB3ZWJzb2NrZXRPcHRpb25zID0gYXdhaXQgdGhpcy5idWlsZFdlYnNvY2tldE9wdGlvbnMob3B0aW9ucyk7CiAgICB0aGlzLmRlYnVnTG9nKG51bGwgPT0gb3B0aW9ucyA/IHZvaWQgMCA6IG9wdGlvbnMuZGVidWcsIGAtLS0gd2Vic29ja2V0IHVybDogJHtmdWxsVXJsfWApOwogICAgdGhpcy5kZWJ1Z0xvZyhudWxsID09IG9wdGlvbnMgPyB2b2lkIDAgOiBvcHRpb25zLmRlYnVnLCAnLS0tIHdlYnNvY2tldCBvcHRpb25zOicsIHdlYnNvY2tldE9wdGlvbnMpOwogICAgY29uc3Qgd3MgPSBuZXcgV2ViU29ja2V0QVBJKGZ1bGxVcmwsIHdlYnNvY2tldE9wdGlvbnMpOwogICAgcmV0dXJuIHdzOwogIH0KCiAgZ2V0Q29uZmlnKCkgewogICAgcmV0dXJuIHRoaXMuX2NvbmZpZzsKICB9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55CgoKICBkZWJ1Z0xvZygpIHsKICAgIGxldCBmb3JjZURlYnVnID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgdm9pZCAwICE9PSBhcmd1bWVudHNbMF0gJiYgYXJndW1lbnRzWzBdOwoKICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCBtc2dzID0gbmV3IEFycmF5KF9sZW4gPiAxID8gX2xlbiAtIDEgOiAwKSwgX2tleSA9IDE7IF9rZXkgPCBfbGVuOyBfa2V5KyspIG1zZ3NbX2tleSAtIDFdID0gYXJndW1lbnRzW19rZXldOwoKICAgIGlmICh0aGlzLmRlYnVnIHx8IGZvcmNlRGVidWcpIGNvbnNvbGUuZGVidWcoLi4ubXNncyk7CiAgfQoKICBjb25zdHJ1Y3Rvcihjb25maWcpIHsKICAgIHRoaXMuX2NvbmZpZyA9IGNvbmZpZzsKICAgIHRoaXMuYmFzZVVSTCA9IGNvbmZpZy5iYXNlVVJMIHx8IENPWkVfQ09NX0JBU0VfVVJMOwogICAgdGhpcy5iYXNlV3NVUkwgPSBjb25maWcuYmFzZVdzVVJMIHx8IENPWkVfQ05fQkFTRV9XU19VUkw7CiAgICB0aGlzLnRva2VuID0gY29uZmlnLnRva2VuOwogICAgdGhpcy5heGlvc09wdGlvbnMgPSBjb25maWcuYXhpb3NPcHRpb25zIHx8IHt9OwogICAgdGhpcy5heGlvc0luc3RhbmNlID0gY29uZmlnLmF4aW9zSW5zdGFuY2U7CiAgICB0aGlzLmRlYnVnID0gY29uZmlnLmRlYnVnIHx8IGZhbHNlOwogICAgdGhpcy5hbGxvd1BlcnNvbmFsQWNjZXNzVG9rZW5JbkJyb3dzZXIgPSBjb25maWcuYWxsb3dQZXJzb25hbEFjY2Vzc1Rva2VuSW5Ccm93c2VyIHx8IGZhbHNlOwogICAgdGhpcy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnM7CiAgICBpZiAoaXNCcm93c2VyKCkgJiYgJ2Z1bmN0aW9uJyAhPSB0eXBlb2YgdGhpcy50b2tlbiAmJiBpc1BlcnNvbmFsQWNjZXNzVG9rZW4odGhpcy50b2tlbikgJiYgIXRoaXMuYWxsb3dQZXJzb25hbEFjY2Vzc1Rva2VuSW5Ccm93c2VyKSB0aHJvdyBuZXcgQ296ZUVycm9yKCdCcm93c2VyIGVudmlyb25tZW50cyBkbyBub3Qgc3VwcG9ydCBhdXRoZW50aWNhdGlvbiB1c2luZyBQZXJzb25hbCBBY2Nlc3MgVG9rZW4gKFBBVCkgYnkgZGVmYXVsdC5cbmFzIGl0IG1heSBleHBvc2Ugc2VjcmV0IEFQSSBrZXlzLiBcblxuUGxlYXNlIHVzZSBPQXV0aDIuMCBhdXRoZW50aWNhdGlvbiBtZWNoYW5pc20uIHNlZTpcbmh0dHBzOi8vd3d3LmNvemUuY29tL2RvY3MvZGV2ZWxvcGVyX2d1aWRlcy9vYXV0aF9hcHBzP19sYW5nPWVuIFxuXG5JZiB5b3UgbmVlZCB0byBmb3JjZSB1c2UsIHBsZWFzZSBzZXQgdGhlIGBhbGxvd1BlcnNvbmFsQWNjZXNzVG9rZW5JbkJyb3dzZXJgIG9wdGlvbiB0byBgdHJ1ZWAuIFxuXG5lLmcgbmV3IENvemVBUEkoeyB0b2tlbiwgYWxsb3dQZXJzb25hbEFjY2Vzc1Rva2VuSW5Ccm93c2VyOiB0cnVlIH0pO1xuXG4nKTsKICB9Cgp9CgpBUElDbGllbnQuQVBJRXJyb3IgPSBBUElFcnJvcjsKQVBJQ2xpZW50LkJhZFJlcXVlc3RFcnJvciA9IEJhZFJlcXVlc3RFcnJvcjsKQVBJQ2xpZW50LkF1dGhlbnRpY2F0aW9uRXJyb3IgPSBBdXRoZW50aWNhdGlvbkVycm9yOwpBUElDbGllbnQuUGVybWlzc2lvbkRlbmllZEVycm9yID0gUGVybWlzc2lvbkRlbmllZEVycm9yOwpBUElDbGllbnQuTm90Rm91bmRFcnJvciA9IE5vdEZvdW5kRXJyb3I7CkFQSUNsaWVudC5SYXRlTGltaXRFcnJvciA9IFJhdGVMaW1pdEVycm9yOwpBUElDbGllbnQuSW50ZXJuYWxTZXJ2ZXJFcnJvciA9IEludGVybmFsU2VydmVyRXJyb3I7CkFQSUNsaWVudC5HYXRld2F5RXJyb3IgPSBHYXRld2F5RXJyb3I7CkFQSUNsaWVudC5UaW1lb3V0RXJyb3IgPSBUaW1lb3V0RXJyb3I7CkFQSUNsaWVudC5Vc2VyQWJvcnRFcnJvciA9IEFQSVVzZXJBYm9ydEVycm9yOwoKY29uc3QgZXh0ZXJuYWxfY3J5cHRvX25hbWVzcGFjZU9iamVjdCA9IHJlcXVpcmUoImNyeXB0byIpOwoKY29uc3QgZXh0ZXJuYWxfanNvbndlYnRva2VuX25hbWVzcGFjZU9iamVjdCA9IHJlcXVpcmUoImpzb253ZWJ0b2tlbiIpOwoKdmFyIGV4dGVybmFsX2pzb253ZWJ0b2tlbl9kZWZhdWx0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18ubihleHRlcm5hbF9qc29ud2VidG9rZW5fbmFtZXNwYWNlT2JqZWN0KTsKCmNvbnN0IGdldENyeXB0byA9ICgpID0+IHsKICBpZiAoaXNVbmlBcHAoKSkgcmV0dXJuIHsKICAgIGdldFJhbmRvbVZhbHVlczogdW5pLmdldFJhbmRvbVZhbHVlcywKICAgIHN1YnRsZTogewogICAgICAvLyBUT0RPIEN1cnJlbnRseSBub3Qgc3VwcG9ydGluZyB1bmlhcHAsIHdpbGwgcHJvdmlkZSBzdXBwb3J0IGxhdGVyIGlmIG5lZWRlZAogICAgICBkaWdlc3Q6ICgpID0+IHsKICAgICAgICBjb25zb2xlLmVycm9yKCdkaWdlc3QgaXMgbm90IHN1cHBvcnRlZCBpbiB1bmlhcHAnKTsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2RpZ2VzdCBpcyBub3Qgc3VwcG9ydGVkIGluIHVuaWFwcCcpOwogICAgICB9CiAgICB9CiAgfTsKICBpZiAoaXNCcm93c2VyKCkpIHJldHVybiB3aW5kb3cuY3J5cHRvOyAvLyAjaWZuZGVmIE1QCgogIHJldHVybiB7CiAgICBnZXRSYW5kb21WYWx1ZXM6IGFycmF5ID0+IGV4dGVybmFsX2NyeXB0b19uYW1lc3BhY2VPYmplY3QucmFuZG9tRmlsbFN5bmMoYXJyYXkpLAogICAgc3VidGxlOiBleHRlcm5hbF9jcnlwdG9fbmFtZXNwYWNlT2JqZWN0LnN1YnRsZQogIH07IC8vICNlbmRpZgp9OwoKY29uc3QgZ2VuZXJhdGVSYW5kb21TdHJpbmcgPSAoKSA9PiB7CiAgY29uc3QgYXJyYXkgPSBuZXcgVWludDhBcnJheSgzMik7CiAgZ2V0Q3J5cHRvKCkuZ2V0UmFuZG9tVmFsdWVzKGFycmF5KTsKICByZXR1cm4gQXJyYXkuZnJvbShhcnJheSwgYnl0ZSA9PiBieXRlLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAnMCcpKS5qb2luKCcnKTsKfTsKCmNvbnN0IGdldFdlYkF1dGhlbnRpY2F0aW9uVXJsID0gY29uZmlnID0+IHsKICB2YXIgX2NvbmZpZ19iYXNlVVJMOwoKICBjb25zdCBiYXNlVXJsID0gKG51bGwgIT09IChfY29uZmlnX2Jhc2VVUkwgPSBjb25maWcuYmFzZVVSTCkgJiYgdm9pZCAwICE9PSBfY29uZmlnX2Jhc2VVUkwgPyBfY29uZmlnX2Jhc2VVUkwgOiBDT1pFX0NPTV9CQVNFX1VSTCkucmVwbGFjZSgnaHR0cHM6Ly9hcGknLCAnaHR0cHM6Ly93d3cnKTsKCiAgdmFyIF9jb25maWdfc3RhdGU7CgogIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoewogICAgcmVzcG9uc2VfdHlwZTogJ2NvZGUnLAogICAgY2xpZW50X2lkOiBjb25maWcuY2xpZW50SWQsCiAgICByZWRpcmVjdF91cmk6IGNvbmZpZy5yZWRpcmVjdFVybCwKICAgIHN0YXRlOiBudWxsICE9PSAoX2NvbmZpZ19zdGF0ZSA9IGNvbmZpZy5zdGF0ZSkgJiYgdm9pZCAwICE9PSBfY29uZmlnX3N0YXRlID8gX2NvbmZpZ19zdGF0ZSA6ICcnCiAgfSk7CiAgaWYgKGNvbmZpZy53b3Jrc3BhY2VJZCkgcmV0dXJuIGAke2Jhc2VVcmx9L2FwaS9wZXJtaXNzaW9uL29hdXRoMi93b3Jrc3BhY2VfaWQvJHtjb25maWcud29ya3NwYWNlSWR9L2F1dGhvcml6ZT8ke3BhcmFtcy50b1N0cmluZygpfWA7CiAgcmV0dXJuIGAke2Jhc2VVcmx9L2FwaS9wZXJtaXNzaW9uL29hdXRoMi9hdXRob3JpemU/JHtwYXJhbXMudG9TdHJpbmcoKX1gOwp9OwoKY29uc3QgZ2V0UEtDRUF1dGhlbnRpY2F0aW9uVXJsID0gYXN5bmMgY29uZmlnID0+IHsKICB2YXIgX2NvbmZpZ19iYXNlVVJMOwoKICBjb25zdCBiYXNlVXJsID0gKG51bGwgIT09IChfY29uZmlnX2Jhc2VVUkwgPSBjb25maWcuYmFzZVVSTCkgJiYgdm9pZCAwICE9PSBfY29uZmlnX2Jhc2VVUkwgPyBfY29uZmlnX2Jhc2VVUkwgOiBDT1pFX0NPTV9CQVNFX1VSTCkucmVwbGFjZSgnaHR0cHM6Ly9hcGknLCAnaHR0cHM6Ly93d3cnKTsKICBjb25zdCBjcnlwdG8gPSBnZXRDcnlwdG8oKTsgLy8gR2VuZXJhdGUgY29kZV9jaGFsbGVuZ2UgZnJvbSBjb2RlX3ZlcmlmaWVyCgogIGNvbnN0IGdlbmVyYXRlQ29kZUNoYWxsZW5nZSA9IGFzeW5jIGNvZGVWZXJpZmllciA9PiB7CiAgICBjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7CiAgICBjb25zdCBkYXRhID0gZW5jb2Rlci5lbmNvZGUoY29kZVZlcmlmaWVyKTsKICAgIGNvbnN0IGhhc2ggPSBhd2FpdCBjcnlwdG8uc3VidGxlLmRpZ2VzdCgnU0hBLTI1NicsIGRhdGEpOwogICAgcmV0dXJuIGJ0b2EoU3RyaW5nLmZyb21DaGFyQ29kZSguLi5uZXcgVWludDhBcnJheShoYXNoKSkpLnJlcGxhY2UoLz0vZywgJycpLnJlcGxhY2UoL1wrL2csICctJykucmVwbGFjZSgvXC8vZywgJ18nKTsKICB9OyAvLyBHZW5lcmF0ZSBhIHJhbmRvbSBjb2RlX3ZlcmlmaWVyCgoKICBjb25zdCBjb2RlVmVyaWZpZXIgPSBnZW5lcmF0ZVJhbmRvbVN0cmluZygpOwogIGNvbnN0IGNvZGVDaGFsbGVuZ2UgPSBhd2FpdCBnZW5lcmF0ZUNvZGVDaGFsbGVuZ2UoY29kZVZlcmlmaWVyKTsKCiAgdmFyIF9jb25maWdfc3RhdGU7CgogIGNvbnN0IHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoewogICAgcmVzcG9uc2VfdHlwZTogJ2NvZGUnLAogICAgY2xpZW50X2lkOiBjb25maWcuY2xpZW50SWQsCiAgICByZWRpcmVjdF91cmk6IGNvbmZpZy5yZWRpcmVjdFVybCwKICAgIHN0YXRlOiBudWxsICE9PSAoX2NvbmZpZ19zdGF0ZSA9IGNvbmZpZy5zdGF0ZSkgJiYgdm9pZCAwICE9PSBfY29uZmlnX3N0YXRlID8gX2NvbmZpZ19zdGF0ZSA6ICcnLAogICAgY29kZV9jaGFsbGVuZ2U6IGNvZGVDaGFsbGVuZ2UsCiAgICBjb2RlX2NoYWxsZW5nZV9tZXRob2Q6IGNvbmZpZy5jb2RlX2NoYWxsZW5nZV9tZXRob2QgfHwgJ1MyNTYnCiAgfSk7CiAgaWYgKGNvbmZpZy53b3Jrc3BhY2VJZCkgcmV0dXJuIHsKICAgIHVybDogYCR7YmFzZVVybH0vYXBpL3Blcm1pc3Npb24vb2F1dGgyL3dvcmtzcGFjZV9pZC8ke2NvbmZpZy53b3Jrc3BhY2VJZH0vYXV0aG9yaXplPyR7cGFyYW1zLnRvU3RyaW5nKCl9YCwKICAgIGNvZGVWZXJpZmllcgogIH07CiAgcmV0dXJuIHsKICAgIHVybDogYCR7YmFzZVVybH0vYXBpL3Blcm1pc3Npb24vb2F1dGgyL2F1dGhvcml6ZT8ke3BhcmFtcy50b1N0cmluZygpfWAsCiAgICBjb2RlVmVyaWZpZXIKICB9Owp9OwoKY29uc3QgZ2V0V2ViT0F1dGhUb2tlbiA9IGFzeW5jIChjb25maWcsIG9wdGlvbnMpID0+IHsKICBjb25zdCBhcGkgPSBuZXcgQVBJQ2xpZW50KHsKICAgIHRva2VuOiBjb25maWcuY2xpZW50U2VjcmV0LAogICAgYmFzZVVSTDogY29uZmlnLmJhc2VVUkwKICB9KTsKICBjb25zdCBhcGlVcmwgPSAnL2FwaS9wZXJtaXNzaW9uL29hdXRoMi90b2tlbic7CiAgY29uc3QgcGF5bG9hZCA9IHsKICAgIGdyYW50X3R5cGU6ICdhdXRob3JpemF0aW9uX2NvZGUnLAogICAgY2xpZW50X2lkOiBjb25maWcuY2xpZW50SWQsCiAgICByZWRpcmVjdF91cmk6IGNvbmZpZy5yZWRpcmVjdFVybCwKICAgIGNvZGU6IGNvbmZpZy5jb2RlCiAgfTsKICBjb25zdCByZXN1bHQgPSBhd2FpdCBhcGkucG9zdChhcGlVcmwsIHBheWxvYWQsIGZhbHNlLCBvcHRpb25zKTsKICByZXR1cm4gcmVzdWx0Owp9OwoKY29uc3QgZ2V0UEtDRU9BdXRoVG9rZW4gPSBhc3luYyAoY29uZmlnLCBvcHRpb25zKSA9PiB7CiAgY29uc3QgYXBpID0gbmV3IEFQSUNsaWVudCh7CiAgICB0b2tlbjogJycsCiAgICBiYXNlVVJMOiBjb25maWcuYmFzZVVSTAogIH0pOwogIGNvbnN0IGFwaVVybCA9ICcvYXBpL3Blcm1pc3Npb24vb2F1dGgyL3Rva2VuJzsKICBjb25zdCBwYXlsb2FkID0gewogICAgZ3JhbnRfdHlwZTogJ2F1dGhvcml6YXRpb25fY29kZScsCiAgICBjbGllbnRfaWQ6IGNvbmZpZy5jbGllbnRJZCwKICAgIHJlZGlyZWN0X3VyaTogY29uZmlnLnJlZGlyZWN0VXJsLAogICAgY29kZTogY29uZmlnLmNvZGUsCiAgICBjb2RlX3ZlcmlmaWVyOiBjb25maWcuY29kZVZlcmlmaWVyCiAgfTsKICBjb25zdCByZXN1bHQgPSBhd2FpdCBhcGkucG9zdChhcGlVcmwsIHBheWxvYWQsIGZhbHNlLCBvcHRpb25zKTsKICByZXR1cm4gcmVzdWx0Owp9OwoKY29uc3QgcmVmcmVzaE9BdXRoVG9rZW4gPSBhc3luYyAoY29uZmlnLCBvcHRpb25zKSA9PiB7CiAgY29uc3QgYXBpID0gbmV3IEFQSUNsaWVudCh7CiAgICB0b2tlbjogY29uZmlnLmNsaWVudFNlY3JldCB8fCAnJywKICAgIGJhc2VVUkw6IGNvbmZpZy5iYXNlVVJMCiAgfSk7CiAgY29uc3QgYXBpVXJsID0gJy9hcGkvcGVybWlzc2lvbi9vYXV0aDIvdG9rZW4nOwogIGNvbnN0IHBheWxvYWQgPSB7CiAgICBncmFudF90eXBlOiAncmVmcmVzaF90b2tlbicsCiAgICBjbGllbnRfaWQ6IGNvbmZpZy5jbGllbnRJZCwKICAgIHJlZnJlc2hfdG9rZW46IGNvbmZpZy5yZWZyZXNoVG9rZW4KICB9OwogIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaS5wb3N0KGFwaVVybCwgcGF5bG9hZCwgZmFsc2UsIG9wdGlvbnMpOwogIHJldHVybiByZXN1bHQ7Cn07Cgpjb25zdCBnZXREZXZpY2VDb2RlID0gYXN5bmMgKGNvbmZpZywgb3B0aW9ucykgPT4gewogIGlmIChpc0Jyb3dzZXIoKSkgdGhyb3cgbmV3IEVycm9yKCdnZXREZXZpY2VDb2RlIGlzIG5vdCBzdXBwb3J0ZWQgaW4gYnJvd3NlcicpOwogIGNvbnN0IGFwaSA9IG5ldyBBUElDbGllbnQoewogICAgdG9rZW46ICcnLAogICAgYmFzZVVSTDogY29uZmlnLmJhc2VVUkwKICB9KTsKICBsZXQgYXBpVXJsOwogIGFwaVVybCA9IGNvbmZpZy53b3Jrc3BhY2VJZCA/IGAvYXBpL3Blcm1pc3Npb24vb2F1dGgyL3dvcmtzcGFjZV9pZC8ke2NvbmZpZy53b3Jrc3BhY2VJZH0vZGV2aWNlL2NvZGVgIDogJy9hcGkvcGVybWlzc2lvbi9vYXV0aDIvZGV2aWNlL2NvZGUnOwogIGNvbnN0IHBheWxvYWQgPSB7CiAgICBjbGllbnRfaWQ6IGNvbmZpZy5jbGllbnRJZAogIH07CiAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYXBpLnBvc3QoYXBpVXJsLCBwYXlsb2FkLCBmYWxzZSwgb3B0aW9ucyk7CiAgcmV0dXJuIHJlc3VsdDsKfTsKCmNvbnN0IF9nZXREZXZpY2VUb2tlbiA9IGFzeW5jIChjb25maWcsIG9wdGlvbnMpID0+IHsKICBjb25zdCBhcGkgPSBuZXcgQVBJQ2xpZW50KHsKICAgIHRva2VuOiAnJywKICAgIGJhc2VVUkw6IGNvbmZpZy5iYXNlVVJMCiAgfSk7CiAgY29uc3QgYXBpVXJsID0gJy9hcGkvcGVybWlzc2lvbi9vYXV0aDIvdG9rZW4nOwogIGNvbnN0IHBheWxvYWQgPSB7CiAgICBncmFudF90eXBlOiAndXJuOmlldGY6cGFyYW1zOm9hdXRoOmdyYW50LXR5cGU6ZGV2aWNlX2NvZGUnLAogICAgY2xpZW50X2lkOiBjb25maWcuY2xpZW50SWQsCiAgICBkZXZpY2VfY29kZTogY29uZmlnLmRldmljZUNvZGUKICB9OwogIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGFwaS5wb3N0KGFwaVVybCwgcGF5bG9hZCwgZmFsc2UsIG9wdGlvbnMpOwogIHJldHVybiByZXN1bHQ7Cn07Cgpjb25zdCBnZXREZXZpY2VUb2tlbiA9IGFzeW5jIChjb25maWcsIG9wdGlvbnMpID0+IHsKICBpZiAoaXNCcm93c2VyKCkpIHRocm93IG5ldyBFcnJvcignZ2V0RGV2aWNlVG9rZW4gaXMgbm90IHN1cHBvcnRlZCBpbiBicm93c2VyJyk7CiAgaWYgKCFjb25maWcucG9sbCkgcmV0dXJuIF9nZXREZXZpY2VUb2tlbihjb25maWcsIG9wdGlvbnMpOwogIGxldCBpbnRlcnZhbCA9IFBPTExfSU5URVJWQUw7CgogIHdoaWxlICh0cnVlKSB0cnkgewogICAgLy8gQXR0ZW1wdCB0byBnZXQgdGhlIGRldmljZSB0b2tlbgogICAgY29uc3QgZGV2aWNlVG9rZW4gPSBhd2FpdCBfZ2V0RGV2aWNlVG9rZW4oY29uZmlnLCBvcHRpb25zKTsKICAgIHJldHVybiBkZXZpY2VUb2tlbjsKICB9IGNhdGNoIChlcnJvcikgewogICAgaWYgKGVycm9yIGluc3RhbmNlb2YgQVBJRXJyb3IpIHsKICAgICAgdmFyIF9lcnJvcl9yYXdFcnJvciwgX2Vycm9yX3Jhd0Vycm9yMTsgLy8gSWYgdGhlIGVycm9yIGlzIGF1dGhvcml6YXRpb25fcGVuZGluZywgY29udGludWUgcG9sbGluZwoKCiAgICAgIGlmICgobnVsbCA9PSBlcnJvciA/IHZvaWQgMCA6IG51bGwgPT09IChfZXJyb3JfcmF3RXJyb3IgPSBlcnJvci5yYXdFcnJvcikgfHwgdm9pZCAwID09PSBfZXJyb3JfcmF3RXJyb3IgPyB2b2lkIDAgOiBfZXJyb3JfcmF3RXJyb3IuZXJyb3IpID09PSAiYXV0aG9yaXphdGlvbl9wZW5kaW5nIikgewogICAgICAgIGF3YWl0IHNsZWVwKGludGVydmFsKTsKICAgICAgICBjb250aW51ZTsgLy8gSWYgdGhlIGVycm9yIGlzIHNsb3dfZG93biwgaW5jcmVhc2UgdGhlIGludGVydmFsCiAgICAgIH0KCiAgICAgIGlmICgobnVsbCA9PSBlcnJvciA/IHZvaWQgMCA6IG51bGwgPT09IChfZXJyb3JfcmF3RXJyb3IxID0gZXJyb3IucmF3RXJyb3IpIHx8IHZvaWQgMCA9PT0gX2Vycm9yX3Jhd0Vycm9yMSA/IHZvaWQgMCA6IF9lcnJvcl9yYXdFcnJvcjEuZXJyb3IpID09PSAic2xvd19kb3duIikgewogICAgICAgIGlmIChpbnRlcnZhbCA8IE1BWF9QT0xMX0lOVEVSVkFMKSBpbnRlcnZhbCArPSBQT0xMX0lOVEVSVkFMOwogICAgICAgIGF3YWl0IHNsZWVwKGludGVydmFsKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgfSAvLyBGb3IgYW55IG90aGVyIGVycm9yLCB0aHJvdyBpdAoKCiAgICB0aHJvdyBlcnJvcjsKICB9Cn07Cgpjb25zdCBfZ2V0SldUVG9rZW4gPSBhc3luYyAoY29uZmlnLCBvcHRpb25zKSA9PiB7CiAgY29uc3QgYXBpID0gbmV3IEFQSUNsaWVudCh7CiAgICB0b2tlbjogY29uZmlnLnRva2VuLAogICAgYmFzZVVSTDogY29uZmlnLmJhc2VVUkwKICB9KTsKICBsZXQgYXBpVXJsOwogIGFwaVVybCA9IGNvbmZpZy5hY2NvdW50SWQgPyBgL2FwaS9wZXJtaXNzaW9uL29hdXRoMi9hY2NvdW50LyR7Y29uZmlnLmFjY291bnRJZH0vdG9rZW5gIDogJy9hcGkvcGVybWlzc2lvbi9vYXV0aDIvdG9rZW4nOwoKICB2YXIgX2NvbmZpZ19kdXJhdGlvblNlY29uZHM7CgogIGNvbnN0IHBheWxvYWQgPSB7CiAgICBncmFudF90eXBlOiAndXJuOmlldGY6cGFyYW1zOm9hdXRoOmdyYW50LXR5cGU6and0LWJlYXJlcicsCiAgICBkdXJhdGlvbl9zZWNvbmRzOiBudWxsICE9PSAoX2NvbmZpZ19kdXJhdGlvblNlY29uZHMgPSBjb25maWcuZHVyYXRpb25TZWNvbmRzKSAmJiB2b2lkIDAgIT09IF9jb25maWdfZHVyYXRpb25TZWNvbmRzID8gX2NvbmZpZ19kdXJhdGlvblNlY29uZHMgOiA5MDAsCiAgICBzY29wZTogY29uZmlnLnNjb3BlCiAgfTsKICBjb25zdCByZXN1bHQgPSBhd2FpdCBhcGkucG9zdChhcGlVcmwsIHBheWxvYWQsIGZhbHNlLCBvcHRpb25zKTsKICByZXR1cm4gcmVzdWx0Owp9OwoKY29uc3QgZ2V0SldUVG9rZW4gPSBhc3luYyAoY29uZmlnLCBvcHRpb25zKSA9PiB7CiAgaWYgKGlzQnJvd3NlcigpKSB0aHJvdyBuZXcgRXJyb3IoJ2dldEpXVFRva2VuIGlzIG5vdCBzdXBwb3J0ZWQgaW4gYnJvd3NlcicpOyAvLyBWYWxpZGF0ZSBwcml2YXRlIGtleSBmb3JtYXQKCiAgY29uc3Qga2V5Rm9ybWF0ID0gY29uZmlnLnByaXZhdGVLZXkuaW5jbHVkZXMoJ0JFR0lOIFJTQSBQUklWQVRFIEtFWScpID8gJ1JTQScgOiBjb25maWcucHJpdmF0ZUtleS5pbmNsdWRlcygnQkVHSU4gUFJJVkFURSBLRVknKSA/ICdQS0NTOCcgOiBudWxsOwogIGlmICgha2V5Rm9ybWF0KSB0aHJvdyBBUElFcnJvci5nZW5lcmF0ZSg0MDAsIHZvaWQgMCwgJ0ludmFsaWQgcHJpdmF0ZSBrZXkgZm9ybWF0LiBFeHBlY3RlZCBQRU0gZm9ybWF0IChSU0Egb3IgUEtDUzgpJywgdm9pZCAwKTsgLy8gUHJlcGFyZSB0aGUgcGF5bG9hZCBmb3IgdGhlIEpXVAoKICBjb25zdCBub3cgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkKCiAgY29uc3QgcGF5bG9hZCA9IHsKICAgIGlzczogY29uZmlnLmFwcElkLAogICAgYXVkOiBjb25maWcuYXVkLAogICAgaWF0OiBub3csCiAgICBleHA6IG5vdyArIDM2MDAsCiAgICBqdGk6IGdlbmVyYXRlUmFuZG9tU3RyaW5nKCkKICB9OwogIGlmIChjb25maWcuc2Vzc2lvbk5hbWUpIHBheWxvYWQuc2Vzc2lvbl9uYW1lID0gY29uZmlnLnNlc3Npb25OYW1lOwogIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICB2YXIgX2NvbmZpZ19hbGdvcml0aG07CgogICAgZXh0ZXJuYWxfanNvbndlYnRva2VuX2RlZmF1bHQoKS5zaWduKHBheWxvYWQsIGNvbmZpZy5wcml2YXRlS2V5LCB7CiAgICAgIGFsZ29yaXRobTogbnVsbCAhPT0gKF9jb25maWdfYWxnb3JpdGhtID0gY29uZmlnLmFsZ29yaXRobSkgJiYgdm9pZCAwICE9PSBfY29uZmlnX2FsZ29yaXRobSA/IF9jb25maWdfYWxnb3JpdGhtIDogJ1JTMjU2JywKICAgICAga2V5aWQ6IGNvbmZpZy5rZXlpZAogICAgfSwgYXN5bmMgKGVyciwgdG9rZW4pID0+IHsKICAgICAgaWYgKGVyciB8fCAhdG9rZW4pIHsKICAgICAgICByZWplY3QoZXJyKTsKICAgICAgICByZXR1cm47CiAgICAgIH0gLy8gRXhjaGFuZ2UgdGhlIEpXVCBmb3IgYW4gT0F1dGggdG9rZW4KCgogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IF9nZXRKV1RUb2tlbih7IC4uLmNvbmZpZywKICAgICAgICAgIHRva2VuCiAgICAgICAgfSwgb3B0aW9ucyk7CiAgICAgICAgcmVzb2x2ZShyZXN1bHQpOwogICAgICB9IGNhdGNoIChlcnIyKSB7CiAgICAgICAgcmVqZWN0KGVycjIpOwogICAgICB9CiAgICB9KTsKICB9KTsKfTsKCnZhciBhdXRoX1BLQ0VBdXRoRXJyb3JUeXBlID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChQS0NFQXV0aEVycm9yVHlwZSkgewogIFBLQ0VBdXRoRXJyb3JUeXBlWyJBVVRIT1JJWkFUSU9OX1BFTkRJTkciXSA9ICJhdXRob3JpemF0aW9uX3BlbmRpbmciOwogIFBLQ0VBdXRoRXJyb3JUeXBlWyJTTE9XX0RPV04iXSA9ICJzbG93X2Rvd24iOwogIFBLQ0VBdXRoRXJyb3JUeXBlWyJBQ0NFU1NfREVOSUVEIl0gPSAiYWNjZXNzX2RlbmllZCI7CiAgUEtDRUF1dGhFcnJvclR5cGVbIkVYUElSRURfVE9LRU4iXSA9ICJleHBpcmVkX3Rva2VuIjsKICByZXR1cm4gUEtDRUF1dGhFcnJvclR5cGU7Cn0oe30pOwoKY2xhc3MgQ296ZUFQSSBleHRlbmRzIEFQSUNsaWVudCB7CiAgY29uc3RydWN0b3IoLi4uYXJncykgewogICAgc3VwZXIoLi4uYXJncyksIHRoaXMuYm90cyA9IG5ldyBCb3RzKHRoaXMpLCB0aGlzLmNoYXQgPSBuZXcgQ2hhdCh0aGlzKSwgdGhpcy5jb252ZXJzYXRpb25zID0gbmV3IENvbnZlcnNhdGlvbnModGhpcyksIHRoaXMuZmlsZXMgPSBuZXcgRmlsZXModGhpcyksCiAgICAvKioKICAgICogQGRlcHJlY2F0ZWQKICAgICovCiAgICB0aGlzLmtub3dsZWRnZSA9IG5ldyBLbm93bGVkZ2UodGhpcyksIHRoaXMuZGF0YXNldHMgPSBuZXcgRGF0YXNldHModGhpcyksIHRoaXMud29ya2Zsb3dzID0gbmV3IFdvcmtmbG93cyh0aGlzKSwgdGhpcy53b3Jrc3BhY2VzID0gbmV3IFdvcmtTcGFjZXModGhpcyksIHRoaXMuYXVkaW8gPSBuZXcgQXVkaW8odGhpcyksIHRoaXMudGVtcGxhdGVzID0gbmV3IFRlbXBsYXRlcyh0aGlzKSwgdGhpcy53ZWJzb2NrZXRzID0gbmV3IFdlYnNvY2tldHModGhpcyk7CiAgfQoKfQoKdmFyIF9fd2VicGFja19leHBvcnRfdGFyZ2V0X18gPSBleHBvcnRzOwoKZm9yICh2YXIgaSBpbiBfX3dlYnBhY2tfZXhwb3J0c19fKSBfX3dlYnBhY2tfZXhwb3J0X3RhcmdldF9fW2ldID0gX193ZWJwYWNrX2V4cG9ydHNfX1tpXTsKCmlmIChfX3dlYnBhY2tfZXhwb3J0c19fLl9fZXNNb2R1bGUpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShfX3dlYnBhY2tfZXhwb3J0X3RhcmdldF9fLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTs="},{"version":3,"sources":["E:/SmartFitness/smart-fitness-view/node_modules/@coze/api/dist/cjs/index.js"],"names":["__webpack_require__","n","module","getter","__esModule","d","a","exports1","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","__webpack_exports__","Transcriptions","InternalServerError","fetchAPI","COZE_CN_BASE_WS_URL","APIError","Knowledge","CozeAPI","OldDocuments","Documents","POLL_INTERVAL","WebSocketAPI","Websockets","handleAdditionalMessages","documents_Documents","getJWTToken","Audio","Files","getDeviceToken","ChatEventType","chat_ChatEventType","ChatStatus","chat_ChatStatus","NotFoundError","APIConnectionError","COZE_COM_BASE_WS_URL","Rooms","WorkSpaces","JSONParseError","castToError","getPKCEOAuthToken","getDeviceCode","getWebAuthenticationUrl","handleParameters","COZE_COM_BASE_URL","AuthenticationError","COZE_CN_BASE_URL","getPKCEAuthenticationUrl","TemplateEntityType","templates_TemplateEntityType","Conversations","Workflows","GatewayError","PermissionDeniedError","APIUserAbortError","Bots","Chat","RateLimitError","Runs","_getJWTToken","TimeoutError","WebsocketsEventType","types_WebsocketsEventType","PKCEAuthErrorType","auth_PKCEAuthErrorType","MAX_POLL_INTERVAL","WorkflowChat","WorkflowEventType","runs_WorkflowEventType","Templates","getWebOAuthToken","refreshOAuthToken","Images","BadRequestError","CozeError","RoleType","chat_RoleType","Voices","Messages","messages_Messages","WorkflowEvent","adapterFetch","Datasets","APIResource","constructor","client","_client","create","params","options","apiUrl","result","post","data","update","list","publish","retrieve","safeJsonParse","jsonString","defaultValue","arguments","length","JSON","parse","error","sleep","ms","Promise","resolve","setTimeout","isUniApp","uni","isBrowser","window","isPlainObject","proto","getPrototypeOf","baseProto","mergeConfig","_len","objects","Array","_key","reduce","isArray","isPersonalAccessToken","token","startsWith","buildWebsocketUrl","path","queryString","entries","filter","param","_","map","join","Error","makeMessage","status","errorBody","message","headers","code","msg","push","detail","logId","logid","generate","errorResponse","cause","_error_detail","_error_error","rawError","name","args","err","conversation_id","chat_id","uuid","Math","random","Date","getTime","toString","additional_messages","i","content","stringify","parameters","user_id","rest","payload","shortcut_command","stream","createAndPoll","chatId","id","conversationId","chat","messageList","messages","event","ret","cancel","submitToolOutputs","response","message_id","delete","clear","external_axios_namespaceObject","require","external_axios_default","upload","toFormData","file_id","Number","resume","history","workflowId","executeId","DONE","runs","documents_headers","document_infos","documents","documents_documents_headers","datasetId","documentId","put","dataset_id","process","images","clone","Speech","sample_rate","responseType","rooms","voices","speech","transcriptions","duplicate","templateId","chat_Chat","req","makeWebsocket","transcriptions_Transcriptions","speech_Speech","audio_Audio","audio","external_ws_namespaceObject","external_ws_default","external_reconnecting_websocket_namespaceObject","external_reconnecting_websocket_default","readyState","rws","send","close","reason","reconnect","addEventListener","type","listener","removeEventListener","url","onmessage","onopen","onclose","onerror","separator","includes","authorization","WebSocket","url2","protocols","_this_onmessage","_this","console","_this_onopen","_this_onclose","_event_target__req_res","_event_target__req","_event_target","_event_target__req_res1","_event_target__req1","_event_target1","_this_onerror","statusCode","target","_req","res","rawHeaders","logidIndex","findIndex","header","event_type","ERROR","_event_error","String","external_os_namespaceObject","external_os_default","package_namespaceObject","version","version_version","getEnv","nodeVersion","slice","platform","osName","toLowerCase","osVersion","release","darwinVersion","split","majorVersion","parseInt","isNaN","macVersion","getUserAgent","getNodeClientUserAgent","ua","lang","lang_version","os_name","os_version","getBrowserClientUserAgent","browserInfo","osInfo","userAgent","navigator","indexOf","_userAgent_match","windowsVersion","match","_userAgent_match1","replace","_userAgent_match2","_userAgent_match3","_userAgent_match4","_userAgent_match5","browser","browser_version","getUniAppClientUserAgent","systemInfo","getSystemInfoSync","platformInfo","system","AppPlatform","appVersion","uniPlatform","SDKVersion","appName","framework","platform_version","screen_width","screenWidth","screen_height","screenHeight","device_model","model","device_brand","brand","external_node_fetch_namespaceObject","external_node_fetch_default","handleError","isAxiosError","_error_response","_error_response1","_error_response2","_error_response3","body","isSupportNativeFetch","compareVersions","axiosInstance","isStreaming","isAxiosStatic","axiosVersion","VERSION","adapter","catch","reader","asyncIterator","getReader","decoder","TextDecoder","fieldValues","buffer","done","next","read","decode","lines","line","index","field","substring","trim","json","v1","v2","v1Parts","v2Parts","part1","part2","instance","Axios","APIClient","getToken","buildOptions","method","config","axiosOptions","buildWebsocketOptions","_this__config_debug","debug","_config","websocketOptions","makeRequest","isStream","fullUrl","baseURL","fetchOptions","debugLog","_response_headers","contentType","baseWsURL","ws","getConfig","forceDebug","msgs","allowPersonalAccessTokenInBrowser","UserAbortError","external_crypto_namespaceObject","external_jsonwebtoken_namespaceObject","external_jsonwebtoken_default","getCrypto","getRandomValues","subtle","digest","crypto","array","randomFillSync","generateRandomString","Uint8Array","from","byte","padStart","_config_baseURL","baseUrl","_config_state","URLSearchParams","response_type","client_id","clientId","redirect_uri","redirectUrl","state","workspaceId","generateCodeChallenge","codeVerifier","encoder","TextEncoder","encode","hash","btoa","fromCharCode","codeChallenge","code_challenge","code_challenge_method","api","clientSecret","grant_type","code_verifier","refresh_token","refreshToken","_getDeviceToken","device_code","deviceCode","poll","interval","deviceToken","_error_rawError","_error_rawError1","accountId","_config_durationSeconds","duration_seconds","durationSeconds","scope","keyFormat","privateKey","now","floor","iss","appId","aud","iat","exp","jti","sessionName","session_name","reject","_config_algorithm","sign","algorithm","keyid","err2","bots","conversations","files","knowledge","datasets","workflows","workspaces","templates","websockets","__webpack_export_target__","exports"],"mappings":"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","sourcesContent":["\"use strict\";\n// The require scope\nvar __webpack_require__ = {};\n/************************************************************************/ // webpack/runtime/compat_get_default_export\n(()=>{\n    // getDefaultExport function for compatibility with non-ESM modules\n    __webpack_require__.n = function(module) {\n        var getter = module && module.__esModule ? function() {\n            return module['default'];\n        } : function() {\n            return module;\n        };\n        __webpack_require__.d(getter, {\n            a: getter\n        });\n        return getter;\n    };\n})();\n// webpack/runtime/define_property_getters\n(()=>{\n    __webpack_require__.d = function(exports1, definition) {\n        for(var key in definition)if (__webpack_require__.o(definition, key) && !__webpack_require__.o(exports1, key)) Object.defineProperty(exports1, key, {\n            enumerable: true,\n            get: definition[key]\n        });\n    };\n})();\n// webpack/runtime/has_own_property\n(()=>{\n    __webpack_require__.o = function(obj, prop) {\n        return Object.prototype.hasOwnProperty.call(obj, prop);\n    };\n})();\n// webpack/runtime/make_namespace_object\n(()=>{\n    // define __esModule on exports\n    __webpack_require__.r = function(exports1) {\n        if ('undefined' != typeof Symbol && Symbol.toStringTag) Object.defineProperty(exports1, Symbol.toStringTag, {\n            value: 'Module'\n        });\n        Object.defineProperty(exports1, '__esModule', {\n            value: true\n        });\n    };\n})();\n/************************************************************************/ var __webpack_exports__ = {};\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n    Transcriptions: ()=>/* reexport */ Transcriptions,\n    InternalServerError: ()=>/* reexport */ InternalServerError,\n    fetchAPI: ()=>/* reexport */ fetchAPI,\n    COZE_CN_BASE_WS_URL: ()=>/* reexport */ COZE_CN_BASE_WS_URL,\n    APIError: ()=>/* reexport */ APIError,\n    Knowledge: ()=>/* reexport */ Knowledge,\n    CozeAPI: ()=>/* binding */ CozeAPI,\n    OldDocuments: ()=>/* reexport */ Documents,\n    POLL_INTERVAL: ()=>/* reexport */ POLL_INTERVAL,\n    WebSocketAPI: ()=>/* reexport */ WebSocketAPI,\n    Websockets: ()=>/* reexport */ Websockets,\n    handleAdditionalMessages: ()=>/* reexport */ handleAdditionalMessages,\n    Documents: ()=>/* reexport */ documents_Documents,\n    getJWTToken: ()=>/* reexport */ getJWTToken,\n    Audio: ()=>/* reexport */ Audio,\n    Files: ()=>/* reexport */ Files,\n    getDeviceToken: ()=>/* reexport */ getDeviceToken,\n    ChatEventType: ()=>/* reexport */ chat_ChatEventType,\n    ChatStatus: ()=>/* reexport */ chat_ChatStatus,\n    NotFoundError: ()=>/* reexport */ NotFoundError,\n    APIConnectionError: ()=>/* reexport */ APIConnectionError,\n    COZE_COM_BASE_WS_URL: ()=>/* reexport */ COZE_COM_BASE_WS_URL,\n    Rooms: ()=>/* reexport */ Rooms,\n    WorkSpaces: ()=>/* reexport */ WorkSpaces,\n    JSONParseError: ()=>/* reexport */ JSONParseError,\n    castToError: ()=>/* reexport */ castToError,\n    getPKCEOAuthToken: ()=>/* reexport */ getPKCEOAuthToken,\n    getDeviceCode: ()=>/* reexport */ getDeviceCode,\n    getWebAuthenticationUrl: ()=>/* reexport */ getWebAuthenticationUrl,\n    handleParameters: ()=>/* reexport */ handleParameters,\n    COZE_COM_BASE_URL: ()=>/* reexport */ COZE_COM_BASE_URL,\n    AuthenticationError: ()=>/* reexport */ AuthenticationError,\n    COZE_CN_BASE_URL: ()=>/* reexport */ COZE_CN_BASE_URL,\n    getPKCEAuthenticationUrl: ()=>/* reexport */ getPKCEAuthenticationUrl,\n    TemplateEntityType: ()=>/* reexport */ templates_TemplateEntityType,\n    Conversations: ()=>/* reexport */ Conversations,\n    Workflows: ()=>/* reexport */ Workflows,\n    GatewayError: ()=>/* reexport */ GatewayError,\n    PermissionDeniedError: ()=>/* reexport */ PermissionDeniedError,\n    APIUserAbortError: ()=>/* reexport */ APIUserAbortError,\n    Bots: ()=>/* reexport */ Bots,\n    Chat: ()=>/* reexport */ Chat,\n    RateLimitError: ()=>/* reexport */ RateLimitError,\n    Runs: ()=>/* reexport */ Runs,\n    _getJWTToken: ()=>/* reexport */ _getJWTToken,\n    TimeoutError: ()=>/* reexport */ TimeoutError,\n    WebsocketsEventType: ()=>/* reexport */ types_WebsocketsEventType,\n    PKCEAuthErrorType: ()=>/* reexport */ auth_PKCEAuthErrorType,\n    MAX_POLL_INTERVAL: ()=>/* reexport */ MAX_POLL_INTERVAL,\n    WorkflowChat: ()=>/* reexport */ WorkflowChat,\n    WorkflowEventType: ()=>/* reexport */ runs_WorkflowEventType,\n    Templates: ()=>/* reexport */ Templates,\n    getWebOAuthToken: ()=>/* reexport */ getWebOAuthToken,\n    refreshOAuthToken: ()=>/* reexport */ refreshOAuthToken,\n    Images: ()=>/* reexport */ Images,\n    BadRequestError: ()=>/* reexport */ BadRequestError,\n    CozeError: ()=>/* reexport */ CozeError,\n    RoleType: ()=>/* reexport */ chat_RoleType,\n    Voices: ()=>/* reexport */ Voices,\n    Messages: ()=>/* reexport */ messages_Messages,\n    WorkflowEvent: ()=>/* reexport */ WorkflowEvent,\n    adapterFetch: ()=>/* reexport */ adapterFetch,\n    Datasets: ()=>/* reexport */ Datasets\n});\nclass APIResource {\n    constructor(client){\n        this._client = client;\n    }\n}\n/* eslint-disable @typescript-eslint/no-namespace */ class Bots extends APIResource {\n    /**\n   * Create a new agent. | 调用接口创建一个新的智能体。\n   * @docs en:https://www.coze.com/docs/developer_guides/create_bot?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/create_bot?_lang=zh\n   * @param params - Required The parameters for creating a bot. | 创建 Bot 的参数。\n   * @param params.space_id - Required The Space ID of the space where the agent is located. | Bot 所在的空间的 Space ID。\n   * @param params.name - Required The name of the agent. It should be 1 to 20 characters long. | Bot 的名称。\n   * @param params.description - Optional The description of the agent. It can be 0 to 500 characters long. | Bot 的描述信息。\n   * @param params.icon_file_id - Optional The file ID for the agent's avatar. | 作为智能体头像的文件 ID。\n   * @param params.prompt_info - Optional The personality and reply logic of the agent. | Bot 的提示词配置。\n   * @param params.onboarding_info - Optional The settings related to the agent's opening remarks. | Bot 的开场白配置。\n   * @returns Information about the created bot. | 创建的 Bot 信息。\n   */ async create(params, options) {\n        const apiUrl = '/v1/bot/create';\n        const result = await this._client.post(apiUrl, params, false, options);\n        return result.data;\n    }\n    /**\n   * Update the configuration of an agent. | 调用接口修改智能体的配置。\n   * @docs en:https://www.coze.com/docs/developer_guides/update_bot?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/update_bot?_lang=zh\n   * @param params - Required The parameters for updating a bot. | 修改 Bot 的参数。\n   * @param params.bot_id - Required The ID of the agent that the API interacts with. | 待修改配置的智能体ID。\n   * @param params.name - Optional The name of the agent. | Bot 的名称。\n   * @param params.description - Optional The description of the agent. | Bot 的描述信息。\n   * @param params.icon_file_id - Optional The file ID for the agent's avatar. | 作为智能体头像的文件 ID。\n   * @param params.prompt_info - Optional The personality and reply logic of the agent. | Bot 的提示词配置。\n   * @param params.onboarding_info - Optional The settings related to the agent's opening remarks. | Bot 的开场白配置。\n   * @param params.knowledge - Optional Knowledge configurations of the agent. | Bot 的知识库配置。\n   * @returns Undefined | 无返回值\n   */ async update(params, options) {\n        const apiUrl = '/v1/bot/update';\n        const result = await this._client.post(apiUrl, params, false, options);\n        return result.data;\n    }\n    /**\n   * Get the agents published as API service. | 调用接口查看指定空间发布到 Agent as API 渠道的智能体列表。\n   * @docs en:https://www.coze.com/docs/developer_guides/published_bots_list?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/published_bots_list?_lang=zh\n   * @param params - Required The parameters for listing bots. | 列出 Bot 的参数。\n   * @param params.space_id - Required The ID of the space. | Bot 所在的空间的 Space ID。\n   * @param params.page_size - Optional Pagination size. | 分页大小。\n   * @param params.page_index - Optional Page number for paginated queries. | 分页查询时的页码。\n   * @returns List of published bots. | 已发布的 Bot 列表。\n   */ async list(params, options) {\n        const apiUrl = '/v1/space/published_bots_list';\n        const result = await this._client.get(apiUrl, params, false, options);\n        return result.data;\n    }\n    /**\n   * Publish the specified agent as an API service. | 调用接口创建一个新的智能体。\n   * @docs en:https://www.coze.com/docs/developer_guides/publish_bot?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/publish_bot?_lang=zh\n   * @param params - Required The parameters for publishing a bot. | 发布 Bot 的参数。\n   * @param params.bot_id - Required The ID of the agent that the API interacts with. | 要发布的智能体ID。\n   * @param params.connector_ids - Required The list of publishing channel IDs for the agent. | 智能体的发布渠道 ID 列表。\n   * @returns Undefined | 无返回值\n   */ async publish(params, options) {\n        const apiUrl = '/v1/bot/publish';\n        const result = await this._client.post(apiUrl, params, false, options);\n        return result.data;\n    }\n    /**\n   * Get the configuration information of the agent. | 获取指定智能体的配置信息。\n   * @docs en:https://www.coze.com/docs/developer_guides/get_metadata?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/get_metadata?_lang=zh\n   * @param params - Required The parameters for retrieving a bot. | 获取 Bot 的参数。\n   * @param params.bot_id - Required The ID of the agent that the API interacts with. | 要查看的智能体ID。\n   * @returns Information about the bot. | Bot 的配置信息。\n   */ async retrieve(params, options) {\n        const apiUrl = '/v1/bot/get_online_info';\n        const result = await this._client.get(apiUrl, params, false, options);\n        return result.data;\n    }\n}\n/* eslint-disable security/detect-object-injection */ /* eslint-disable @typescript-eslint/no-explicit-any */ function safeJsonParse(jsonString) {\n    let defaultValue = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : '';\n    try {\n        return JSON.parse(jsonString);\n    } catch (error) {\n        return defaultValue;\n    }\n}\nfunction sleep(ms) {\n    return new Promise((resolve)=>{\n        setTimeout(resolve, ms);\n    });\n}\nfunction isUniApp() {\n    return 'undefined' != typeof uni;\n}\nfunction isBrowser() {\n    return 'undefined' != typeof window;\n}\nfunction isPlainObject(obj) {\n    if ('object' != typeof obj || null === obj) return false;\n    const proto = Object.getPrototypeOf(obj);\n    if (null === proto) return true;\n    let baseProto = proto;\n    while(null !== Object.getPrototypeOf(baseProto))baseProto = Object.getPrototypeOf(baseProto);\n    return proto === baseProto;\n}\nfunction mergeConfig() {\n    for(var _len = arguments.length, objects = new Array(_len), _key = 0; _key < _len; _key++)objects[_key] = arguments[_key];\n    return objects.reduce((result, obj)=>{\n        if (void 0 === obj) return result || {};\n        for(const key in obj)if (Object.prototype.hasOwnProperty.call(obj, key)) {\n            if (isPlainObject(obj[key]) && !Array.isArray(obj[key])) result[key] = mergeConfig(result[key] || {}, obj[key]);\n            else result[key] = obj[key];\n        }\n        return result;\n    }, {});\n}\nfunction isPersonalAccessToken(token) {\n    return null == token ? void 0 : token.startsWith('pat_');\n}\nfunction buildWebsocketUrl(path, params) {\n    const queryString = Object.entries(params).filter((param)=>{\n        let [_, value] = param;\n        return null != value && '' !== value;\n    }).map((param)=>{\n        let [key, value] = param;\n        return `${key}=${value}`;\n    }).join('&');\n    return `${path}?${queryString}`;\n}\n/* eslint-disable max-params */ class CozeError extends Error {\n}\nclass APIError extends CozeError {\n    static makeMessage(status, errorBody, message, headers) {\n        if (!errorBody && message) return message;\n        if (errorBody) {\n            const list = [];\n            const { code, msg, error } = errorBody;\n            if (code) list.push(`code: ${code}`);\n            if (msg) list.push(`msg: ${msg}`);\n            if ((null == error ? void 0 : error.detail) && msg !== error.detail) list.push(`detail: ${error.detail}`);\n            const logId = (null == error ? void 0 : error.logid) || (null == headers ? void 0 : headers['x-tt-logid']);\n            if (logId) list.push(`logid: ${logId}`);\n            return list.join(', ');\n        }\n        if (status) return `http status code: ${status} (no body)`;\n        return '(no status code or body)';\n    }\n    static generate(status, errorResponse, message, headers) {\n        if (!status) return new APIConnectionError({\n            cause: castToError(errorResponse)\n        });\n        const error = errorResponse;\n        // https://www.coze.cn/docs/developer_guides/coze_error_codes\n        if (400 === status || (null == error ? void 0 : error.code) === 4000) return new BadRequestError(status, error, message, headers);\n        if (401 === status || (null == error ? void 0 : error.code) === 4100) return new AuthenticationError(status, error, message, headers);\n        if (403 === status || (null == error ? void 0 : error.code) === 4101) return new PermissionDeniedError(status, error, message, headers);\n        if (404 === status || (null == error ? void 0 : error.code) === 4200) return new NotFoundError(status, error, message, headers);\n        if (429 === status || (null == error ? void 0 : error.code) === 4013) return new RateLimitError(status, error, message, headers);\n        if (408 === status) return new TimeoutError(status, error, message, headers);\n        if (502 === status) return new GatewayError(status, error, message, headers);\n        if (status >= 500) return new InternalServerError(status, error, message, headers);\n        return new APIError(status, error, message, headers);\n    }\n    constructor(status, error, message, headers){\n        var _error_detail, _error_error;\n        super(`${APIError.makeMessage(status, error, message, headers)}`);\n        this.status = status;\n        this.headers = headers;\n        this.logid = (null == error ? void 0 : null === (_error_detail = error.detail) || void 0 === _error_detail ? void 0 : _error_detail.logid) || (null == headers ? void 0 : headers['x-tt-logid']);\n        // this.error = error;\n        this.code = null == error ? void 0 : error.code;\n        this.msg = null == error ? void 0 : error.msg;\n        this.detail = null == error ? void 0 : null === (_error_error = error.error) || void 0 === _error_error ? void 0 : _error_error.detail;\n        this.rawError = error;\n    }\n}\nclass APIConnectionError extends APIError {\n    constructor({ message }){\n        super(void 0, void 0, message || 'Connection error.', void 0), this.status = void 0;\n    // if (cause) {\n    //   this.cause = cause;\n    // }\n    }\n}\nclass APIUserAbortError extends APIError {\n    constructor(message){\n        super(void 0, void 0, message || 'Request was aborted.', void 0), this.name = 'UserAbortError', this.status = void 0;\n    }\n}\nclass BadRequestError extends APIError {\n    constructor(...args){\n        super(...args), this.name = 'BadRequestError', this.status = 400;\n    }\n}\nclass AuthenticationError extends APIError {\n    constructor(...args){\n        super(...args), this.name = 'AuthenticationError', this.status = 401;\n    }\n}\nclass PermissionDeniedError extends APIError {\n    constructor(...args){\n        super(...args), this.name = 'PermissionDeniedError', this.status = 403;\n    }\n}\nclass NotFoundError extends APIError {\n    constructor(...args){\n        super(...args), this.name = 'NotFoundError', this.status = 404;\n    }\n}\nclass TimeoutError extends APIError {\n    constructor(...args){\n        super(...args), this.name = 'TimeoutError', this.status = 408;\n    }\n}\nclass RateLimitError extends APIError {\n    constructor(...args){\n        super(...args), this.name = 'RateLimitError', this.status = 429;\n    }\n}\nclass InternalServerError extends APIError {\n    constructor(...args){\n        super(...args), this.name = 'InternalServerError', this.status = 500;\n    }\n}\nclass GatewayError extends APIError {\n    constructor(...args){\n        super(...args), this.name = 'GatewayError', this.status = 502;\n    }\n}\nconst castToError = (err)=>{\n    if (err instanceof Error) return err;\n    return new Error(err);\n};\nclass JSONParseError extends Error {\n    constructor({ message, cause }){\n        super(message);\n        this.cause = cause;\n    }\n}\nclass Messages extends APIResource {\n    /**\n   * Get the list of messages in a chat. | 获取对话中的消息列表。\n   * @docs en:https://www.coze.com/docs/developer_guides/chat_message_list?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/chat_message_list?_lang=zh\n   * @param conversation_id - Required The ID of the conversation. | 会话 ID。\n   * @param chat_id - Required The ID of the chat. | 对话 ID。\n   * @returns An array of chat messages. | 对话消息数组。\n   */ async list(conversation_id, chat_id, options) {\n        const apiUrl = `/v3/chat/message/list?conversation_id=${conversation_id}&chat_id=${chat_id}`;\n        const result = await this._client.get(apiUrl, void 0, false, options);\n        return result.data;\n    }\n}\nconst uuid = ()=>(Math.random() * new Date().getTime()).toString();\nconst handleAdditionalMessages = (additional_messages)=>null == additional_messages ? void 0 : additional_messages.map((i)=>({\n            ...i,\n            content: 'object' == typeof i.content ? JSON.stringify(i.content) : i.content\n        }));\nconst handleParameters = (parameters)=>{\n    if (parameters) {\n        for (const [key, value] of Object.entries(parameters))if ('object' == typeof value) parameters[key] = JSON.stringify(value);\n    }\n    return parameters;\n};\nclass Chat extends APIResource {\n    /**\n   * Call the Chat API to send messages to a published Coze agent. | 调用此接口发起一次对话，支持添加上下文\n   * @docs en:https://www.coze.com/docs/developer_guides/chat_v3?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/chat_v3?_lang=zh\n   * @param params - Required The parameters for creating a chat session. | 创建会话的参数。\n   * @param params.bot_id - Required The ID of the agent. | 要进行会话聊天的 Bot ID。\n   * @param params.user_id - Optional The ID of the user interacting with the Bot. | 标识当前与 Bot 交互的用户。\n   * @param params.additional_messages - Optional Additional messages for the conversation. | 对话的附加信息。\n   * @param params.custom_variables - Optional Variables defined in the Bot. | Bot 中定义变量。\n   * @param params.auto_save_history - Optional Whether to automatically save the conversation history. | 是否自动保存历史对话记录。\n   * @param params.meta_data - Optional Additional metadata for the message. | 创建消息时的附加消息。\n   * @param params.conversation_id - Optional The ID of the conversation. | 标识对话发生在哪一次会话中。\n   * @param params.extra_params - Optional Extra parameters for the conversation. | 附加参数。\n   * @returns The data of the created chat. | 创建的对话数据。\n   */ async create(params, options) {\n        if (!params.user_id) params.user_id = uuid();\n        const { conversation_id, ...rest } = params;\n        const apiUrl = `/v3/chat${conversation_id ? `?conversation_id=${conversation_id}` : ''}`;\n        const payload = {\n            ...rest,\n            additional_messages: handleAdditionalMessages(params.additional_messages),\n            shortcut_command: params.shortcut_command ? {\n                ...params.shortcut_command,\n                parameters: handleParameters(params.shortcut_command.parameters)\n            } : void 0,\n            stream: false\n        };\n        const result = await this._client.post(apiUrl, payload, false, options);\n        return result.data;\n    }\n    /**\n   * Call the Chat API to send messages to a published Coze agent. | 调用此接口发起一次对话，支持添加上下文\n   * @docs en:https://www.coze.com/docs/developer_guides/chat_v3?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/chat_v3?_lang=zh\n   * @param params - Required The parameters for creating a chat session. | 创建会话的参数。\n   * @param params.bot_id - Required The ID of the agent. | 要进行会话聊天的 Bot ID。\n   * @param params.user_id - Optional The ID of the user interacting with the Bot. | 标识当前与 Bot 交互的用户。\n   * @param params.additional_messages - Optional Additional messages for the conversation. | 对话的附加信息。\n   * @param params.custom_variables - Optional Variables defined in the Bot. | Bot 中定义的变量。\n   * @param params.auto_save_history - Optional Whether to automatically save the conversation history. | 是否自动保存历史对话记录。\n   * @param params.meta_data - Optional Additional metadata for the message. | 创建消息时的附加消息。\n   * @param params.conversation_id - Optional The ID of the conversation. | 标识对话发生在哪一次会话中。\n   * @param params.extra_params - Optional Extra parameters for the conversation. | 附加参数。\n   * @returns\n   */ async createAndPoll(params, options) {\n        if (!params.user_id) params.user_id = uuid();\n        const { conversation_id, ...rest } = params;\n        const apiUrl = `/v3/chat${conversation_id ? `?conversation_id=${conversation_id}` : ''}`;\n        const payload = {\n            ...rest,\n            additional_messages: handleAdditionalMessages(params.additional_messages),\n            shortcut_command: params.shortcut_command ? {\n                ...params.shortcut_command,\n                parameters: handleParameters(params.shortcut_command.parameters)\n            } : void 0,\n            stream: false\n        };\n        const result = await this._client.post(apiUrl, payload, false, options);\n        const chatId = result.data.id;\n        const conversationId = result.data.conversation_id;\n        let chat;\n        while(true){\n            await sleep(100);\n            chat = await this.retrieve(conversationId, chatId);\n            if ('completed' === chat.status || 'failed' === chat.status || 'requires_action' === chat.status) break;\n        }\n        const messageList = await this.messages.list(conversationId, chatId);\n        return {\n            chat,\n            messages: messageList\n        };\n    }\n    /**\n   * Call the Chat API to send messages to a published Coze agent with streaming response. | 调用此接口发起一次对话，支持流式响应。\n   * @docs en:https://www.coze.com/docs/developer_guides/chat_v3?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/chat_v3?_lang=zh\n   * @param params - Required The parameters for streaming a chat session. | 流式会话的参数。\n   * @param params.bot_id - Required The ID of the agent. | 要进行会话聊天的 Bot ID。\n   * @param params.user_id - Optional The ID of the user interacting with the Bot. | 标识当前与 Bot 交互的用户。\n   * @param params.additional_messages - Optional Additional messages for the conversation. | 对话的附加信息。\n   * @param params.custom_variables - Optional Variables defined in the Bot. | Bot 中定义的变量。\n   * @param params.auto_save_history - Optional Whether to automatically save the conversation history. | 是否自动保存历史对话记录。\n   * @param params.meta_data - Optional Additional metadata for the message. | 创建消息时的附加消息。\n   * @param params.conversation_id - Optional The ID of the conversation. | 标识对话发生在哪一次会话中。\n   * @param params.extra_params - Optional Extra parameters for the conversation. | 附加参数。\n   * @returns A stream of chat data. | 对话数据流。\n   */ async *stream(params, options) {\n        if (!params.user_id) params.user_id = uuid();\n        const { conversation_id, ...rest } = params;\n        const apiUrl = `/v3/chat${conversation_id ? `?conversation_id=${conversation_id}` : ''}`;\n        const payload = {\n            ...rest,\n            additional_messages: handleAdditionalMessages(params.additional_messages),\n            shortcut_command: params.shortcut_command ? {\n                ...params.shortcut_command,\n                parameters: handleParameters(params.shortcut_command.parameters)\n            } : void 0,\n            stream: true\n        };\n        const result = await this._client.post(apiUrl, payload, true, options);\n        for await (const message of result)if (\"done\" === message.event) {\n            const ret = {\n                event: message.event,\n                data: '[DONE]'\n            };\n            yield ret;\n        } else try {\n            const ret = {\n                event: message.event,\n                data: JSON.parse(message.data)\n            };\n            yield ret;\n        } catch (error) {\n            throw new CozeError(`Could not parse message into JSON:${message.data}`);\n        }\n    }\n    /**\n   * Get the detailed information of the chat. | 查看对话的详细信息。\n   * @docs en:https://www.coze.com/docs/developer_guides/retrieve_chat?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/retrieve_chat?_lang=zh\n   * @param conversation_id - Required The ID of the conversation. | 会话 ID。\n   * @param chat_id - Required The ID of the chat. | 对话 ID。\n   * @returns The data of the retrieved chat. | 检索到的对话数据。\n   */ async retrieve(conversation_id, chat_id, options) {\n        const apiUrl = `/v3/chat/retrieve?conversation_id=${conversation_id}&chat_id=${chat_id}`;\n        const result = await this._client.post(apiUrl, void 0, false, options);\n        return result.data;\n    }\n    /**\n   * Cancel a chat session. | 取消对话会话。\n   * @docs en:https://www.coze.com/docs/developer_guides/cancel_chat?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/cancel_chat?_lang=zh\n   * @param conversation_id - Required The ID of the conversation. | 会话 ID。\n   * @param chat_id - Required The ID of the chat. | 对话 ID。\n   * @returns The data of the canceled chat. | 取消的对话数据。\n   */ async cancel(conversation_id, chat_id, options) {\n        const apiUrl = '/v3/chat/cancel';\n        const payload = {\n            conversation_id,\n            chat_id\n        };\n        const result = await this._client.post(apiUrl, payload, false, options);\n        return result.data;\n    }\n    /**\n   * Submit tool outputs for a chat session. | 提交对话会话的工具输出。\n   * @docs en:https://www.coze.com/docs/developer_guides/chat_submit_tool_outputs?_lang=en\n   * @docs zh:https://www.coze.cn/docs/developer_guides/chat_submit_tool_outputs?_lang=zh\n   * @param params - Required Parameters for submitting tool outputs. | 提交工具输出的参数。\n   * @param params.conversation_id - Required The ID of the conversation. | 会话 ID。\n   * @param params.chat_id - Required The ID of the chat. | 对话 ID。\n   * @param params.tool_outputs - Required The outputs of the tool. | 工具的输出。\n   * @param params.stream - Optional Whether to use streaming response. | 是否使用流式响应。\n   * @returns The data of the submitted tool outputs or a stream of chat data. | 提交的工具输出数据或对话数据流。\n   */ async *submitToolOutputs(params, options) {\n        const { conversation_id, chat_id, ...rest } = params;\n        const apiUrl = `/v3/chat/submit_tool_outputs?conversation_id=${params.conversation_id}&chat_id=${params.chat_id}`;\n        const payload = {\n            ...rest\n        };\n        if (false === params.stream) {\n            const response = await this._client.post(apiUrl, payload, false, options);\n            return response.data;\n        }\n        {\n            const result = await this._client.post(apiUrl, payload, true, options);\n            for await (const message of result)if (\"done\" === message.event) {\n                const ret = {\n                    event: message.event,\n                    data: '[DONE]'\n                };\n                yield ret;\n            } else try {\n                const ret = {\n                    event: message.event,\n                    data: JSON.parse(message.data)\n                };\n                yield ret;\n            } catch (error) {\n                throw new CozeError(`Could not parse message into JSON:${message.data}`);\n            }\n        }\n    }\n    constructor(...args){\n        super(...args), this.messages = new Messages(this._client);\n    }\n}\nvar chat_ChatStatus = /*#__PURE__*/ function(ChatStatus) {\n    ChatStatus[\"CREATED\"] = \"created\";\n    ChatStatus[\"IN_PROGRESS\"] = \"in_progress\";\n    ChatStatus[\"COMPLETED\"] = \"completed\";\n    ChatStatus[\"FAILED\"] = \"failed\";\n    ChatStatus[\"REQUIRES_ACTION\"] = \"requires_action\";\n    ChatStatus[\"CANCELED\"] = \"canceled\";\n    return ChatStatus;\n}({});\nvar chat_ChatEventType = /*#__PURE__*/ function(ChatEventType) {\n    ChatEventType[\"CONVERSATION_CHAT_CREATED\"] = \"conversation.chat.created\";\n    ChatEventType[\"CONVERSATION_CHAT_IN_PROGRESS\"] = \"conversation.chat.in_progress\";\n    ChatEventType[\"CONVERSATION_CHAT_COMPLETED\"] = \"conversation.chat.completed\";\n    ChatEventType[\"CONVERSATION_CHAT_FAILED\"] = \"conversation.chat.failed\";\n    ChatEventType[\"CONVERSATION_CHAT_REQUIRES_ACTION\"] = \"conversation.chat.requires_action\";\n    ChatEventType[\"CONVERSATION_MESSAGE_DELTA\"] = \"conversation.message.delta\";\n    ChatEventType[\"CONVERSATION_MESSAGE_COMPLETED\"] = \"conversation.message.completed\";\n    ChatEventType[\"CONVERSATION_AUDIO_DELTA\"] = \"conversation.audio.delta\";\n    ChatEventType[\"DONE\"] = \"done\";\n    ChatEventType[\"ERROR\"] = \"error\";\n    return ChatEventType;\n}({});\nvar chat_RoleType = /*#__PURE__*/ function(RoleType) {\n    RoleType[\"User\"] = \"user\";\n    RoleType[\"Assistant\"] = \"assistant\";\n    return RoleType;\n}({});\nclass messages_Messages extends APIResource {\n    /**\n   * Create a message and add it to the specified conversation. | 创建一条消息，并将其添加到指定的会话中。\n   * @docs en: https://www.coze.com/docs/developer_guides/create_message?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/create_message?_lang=zh\n   * @param conversation_id - Required The ID of the conversation. | Conversation ID，即会话的唯一标识。\n   * @param params - Required The parameters for creating a message | 创建消息所需的参数\n   * @param params.role - Required The entity that sent this message. Possible values: user, assistant. | 发送这条消息的实体。取值：user, assistant。\n   * @param params.content - Required The content of the message. | 消息的内容。\n   * @param params.content_type - Required The type of the message content. | 消息内容的类型。\n   * @param params.meta_data - Optional Additional information when creating a message. | 创建消息时的附加消息。\n   * @returns Information about the new message. | 消息详情。\n   */ async create(conversation_id, params, options) {\n        const apiUrl = `/v1/conversation/message/create?conversation_id=${conversation_id}`;\n        const response = await this._client.post(apiUrl, params, false, options);\n        return response.data;\n    }\n    /**\n   * Modify a message, supporting the modification of message content, additional content, and message type. | 修改一条消息，支持修改消息内容、附加内容和消息类型。\n   * @docs en: https://www.coze.com/docs/developer_guides/modify_message?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/modify_message?_lang=zh\n   * @param conversation_id - Required The ID of the conversation. | Conversation ID，即会话的唯一标识。\n   * @param message_id - Required The ID of the message. | Message ID，即消息的唯一标识。\n   * @param params - Required The parameters for modifying a message | 修改消息所需的参数\n   * @param params.meta_data - Optional Additional information when modifying a message. | 修改消息时的附加消息。\n   * @param params.content - Optional The content of the message. | 消息的内容。\n   * @param params.content_type - Optional The type of the message content. | 消息内容的类型。\n   * @returns Information about the modified message. | 消息详情。\n   */ // eslint-disable-next-line max-params\n    async update(conversation_id, message_id, params, options) {\n        const apiUrl = `/v1/conversation/message/modify?conversation_id=${conversation_id}&message_id=${message_id}`;\n        const response = await this._client.post(apiUrl, params, false, options);\n        return response.message;\n    }\n    /**\n   * Get the detailed information of specified message. | 查看指定消息的详细信息。\n   * @docs en: https://www.coze.com/docs/developer_guides/retrieve_message?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/retrieve_message?_lang=zh\n   * @param conversation_id - Required The ID of the conversation. | Conversation ID，即会话的唯一标识。\n   * @param message_id - Required The ID of the message. | Message ID，即消息的唯一标识。\n   * @returns Information about the message. | 消息详情。\n   */ async retrieve(conversation_id, message_id, options) {\n        const apiUrl = `/v1/conversation/message/retrieve?conversation_id=${conversation_id}&message_id=${message_id}`;\n        const response = await this._client.get(apiUrl, null, false, options);\n        return response.data;\n    }\n    /**\n   * List messages in a conversation. | 列出会话中的消息。\n   * @docs en: https://www.coze.com/docs/developer_guides/message_list?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/message_list?_lang=zh\n   * @param conversation_id - Required The ID of the conversation. | Conversation ID，即会话的唯一标识。\n   * @param params - Optional The parameters for listing messages | 列出消息所需的参数\n   * @param params.order - Optional The order of the messages. | 消息的顺序。\n   * @param params.chat_id - Optional The ID of the chat. | 聊天 ID。\n   * @param params.before_id - Optional The ID of the message before which to list. | 列出此消息之前的消息 ID。\n   * @param params.after_id - Optional The ID of the message after which to list. | 列出此消息之后的消息 ID。\n   * @param params.limit - Optional The maximum number of messages to return. | 返回的最大消息数。\n   * @returns A list of messages. | 消息列表。\n   */ async list(conversation_id, params, options) {\n        const apiUrl = `/v1/conversation/message/list?conversation_id=${conversation_id}`;\n        const response = await this._client.post(apiUrl, params, false, options);\n        return response;\n    }\n    /**\n   * Call the API to delete a message within a specified conversation. | 调用接口在指定会话中删除消息。\n   * @docs en: https://www.coze.com/docs/developer_guides/delete_message?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/delete_message?_lang=zh\n   * @param conversation_id - Required The ID of the conversation. | Conversation ID，即会话的唯一标识。\n   * @param message_id - Required The ID of the message. | Message ID，即消息的唯一标识。\n   * @returns Details of the deleted message. | 已删除的消息详情。\n   */ async delete(conversation_id, message_id, options) {\n        const apiUrl = `/v1/conversation/message/delete?conversation_id=${conversation_id}&message_id=${message_id}`;\n        const response = await this._client.post(apiUrl, void 0, false, options);\n        return response.data;\n    }\n}\nclass Conversations extends APIResource {\n    /**\n   * Create a conversation. Conversation is an interaction between an agent and a user, including one or more messages. | 调用接口创建一个会话。\n   * @docs en: https://www.coze.com/docs/developer_guides/create_conversation?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/create_conversation?_lang=zh\n   * @param params - Required The parameters for creating a conversation | 创建会话所需的参数\n   * @param params.messages - Optional Messages in the conversation. | 会话中的消息内容。\n   * @param params.meta_data - Optional Additional information when creating a message. | 创建消息时的附加消息。\n   * @param params.bot_id - Optional Bind and isolate conversation on different bots. | 绑定和隔离不同Bot的会话。\n   * @returns Information about the created conversation. | 会话的基础信息。\n   */ async create(params, options) {\n        const apiUrl = '/v1/conversation/create';\n        const response = await this._client.post(apiUrl, params, false, options);\n        return response.data;\n    }\n    /**\n   * Get the information of specific conversation. | 通过会话 ID 查看会话信息。\n   * @docs en: https://www.coze.com/docs/developer_guides/retrieve_conversation?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/retrieve_conversation?_lang=zh\n   * @param conversation_id - Required The ID of the conversation. | Conversation ID，即会话的唯一标识。\n   * @returns Information about the conversation. | 会话的基础信息。\n   */ async retrieve(conversation_id, options) {\n        const apiUrl = `/v1/conversation/retrieve?conversation_id=${conversation_id}`;\n        const response = await this._client.get(apiUrl, null, false, options);\n        return response.data;\n    }\n    /**\n   * List all conversations. | 列出 Bot 下所有会话。\n   * @param params\n   * @param params.bot_id - Required Bot ID. | Bot ID。\n   * @param params.page_num - Optional The page number. | 页码，默认值为 1。\n   * @param params.page_size - Optional The number of conversations per page. | 每页的会话数量，默认值为 50。\n   * @returns Information about the conversations. | 会话的信息。\n   */ async list(params, options) {\n        const apiUrl = '/v1/conversations';\n        const response = await this._client.get(apiUrl, params, false, options);\n        return response.data;\n    }\n    /**\n   * Clear a conversation. | 清空会话。\n   * @param conversation_id - Required The ID of the conversation. | Conversation ID，即会话的唯一标识。\n   * @returns Information about the conversation session. | 会话的会话 ID。\n   */ async clear(conversation_id, options) {\n        const apiUrl = `/v1/conversations/${conversation_id}/clear`;\n        const response = await this._client.post(apiUrl, null, false, options);\n        return response.data;\n    }\n    constructor(...args){\n        super(...args), this.messages = new messages_Messages(this._client);\n    }\n}\nconst external_axios_namespaceObject = require(\"axios\");\nvar external_axios_default = /*#__PURE__*/ __webpack_require__.n(external_axios_namespaceObject);\nclass Files extends APIResource {\n    /**\n   * Upload files to Coze platform. | 调用接口上传文件到扣子。\n   * @docs en: https://www.coze.com/docs/developer_guides/upload_files?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/upload_files?_lang=zh\n   * @param params - Required The parameters for file upload | 上传文件所需的参数\n   * @param params.file - Required The file to be uploaded. | 需要上传的文件。\n   * @returns Information about the new file. | 已上传的文件信息。\n   */ async upload(params, options) {\n        const apiUrl = '/v1/files/upload';\n        const response = await this._client.post(apiUrl, (0, external_axios_namespaceObject.toFormData)(params), false, options);\n        return response.data;\n    }\n    /**\n   * Get the information of the specific file uploaded to Coze platform. | 查看已上传的文件详情。\n   * @docs en: https://www.coze.com/docs/developer_guides/retrieve_files?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/retrieve_files?_lang=zh\n   * @param file_id - Required The ID of the uploaded file. | 已上传的文件 ID。\n   * @returns Information about the uploaded file. | 已上传的文件信息。\n   */ async retrieve(file_id, options) {\n        const apiUrl = `/v1/files/retrieve?file_id=${file_id}`;\n        const response = await this._client.get(apiUrl, null, false, options);\n        return response.data;\n    }\n}\nclass Runs extends APIResource {\n    /**\n   * Initiates a workflow run. | 启动工作流运行。\n   * @docs en: https://www.coze.com/docs/developer_guides/workflow_run?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/workflow_run?_lang=zh\n   * @param params.workflow_id - Required The ID of the workflow to run. | 必选 要运行的工作流 ID。\n   * @param params.bot_id - Optional The ID of the bot associated with the workflow. | 可选 与工作流关联的机器人 ID。\n   * @param params.parameters - Optional Parameters for the workflow execution. | 可选 工作流执行的参数。\n   * @param params.ext - Optional Additional information for the workflow execution. | 可选 工作流执行的附加信息。\n   * @param params.execute_mode - Optional The mode in which to execute the workflow. | 可选 工作流执行的模式。\n   * @param params.connector_id - Optional The ID of the connector to use for the workflow. | 可选 用于工作流的连接器 ID。\n   * @param params.app_id - Optional The ID of the app.  | 可选 要进行会话聊天的 App ID\n   * @returns RunWorkflowData | 工作流运行数据\n   */ async create(params, options) {\n        const apiUrl = '/v1/workflow/run';\n        const response = await this._client.post(apiUrl, params, false, options);\n        return response;\n    }\n    /**\n   * Streams the workflow run events. | 流式传输工作流运行事件。\n   * @docs en: https://www.coze.com/docs/developer_guides/workflow_stream_run?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/workflow_stream_run?_lang=zh\n   * @param params.workflow_id - Required The ID of the workflow to run. | 必选 要运行的工作流 ID。\n   * @param params.bot_id - Optional The ID of the bot associated with the workflow. | 可选 与工作流关联的机器人 ID。\n   * @param params.parameters - Optional Parameters for the workflow execution. | 可选 工作流执行的参数。\n   * @param params.ext - Optional Additional information for the workflow execution. | 可选 工作流执行的附加信息。\n   * @param params.execute_mode - Optional The mode in which to execute the workflow. | 可选 工作流执行的模式。\n   * @param params.connector_id - Optional The ID of the connector to use for the workflow. | 可选 用于工作流的连接器 ID。\n   * @param params.app_id - Optional The ID of the app.  | 可选 要进行会话聊天的 App ID\n   * @returns Stream<WorkflowEvent, { id: string; event: string; data: string }> | 工作流事件流\n   */ async *stream(params, options) {\n        const apiUrl = '/v1/workflow/stream_run';\n        const result = await this._client.post(apiUrl, params, true, options);\n        for await (const message of result)try {\n            if (\"Done\" === message.event) yield new WorkflowEvent(Number(message.id), \"Done\");\n            else yield new WorkflowEvent(Number(message.id), message.event, JSON.parse(message.data));\n        } catch (error) {\n            throw new CozeError(`Could not parse message into JSON:${message.data}`);\n        }\n    }\n    /**\n   * Resumes a paused workflow run. | 恢复暂停的工作流运行。\n   * @docs en: https://www.coze.com/docs/developer_guides/workflow_resume?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/workflow_resume?_lang=zh\n   * @param params.workflow_id - Required The ID of the workflow to resume. | 必选 要恢复的工作流 ID。\n   * @param params.event_id - Required The ID of the event to resume from. | 必选 要从中恢复的事件 ID。\n   * @param params.resume_data - Required Data needed to resume the workflow. | 必选 恢复工作流所需的数据。\n   * @param params.interrupt_type - Required The type of interruption to resume from. | 必选 要恢复的中断类型。\n   * @returns { id: string; event: WorkflowEventType; data: WorkflowEventMessage | WorkflowEventInterrupt | WorkflowEventError | null } | 恢复的工作流事件数据\n   */ async resume(params, options) {\n        const apiUrl = '/v1/workflow/stream_resume';\n        const response = await this._client.post(apiUrl, params, false, options);\n        return response;\n    }\n    /**\n   * Get the workflow run history | 工作流异步运行后，查看执行结果\n   * @docs zh: https://www.coze.cn/open/docs/developer_guides/workflow_history\n   * @param workflowId - Required The ID of the workflow. | 必选 工作流 ID。\n   * @param executeId - Required The ID of the workflow execution. | 必选 工作流执行 ID。\n   * @returns WorkflowExecuteHistory[] | 工作流执行历史\n   */ async history(workflowId, executeId, options) {\n        const apiUrl = `/v1/workflows/${workflowId}/run_histories/${executeId}`;\n        const response = await this._client.get(apiUrl, void 0, false, options);\n        return response.data;\n    }\n}\nvar runs_WorkflowEventType = /*#__PURE__*/ function(WorkflowEventType) {\n    // The output message from the workflow node, such as the output message from\n    // the message node or end node. You can view the specific message content in data.\n    WorkflowEventType[\"MESSAGE\"] = \"Message\";\n    // An error has occurred. You can view the error_code and error_message in data to\n    // troubleshoot the issue.\n    // 报错。可以在 data 中查看 error_code 和 error_message，排查问题。\n    WorkflowEventType[\"ERROR\"] = \"Error\";\n    // End. Indicates the end of the workflow execution, where data is empty.\n    // 结束。表示工作流执行结束，此时 data 为空。\n    WorkflowEventType[\"DONE\"] = \"Done\";\n    // Interruption. Indicates the workflow has been interrupted, where the data field\n    // contains specific interruption information.\n    // 中断。表示工作流中断，此时 data 字段中包含具体的中断信息。\n    WorkflowEventType[\"INTERRUPT\"] = \"Interrupt\";\n    return WorkflowEventType;\n}({});\nclass WorkflowEvent {\n    constructor(id, event, data){\n        this.id = id;\n        this.event = event;\n        this.data = data;\n    }\n}\nclass WorkflowChat extends APIResource {\n    /**\n   * Execute a chat workflow. | 执行对话流\n   * @docs en: https://www.coze.cn/docs/developer_guides/workflow_chat?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/workflow_chat?_lang=zh\n   * @param params.workflow_id - Required The ID of the workflow to chat with. | 必选 要对话的工作流 ID。\n   * @param params.additional_messages - Required Array of messages for the chat. | 必选 对话的消息数组。\n   * @param params.parameters - Optional  Parameters for the workflow execution. | 必选 工作流执行的参数。\n   * @param params.app_id - Optional The ID of the app. | 可选 应用 ID。\n   * @param params.bot_id - Optional The ID of the bot. | 可选 Bot ID。\n   * @param params.conversation_id - Optional The ID of the conversation. | 可选 会话 ID。\n   * @param params.ext - Optional Additional information for the chat. | 可选 对话的附加信息。\n   * @returns AsyncGenerator<StreamChatData> | 对话数据流\n   */ async *stream(params, options) {\n        const apiUrl = '/v1/workflows/chat';\n        const payload = {\n            ...params,\n            additional_messages: handleAdditionalMessages(params.additional_messages)\n        };\n        const result = await this._client.post(apiUrl, payload, true, options);\n        for await (const message of result)if (message.event === chat_ChatEventType.DONE) {\n            const ret = {\n                event: message.event,\n                data: '[DONE]'\n            };\n            yield ret;\n        } else try {\n            const ret = {\n                event: message.event,\n                data: JSON.parse(message.data)\n            };\n            yield ret;\n        } catch (error) {\n            throw new CozeError(`Could not parse message into JSON:${message.data}`);\n        }\n    }\n}\nclass Workflows extends APIResource {\n    constructor(...args){\n        super(...args), this.runs = new Runs(this._client), this.chat = new WorkflowChat(this._client);\n    }\n}\nclass WorkSpaces extends APIResource {\n    /**\n   * View the list of workspaces that the current Coze user has joined. | 查看当前扣子用户加入的空间列表。\n   * @docs en: https://www.coze.com/docs/developer_guides/list_workspace?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/list_workspace?_lang=zh\n   * @param params.page_num - Optional The page number for paginated queries. Default is 1.\n   * | 可选 分页查询时的页码。默认为 1，即从第一页数据开始返回。\n   * @param params.page_size - Optional The size of pagination. Default is 10. Maximum is 50. | 可选 分页大小。默认为 10，最大为 50。\n   * @returns OpenSpaceData | 工作空间列表\n   */ async list(params, options) {\n        const apiUrl = '/v1/workspaces';\n        const response = await this._client.get(apiUrl, params, false, options);\n        return safeJsonParse(response, response).data;\n    }\n}\n// Required header for knowledge APIs\nconst documents_headers = {\n    'agw-js-conv': 'str'\n};\nclass Documents extends APIResource {\n    /**\n   * @deprecated  The method is deprecated and will be removed in a future version. Please use 'client.datasets.documents.list' instead.\n   *\n   * View the file list of a specified knowledge base, which includes lists of documents, spreadsheets, or images.\n   * | 调用接口查看指定知识库的内容列表，即文件、表格或图像列表。\n   * @docs en: https://www.coze.com/docs/developer_guides/list_knowledge_files?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/list_knowledge_files?_lang=zh\n   * @param params.dataset_id - Required The ID of the knowledge base. | 必选 待查看文件的知识库 ID。\n   * @param params.page - Optional The page number for paginated queries. Default is 1. | 可选 分页查询时的页码。默认为 1。\n   * @param params.page_size - Optional The size of pagination. Default is 10. | 可选 分页大小。默认为 10。\n   * @returns ListDocumentData | 知识库文件列表\n   */ list(params, options) {\n        const apiUrl = '/open_api/knowledge/document/list';\n        const response = this._client.get(apiUrl, params, false, mergeConfig(options, {\n            headers: documents_headers\n        }));\n        return response;\n    }\n    /**\n   * @deprecated  The method is deprecated and will be removed in a future version. Please use 'client.datasets.documents.create' instead.\n   *\n   * Upload files to the specific knowledge. | 调用此接口向指定知识库中上传文件。\n   * @docs en: https://www.coze.com/docs/developer_guides/create_knowledge_files?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/create_knowledge_files?_lang=zh\n   * @param params.dataset_id - Required The ID of the knowledge. | 必选 知识库 ID。\n   * @param params.document_bases - Required The metadata information of the files awaiting upload. | 必选 待上传文件的元数据信息。\n   * @param params.chunk_strategy - Required when uploading files to a new knowledge for the first time. Chunk strategy.\n   * | 向新知识库首次上传文件时必选 分段规则。\n   * @returns DocumentInfo[] | 已上传文件的基本信息\n   */ async create(params, options) {\n        const apiUrl = '/open_api/knowledge/document/create';\n        const response = await this._client.post(apiUrl, params, false, mergeConfig(options, {\n            headers: documents_headers\n        }));\n        return response.document_infos;\n    }\n    /**\n   * @deprecated  The method is deprecated and will be removed in a future version. Please use 'client.datasets.documents.delete' instead.\n   *\n   * Delete text, images, sheets, and other files in the knowledge base, supporting batch deletion.\n   * | 删除知识库中的文本、图像、表格等文件，支持批量删除。\n   * @docs en: https://www.coze.com/docs/developer_guides/delete_knowledge_files?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/delete_knowledge_files?_lang=zh\n   * @param params.document_ids - Required The list of knowledge base files to be deleted. | 必选 待删除的文件 ID。\n   * @returns void | 无返回\n   */ async delete(params, options) {\n        const apiUrl = '/open_api/knowledge/document/delete';\n        await this._client.post(apiUrl, params, false, mergeConfig(options, {\n            headers: documents_headers\n        }));\n    }\n    /**\n   * @deprecated  The method is deprecated and will be removed in a future version. Please use 'client.datasets.documents.update' instead.\n   *\n   * Modify the knowledge base file name and update strategy. | 调用接口修改知识库文件名称和更新策略。\n   * @docs en: https://www.coze.com/docs/developer_guides/modify_knowledge_files?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/modify_knowledge_files?_lang=zh\n   * @param params.document_id - Required The ID of the knowledge base file. | 必选 待修改的知识库文件 ID。\n   * @param params.document_name - Optional The new name of the knowledge base file. | 可选 知识库文件的新名称。\n   * @param params.update_rule - Optional The update strategy for online web pages. | 可选 在线网页更新策略。\n   * @returns void | 无返回\n   */ async update(params, options) {\n        const apiUrl = '/open_api/knowledge/document/update';\n        await this._client.post(apiUrl, params, false, mergeConfig(options, {\n            headers: documents_headers\n        }));\n    }\n}\nclass Knowledge extends APIResource {\n    constructor(...args){\n        super(...args), /**\n   * @deprecated\n   */ this.documents = new Documents(this._client);\n    }\n}\n// Required header for knowledge APIs\nconst documents_documents_headers = {\n    'agw-js-conv': 'str'\n};\nclass documents_Documents extends APIResource {\n    /**\n   * View the file list of a specified knowledge base, which includes lists of documents, spreadsheets, or images.\n   * | 调用接口查看指定知识库的内容列表，即文件、表格或图像列表。\n   * @docs en: https://www.coze.com/docs/developer_guides/list_knowledge_files?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/list_knowledge_files?_lang=zh\n   * @param params.dataset_id - Required The ID of the knowledge base. | 必选 待查看文件的知识库 ID。\n   * @param params.page - Optional The page number for paginated queries. Default is 1. | 可选 分页查询时的页码。默认为 1。\n   * @param params.page_size - Optional The size of pagination. Default is 10. | 可选 分页大小。默认为 10。\n   * @returns ListDocumentData | 知识库文件列表\n   */ async list(params, options) {\n        const apiUrl = '/open_api/knowledge/document/list';\n        const response = await this._client.post(apiUrl, params, false, mergeConfig(options, {\n            headers: documents_documents_headers\n        }));\n        return response;\n    }\n    /**\n   * Upload files to the specific knowledge. | 调用此接口向指定知识库中上传文件。\n   * @docs en: https://www.coze.com/docs/developer_guides/create_knowledge_files?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/create_knowledge_files?_lang=zh\n   * @param params.dataset_id - Required The ID of the knowledge. | 必选 知识库 ID。\n   * @param params.document_bases - Required The metadata information of the files awaiting upload. | 必选 待上传文件的元数据信息。\n   * @param params.chunk_strategy - Required when uploading files to a new knowledge for the first time. Chunk strategy.\n   * | 向新知识库首次上传文件时必选 分段规则。\n   * @returns DocumentInfo[] | 已上传文件的基本信息\n   */ async create(params, options) {\n        const apiUrl = '/open_api/knowledge/document/create';\n        const response = await this._client.post(apiUrl, params, false, mergeConfig(options, {\n            headers: documents_documents_headers\n        }));\n        return response.document_infos;\n    }\n    /**\n   * Delete text, images, sheets, and other files in the knowledge base, supporting batch deletion.\n   * | 删除知识库中的文本、图像、表格等文件，支持批量删除。\n   * @docs en: https://www.coze.com/docs/developer_guides/delete_knowledge_files?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/delete_knowledge_files?_lang=zh\n   * @param params.document_ids - Required The list of knowledge base files to be deleted. | 必选 待删除的文件 ID。\n   * @returns void | 无返回\n   */ async delete(params, options) {\n        const apiUrl = '/open_api/knowledge/document/delete';\n        await this._client.post(apiUrl, params, false, mergeConfig(options, {\n            headers: documents_documents_headers\n        }));\n    }\n    /**\n   * Modify the knowledge base file name and update strategy. | 调用接口修改知识库文件名称和更新策略。\n   * @docs en: https://www.coze.com/docs/developer_guides/modify_knowledge_files?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/modify_knowledge_files?_lang=zh\n   * @param params.document_id - Required The ID of the knowledge base file. | 必选 待修改的知识库文件 ID。\n   * @param params.document_name - Optional The new name of the knowledge base file. | 可选 知识库文件的新名称。\n   * @param params.update_rule - Optional The update strategy for online web pages. | 可选 在线网页更新策略。\n   * @returns void | 无返回\n   */ async update(params, options) {\n        const apiUrl = '/open_api/knowledge/document/update';\n        await this._client.post(apiUrl, params, false, mergeConfig(options, {\n            headers: documents_documents_headers\n        }));\n    }\n}\nclass Images extends APIResource {\n    /**\n   * Update the description of an image in the knowledge base | 更新知识库中的图片描述\n   * @docs en: https://www.coze.com/docs/developer_guides/developer_guides/update_image_caption?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/developer_guides/update_image_caption?_lang=zh\n   * @param datasetId - The ID of the dataset | 必选 知识库 ID\n   * @param documentId - The ID of the document | 必选 知识库文件 ID\n   * @param params - The parameters for updating the image\n   * @param params.caption - Required. The description of the image | 必选 图片的描述信息\n   * @returns undefined\n   */ // eslint-disable-next-line max-params\n    async update(datasetId, documentId, params, options) {\n        const apiUrl = `/v1/datasets/${datasetId}/images/${documentId}`;\n        await this._client.put(apiUrl, params, false, options);\n    }\n    /**\n   * List images in the knowledge base | 列出知识库中的图片\n   * @docs en: https://www.coze.com/docs/developer_guides/developer_guides/get_images?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/developer_guides/get_images?_lang=zh\n   * @param datasetId - The ID of the dataset | 必选 知识库 ID\n   * @param params - The parameters for listing images\n   * @param params.page_num - Optional. Page number for pagination, minimum value is 1, defaults to 1 | 可选 分页查询时的页码。默认为 1。\n   * @param params.page_size - Optional. Number of items per page, range 1-299, defaults to 10 | 可选 分页大小。默认为 10。\n   * @param params.keyword - Optional. Search keyword for image descriptions | 可选 图片描述的搜索关键词。\n   * @param params.has_caption - Optional. Filter for images with/without captions | 可选 是否过滤有/无描述的图片。\n   */ async list(datasetId, params, options) {\n        const apiUrl = `/v1/datasets/${datasetId}/images`;\n        const response = await this._client.get(apiUrl, params, false, options);\n        return response.data;\n    }\n}\nclass Datasets extends APIResource {\n    /**\n   * Creates a new dataset | 创建数据集\n   * @docs en: https://www.coze.com/docs/developer_guides/create_dataset?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/create_dataset?_lang=zh\n   * @param params - The parameters for creating a dataset\n   * @param {string} params.name - Required. Dataset name, maximum length of 100 characters | 必选 数据集名称，最大长度为 100 个字符\n   * @param {string} params.space_id - Required. Space ID where the dataset belongs | 必选 数据集所属的空间 ID\n   * @param {number} params.format_type - Required. Dataset type (0: Text type, 2: Image type) | 必选 数据集类型 (0: 文本类型, 2: 图片类型)\n   * @param {string} [params.description] - Optional. Dataset description | 可选 数据集描述\n   * @param {string} [params.file_id] - Optional. Dataset icon file ID from file upload\n   */ async create(params, options) {\n        const apiUrl = '/v1/datasets';\n        const response = await this._client.post(apiUrl, params, false, options);\n        return response.data;\n    }\n    /**\n   * Lists all datasets in a space | 列出空间中的所有数据集\n   * @docs en: https://www.coze.com/docs/developer_guides/list_dataset?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/list_dataset?_lang=zh\n   * @param params - The parameters for listing datasets | 列出数据集的参数\n   * @param {string} params.space_id - Required. Space ID where the datasets belong | 必选 数据集所属的空间 ID\n   * @param {string} [params.name] - Optional. Dataset name for fuzzy search | 可选 数据集名称用于模糊搜索\n   * @param {number} [params.format_type] - Optional. Dataset type (0: Text type, 2: Image type) | 可选 数据集类型 (0: 文本类型, 2: 图片类型)\n   * @param {number} [params.page_num] - Optional. Page number for pagination (default: 1) | 可选 分页查询时的页码。默认为 1。\n   * @param {number} [params.page_size] - Optional. Number of items per page (default: 10) | 可选 分页大小。默认为 10。\n   */ async list(params, options) {\n        const apiUrl = '/v1/datasets';\n        const response = await this._client.get(apiUrl, params, false, options);\n        return response.data;\n    }\n    /**\n   * Updates a dataset | 更新数据集\n   * @docs en: https://www.coze.com/docs/developer_guides/update_dataset?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/update_dataset?_lang=zh\n   * @param dataset_id - Required. The ID of the dataset to update | 必选 数据集 ID\n   * @param params - Required. The parameters for updating the dataset | 必选 更新数据集的参数\n   * @param params.name - Required. Dataset name, maximum length of 100 characters. | 必选 数据集名称，最大长度为 100 个字符。\n   * @param params.file_id - Optional. Dataset icon, should pass the file_id obtained from the file upload interface. | 可选 数据集图标，应传递从文件上传接口获取的 file_id。\n   * @param params.description - Optional. Dataset description. | 可选 数据集描述。\n   */ async update(dataset_id, params, options) {\n        const apiUrl = `/v1/datasets/${dataset_id}`;\n        await this._client.put(apiUrl, params, false, options);\n    }\n    /**\n   * Deletes a dataset | 删除数据集\n   * @docs en: https://www.coze.com/docs/developer_guides/delete_dataset?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/delete_dataset?_lang=zh\n   * @param dataset_id - Required. The ID of the dataset to delete | 必选 数据集 ID\n   */ async delete(dataset_id, options) {\n        const apiUrl = `/v1/datasets/${dataset_id}`;\n        await this._client.delete(apiUrl, false, options);\n    }\n    /**\n   * Views the progress of dataset upload | 查看数据集上传进度\n   * @docs en: https://www.coze.com/docs/developer_guides/get_dataset_progress?_lang=en\n   * @docs zh: https://www.coze.cn/docs/developer_guides/get_dataset_progress?_lang=zh\n   * @param dataset_id - Required. The ID of the dataset to process | 必选 数据集 ID\n   * @param params - Required. The parameters for processing the dataset | 必选 处理数据集的参数\n   * @param params.dataset_ids - Required. List of dataset IDs | 必选 数据集 ID 列表\n   */ async process(dataset_id, params, options) {\n        const apiUrl = `/v1/datasets/${dataset_id}/process`;\n        const response = await this._client.post(apiUrl, params, false, options);\n        return response.data;\n    }\n    constructor(...args){\n        super(...args), this.documents = new documents_Documents(this._client), this.images = new Images(this._client);\n    }\n}\nclass Voices extends APIResource {\n    /**\n   * @description Clone a voice | 音色克隆\n   * @param params\n   * @param params.voice_name - Required. Voice name, cannot be empty and must be longer than 6 characters\n   * | 复刻的音色名称，不能为空，长度大于 6\n   * @param params.file - Required. Audio file | 音频文件\n   * @param params.audio_format - Required. Only supports \"wav\", \"mp3\", \"ogg\", \"m4a\", \"aac\", \"pcm\" formats\n   * | 只支持 \"wav\", \"mp3\", \"ogg\", \"m4a\", \"aac\", \"pcm\" 格式\n   * @param params.language - Optional. Only supports \"zh\", \"en\" \"ja\" \"es\" \"id\" \"pt\" languages\n   * | 只支持 \"zh\", \"en\" \"ja\" \"es\" \"id\" \"pt\" 语种\n   * @param params.voice_id - Optional. If provided, will train on existing voice and override previous training\n   * | 传入的话就会在原有的音色上去训练，覆盖前面训练好的音色\n   * @param params.preview_text - Optional. If provided, will generate preview audio based on this text, otherwise uses default text\n   * | 如果传入会基于该文本生成预览音频，否则使用默认的文本\n   * @param params.text - Optional. Users can read this text, service will compare audio with text. Returns error if difference is too large\n   * | 可以让用户按照该文本念诵，服务会对比音频与该文本的差异。若差异过大会返回错误\n   * @param params.space_id - Optional.  The space id of the voice. | 空间ID\n   * @param params.description- Optional. The description of the voice. | 音色描述\n   * @param options - Request options\n   * @returns Clone voice data\n   */ async clone(params, options) {\n        const apiUrl = '/v1/audio/voices/clone';\n        const response = await this._client.post(apiUrl, (0, external_axios_namespaceObject.toFormData)(params), false, options);\n        return response.data;\n    }\n    /**\n   * @description List voices | 获取音色列表\n   * @param params\n   * @param params.filter_system_voice - Optional. Whether to filter system voices, default is false\n   * | 是否过滤系统音色, 默认不过滤\n   * @param params.page_num - Optional. Starts from 1 by default, value must be > 0\n   * | 不传默认从 1 开始，传值需要 > 0\n   * @param params.page_size - Optional. Default is 100, value must be (0, 100]\n   * | 不传默认 100，传值需要 (0, 100]\n   * @param options - Request options\n   * @returns List voices data\n   */ async list(params, options) {\n        const apiUrl = '/v1/audio/voices';\n        const response = await this._client.get(apiUrl, params, false, options);\n        return response.data;\n    }\n}\nclass Transcriptions extends APIResource {\n    /**\n   * ASR voice to text | ASR 语音转文本\n   * @param params - Required The parameters for file upload | 上传文件所需的参数\n   * @param params.file - Required The audio file to be uploaded. | 需要上传的音频文件。\n   */ async create(params, options) {\n        const apiUrl = '/v1/audio/transcriptions';\n        const response = await this._client.post(apiUrl, (0, external_axios_namespaceObject.toFormData)(params), false, options);\n        return response.data;\n    }\n}\nclass Speech extends APIResource {\n    /**\n   * @description Speech synthesis | 语音合成\n   * @param params\n   * @param params.input - Required. Text to generate audio | 要为其生成音频的文本\n   * @param params.voice_id - Required. Voice ID | 生成音频的音色 ID\n   * @param params.response_format - Optional. Audio encoding format,\n   * supports \"wav\", \"pcm\", \"ogg\", \"opus\", \"mp3\", default is \"mp3\"\n   * | 音频编码格式，支持 \"wav\", \"pcm\", \"ogg\", \"opus\", \"mp3\"，默认是 \"mp3\"\n   * @param options - Request options\n   * @returns Speech synthesis data\n   */ async create(params, options) {\n        const apiUrl = '/v1/audio/speech';\n        const response = await this._client.post(apiUrl, {\n            ...params,\n            sample_rate: params.sample_rate || 24000\n        }, false, mergeConfig(options, {\n            responseType: 'arraybuffer'\n        }));\n        return response;\n    }\n}\nclass Rooms extends APIResource {\n    async create(params, options) {\n        const apiUrl = '/v1/audio/rooms';\n        const response = await this._client.post(apiUrl, params, false, options);\n        return response.data;\n    }\n}\nclass Audio extends APIResource {\n    constructor(...args){\n        super(...args), this.rooms = new Rooms(this._client), this.voices = new Voices(this._client), this.speech = new Speech(this._client), this.transcriptions = new Transcriptions(this._client);\n    }\n}\nclass Templates extends APIResource {\n    /**\n   * Duplicate a template. | 复制一个模板。\n   * @param templateId - Required. The ID of the template to duplicate. | 要复制的模板的 ID。\n   * @param params - Optional. The parameters for the duplicate operation. | 可选参数，用于复制操作。\n   * @param params.workspace_id - Required. The ID of the workspace to duplicate the template into. | 要复制到的目标工作空间的 ID。\n   * @param params.name - Optional. The name of the new template. | 新模板的名称。\n   * @returns TemplateDuplicateRes | 复制模板结果\n   */ async duplicate(templateId, params, options) {\n        const apiUrl = `/v1/templates/${templateId}/duplicate`;\n        const response = await this._client.post(apiUrl, params, false, options);\n        return response.data;\n    }\n}\nvar templates_TemplateEntityType = /*#__PURE__*/ function(TemplateEntityType) {\n    TemplateEntityType[\"AGENT\"] = \"agent\";\n    return TemplateEntityType;\n}({});\nclass chat_Chat extends APIResource {\n    async create(req, options) {\n        const apiUrl = buildWebsocketUrl('/v1/chat', req);\n        return await this._client.makeWebsocket(apiUrl, options);\n    }\n}\nclass transcriptions_Transcriptions extends APIResource {\n    async create(options) {\n        const apiUrl = '/v1/audio/transcriptions';\n        return await this._client.makeWebsocket(apiUrl, options);\n    }\n}\nclass speech_Speech extends APIResource {\n    async create(options) {\n        const apiUrl = '/v1/audio/speech';\n        return await this._client.makeWebsocket(apiUrl, options);\n    }\n}\nclass audio_Audio extends APIResource {\n    constructor(...args){\n        super(...args), this.speech = new speech_Speech(this._client), this.transcriptions = new transcriptions_Transcriptions(this._client);\n    }\n}\n// Common types (not exported)\n// Keep all existing exports but use the base types where applicable\nvar types_WebsocketsEventType = /*#__PURE__*/ function(WebsocketsEventType) {\n    // Common\n    /** SDK error */ WebsocketsEventType[\"CLIENT_ERROR\"] = \"client_error\";\n    /** Connection closed */ WebsocketsEventType[\"CLOSED\"] = \"closed\";\n    /** All events */ WebsocketsEventType[\"ALL\"] = \"all\";\n    // Error\n    /** Received error event */ WebsocketsEventType[\"ERROR\"] = \"error\";\n    // v1/audio/speech\n    /** Send text to server */ WebsocketsEventType[\"INPUT_TEXT_BUFFER_APPEND\"] = \"input_text_buffer.append\";\n    /** No text to send, after audio all received, can close connection */ WebsocketsEventType[\"INPUT_TEXT_BUFFER_COMPLETE\"] = \"input_text_buffer.complete\";\n    /** Send speech config to server */ WebsocketsEventType[\"SPEECH_UPDATE\"] = \"speech.update\";\n    /** Received `speech.updated` event */ WebsocketsEventType[\"SPEECH_UPDATED\"] = \"speech.updated\";\n    /** After speech created */ WebsocketsEventType[\"SPEECH_CREATED\"] = \"speech.created\";\n    /** Received `input_text_buffer.complete` event */ WebsocketsEventType[\"INPUT_TEXT_BUFFER_COMPLETED\"] = \"input_text_buffer.completed\";\n    /** Received `speech.update` event */ WebsocketsEventType[\"SPEECH_AUDIO_UPDATE\"] = \"speech.audio.update\";\n    /** All audio received, can close connection */ WebsocketsEventType[\"SPEECH_AUDIO_COMPLETED\"] = \"speech.audio.completed\";\n    // v1/audio/transcriptions\n    /** Send audio to server */ WebsocketsEventType[\"INPUT_AUDIO_BUFFER_APPEND\"] = \"input_audio_buffer.append\";\n    /** No audio to send, after text all received, can close connection */ WebsocketsEventType[\"INPUT_AUDIO_BUFFER_COMPLETE\"] = \"input_audio_buffer.complete\";\n    /** Send transcriptions config to server */ WebsocketsEventType[\"TRANSCRIPTIONS_UPDATE\"] = \"transcriptions.update\";\n    /** Send `input_audio_buffer.clear` event */ WebsocketsEventType[\"INPUT_AUDIO_BUFFER_CLEAR\"] = \"input_audio_buffer.clear\";\n    /** After transcriptions created */ WebsocketsEventType[\"TRANSCRIPTIONS_CREATED\"] = \"transcriptions.created\";\n    /** Received `input_audio_buffer.complete` event */ WebsocketsEventType[\"INPUT_AUDIO_BUFFER_COMPLETED\"] = \"input_audio_buffer.completed\";\n    /** Received `transcriptions.update` event */ WebsocketsEventType[\"TRANSCRIPTIONS_MESSAGE_UPDATE\"] = \"transcriptions.message.update\";\n    /** All audio received, can close connection */ WebsocketsEventType[\"TRANSCRIPTIONS_MESSAGE_COMPLETED\"] = \"transcriptions.message.completed\";\n    /** Received `input_audio_buffer.cleared` event */ WebsocketsEventType[\"INPUT_AUDIO_BUFFER_CLEARED\"] = \"input_audio_buffer.cleared\";\n    /** Received `transcriptions.updated` event */ WebsocketsEventType[\"TRANSCRIPTIONS_UPDATED\"] = \"transcriptions.updated\";\n    // v1/chat\n    /** Send chat config to server */ WebsocketsEventType[\"CHAT_UPDATE\"] = \"chat.update\";\n    /** Send tool outputs to server */ WebsocketsEventType[\"CONVERSATION_CHAT_SUBMIT_TOOL_OUTPUTS\"] = \"conversation.chat.submit_tool_outputs\";\n    /** After chat created */ WebsocketsEventType[\"CHAT_CREATED\"] = \"chat.created\";\n    /** After chat updated */ WebsocketsEventType[\"CHAT_UPDATED\"] = \"chat.updated\";\n    /** Audio AST completed, chat started */ WebsocketsEventType[\"CONVERSATION_CHAT_CREATED\"] = \"conversation.chat.created\";\n    /** Message created */ WebsocketsEventType[\"CONVERSATION_MESSAGE_CREATE\"] = \"conversation.message.create\";\n    /** Clear conversation */ WebsocketsEventType[\"CONVERSATION_CLEAR\"] = \"conversation.clear\";\n    /** Chat in progress */ WebsocketsEventType[\"CONVERSATION_CHAT_IN_PROGRESS\"] = \"conversation.chat.in_progress\";\n    /** Get agent text message update */ WebsocketsEventType[\"CONVERSATION_MESSAGE_DELTA\"] = \"conversation.message.delta\";\n    /** Need plugin submit */ WebsocketsEventType[\"CONVERSATION_CHAT_REQUIRES_ACTION\"] = \"conversation.chat.requires_action\";\n    /** Message completed */ WebsocketsEventType[\"CONVERSATION_MESSAGE_COMPLETED\"] = \"conversation.message.completed\";\n    /** Get agent audio message update */ WebsocketsEventType[\"CONVERSATION_AUDIO_DELTA\"] = \"conversation.audio.delta\";\n    /** Audio message completed */ WebsocketsEventType[\"CONVERSATION_AUDIO_COMPLETED\"] = \"conversation.audio.completed\";\n    /** All message received, can close connection */ WebsocketsEventType[\"CONVERSATION_CHAT_COMPLETED\"] = \"conversation.chat.completed\";\n    /** Chat failed */ WebsocketsEventType[\"CONVERSATION_CHAT_FAILED\"] = \"conversation.chat.failed\";\n    /** Received `conversation.cleared` event */ WebsocketsEventType[\"CONVERSATION_CLEARED\"] = \"conversation.cleared\";\n    /** Speech started */ WebsocketsEventType[\"INPUT_AUDIO_BUFFER_SPEECH_STARTED\"] = \"input_audio_buffer.speech_started\";\n    /** Speech stopped */ WebsocketsEventType[\"INPUT_AUDIO_BUFFER_SPEECH_STOPPED\"] = \"input_audio_buffer.speech_stopped\";\n    /** Chat interrupted by client */ WebsocketsEventType[\"CONVERSATION_CHAT_CANCEL\"] = \"conversation.chat.cancel\";\n    /** Chat canceled */ WebsocketsEventType[\"CONVERSATION_CHAT_CANCELED\"] = \"conversation.chat.canceled\";\n    /** Audio transcript update */ WebsocketsEventType[\"CONVERSATION_AUDIO_TRANSCRIPT_UPDATE\"] = \"conversation.audio_transcript.update\";\n    /** Audio transcript completed */ WebsocketsEventType[\"CONVERSATION_AUDIO_TRANSCRIPT_COMPLETED\"] = \"conversation.audio_transcript.completed\";\n    /** Audio dump */ WebsocketsEventType[\"DUMP_AUDIO\"] = \"dump.audio\";\n    return WebsocketsEventType;\n}({});\nclass Websockets extends APIResource {\n    constructor(...args){\n        super(...args), this.audio = new audio_Audio(this._client), this.chat = new chat_Chat(this._client);\n    }\n}\nconst external_ws_namespaceObject = require(\"ws\");\nvar external_ws_default = /*#__PURE__*/ __webpack_require__.n(external_ws_namespaceObject);\nconst external_reconnecting_websocket_namespaceObject = require(\"reconnecting-websocket\");\nvar external_reconnecting_websocket_default = /*#__PURE__*/ __webpack_require__.n(external_reconnecting_websocket_namespaceObject);\nclass WebSocketAPI {\n    // Standard WebSocket properties\n    get readyState() {\n        return this.rws.readyState;\n    }\n    // Standard WebSocket methods\n    send(data) {\n        return this.rws.send(JSON.stringify(data));\n    }\n    close(code, reason) {\n        return this.rws.close(code, reason);\n    }\n    reconnect(code, reason) {\n        return this.rws.reconnect(code, reason);\n    }\n    // Event listener methods\n    addEventListener(type, listener) {\n        this.rws.addEventListener(type, listener);\n    }\n    removeEventListener(type, listener) {\n        this.rws.removeEventListener(type, listener);\n    }\n    constructor(url, options = {}){\n        // Event handler methods\n        this.onmessage = null;\n        this.onopen = null;\n        this.onclose = null;\n        this.onerror = null;\n        const separator = url.includes('?') ? '&' : '?';\n        const { authorization } = options.headers || {};\n        this.rws = new (external_reconnecting_websocket_default())(`${url}${separator}authorization=${authorization}`, [], {\n            WebSocket: isBrowser() ? window.WebSocket : class extends external_ws_default() {\n                constructor(url2, protocols){\n                    super(url2, protocols, {\n                        headers: options.headers\n                    });\n                }\n            },\n            ...options\n        });\n        this.rws.addEventListener('message', (event)=>{\n            try {\n                var _this_onmessage, _this;\n                const data = JSON.parse(event.data);\n                null === (_this_onmessage = (_this = this).onmessage) || void 0 === _this_onmessage || _this_onmessage.call(_this, data, event);\n            } catch (error) {\n                console.error('WebSocketAPI onmessage error', error);\n            }\n        });\n        this.rws.addEventListener('open', (event)=>{\n            var _this_onopen, _this;\n            null === (_this_onopen = (_this = this).onopen) || void 0 === _this_onopen || _this_onopen.call(_this, event);\n        });\n        this.rws.addEventListener('close', (event)=>{\n            var _this_onclose, _this;\n            null === (_this_onclose = (_this = this).onclose) || void 0 === _this_onclose || _this_onclose.call(_this, event);\n        });\n        this.rws.addEventListener('error', (event)=>{\n            var _event_target__req_res, _event_target__req, _event_target, _event_target__req_res1, _event_target__req1, _event_target1, _this_onerror, _this;\n            const { readyState } = this.rws;\n            if (3 === readyState) return;\n            const statusCode = null === (_event_target = event.target) || void 0 === _event_target ? void 0 : null === (_event_target__req = _event_target._req) || void 0 === _event_target__req ? void 0 : null === (_event_target__req_res = _event_target__req.res) || void 0 === _event_target__req_res ? void 0 : _event_target__req_res.statusCode;\n            const rawHeaders = (null === (_event_target1 = event.target) || void 0 === _event_target1 ? void 0 : null === (_event_target__req1 = _event_target1._req) || void 0 === _event_target__req1 ? void 0 : null === (_event_target__req_res1 = _event_target__req1.res) || void 0 === _event_target__req_res1 ? void 0 : _event_target__req_res1.rawHeaders) || [];\n            const logidIndex = rawHeaders.findIndex((header)=>'X-Tt-Logid' === header);\n            const logid = -1 !== logidIndex ? rawHeaders[logidIndex + 1] : void 0;\n            const error = {\n                id: '0',\n                event_type: types_WebsocketsEventType.ERROR,\n                data: {\n                    code: -1,\n                    msg: 'WebSocket error'\n                },\n                detail: {\n                    logid\n                }\n            };\n            if (401 === statusCode) {\n                error.data.code = 401;\n                error.data.msg = 'Unauthorized';\n            } else if (403 === statusCode) {\n                error.data.code = 403;\n                error.data.msg = 'Forbidden';\n            } else {\n                error.data.code = 500;\n                var _event_error;\n                error.data.msg = String(null !== (_event_error = null == event ? void 0 : event.error) && void 0 !== _event_error ? _event_error : '') || 'WebSocket error';\n            }\n            null === (_this_onerror = (_this = this).onerror) || void 0 === _this_onerror || _this_onerror.call(_this, error, event);\n        });\n    }\n}\nconst external_os_namespaceObject = require(\"os\");\nvar external_os_default = /*#__PURE__*/ __webpack_require__.n(external_os_namespaceObject);\nvar package_namespaceObject = JSON.parse('{\"name\":\"@coze/api\",\"version\":\"1.2.0\",\"description\":\"Official Coze Node.js SDK for seamless AI integration into your applications | 扣子官方 Node.js SDK，助您轻松集成 AI 能力到应用中\",\"keywords\":[\"coze\",\"ai\",\"nodejs\",\"sdk\",\"chatbot\",\"typescript\"],\"homepage\":\"https://github.com/coze-dev/coze-js/tree/main/packages/coze-js\",\"bugs\":{\"url\":\"https://github.com/coze-dev/coze-js/issues\"},\"repository\":{\"type\":\"git\",\"url\":\"https://github.com/coze-dev/coze-js.git\",\"directory\":\"packages/coze-js\"},\"license\":\"MIT\",\"author\":\"Leeight <leeight@gmail.com>\",\"exports\":{\".\":{\"require\":\"./dist/cjs/index.js\",\"import\":\"./dist/esm/index.mjs\",\"types\":\"./dist/types/index.d.ts\"},\"./ws-tools\":{\"require\":\"./dist/cjs/ws-tools/index.js\",\"import\":\"./dist/esm/ws-tools/index.mjs\",\"types\":\"./dist/types/ws-tools/ws-tools/index.d.ts\"}},\"main\":\"dist/cjs/index.js\",\"unpkg\":\"dist/umd/index.js\",\"module\":\"dist/esm/index.mjs\",\"browser\":{\"crypto\":false,\"os\":false,\"jsonwebtoken\":false,\"node-fetch\":false,\"ws\":false},\"typesVersions\":{\"*\":{\".\":[\"dist/types/index.d.ts\"],\"ws-tools\":[\"dist/types/ws-tools/ws-tools/index.d.ts\"]}},\"files\":[\"dist\",\"LICENSE\",\"README.md\",\"README.zh-CN.md\"],\"scripts\":{\"build\":\"rslib build\",\"format\":\"prettier --write .\",\"lint\":\"eslint ./ --cache --quiet\",\"start\":\"rslib build -w\",\"test\":\"vitest\",\"test:cov\":\"vitest --coverage --run\"},\"dependencies\":{\"agora-extension-ai-denoiser\":\"^1.0.0\",\"agora-rtc-sdk-ng\":\"^4.23.2\",\"agora-rte-extension\":\"^1.2.4\",\"jsonwebtoken\":\"^9.0.2\",\"node-fetch\":\"^2.x\",\"reconnecting-websocket\":\"^4.4.0\",\"uuid\":\"^10.0.0\",\"ws\":\"^8.11.0\"},\"devDependencies\":{\"@coze-infra/eslint-config\":\"workspace:*\",\"@coze-infra/ts-config\":\"workspace:*\",\"@coze-infra/vitest-config\":\"workspace:*\",\"@rslib/core\":\"0.0.18\",\"@swc/core\":\"^1.3.14\",\"@types/jsonwebtoken\":\"^9.0.0\",\"@types/node\":\"^20\",\"@types/node-fetch\":\"^2.x\",\"@types/uuid\":\"^9.0.1\",\"@types/whatwg-fetch\":\"^0.0.33\",\"@types/ws\":\"^8.5.1\",\"@vitest/coverage-v8\":\"~2.1.4\",\"axios\":\"^1.7.7\",\"typescript\":\"^5.5.3\",\"vitest\":\"~2.1.4\"},\"peerDependencies\":{\"axios\":\"^1.7.1\"},\"cozePublishConfig\":{\"exports\":{\".\":{\"require\":\"./dist/cjs/index.js\",\"import\":\"./dist/esm/index.mjs\",\"types\":\"./dist/types/index.d.ts\"},\"./ws-tools\":{\"require\":\"./dist/cjs/ws-tools/index.js\",\"import\":\"./dist/esm/ws-tools/index.mjs\",\"types\":\"./dist/types/ws-tools/ws-tools/index.d.ts\"}},\"main\":\"dist/cjs/index.js\",\"module\":\"dist/esm/index.mjs\",\"types\":\"dist/types/index.d.ts\"},\"types\":\"dist/types/index.d.ts\"}'); // CONCATENATED MODULE: ./src/version.ts\nconst { version: version_version } = package_namespaceObject;\nconst getEnv = ()=>{\n    const nodeVersion = process.version.slice(1); // Remove 'v' prefix\n    const { platform } = process;\n    let osName = platform.toLowerCase();\n    let osVersion = external_os_default().release();\n    if ('darwin' === platform) {\n        osName = 'macos';\n        // Try to parse the macOS version\n        try {\n            const darwinVersion = external_os_default().release().split('.');\n            if (darwinVersion.length >= 2) {\n                const majorVersion = parseInt(darwinVersion[0], 10);\n                if (!isNaN(majorVersion) && majorVersion >= 9) {\n                    const macVersion = majorVersion - 9;\n                    osVersion = `10.${macVersion}.${darwinVersion[1]}`;\n                }\n            }\n        } catch (error) {\n        // Keep the default os.release() value if parsing fails\n        }\n    } else if ('win32' === platform) {\n        osName = 'windows';\n        osVersion = external_os_default().release();\n    } else if ('linux' === platform) {\n        osName = 'linux';\n        osVersion = external_os_default().release();\n    }\n    return {\n        osName,\n        osVersion,\n        nodeVersion\n    };\n};\nconst getUserAgent = ()=>{\n    const { nodeVersion, osName, osVersion } = getEnv();\n    return `coze-js/${version_version} node/${nodeVersion} ${osName}/${osVersion}`.toLowerCase();\n};\nconst getNodeClientUserAgent = ()=>{\n    const { osVersion, nodeVersion, osName } = getEnv();\n    const ua = {\n        version: version_version,\n        lang: 'node',\n        lang_version: nodeVersion,\n        os_name: osName,\n        os_version: osVersion\n    };\n    return JSON.stringify(ua);\n};\nconst getBrowserClientUserAgent = ()=>{\n    const browserInfo = {\n        name: 'unknown',\n        version: 'unknown'\n    };\n    const osInfo = {\n        name: 'unknown',\n        version: 'unknown'\n    };\n    const { userAgent } = navigator;\n    // 检测操作系统及版本\n    if (userAgent.indexOf('Windows') > -1) {\n        var _userAgent_match;\n        osInfo.name = 'windows';\n        const windowsVersion = (null === (_userAgent_match = userAgent.match(/Windows NT ([0-9.]+)/)) || void 0 === _userAgent_match ? void 0 : _userAgent_match[1]) || 'unknown';\n        osInfo.version = windowsVersion;\n    } else if (userAgent.indexOf('Mac OS X') > -1) {\n        var _userAgent_match1;\n        osInfo.name = 'macos';\n        // 将 10_15_7 格式转换为 10.15.7\n        osInfo.version = ((null === (_userAgent_match1 = userAgent.match(/Mac OS X ([0-9_]+)/)) || void 0 === _userAgent_match1 ? void 0 : _userAgent_match1[1]) || 'unknown').replace(/_/g, '.');\n    } else if (userAgent.indexOf('Linux') > -1) {\n        var _userAgent_match2;\n        osInfo.name = 'linux';\n        osInfo.version = (null === (_userAgent_match2 = userAgent.match(/Linux ([0-9.]+)/)) || void 0 === _userAgent_match2 ? void 0 : _userAgent_match2[1]) || 'unknown';\n    }\n    // 检测浏览器及版本\n    if (userAgent.indexOf('Chrome') > -1) {\n        var _userAgent_match3;\n        browserInfo.name = 'chrome';\n        browserInfo.version = (null === (_userAgent_match3 = userAgent.match(/Chrome\\/([0-9.]+)/)) || void 0 === _userAgent_match3 ? void 0 : _userAgent_match3[1]) || 'unknown';\n    } else if (userAgent.indexOf('Firefox') > -1) {\n        var _userAgent_match4;\n        browserInfo.name = 'firefox';\n        browserInfo.version = (null === (_userAgent_match4 = userAgent.match(/Firefox\\/([0-9.]+)/)) || void 0 === _userAgent_match4 ? void 0 : _userAgent_match4[1]) || 'unknown';\n    } else if (userAgent.indexOf('Safari') > -1) {\n        var _userAgent_match5;\n        browserInfo.name = 'safari';\n        browserInfo.version = (null === (_userAgent_match5 = userAgent.match(/Version\\/([0-9.]+)/)) || void 0 === _userAgent_match5 ? void 0 : _userAgent_match5[1]) || 'unknown';\n    }\n    const ua = {\n        version: version_version,\n        browser: browserInfo.name,\n        browser_version: browserInfo.version,\n        os_name: osInfo.name,\n        os_version: osInfo.version\n    };\n    return JSON.stringify(ua);\n};\n// Get UniApp client user agent\nconst getUniAppClientUserAgent = ()=>{\n    // Get system info\n    const systemInfo = uni.getSystemInfoSync();\n    const platformInfo = {\n        name: 'unknown',\n        version: 'unknown'\n    };\n    const osInfo = {\n        name: 'unknown',\n        version: 'unknown'\n    };\n    // Handle operating system info\n    if ('android' === systemInfo.platform) {\n        osInfo.name = 'android';\n        osInfo.version = systemInfo.system || 'unknown';\n    } else if ('ios' === systemInfo.platform) {\n        osInfo.name = 'ios';\n        osInfo.version = systemInfo.system || 'unknown';\n    } else if ('windows' === systemInfo.platform) {\n        osInfo.name = 'windows';\n        osInfo.version = systemInfo.system || 'unknown';\n    } else if ('mac' === systemInfo.platform) {\n        osInfo.name = 'macos';\n        osInfo.version = systemInfo.system || 'unknown';\n    } else {\n        // Other platforms use platform name directly\n        osInfo.name = systemInfo.platform;\n        osInfo.version = systemInfo.system || 'unknown';\n    }\n    // Handle app/platform info\n    if (systemInfo.AppPlatform) {\n        // App environment\n        platformInfo.name = systemInfo.AppPlatform.toLowerCase();\n        platformInfo.version = systemInfo.appVersion || 'unknown';\n    } else if (systemInfo.uniPlatform) {\n        // UniApp recognized platform\n        platformInfo.name = systemInfo.uniPlatform;\n        platformInfo.version = systemInfo.SDKVersion || 'unknown';\n    } else {\n        // Try to determine platform type from environment\n        const { appName, appVersion } = systemInfo;\n        if (appName) {\n            platformInfo.name = appName.toLowerCase();\n            platformInfo.version = appVersion || 'unknown';\n        }\n    }\n    const ua = {\n        version: version_version,\n        framework: 'uniapp',\n        platform: platformInfo.name,\n        platform_version: platformInfo.version,\n        os_name: osInfo.name,\n        os_version: osInfo.version,\n        screen_width: systemInfo.screenWidth,\n        screen_height: systemInfo.screenHeight,\n        device_model: systemInfo.model,\n        device_brand: systemInfo.brand\n    };\n    return JSON.stringify(ua);\n};\nconst external_node_fetch_namespaceObject = require(\"node-fetch\");\nvar external_node_fetch_default = /*#__PURE__*/ __webpack_require__.n(external_node_fetch_namespaceObject);\n/* eslint-disable @typescript-eslint/no-explicit-any */ const handleError = (error)=>{\n    if (!error.isAxiosError && (!error.code || !error.message)) return new CozeError(`Unexpected error: ${error.message}`);\n    if ('ECONNABORTED' === error.code && error.message.includes('timeout') || 'ETIMEDOUT' === error.code) {\n        var _error_response;\n        return new TimeoutError(408, void 0, `Request timed out: ${error.message}`, null === (_error_response = error.response) || void 0 === _error_response ? void 0 : _error_response.headers);\n    }\n    if ('ERR_CANCELED' === error.code) return new APIUserAbortError(error.message);\n    else {\n        var _error_response1, _error_response2, _error_response3;\n        return APIError.generate((null === (_error_response1 = error.response) || void 0 === _error_response1 ? void 0 : _error_response1.status) || 500, null === (_error_response2 = error.response) || void 0 === _error_response2 ? void 0 : _error_response2.data, error.message, null === (_error_response3 = error.response) || void 0 === _error_response3 ? void 0 : _error_response3.headers);\n    }\n};\n// node-fetch is used for streaming requests\nconst adapterFetch = async (options)=>{\n    const response = await external_node_fetch_default()(options.url, {\n        body: options.data,\n        ...options\n    });\n    return {\n        data: response.body,\n        ...response\n    };\n};\nconst isSupportNativeFetch = ()=>{\n    if (isBrowser() || isUniApp()) return true;\n    // native fetch is supported in node 18.0.0 or higher\n    const version = process.version.slice(1);\n    return compareVersions(version, '18.0.0') >= 0;\n};\nasync function fetchAPI(url) {\n    let options = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};\n    const axiosInstance = options.axiosInstance || external_axios_default();\n    // Add version check for streaming requests\n    if (options.isStreaming && isAxiosStatic(axiosInstance)) {\n        const axiosVersion = axiosInstance.VERSION || external_axios_default().VERSION;\n        if (!axiosVersion || compareVersions(axiosVersion, '1.7.1') < 0) throw new CozeError('Streaming requests require axios version 1.7.1 or higher. Please upgrade your axios version.');\n    }\n    const response = await axiosInstance({\n        url,\n        responseType: options.isStreaming ? 'stream' : 'json',\n        adapter: options.isStreaming ? isSupportNativeFetch() ? 'fetch' : adapterFetch : void 0,\n        ...options\n    }).catch((error)=>{\n        throw handleError(error);\n    });\n    return {\n        async *stream () {\n            try {\n                const stream = response.data;\n                const reader = stream[Symbol.asyncIterator] ? stream[Symbol.asyncIterator]() : stream.getReader();\n                const decoder = new TextDecoder();\n                const fieldValues = {};\n                let buffer = '';\n                while(true){\n                    const { done, value } = await (reader.next ? reader.next() : reader.read());\n                    if (done) {\n                        if (buffer) {\n                            // If the stream ends without a newline, it means an error occurred\n                            fieldValues.event = 'error';\n                            fieldValues.data = buffer;\n                            yield fieldValues;\n                        }\n                        break;\n                    }\n                    buffer += decoder.decode(value, {\n                        stream: true\n                    });\n                    const lines = buffer.split('\\n');\n                    for(let i = 0; i < lines.length - 1; i++){\n                        const line = lines[i];\n                        const index = line.indexOf(':');\n                        if (-1 !== index) {\n                            const field = line.substring(0, index).trim();\n                            const content = line.substring(index + 1).trim();\n                            fieldValues[field] = content;\n                            if ('data' === field) yield fieldValues;\n                        }\n                    }\n                    buffer = lines[lines.length - 1]; // Keep the last incomplete line in the buffer\n                }\n            } catch (error) {\n                handleError(error);\n            }\n        },\n        json: ()=>response.data,\n        response\n    };\n}\n// Add version comparison utility\nfunction compareVersions(v1, v2) {\n    const v1Parts = v1.split('.').map(Number);\n    const v2Parts = v2.split('.').map(Number);\n    for(let i = 0; i < 3; i++){\n        const part1 = v1Parts[i] || 0;\n        const part2 = v2Parts[i] || 0;\n        if (part1 > part2) return 1;\n        if (part1 < part2) return -1;\n    }\n    return 0;\n}\nfunction isAxiosStatic(instance) {\n    return !!(null == instance ? void 0 : instance.Axios);\n}\n/**\n * default coze  base URL is api.coze.com\n */ const COZE_COM_BASE_URL = 'https://api.coze.com';\n/**\n * change to api.coze.cn if you use https://coze.cn\n */ const COZE_CN_BASE_URL = 'https://api.coze.cn';\n/**\n * default base websocket URL is wss://ws.coze.com\n */ const COZE_COM_BASE_WS_URL = 'wss://ws.coze.com';\n/**\n * change to wss://ws.coze.cn if you use https://coze.cn\n */ const COZE_CN_BASE_WS_URL = 'wss://ws.coze.cn';\nconst POLL_INTERVAL = 5000;\nconst MAX_POLL_INTERVAL = 30000;\n/* eslint-disable max-params */ class APIClient {\n    async getToken() {\n        if ('function' == typeof this.token) return await this.token();\n        return this.token;\n    }\n    async buildOptions(method, body, options) {\n        const token = await this.getToken();\n        const headers = {\n            authorization: `Bearer ${token}`\n        };\n        if (isUniApp()) headers['X-Coze-Client-User-Agent'] = getUniAppClientUserAgent();\n        else if (isBrowser()) headers['X-Coze-Client-User-Agent'] = getBrowserClientUserAgent();\n        else {\n            headers['User-Agent'] = getUserAgent();\n            headers['X-Coze-Client-User-Agent'] = getNodeClientUserAgent();\n        }\n        const config = mergeConfig(this.axiosOptions, options, {\n            headers\n        }, {\n            headers: this.headers || {}\n        });\n        config.method = method;\n        config.data = body;\n        return config;\n    }\n    async buildWebsocketOptions(options) {\n        const token = await this.getToken();\n        const headers = {\n            authorization: `Bearer ${token}`\n        };\n        if (isBrowser()) headers['X-Coze-Client-User-Agent'] = getBrowserClientUserAgent();\n        else {\n            headers['User-Agent'] = getUserAgent();\n            headers['X-Coze-Client-User-Agent'] = getNodeClientUserAgent();\n        }\n        var _this__config_debug;\n        const config = mergeConfig({\n            debug: null !== (_this__config_debug = this._config.debug) && void 0 !== _this__config_debug && _this__config_debug\n        }, this._config.websocketOptions, options, {\n            headers\n        }, {\n            headers: this.headers || {}\n        });\n        return config;\n    }\n    async makeRequest(apiUrl, method, body, isStream, options) {\n        const fullUrl = `${this.baseURL}${apiUrl}`;\n        const fetchOptions = await this.buildOptions(method, body, options);\n        fetchOptions.isStreaming = isStream;\n        fetchOptions.axiosInstance = this.axiosInstance;\n        this.debugLog(null == options ? void 0 : options.debug, `--- request url: ${fullUrl}`);\n        this.debugLog(null == options ? void 0 : options.debug, '--- request options:', fetchOptions);\n        const { response, stream, json } = await fetchAPI(fullUrl, fetchOptions);\n        this.debugLog(null == options ? void 0 : options.debug, `--- response status: ${response.status}`);\n        this.debugLog(null == options ? void 0 : options.debug, '--- response headers: ', response.headers);\n        var _response_headers;\n        // Taro use `header`\n        const contentType = (null !== (_response_headers = response.headers) && void 0 !== _response_headers ? _response_headers : response.header)['content-type'];\n        if (isStream) {\n            if (contentType && contentType.includes('application/json')) {\n                const result = await json();\n                const { code, msg } = result;\n                if (0 !== code && void 0 !== code) throw APIError.generate(response.status, result, msg, response.headers);\n            }\n            return stream();\n        }\n        if (!(contentType && contentType.includes('application/json'))) return await response.data;\n        {\n            const result = await json();\n            const { code, msg } = result;\n            if (0 !== code && void 0 !== code) throw APIError.generate(response.status, result, msg, response.headers);\n            return result;\n        }\n    }\n    async post(apiUrl, body) {\n        let isStream = arguments.length > 2 && void 0 !== arguments[2] && arguments[2], options = arguments.length > 3 ? arguments[3] : void 0;\n        return this.makeRequest(apiUrl, 'POST', body, isStream, options);\n    }\n    async get(apiUrl, param, isStream, options) {\n        // 拼接参数\n        const queryString = Object.entries(param || {}).map((param)=>{\n            let [key, value] = param;\n            return `${key}=${value}`;\n        }).join('&');\n        return this.makeRequest(queryString ? `${apiUrl}${apiUrl.includes('?') ? '&' : '?'}${queryString}` : apiUrl, 'GET', void 0, isStream, options);\n    }\n    async put(apiUrl, body, isStream, options) {\n        return this.makeRequest(apiUrl, 'PUT', body, isStream, options);\n    }\n    async delete(apiUrl, isStream, options) {\n        return this.makeRequest(apiUrl, 'DELETE', void 0, isStream, options);\n    }\n    async makeWebsocket(apiUrl, options) {\n        const fullUrl = `${this.baseWsURL}${apiUrl}`;\n        const websocketOptions = await this.buildWebsocketOptions(options);\n        this.debugLog(null == options ? void 0 : options.debug, `--- websocket url: ${fullUrl}`);\n        this.debugLog(null == options ? void 0 : options.debug, '--- websocket options:', websocketOptions);\n        const ws = new WebSocketAPI(fullUrl, websocketOptions);\n        return ws;\n    }\n    getConfig() {\n        return this._config;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    debugLog() {\n        let forceDebug = arguments.length > 0 && void 0 !== arguments[0] && arguments[0];\n        for(var _len = arguments.length, msgs = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++)msgs[_key - 1] = arguments[_key];\n        if (this.debug || forceDebug) console.debug(...msgs);\n    }\n    constructor(config){\n        this._config = config;\n        this.baseURL = config.baseURL || COZE_COM_BASE_URL;\n        this.baseWsURL = config.baseWsURL || COZE_CN_BASE_WS_URL;\n        this.token = config.token;\n        this.axiosOptions = config.axiosOptions || {};\n        this.axiosInstance = config.axiosInstance;\n        this.debug = config.debug || false;\n        this.allowPersonalAccessTokenInBrowser = config.allowPersonalAccessTokenInBrowser || false;\n        this.headers = config.headers;\n        if (isBrowser() && 'function' != typeof this.token && isPersonalAccessToken(this.token) && !this.allowPersonalAccessTokenInBrowser) throw new CozeError('Browser environments do not support authentication using Personal Access Token (PAT) by default.\\nas it may expose secret API keys. \\n\\nPlease use OAuth2.0 authentication mechanism. see:\\nhttps://www.coze.com/docs/developer_guides/oauth_apps?_lang=en \\n\\nIf you need to force use, please set the `allowPersonalAccessTokenInBrowser` option to `true`. \\n\\ne.g new CozeAPI({ token, allowPersonalAccessTokenInBrowser: true });\\n\\n');\n    }\n}\nAPIClient.APIError = APIError;\nAPIClient.BadRequestError = BadRequestError;\nAPIClient.AuthenticationError = AuthenticationError;\nAPIClient.PermissionDeniedError = PermissionDeniedError;\nAPIClient.NotFoundError = NotFoundError;\nAPIClient.RateLimitError = RateLimitError;\nAPIClient.InternalServerError = InternalServerError;\nAPIClient.GatewayError = GatewayError;\nAPIClient.TimeoutError = TimeoutError;\nAPIClient.UserAbortError = APIUserAbortError;\nconst external_crypto_namespaceObject = require(\"crypto\");\nconst external_jsonwebtoken_namespaceObject = require(\"jsonwebtoken\");\nvar external_jsonwebtoken_default = /*#__PURE__*/ __webpack_require__.n(external_jsonwebtoken_namespaceObject);\nconst getCrypto = ()=>{\n    if (isUniApp()) return {\n        getRandomValues: uni.getRandomValues,\n        subtle: {\n            // TODO Currently not supporting uniapp, will provide support later if needed\n            digest: ()=>{\n                console.error('digest is not supported in uniapp');\n                throw new Error('digest is not supported in uniapp');\n            }\n        }\n    };\n    if (isBrowser()) return window.crypto;\n    // #ifndef MP\n    return {\n        getRandomValues: (array)=>external_crypto_namespaceObject.randomFillSync(array),\n        subtle: external_crypto_namespaceObject.subtle\n    };\n// #endif\n};\nconst generateRandomString = ()=>{\n    const array = new Uint8Array(32);\n    getCrypto().getRandomValues(array);\n    return Array.from(array, (byte)=>byte.toString(16).padStart(2, '0')).join('');\n};\nconst getWebAuthenticationUrl = (config)=>{\n    var _config_baseURL;\n    const baseUrl = (null !== (_config_baseURL = config.baseURL) && void 0 !== _config_baseURL ? _config_baseURL : COZE_COM_BASE_URL).replace('https://api', 'https://www');\n    var _config_state;\n    const params = new URLSearchParams({\n        response_type: 'code',\n        client_id: config.clientId,\n        redirect_uri: config.redirectUrl,\n        state: null !== (_config_state = config.state) && void 0 !== _config_state ? _config_state : ''\n    });\n    if (config.workspaceId) return `${baseUrl}/api/permission/oauth2/workspace_id/${config.workspaceId}/authorize?${params.toString()}`;\n    return `${baseUrl}/api/permission/oauth2/authorize?${params.toString()}`;\n};\nconst getPKCEAuthenticationUrl = async (config)=>{\n    var _config_baseURL;\n    const baseUrl = (null !== (_config_baseURL = config.baseURL) && void 0 !== _config_baseURL ? _config_baseURL : COZE_COM_BASE_URL).replace('https://api', 'https://www');\n    const crypto = getCrypto();\n    // Generate code_challenge from code_verifier\n    const generateCodeChallenge = async (codeVerifier)=>{\n        const encoder = new TextEncoder();\n        const data = encoder.encode(codeVerifier);\n        const hash = await crypto.subtle.digest('SHA-256', data);\n        return btoa(String.fromCharCode(...new Uint8Array(hash))).replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n    };\n    // Generate a random code_verifier\n    const codeVerifier = generateRandomString();\n    const codeChallenge = await generateCodeChallenge(codeVerifier);\n    var _config_state;\n    const params = new URLSearchParams({\n        response_type: 'code',\n        client_id: config.clientId,\n        redirect_uri: config.redirectUrl,\n        state: null !== (_config_state = config.state) && void 0 !== _config_state ? _config_state : '',\n        code_challenge: codeChallenge,\n        code_challenge_method: config.code_challenge_method || 'S256'\n    });\n    if (config.workspaceId) return {\n        url: `${baseUrl}/api/permission/oauth2/workspace_id/${config.workspaceId}/authorize?${params.toString()}`,\n        codeVerifier\n    };\n    return {\n        url: `${baseUrl}/api/permission/oauth2/authorize?${params.toString()}`,\n        codeVerifier\n    };\n};\nconst getWebOAuthToken = async (config, options)=>{\n    const api = new APIClient({\n        token: config.clientSecret,\n        baseURL: config.baseURL\n    });\n    const apiUrl = '/api/permission/oauth2/token';\n    const payload = {\n        grant_type: 'authorization_code',\n        client_id: config.clientId,\n        redirect_uri: config.redirectUrl,\n        code: config.code\n    };\n    const result = await api.post(apiUrl, payload, false, options);\n    return result;\n};\nconst getPKCEOAuthToken = async (config, options)=>{\n    const api = new APIClient({\n        token: '',\n        baseURL: config.baseURL\n    });\n    const apiUrl = '/api/permission/oauth2/token';\n    const payload = {\n        grant_type: 'authorization_code',\n        client_id: config.clientId,\n        redirect_uri: config.redirectUrl,\n        code: config.code,\n        code_verifier: config.codeVerifier\n    };\n    const result = await api.post(apiUrl, payload, false, options);\n    return result;\n};\nconst refreshOAuthToken = async (config, options)=>{\n    const api = new APIClient({\n        token: config.clientSecret || '',\n        baseURL: config.baseURL\n    });\n    const apiUrl = '/api/permission/oauth2/token';\n    const payload = {\n        grant_type: 'refresh_token',\n        client_id: config.clientId,\n        refresh_token: config.refreshToken\n    };\n    const result = await api.post(apiUrl, payload, false, options);\n    return result;\n};\nconst getDeviceCode = async (config, options)=>{\n    if (isBrowser()) throw new Error('getDeviceCode is not supported in browser');\n    const api = new APIClient({\n        token: '',\n        baseURL: config.baseURL\n    });\n    let apiUrl;\n    apiUrl = config.workspaceId ? `/api/permission/oauth2/workspace_id/${config.workspaceId}/device/code` : '/api/permission/oauth2/device/code';\n    const payload = {\n        client_id: config.clientId\n    };\n    const result = await api.post(apiUrl, payload, false, options);\n    return result;\n};\nconst _getDeviceToken = async (config, options)=>{\n    const api = new APIClient({\n        token: '',\n        baseURL: config.baseURL\n    });\n    const apiUrl = '/api/permission/oauth2/token';\n    const payload = {\n        grant_type: 'urn:ietf:params:oauth:grant-type:device_code',\n        client_id: config.clientId,\n        device_code: config.deviceCode\n    };\n    const result = await api.post(apiUrl, payload, false, options);\n    return result;\n};\nconst getDeviceToken = async (config, options)=>{\n    if (isBrowser()) throw new Error('getDeviceToken is not supported in browser');\n    if (!config.poll) return _getDeviceToken(config, options);\n    let interval = POLL_INTERVAL;\n    while(true)try {\n        // Attempt to get the device token\n        const deviceToken = await _getDeviceToken(config, options);\n        return deviceToken;\n    } catch (error) {\n        if (error instanceof APIError) {\n            var _error_rawError, _error_rawError1;\n            // If the error is authorization_pending, continue polling\n            if ((null == error ? void 0 : null === (_error_rawError = error.rawError) || void 0 === _error_rawError ? void 0 : _error_rawError.error) === \"authorization_pending\") {\n                await sleep(interval);\n                continue;\n            // If the error is slow_down, increase the interval\n            }\n            if ((null == error ? void 0 : null === (_error_rawError1 = error.rawError) || void 0 === _error_rawError1 ? void 0 : _error_rawError1.error) === \"slow_down\") {\n                if (interval < MAX_POLL_INTERVAL) interval += POLL_INTERVAL;\n                await sleep(interval);\n                continue;\n            }\n        }\n        // For any other error, throw it\n        throw error;\n    }\n};\nconst _getJWTToken = async (config, options)=>{\n    const api = new APIClient({\n        token: config.token,\n        baseURL: config.baseURL\n    });\n    let apiUrl;\n    apiUrl = config.accountId ? `/api/permission/oauth2/account/${config.accountId}/token` : '/api/permission/oauth2/token';\n    var _config_durationSeconds;\n    const payload = {\n        grant_type: 'urn:ietf:params:oauth:grant-type:jwt-bearer',\n        duration_seconds: null !== (_config_durationSeconds = config.durationSeconds) && void 0 !== _config_durationSeconds ? _config_durationSeconds : 900,\n        scope: config.scope\n    };\n    const result = await api.post(apiUrl, payload, false, options);\n    return result;\n};\nconst getJWTToken = async (config, options)=>{\n    if (isBrowser()) throw new Error('getJWTToken is not supported in browser');\n    // Validate private key format\n    const keyFormat = config.privateKey.includes('BEGIN RSA PRIVATE KEY') ? 'RSA' : config.privateKey.includes('BEGIN PRIVATE KEY') ? 'PKCS8' : null;\n    if (!keyFormat) throw APIError.generate(400, void 0, 'Invalid private key format. Expected PEM format (RSA or PKCS8)', void 0);\n    // Prepare the payload for the JWT\n    const now = Math.floor(Date.now() / 1000);\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const payload = {\n        iss: config.appId,\n        aud: config.aud,\n        iat: now,\n        exp: now + 3600,\n        jti: generateRandomString()\n    };\n    if (config.sessionName) payload.session_name = config.sessionName;\n    return new Promise((resolve, reject)=>{\n        var _config_algorithm;\n        external_jsonwebtoken_default().sign(payload, config.privateKey, {\n            algorithm: null !== (_config_algorithm = config.algorithm) && void 0 !== _config_algorithm ? _config_algorithm : 'RS256',\n            keyid: config.keyid\n        }, async (err, token)=>{\n            if (err || !token) {\n                reject(err);\n                return;\n            }\n            // Exchange the JWT for an OAuth token\n            try {\n                const result = await _getJWTToken({\n                    ...config,\n                    token\n                }, options);\n                resolve(result);\n            } catch (err2) {\n                reject(err2);\n            }\n        });\n    });\n};\nvar auth_PKCEAuthErrorType = /*#__PURE__*/ function(PKCEAuthErrorType) {\n    PKCEAuthErrorType[\"AUTHORIZATION_PENDING\"] = \"authorization_pending\";\n    PKCEAuthErrorType[\"SLOW_DOWN\"] = \"slow_down\";\n    PKCEAuthErrorType[\"ACCESS_DENIED\"] = \"access_denied\";\n    PKCEAuthErrorType[\"EXPIRED_TOKEN\"] = \"expired_token\";\n    return PKCEAuthErrorType;\n}({});\nclass CozeAPI extends APIClient {\n    constructor(...args){\n        super(...args), this.bots = new Bots(this), this.chat = new Chat(this), this.conversations = new Conversations(this), this.files = new Files(this), /**\n   * @deprecated\n   */ this.knowledge = new Knowledge(this), this.datasets = new Datasets(this), this.workflows = new Workflows(this), this.workspaces = new WorkSpaces(this), this.audio = new Audio(this), this.templates = new Templates(this), this.websockets = new Websockets(this);\n    }\n}\nvar __webpack_export_target__ = exports;\nfor(var i in __webpack_exports__)__webpack_export_target__[i] = __webpack_exports__[i];\nif (__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, '__esModule', {\n    value: true\n});\n"]}]}