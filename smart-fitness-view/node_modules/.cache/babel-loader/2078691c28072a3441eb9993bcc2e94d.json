{"remainingRequest":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\babel-loader\\lib\\index.js!E:\\SmartFitness\\smart-fitness-view\\src\\api\\cozeWorkflow.js","dependencies":[{"path":"E:\\SmartFitness\\smart-fitness-view\\src\\api\\cozeWorkflow.js","mtime":1749641968347},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749639512193},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1749639511518}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IGF4aW9zIGZyb20gJ2F4aW9zJzsgLy8g6I635Y+W5a2Y5YKo55qEdG9rZW4KCmNvbnN0IGdldFN0b3JlZFRva2VuID0gKCkgPT4gewogIHJldHVybiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY296ZVRva2VuJykgfHwgJ3BhdF9aUjNkaElDRFVTTWFwV2FzbnQxTktXMjlMY295dlpsUlZkS1pldHdaNW1vWXhDZHpacThKdThNVUdabVFvRjJBJzsKfTsgLy8g5pu05pawdG9rZW4KCgpleHBvcnQgY29uc3QgdXBkYXRlQ296ZVRva2VuID0gdG9rZW4gPT4gewogIHRyeSB7CiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY296ZVRva2VuJywgdG9rZW4pOwogICAgcmV0dXJuIHRydWU7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ+abtOaWsHRva2Vu5aSx6LSlOicsIGVycm9yKTsKICAgIHJldHVybiBmYWxzZTsKICB9Cn07IC8vIOWIm+W7ukNvemUgQVBJ5a6i5oi356uvCgpleHBvcnQgY29uc3QgY3JlYXRlQ296ZUNsaWVudCA9ICgpID0+IHsKICBjb25zdCB0b2tlbiA9IGdldFN0b3JlZFRva2VuKCk7CgogIGlmICghdG9rZW4pIHsKICAgIHRocm93IG5ldyBFcnJvcign5pyq6K6+572uQ296ZSBUb2tlbicpOwogIH0KCiAgcmV0dXJuIGF4aW9zLmNyZWF0ZSh7CiAgICBiYXNlVVJMOiAnaHR0cHM6Ly9hcGkuY296ZS5jbicsCiAgICBoZWFkZXJzOiB7CiAgICAgICdBdXRob3JpemF0aW9uJzogYEJlYXJlciAke3Rva2VufWAsCiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicKICAgIH0KICB9KTsKfTsgLy8g5Y+R6YCB5raI5oGv5YiwQ296ZeW3peS9nOa1gQoKZXhwb3J0IGNvbnN0IHNlbmRNZXNzYWdlVG9Xb3JrZmxvdyA9IGFzeW5jICh3b3JrZmxvd0lkLCBtZXNzYWdlKSA9PiB7CiAgdHJ5IHsKICAgIGNvbnN0IGNsaWVudCA9IGNyZWF0ZUNvemVDbGllbnQoKTsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2xpZW50LnBvc3QoJy9hcGkvY2hhdC9jb21wbGV0aW9ucycsIHsKICAgICAgbW9kZWw6ICdncHQtMy41LXR1cmJvJywKICAgICAgbWVzc2FnZXM6IFt7CiAgICAgICAgcm9sZTogJ3VzZXInLAogICAgICAgIGNvbnRlbnQ6IG1lc3NhZ2UKICAgICAgfV0sCiAgICAgIHRlbXBlcmF0dXJlOiAwLjcsCiAgICAgIG1heF90b2tlbnM6IDEwMDAsCiAgICAgIHN0cmVhbTogZmFsc2UsCiAgICAgIHdvcmtmbG93X2lkOiB3b3JrZmxvd0lkCiAgICB9KTsKCiAgICBpZiAoIXJlc3BvbnNlLmRhdGEpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdBUEnlk43lupTmoLzlvI/plJnor68nKTsKICAgIH0KCiAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICB9IGNhdGNoIChlcnJvcikgewogICAgY29uc29sZS5lcnJvcign5Y+R6YCB5raI5oGv5aSx6LSlOicsIGVycm9yKTsKCiAgICBpZiAoZXJyb3IucmVzcG9uc2UpIHsKICAgICAgLy8g5aSE55CGQVBJ6ZSZ6K+v5ZON5bqUCiAgICAgIGlmIChlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSB8fCBlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMykgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVG9rZW7ml6DmlYjmiJblt7Lov4fmnJ/vvIzor7fph43mlrDorr7nva5Ub2tlbicpOwogICAgICB9CgogICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3IucmVzcG9uc2UuZGF0YT8uZXJyb3I/Lm1lc3NhZ2UgfHwgJ0FQSeiwg+eUqOWksei0pScpOwogICAgfQoKICAgIHRocm93IGVycm9yOwogIH0KfTsgLy8g5Z+656GA6YWN572uCgpjb25zdCBiYXNlVVJMID0gJ2h0dHBzOi8vYXBpLmNvemUuY24nOwpjb25zdCB0aW1lb3V0ID0gMzAwMDA7IC8vIOazqOaEj++8muatpHRva2Vu5Y+v6IO95bey6L+H5pyf77yM6K+35pu/5o2i5Li65pyJ5pWI55qEdG9rZW4KLy8g5LuObG9jYWxTdG9yYWdl5Lit6I635Y+WdG9rZW7vvIzlpoLmnpzmsqHmnInliJnkvb/nlKjpu5jorqTlgLwKCmNvbnN0IHRva2VuID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2NvemVUb2tlbicpIHx8ICdwYXRfWlIzZGhJQ0RVU01hcFdhc250MU5LVzI5TGNveXZabFJWZEtaZXR3WjVtb1l4Q2R6WnE4SnU4TVVHWm1Rb0YyQSc7IC8vIOajgOafpXRva2Vu5piv5ZCm5pyJ5pWI55qE5qCH5b+XCgpsZXQgaXNUb2tlblZhbGlkID0gdHJ1ZTsgLy8g5Yib5bu6YXhpb3Plrp7kvosKCmNvbnN0IGluc3RhbmNlID0gYXhpb3MuY3JlYXRlKHsKICBiYXNlVVJMLAogIHRpbWVvdXQsCiAgaGVhZGVyczogewogICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7dG9rZW59YCwKICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicKICB9Cn0pOwovKioNCiAqIOiwg+eUqOaJo+WtkEFJ5bel5L2c5rWBDQogKiBAcGFyYW0ge3N0cmluZ30gd29ya2Zsb3dJZCAtIOW3peS9nOa1gUlEDQogKiBAcGFyYW0ge29iamVjdH0gcGFyYW1ldGVycyAtIOW3peS9nOa1geWPguaVsA0KICogQHBhcmFtIHtzdHJpbmd9IFtwZXJzb25hbEFjY2Vzc1Rva2VuXSAtIOS4quS6uuiuv+mXruS7pOeJjO+8jOWPr+mAiQ0KICogQHJldHVybnMge1Byb21pc2V9IC0g6L+U5Zue5bel5L2c5rWB5omn6KGM57uT5p6cDQogKi8KCmV4cG9ydCBjb25zdCBjYWxsQ296ZVdvcmtmbG93ID0gYXN5bmMgKHdvcmtmbG93SWQsIHBhcmFtZXRlcnMsIHBlcnNvbmFsQWNjZXNzVG9rZW4pID0+IHsKICB0cnkgewogICAgLy8g5aaC5p6c5o+Q5L6b5LqG5Liq5Lq66K6/6Zeu5Luk54mM77yM5YiZ5L2/55So5a6DCiAgICBpZiAocGVyc29uYWxBY2Nlc3NUb2tlbikgewogICAgICBpbnN0YW5jZS5kZWZhdWx0cy5oZWFkZXJzLkF1dGhvcml6YXRpb24gPSBgQmVhcmVyICR7cGVyc29uYWxBY2Nlc3NUb2tlbn1gOwogICAgfQoKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaW5zdGFuY2UucG9zdChgL3dvcmtmbG93cy8ke3dvcmtmbG93SWR9L3J1bnNgLCB7CiAgICAgIHBhcmFtZXRlcnMKICAgIH0pOwogICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ+iwg+eUqOaJo+WtkEFJ5bel5L2c5rWB5aSx6LSlOicsIGVycm9yKTsKICAgIHRocm93IGVycm9yOwogIH0KfTsKLyoqDQogKiDmtYHlvI/osIPnlKjmiaPlrZBBSeW3peS9nOa1gQ0KICogQHBhcmFtIHtzdHJpbmd9IHdvcmtmbG93SWQgLSDlt6XkvZzmtYFJRA0KICogQHBhcmFtIHtvYmplY3R9IHBhcmFtZXRlcnMgLSDlt6XkvZzmtYHlj4LmlbANCiAqIEBwYXJhbSB7ZnVuY3Rpb259IG9uTWVzc2FnZSAtIOWkhOeQhua1geW8j+a2iOaBr+eahOWbnuiwg+WHveaVsA0KICogQHBhcmFtIHtzdHJpbmd9IFtwZXJzb25hbEFjY2Vzc1Rva2VuXSAtIOS4quS6uuiuv+mXruS7pOeJjO+8jOWPr+mAiQ0KICogQHJldHVybnMge1Byb21pc2V9IC0g6L+U5Zue5bel5L2c5rWB5omn6KGM57uT5p6cDQogKi8KCmV4cG9ydCBjb25zdCBzdHJlYW1Db3plV29ya2Zsb3cgPSBhc3luYyAod29ya2Zsb3dJZCwgcGFyYW1ldGVycywgb25NZXNzYWdlLCBwZXJzb25hbEFjY2Vzc1Rva2VuKSA9PiB7CiAgdHJ5IHsKICAgIC8vIOWmguaenOaPkOS+m+S6huS4quS6uuiuv+mXruS7pOeJjO+8jOWImeS9v+eUqOWugwogICAgY29uc3QgYWNjZXNzVG9rZW4gPSBwZXJzb25hbEFjY2Vzc1Rva2VuIHx8IHRva2VuOyAvLyDkvb/nlKhFdmVudFNvdXJjZei/m+ihjFNTRei/nuaOpQoKICAgIGNvbnN0IHVybCA9IGAke2Jhc2VVUkx9L3dvcmtmbG93cy8ke3dvcmtmbG93SWR9L3J1bnMvc3RyZWFtYDsKICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7CiAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7YWNjZXNzVG9rZW59YCwKICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgIH0sCiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICBwYXJhbWV0ZXJzCiAgICAgIH0pCiAgICB9KTsgLy8g6K+75Y+W5rWB5byP5ZON5bqUCgogICAgY29uc3QgcmVhZGVyID0gcmVzcG9uc2UuYm9keS5nZXRSZWFkZXIoKTsKICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTsKICAgIGxldCByZXN1bHQgPSAnJzsKCiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBjb25zdCB7CiAgICAgICAgZG9uZSwKICAgICAgICB2YWx1ZQogICAgICB9ID0gYXdhaXQgcmVhZGVyLnJlYWQoKTsKICAgICAgaWYgKGRvbmUpIGJyZWFrOwogICAgICBjb25zdCBjaHVuayA9IGRlY29kZXIuZGVjb2RlKHZhbHVlLCB7CiAgICAgICAgc3RyZWFtOiB0cnVlCiAgICAgIH0pOwogICAgICByZXN1bHQgKz0gY2h1bms7IC8vIOiwg+eUqOWbnuiwg+WHveaVsOWkhOeQhua2iOaBrwoKICAgICAgaWYgKG9uTWVzc2FnZSAmJiB0eXBlb2Ygb25NZXNzYWdlID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgb25NZXNzYWdlKGNodW5rKTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBKU09OLnBhcnNlKHJlc3VsdCk7CiAgfSBjYXRjaCAoZXJyb3IpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ+a1geW8j+iwg+eUqOaJo+WtkEFJ5bel5L2c5rWB5aSx6LSlOicsIGVycm9yKTsKICAgIHRocm93IGVycm9yOwogIH0KfTsKLyoqDQogKiDkvb/nlKjlop7lvLrniYhheGlvc+iwg+eUqOaJo+WtkEFJ5bel5L2c5rWB77yI5pu/5LujU0RL5pa55qGI77yJDQogKiBAcGFyYW0ge3N0cmluZ30gd29ya2Zsb3dJZCAtIOW3peS9nOa1gUlEDQogKiBAcGFyYW0ge29iamVjdH0gcGFyYW1ldGVycyAtIOW3peS9nOa1geWPguaVsA0KICogQHBhcmFtIHtzdHJpbmd9IFtwZXJzb25hbEFjY2Vzc1Rva2VuXSAtIOS4quS6uuiuv+mXruS7pOeJjO+8jOWPr+mAiQ0KICogQHBhcmFtIHtmdW5jdGlvbn0gW29uTWVzc2FnZV0gLSDlpITnkIbmtYHlvI/mtojmga/nmoTlm57osIPlh73mlbDvvIzlj6/pgIkNCiAqIEByZXR1cm5zIHtQcm9taXNlfSAtIOi/lOWbnuW3peS9nOa1geaJp+ihjOe7k+aenA0KICovCgpleHBvcnQgY29uc3QgY2FsbENvemVXb3JrZmxvd1dpdGhTREsgPSBhc3luYyAod29ya2Zsb3dJZCwgcGFyYW1ldGVycywgcGVyc29uYWxBY2Nlc3NUb2tlbiwgb25NZXNzYWdlKSA9PiB7CiAgdHJ5IHsKICAgIC8vIOWmguaenOW3suefpXRva2Vu5peg5pWI77yM55u05o6l5oqb5Ye66ZSZ6K+vCiAgICBpZiAoIWlzVG9rZW5WYWxpZCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FQSeS7pOeJjOW3suWkseaViO+8jOivt+abtOaWsOacieaViOeahOiuv+mXruS7pOeJjCcpOwogICAgfSAvLyDkvb/nlKjorr/pl67ku6TniYwKCgogICAgY29uc3QgYWNjZXNzVG9rZW4gPSBwZXJzb25hbEFjY2Vzc1Rva2VuIHx8IHRva2VuOyAvLyDlpoLmnpzmj5DkvpvkuoZvbk1lc3NhZ2Xlm57osIPvvIzkvb/nlKjmtYHlvI/osIPnlKgKCiAgICBpZiAob25NZXNzYWdlICYmIHR5cGVvZiBvbk1lc3NhZ2UgPT09ICdmdW5jdGlvbicpIHsKICAgICAgLy8g5L2/55SoZmV0Y2ggQVBJ6L+b6KGM5rWB5byP6LCD55SoCiAgICAgIGNvbnN0IHVybCA9IGAke2Jhc2VVUkx9L3dvcmtmbG93cy8ke3dvcmtmbG93SWR9L3J1bnMvc3RyZWFtYDsKICAgICAgY29uc29sZS5sb2coJ+ato+WcqOi/nuaOpeaJo+WtkEFJ5bel5L2c5rWBLi4uJywgewogICAgICAgIHdvcmtmbG93SWQKICAgICAgfSk7CiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7CiAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgQmVhcmVyICR7YWNjZXNzVG9rZW59YCwKICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICB9LAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICAgIHBhcmFtZXRlcnMKICAgICAgICB9KQogICAgICB9KTsKCiAgICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICAvLyDmo4Dmn6XmmK/lkKbmmK/mjojmnYPpl67popgKICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDEgfHwgcmVzcG9uc2Uuc3RhdHVzID09PSA0MDMpIHsKICAgICAgICAgIGlzVG9rZW5WYWxpZCA9IGZhbHNlOwogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGDmjojmnYPlpLHotKU6IOiuv+mXruS7pOeJjOWPr+iDveW3sui/h+acn+aIluaXoOaViCAo54q25oCB56CBOiAke3Jlc3BvbnNlLnN0YXR1c30pYCk7CiAgICAgICAgfQoKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEhUVFDplJnor68hIOeKtuaAgeeggTogJHtyZXNwb25zZS5zdGF0dXN9LCDnirbmgIHmlofmnKw6ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTsKICAgICAgfSAvLyDor7vlj5bmtYHlvI/lk43lupQKCgogICAgICBjb25zdCByZWFkZXIgPSByZXNwb25zZS5ib2R5LmdldFJlYWRlcigpOwogICAgICBjb25zdCBkZWNvZGVyID0gbmV3IFRleHREZWNvZGVyKCk7CgogICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGRvbmUsCiAgICAgICAgICB2YWx1ZQogICAgICAgIH0gPSBhd2FpdCByZWFkZXIucmVhZCgpOwogICAgICAgIGlmIChkb25lKSBicmVhazsKICAgICAgICBjb25zdCBjaHVuayA9IGRlY29kZXIuZGVjb2RlKHZhbHVlLCB7CiAgICAgICAgICBzdHJlYW06IHRydWUKICAgICAgICB9KTsgLy8g5qih5oufU0RL55qE5ZON5bqU5qC85byPCgogICAgICAgIG9uTWVzc2FnZSh7CiAgICAgICAgICBkYXRhOiBjaHVuawogICAgICAgIH0pOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIHN1Y2Nlc3M6IHRydWUsCiAgICAgICAgbWVzc2FnZTogJ+a1geW8j+iwg+eUqOWujOaIkCcKICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIOWQpuWImeS9v+eUqOaZrumAmuiwg+eUqAogICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGluc3RhbmNlLnBvc3QoYC93b3JrZmxvd3MvJHt3b3JrZmxvd0lkfS9ydW5zYCwgewogICAgICAgIHBhcmFtZXRlcnMKICAgICAgfSk7CiAgICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogICAgfQogIH0gY2F0Y2ggKGVycm9yKSB7CiAgICBjb25zb2xlLmVycm9yKCfkvb/nlKjlop7lvLrniYhheGlvc+iwg+eUqOaJo+WtkEFJ5bel5L2c5rWB5aSx6LSlOicsIGVycm9yKTsgLy8g5o+Q5L6b5pu06K+m57uG55qE6ZSZ6K+v5L+h5oGvCgogICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJzsKICAgIGNvbnN0IGVuaGFuY2VkRXJyb3IgPSBuZXcgRXJyb3IoYOiwg+eUqOaJo+WtkEFJ5bel5L2c5rWB5aSx6LSlOiAke2Vycm9yTWVzc2FnZX1gKTsKICAgIGVuaGFuY2VkRXJyb3Iub3JpZ2luYWxFcnJvciA9IGVycm9yOwogICAgZW5oYW5jZWRFcnJvci5pc1Rva2VuRXJyb3IgPSBlcnJvck1lc3NhZ2UuaW5jbHVkZXMoJ+aOiOadg+Wksei0pScpIHx8IGVycm9yTWVzc2FnZS5pbmNsdWRlcygn5Luk54mM5bey5aSx5pWIJyk7CiAgICB0aHJvdyBlbmhhbmNlZEVycm9yOwogIH0KfTs="},{"version":3,"sources":["E:/SmartFitness/smart-fitness-view/src/api/cozeWorkflow.js"],"names":["axios","getStoredToken","localStorage","getItem","updateCozeToken","token","setItem","error","console","createCozeClient","Error","create","baseURL","headers","sendMessageToWorkflow","workflowId","message","client","response","post","model","messages","role","content","temperature","max_tokens","stream","workflow_id","data","status","timeout","isTokenValid","instance","callCozeWorkflow","parameters","personalAccessToken","defaults","Authorization","streamCozeWorkflow","onMessage","accessToken","url","fetch","method","body","JSON","stringify","reader","getReader","decoder","TextDecoder","result","done","value","read","chunk","decode","parse","callCozeWorkflowWithSDK","log","ok","statusText","success","errorMessage","enhancedError","originalError","isTokenError","includes"],"mappings":"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","sourcesContent":["import axios from 'axios';\r\n\r\n// 获取存储的token\r\nconst getStoredToken = () => {\r\n    return localStorage.getItem('cozeToken') || 'pat_ZR3dhICDUSMapWasnt1NKW29LcoyvZlRVdKZetwZ5moYxCdzZq8Ju8MUGZmQoF2A';\r\n};\r\n\r\n// 更新token\r\nexport const updateCozeToken = (token) => {\r\n    try {\r\n        localStorage.setItem('cozeToken', token);\r\n        return true;\r\n    } catch (error) {\r\n        console.error('更新token失败:', error);\r\n        return false;\r\n    }\r\n};\r\n\r\n// 创建Coze API客户端\r\nexport const createCozeClient = () => {\r\n    const token = getStoredToken();\r\n    if (!token) {\r\n        throw new Error('未设置Coze Token');\r\n    }\r\n\r\n    return axios.create({\r\n        baseURL: 'https://api.coze.cn',\r\n        headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json'\r\n        }\r\n    });\r\n};\r\n\r\n// 发送消息到Coze工作流\r\nexport const sendMessageToWorkflow = async (workflowId, message) => {\r\n    try {\r\n        const client = createCozeClient();\r\n        const response = await client.post('/api/chat/completions', {\r\n            model: 'gpt-3.5-turbo',\r\n            messages: [{\r\n                role: 'user',\r\n                content: message\r\n            }],\r\n            temperature: 0.7,\r\n            max_tokens: 1000,\r\n            stream: false,\r\n            workflow_id: workflowId\r\n        });\r\n\r\n        if (!response.data) {\r\n            throw new Error('API响应格式错误');\r\n        }\r\n\r\n        return response.data;\r\n    } catch (error) {\r\n        console.error('发送消息失败:', error);\r\n        if (error.response) {\r\n            // 处理API错误响应\r\n            if (error.response.status === 401 || error.response.status === 403) {\r\n                throw new Error('Token无效或已过期，请重新设置Token');\r\n            }\r\n            throw new Error(error.response.data?.error?.message || 'API调用失败');\r\n        }\r\n        throw error;\r\n    }\r\n};\r\n\r\n// 基础配置\r\nconst baseURL = 'https://api.coze.cn';\r\nconst timeout = 30000;\r\n// 注意：此token可能已过期，请替换为有效的token\r\n// 从localStorage中获取token，如果没有则使用默认值\r\nconst token = localStorage.getItem('cozeToken') || 'pat_ZR3dhICDUSMapWasnt1NKW29LcoyvZlRVdKZetwZ5moYxCdzZq8Ju8MUGZmQoF2A';\r\n\r\n// 检查token是否有效的标志\r\nlet isTokenValid = true;\r\n\r\n// 创建axios实例\r\nconst instance = axios.create({\r\n  baseURL,\r\n  timeout,\r\n  headers: {\r\n    'Authorization': `Bearer ${token}`,\r\n    'Content-Type': 'application/json'\r\n  }\r\n});\r\n\r\n/**\r\n * 调用扣子AI工作流\r\n * @param {string} workflowId - 工作流ID\r\n * @param {object} parameters - 工作流参数\r\n * @param {string} [personalAccessToken] - 个人访问令牌，可选\r\n * @returns {Promise} - 返回工作流执行结果\r\n */\r\nexport const callCozeWorkflow = async (workflowId, parameters, personalAccessToken) => {\r\n  try {\r\n    // 如果提供了个人访问令牌，则使用它\r\n    if (personalAccessToken) {\r\n      instance.defaults.headers.Authorization = `Bearer ${personalAccessToken}`;\r\n    }\r\n\r\n    const response = await instance.post(`/workflows/${workflowId}/runs`, {\r\n      parameters\r\n    });\r\n\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error('调用扣子AI工作流失败:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * 流式调用扣子AI工作流\r\n * @param {string} workflowId - 工作流ID\r\n * @param {object} parameters - 工作流参数\r\n * @param {function} onMessage - 处理流式消息的回调函数\r\n * @param {string} [personalAccessToken] - 个人访问令牌，可选\r\n * @returns {Promise} - 返回工作流执行结果\r\n */\r\nexport const streamCozeWorkflow = async (workflowId, parameters, onMessage, personalAccessToken) => {\r\n  try {\r\n    // 如果提供了个人访问令牌，则使用它\r\n    const accessToken = personalAccessToken || token;\r\n    \r\n    // 使用EventSource进行SSE连接\r\n    const url = `${baseURL}/workflows/${workflowId}/runs/stream`;\r\n    const response = await fetch(url, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Authorization': `Bearer ${accessToken}`,\r\n        'Content-Type': 'application/json'\r\n      },\r\n      body: JSON.stringify({ parameters }),\r\n    });\r\n\r\n    // 读取流式响应\r\n    const reader = response.body.getReader();\r\n    const decoder = new TextDecoder();\r\n    let result = '';\r\n\r\n    while (true) {\r\n      const { done, value } = await reader.read();\r\n      if (done) break;\r\n      \r\n      const chunk = decoder.decode(value, { stream: true });\r\n      result += chunk;\r\n      \r\n      // 调用回调函数处理消息\r\n      if (onMessage && typeof onMessage === 'function') {\r\n        onMessage(chunk);\r\n      }\r\n    }\r\n\r\n    return JSON.parse(result);\r\n  } catch (error) {\r\n    console.error('流式调用扣子AI工作流失败:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * 使用增强版axios调用扣子AI工作流（替代SDK方案）\r\n * @param {string} workflowId - 工作流ID\r\n * @param {object} parameters - 工作流参数\r\n * @param {string} [personalAccessToken] - 个人访问令牌，可选\r\n * @param {function} [onMessage] - 处理流式消息的回调函数，可选\r\n * @returns {Promise} - 返回工作流执行结果\r\n */\r\nexport const callCozeWorkflowWithSDK = async (workflowId, parameters, personalAccessToken, onMessage) => {\r\n  try {\r\n    // 如果已知token无效，直接抛出错误\r\n    if (!isTokenValid) {\r\n      throw new Error('API令牌已失效，请更新有效的访问令牌');\r\n    }\r\n    \r\n    // 使用访问令牌\r\n    const accessToken = personalAccessToken || token;\r\n    \r\n    // 如果提供了onMessage回调，使用流式调用\r\n    if (onMessage && typeof onMessage === 'function') {\r\n      // 使用fetch API进行流式调用\r\n      const url = `${baseURL}/workflows/${workflowId}/runs/stream`;\r\n      \r\n      console.log('正在连接扣子AI工作流...', { workflowId });\r\n      \r\n      const response = await fetch(url, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Authorization': `Bearer ${accessToken}`,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify({ parameters }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        // 检查是否是授权问题\r\n        if (response.status === 401 || response.status === 403) {\r\n          isTokenValid = false;\r\n          throw new Error(`授权失败: 访问令牌可能已过期或无效 (状态码: ${response.status})`);\r\n        }\r\n        throw new Error(`HTTP错误! 状态码: ${response.status}, 状态文本: ${response.statusText}`);\r\n      }\r\n\r\n      // 读取流式响应\r\n      const reader = response.body.getReader();\r\n      const decoder = new TextDecoder();\r\n      \r\n      while (true) {\r\n        const { done, value } = await reader.read();\r\n        if (done) break;\r\n        \r\n        const chunk = decoder.decode(value, { stream: true });\r\n        // 模拟SDK的响应格式\r\n        onMessage({ data: chunk });\r\n      }\r\n\r\n      return { success: true, message: '流式调用完成' };\r\n    } else {\r\n      // 否则使用普通调用\r\n      const response = await instance.post(`/workflows/${workflowId}/runs`, {\r\n        parameters\r\n      });\r\n\r\n      return response.data;\r\n    }\r\n  } catch (error) {\r\n    console.error('使用增强版axios调用扣子AI工作流失败:', error);\r\n    \r\n    // 提供更详细的错误信息\r\n    const errorMessage = error.message || '未知错误';\r\n    const enhancedError = new Error(`调用扣子AI工作流失败: ${errorMessage}`);\r\n    enhancedError.originalError = error;\r\n    enhancedError.isTokenError = errorMessage.includes('授权失败') || errorMessage.includes('令牌已失效');\r\n    \r\n    throw enhancedError;\r\n  }\r\n};"]}]}