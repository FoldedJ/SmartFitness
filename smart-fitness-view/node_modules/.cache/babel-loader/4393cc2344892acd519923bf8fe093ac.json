{"remainingRequest":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\babel-loader\\lib\\index.js!E:\\SmartFitness\\smart-fitness-view\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!E:\\SmartFitness\\smart-fitness-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\SmartFitness\\smart-fitness-view\\src\\components\\ChatWindow.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\SmartFitness\\smart-fitness-view\\src\\components\\ChatWindow.vue","mtime":1749993867826},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749639512193},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1749639511518},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749639512193},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1749639525774},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749639512193},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1749639511518},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749639512193},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1749639525774}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0IHsgZXhlY3V0ZVdvcmtmbG93IH0gZnJvbSAnQC9hcGkvY296ZSc7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnQ2hhdFdpbmRvdycsCiAgcHJvcHM6IHsvLyDkuI3lho3pnIDopoF3b3JrZmxvd0lk5bGe5oCnCiAgfSwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvbGxhcHNlZDogdHJ1ZSwKICAgICAgaW5wdXRNZXNzYWdlOiAnJywKICAgICAgbWVzc2FnZXM6IFt7CiAgICAgICAgdHlwZTogJ3JlY2VpdmVkJywKICAgICAgICBjb250ZW50OiAn5oKo5aW977yB5oiR5piv5oKo55qE5pm66IO95YGl5bq35Yqp5omL77yM5pyJ5LuA5LmI5Y+v5Lul5biu5Yqp5oKo55qE5ZCX77yfJwogICAgICB9XSwKICAgICAgbG9hZGluZzogZmFsc2UKICAgIH07CiAgfSwKCiAgbWV0aG9kczogewogICAgdG9nZ2xlQ29sbGFwc2UoKSB7CiAgICAgIHRoaXMuY29sbGFwc2VkID0gIXRoaXMuY29sbGFwc2VkOwogICAgfSwKCiAgICBhc3luYyBzZW5kTWVzc2FnZSgpIHsKICAgICAgaWYgKCF0aGlzLmlucHV0TWVzc2FnZS50cmltKCkgfHwgdGhpcy5sb2FkaW5nKSByZXR1cm47IC8vIOa3u+WKoOeUqOaIt+a2iOaBr+WIsOiBiuWkqeeql+WPowoKICAgICAgdGhpcy5tZXNzYWdlcy5wdXNoKHsKICAgICAgICB0eXBlOiAnc2VudCcsCiAgICAgICAgY29udGVudDogdGhpcy5pbnB1dE1lc3NhZ2UKICAgICAgfSk7CiAgICAgIGNvbnN0IHVzZXJJbnB1dCA9IHRoaXMuaW5wdXRNZXNzYWdlOwogICAgICB0aGlzLmlucHV0TWVzc2FnZSA9ICcnOwogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOyAvLyDmt7vliqDliqDovb3mtojmga8KCiAgICAgIGNvbnN0IGxvYWRpbmdNc2dJbmRleCA9IHRoaXMubWVzc2FnZXMubGVuZ3RoOwogICAgICB0aGlzLm1lc3NhZ2VzLnB1c2goewogICAgICAgIHR5cGU6ICdyZWNlaXZlZCcsCiAgICAgICAgY29udGVudDogJ+ato+WcqOaAneiAg+S4rS4uLicKICAgICAgfSk7CgogICAgICB0cnkgewogICAgICAgIC8vIOiwg+eUqENvemXlt6XkvZzmtYFBUEkKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGV4ZWN1dGVXb3JrZmxvdyh1c2VySW5wdXQpOyAvLyDlnKjmjqfliLblj7DovpPlh7rlrozmlbTnmoTlk43lupTlr7nosaHvvIznlKjkuo7osIPor5UKCiAgICAgICAgY29uc29sZS5sb2coJ+aUtuWIsOeahOWujOaVtOWTjeW6lDonLCByZXNwb25zZSk7CiAgICAgICAgY29uc29sZS5sb2coJ+WTjeW6lOeahGRhdGHlrZfmrrU6JywgcmVzcG9uc2UuZGF0YSk7IC8vIOWkhOeQhuWTjeW6lOaVsOaNrgoKICAgICAgICBsZXQgcmVzcG9uc2VDb250ZW50ID0gJyc7CgogICAgICAgIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEuY29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAvLyDnm7TmjqXkvb/nlKjlkI7nq6/ov5Tlm57nmoTmlbDmja7vvIzkuI3lho3lsJ3or5Xop6PmnpBKU09OCiAgICAgICAgICByZXNwb25zZUNvbnRlbnQgPSByZXNwb25zZS5kYXRhLmRhdGE7CiAgICAgICAgICBjb25zb2xlLmxvZygn5L2/55So55qE5ZON5bqU5YaF5a65OicsIHJlc3BvbnNlQ29udGVudCk7CiAgICAgICAgfSBlbHNlIGlmIChyZXNwb25zZSAmJiByZXNwb25zZS5kYXRhICYmIHJlc3BvbnNlLmRhdGEubWVzc2FnZSkgewogICAgICAgICAgcmVzcG9uc2VDb250ZW50ID0gcmVzcG9uc2UuZGF0YS5tZXNzYWdlOwogICAgICAgICAgY29uc29sZS5sb2coJ+S9v+eUqOeahOmUmeivr+a2iOaBrzonLCByZXNwb25zZUNvbnRlbnQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXNwb25zZUNvbnRlbnQgPSAn5pS25Yiw5ZON5bqU77yM5L2G5peg5rOV6Kej5p6Q5YaF5a65JzsKICAgICAgICAgIGNvbnNvbGUubG9nKCfml6Dms5Xop6PmnpDlk43lupTlhoXlrrknKTsKICAgICAgICB9IC8vIOabtOaWsOWKoOi9vea2iOaBr+S4uuWunumZheWTjeW6lAoKCiAgICAgICAgdGhpcy5tZXNzYWdlcy5zcGxpY2UobG9hZGluZ01zZ0luZGV4LCAxLCB7CiAgICAgICAgICB0eXBlOiAncmVjZWl2ZWQnLAogICAgICAgICAgY29udGVudDogcmVzcG9uc2VDb250ZW50CiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgLy8g5pu05paw5Yqg6L295raI5oGv5Li66ZSZ6K+v5L+h5oGvCiAgICAgICAgdGhpcy5tZXNzYWdlcy5zcGxpY2UobG9hZGluZ01zZ0luZGV4LCAxLCB7CiAgICAgICAgICB0eXBlOiAncmVjZWl2ZWQnLAogICAgICAgICAgY29udGVudDogJ+aKseatie+8jOaIkemBh+WIsOS6huS4gOS6m+mXrumimO+8micgKyAoZXJyb3IubWVzc2FnZSB8fCAn5pyq55+l6ZSZ6K+vJykKICAgICAgICB9KTsKICAgICAgICBjb25zb2xlLmVycm9yKCfmiafooYzlt6XkvZzmtYHlh7rplJk6JywgZXJyb3IpOwogICAgICB9IGZpbmFsbHkgewogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgIHRoaXMuc2Nyb2xsVG9Cb3R0b20oKTsKICAgICAgICB9KTsKICAgICAgfQogICAgfSwKCiAgICBzY3JvbGxUb0JvdHRvbSgpIHsKICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy4kcmVmcy5tZXNzYWdlc0NvbnRhaW5lcjsKCiAgICAgIGlmIChjb250YWluZXIpIHsKICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wID0gY29udGFpbmVyLnNjcm9sbEhlaWdodDsKICAgICAgfQogICAgfQoKICB9LAoKICB1cGRhdGVkKCkgewogICAgdGhpcy5zY3JvbGxUb0JvdHRvbSgpOwogIH0KCn07"},{"version":3,"sources":["ChatWindow.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"chat-window\" :class=\"{ 'chat-window-collapsed': collapsed }\">\n    <div class=\"chat-header\" @click=\"toggleCollapse\">\n      <span>智能助手</span>\n      <i :class=\"collapsed ? 'el-icon-arrow-up' : 'el-icon-arrow-down'\"></i>\n    </div>\n    <div v-show=\"!collapsed\" class=\"chat-body\">\n      <div class=\"chat-messages\" ref=\"messagesContainer\">\n        <div v-for=\"(message, index) in messages\" :key=\"index\" class=\"message\" :class=\"message.type\">\n          <div class=\"message-content\">{{ message.content }}</div>\n        </div>\n      </div>\n      <div class=\"chat-input\">\n        <el-input\n          v-model=\"inputMessage\"\n          placeholder=\"请输入您的问题...\"\n          @keyup.enter.native=\"sendMessage\"\n          :disabled=\"loading\"\n        ></el-input>\n        <el-button type=\"primary\" icon=\"el-icon-s-promotion\" @click=\"sendMessage\" :loading=\"loading\">发送</el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { executeWorkflow } from '@/api/coze';\n\nexport default {\n  name: 'ChatWindow',\n  props: {\n    // 不再需要workflowId属性\n  },\n  data() {\n    return {\n      collapsed: true,\n      inputMessage: '',\n      messages: [\n        {\n          type: 'received',\n          content: '您好！我是您的智能健康助手，有什么可以帮助您的吗？'\n        }\n      ],\n      loading: false\n    };\n  },\n  methods: {\n    toggleCollapse() {\n      this.collapsed = !this.collapsed;\n    },\n    async sendMessage() {\n      if (!this.inputMessage.trim() || this.loading) return;\n      \n      // 添加用户消息到聊天窗口\n      this.messages.push({\n        type: 'sent',\n        content: this.inputMessage\n      });\n      \n      const userInput = this.inputMessage;\n      this.inputMessage = '';\n      this.loading = true;\n      \n      // 添加加载消息\n      const loadingMsgIndex = this.messages.length;\n      this.messages.push({\n        type: 'received',\n        content: '正在思考中...'\n      });\n      \n      try {\n        // 调用Coze工作流API\n        const response = await executeWorkflow(userInput);\n        \n        // 在控制台输出完整的响应对象，用于调试\n        console.log('收到的完整响应:', response);\n        console.log('响应的data字段:', response.data);\n        \n        // 处理响应数据\n        let responseContent = '';\n        if (response && response.data && response.data.code === 200) {\n          // 直接使用后端返回的数据，不再尝试解析JSON\n          responseContent = response.data.data;\n          console.log('使用的响应内容:', responseContent);\n        } else if (response && response.data && response.data.message) {\n          responseContent = response.data.message;\n          console.log('使用的错误消息:', responseContent);\n        } else {\n          responseContent = '收到响应，但无法解析内容';\n          console.log('无法解析响应内容');\n        }\n        \n        // 更新加载消息为实际响应\n        this.messages.splice(loadingMsgIndex, 1, {\n          type: 'received',\n          content: responseContent\n        });\n      } catch (error) {\n        // 更新加载消息为错误信息\n        this.messages.splice(loadingMsgIndex, 1, {\n          type: 'received',\n          content: '抱歉，我遇到了一些问题：' + (error.message || '未知错误')\n        });\n        console.error('执行工作流出错:', error);\n      } finally {\n        this.loading = false;\n        this.$nextTick(() => {\n          this.scrollToBottom();\n        });\n      }\n    },\n    scrollToBottom() {\n      const container = this.$refs.messagesContainer;\n      if (container) {\n        container.scrollTop = container.scrollHeight;\n      }\n    }\n  },\n  updated() {\n    this.scrollToBottom();\n  }\n};\n</script>\n\n<style scoped lang=\"scss\">\n.chat-window {\n  position: fixed;\n  bottom: 20px;\n  right: 20px;\n  width: 350px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n  z-index: 1000;\n  transition: all 0.3s ease;\n  max-height: 500px;\n  display: flex;\n  flex-direction: column;\n  \n  &.chat-window-collapsed {\n    max-height: 50px;\n  }\n}\n\n.chat-header {\n  padding: 12px 15px;\n  background-color: #409EFF;\n  color: white;\n  border-radius: 8px 8px 0 0;\n  cursor: pointer;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.chat-body {\n  display: flex;\n  flex-direction: column;\n  height: 400px;\n}\n\n.chat-messages {\n  flex: 1;\n  padding: 15px;\n  overflow-y: auto;\n}\n\n.message {\n  margin-bottom: 10px;\n  max-width: 80%;\n  \n  &.sent {\n    margin-left: auto;\n    \n    .message-content {\n      background-color: #409EFF;\n      color: white;\n      border-radius: 18px 18px 0 18px;\n    }\n  }\n  \n  &.received {\n    margin-right: auto;\n    \n    .message-content {\n      background-color: #f2f2f2;\n      color: #333;\n      border-radius: 18px 18px 18px 0;\n    }\n  }\n}\n\n.message-content {\n  padding: 10px 15px;\n  word-break: break-word;\n  white-space: pre-wrap;\n}\n\n.chat-input {\n  padding: 10px;\n  display: flex;\n  border-top: 1px solid #eee;\n  \n  .el-input {\n    margin-right: 10px;\n  }\n}\n</style>"],"sourceRoot":"src/components"}]}