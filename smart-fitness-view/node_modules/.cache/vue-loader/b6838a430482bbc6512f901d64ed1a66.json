{"remainingRequest":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\SmartFitness\\smart-fitness-view\\src\\components\\ChatWindow.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\SmartFitness\\smart-fitness-view\\src\\components\\ChatWindow.vue","mtime":1750052992151},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749639512193},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\babel-loader\\lib\\index.js","mtime":1749639511518},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1749639512193},{"path":"E:\\SmartFitness\\smart-fitness-view\\node_modules\\vue-loader\\lib\\index.js","mtime":1749639525774}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGV4ZWN1dGVXb3JrZmxvdyB9IGZyb20gJ0AvYXBpL2NvemUnOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdDaGF0V2luZG93JywKICBwcm9wczogewogICAgLy8g5LiN5YaN6ZyA6KaBd29ya2Zsb3dJZOWxnuaApwogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGNvbGxhcHNlZDogdHJ1ZSwKICAgICAgaW5wdXRNZXNzYWdlOiAnJywKICAgICAgbWVzc2FnZXM6IFsKICAgICAgICB7CiAgICAgICAgICB0eXBlOiAncmVjZWl2ZWQnLAogICAgICAgICAgY29udGVudDogJ+aCqOWlve+8geaIkeaYr+aCqOeahOaZuuiDveWBpeW6t+WKqeaJi++8jOacieS7gOS5iOWPr+S7peW4ruWKqeaCqOeahOWQl++8nycKICAgICAgICB9CiAgICAgIF0sCiAgICAgIGxvYWRpbmc6IGZhbHNlCiAgICB9OwogIH0sCiAgbWV0aG9kczogewogICAgdG9nZ2xlQ29sbGFwc2UoKSB7CiAgICAgIHRoaXMuY29sbGFwc2VkID0gIXRoaXMuY29sbGFwc2VkOwogICAgfSwKICAgIGFzeW5jIHNlbmRNZXNzYWdlKCkgewogICAgICBpZiAoIXRoaXMuaW5wdXRNZXNzYWdlLnRyaW0oKSB8fCB0aGlzLmxvYWRpbmcpIHJldHVybjsKICAgICAgCiAgICAgIC8vIOa3u+WKoOeUqOaIt+a2iOaBr+WIsOiBiuWkqeeql+WPowogICAgICB0aGlzLm1lc3NhZ2VzLnB1c2goewogICAgICAgIHR5cGU6ICdzZW50JywKICAgICAgICBjb250ZW50OiB0aGlzLmlucHV0TWVzc2FnZQogICAgICB9KTsKICAgICAgCiAgICAgIGNvbnN0IHVzZXJJbnB1dCA9IHRoaXMuaW5wdXRNZXNzYWdlOwogICAgICB0aGlzLmlucHV0TWVzc2FnZSA9ICcnOwogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlOwogICAgICAKICAgICAgLy8g5re75Yqg5Yqg6L295raI5oGvCiAgICAgIGNvbnN0IGxvYWRpbmdNc2dJbmRleCA9IHRoaXMubWVzc2FnZXMubGVuZ3RoOwogICAgICB0aGlzLm1lc3NhZ2VzLnB1c2goewogICAgICAgIHR5cGU6ICdyZWNlaXZlZCcsCiAgICAgICAgY29udGVudDogJ+ato+WcqOaAneiAg+S4rS4uLicKICAgICAgfSk7CiAgICAgIAogICAgICB0cnkgewogICAgICAgIC8vIOiwg+eUqENvemXlt6XkvZzmtYFBUEkKICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGV4ZWN1dGVXb3JrZmxvdyh1c2VySW5wdXQpOwogICAgICAgIAogICAgICAgIC8vIOWcqOaOp+WItuWPsOi+k+WHuuWujOaVtOeahOWTjeW6lOWvueixoe+8jOeUqOS6juiwg+ivlQogICAgICAgIGNvbnNvbGUubG9nKCfmlLbliLDnmoTlrozmlbTlk43lupQ6JywgcmVzcG9uc2UpOwogICAgICAgIGNvbnNvbGUubG9nKCflk43lupTnmoRkYXRh5a2X5q61OicsIHJlc3BvbnNlLmRhdGEpOwogICAgICAgIAogICAgICAgIC8vIOWkhOeQhuWTjeW6lOaVsOaNrgogICAgICAgIGxldCByZXNwb25zZUNvbnRlbnQgPSAnJzsKICAgICAgICBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLmNvZGUgPT09IDIwMCkgewogICAgICAgICAgLy8g55u05o6l5L2/55So5ZCO56uv6L+U5Zue55qE5pWw5o2u77yM5LiN5YaN5bCd6K+V6Kej5p6QSlNPTgogICAgICAgICAgcmVzcG9uc2VDb250ZW50ID0gcmVzcG9uc2UuZGF0YS5kYXRhOwogICAgICAgICAgY29uc29sZS5sb2coJ+S9v+eUqOeahOWTjeW6lOWGheWuuTonLCByZXNwb25zZUNvbnRlbnQpOwogICAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2UgJiYgcmVzcG9uc2UuZGF0YSAmJiByZXNwb25zZS5kYXRhLm1lc3NhZ2UpIHsKICAgICAgICAgIHJlc3BvbnNlQ29udGVudCA9IHJlc3BvbnNlLmRhdGEubWVzc2FnZTsKICAgICAgICAgIGNvbnNvbGUubG9nKCfkvb/nlKjnmoTplJnor6/mtojmga86JywgcmVzcG9uc2VDb250ZW50KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzcG9uc2VDb250ZW50ID0gJ+aUtuWIsOWTjeW6lO+8jOS9huaXoOazleino+aekOWGheWuuSc7CiAgICAgICAgICBjb25zb2xlLmxvZygn5peg5rOV6Kej5p6Q5ZON5bqU5YaF5a65Jyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIOabtOaWsOWKoOi9vea2iOaBr+S4uuWunumZheWTjeW6lAogICAgICAgIHRoaXMubWVzc2FnZXMuc3BsaWNlKGxvYWRpbmdNc2dJbmRleCwgMSwgewogICAgICAgICAgdHlwZTogJ3JlY2VpdmVkJywKICAgICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlQ29udGVudAogICAgICAgIH0pOwogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIC8vIOabtOaWsOWKoOi9vea2iOaBr+S4uumUmeivr+S/oeaBrwogICAgICAgIHRoaXMubWVzc2FnZXMuc3BsaWNlKGxvYWRpbmdNc2dJbmRleCwgMSwgewogICAgICAgICAgdHlwZTogJ3JlY2VpdmVkJywKICAgICAgICAgIGNvbnRlbnQ6ICfmirHmrYnvvIzmiJHpgYfliLDkuobkuIDkupvpl67popjvvJonICsgKGVycm9yLm1lc3NhZ2UgfHwgJ+acquefpemUmeivrycpCiAgICAgICAgfSk7CiAgICAgICAgY29uc29sZS5lcnJvcign5omn6KGM5bel5L2c5rWB5Ye66ZSZOicsIGVycm9yKTsKICAgICAgfSBmaW5hbGx5IHsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsKICAgICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7CiAgICAgICAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBzY3JvbGxUb0JvdHRvbSgpIHsKICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy4kcmVmcy5tZXNzYWdlc0NvbnRhaW5lcjsKICAgICAgaWYgKGNvbnRhaW5lcikgewogICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgPSBjb250YWluZXIuc2Nyb2xsSGVpZ2h0OwogICAgICB9CiAgICB9CiAgfSwKICB1cGRhdGVkKCkgewogICAgdGhpcy5zY3JvbGxUb0JvdHRvbSgpOwogIH0KfTsK"},{"version":3,"sources":["ChatWindow.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ChatWindow.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"chat-window\" :class=\"{ 'chat-window-collapsed': collapsed }\">\n    <div class=\"chat-header\" @click=\"toggleCollapse\">\n      <span>智能助手</span>\n      <i :class=\"collapsed ? 'el-icon-arrow-up' : 'el-icon-arrow-down'\"></i>\n    </div>\n    <div v-show=\"!collapsed\" class=\"chat-body\">\n      <div class=\"chat-messages\" ref=\"messagesContainer\">\n        <div v-for=\"(message, index) in messages\" :key=\"index\" class=\"message\" :class=\"message.type\">\n          <div class=\"message-content\">{{ message.content }}</div>\n        </div>\n      </div>\n      <div class=\"chat-input\">\n        <el-input\n          v-model=\"inputMessage\"\n          placeholder=\"请输入您的问题...\"\n          @keyup.enter.native=\"sendMessage\"\n          :disabled=\"loading\"\n        ></el-input>\n        <el-button type=\"primary\" icon=\"el-icon-s-promotion\" @click=\"sendMessage\" :loading=\"loading\">发送</el-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { executeWorkflow } from '@/api/coze';\n\nexport default {\n  name: 'ChatWindow',\n  props: {\n    // 不再需要workflowId属性\n  },\n  data() {\n    return {\n      collapsed: true,\n      inputMessage: '',\n      messages: [\n        {\n          type: 'received',\n          content: '您好！我是您的智能健康助手，有什么可以帮助您的吗？'\n        }\n      ],\n      loading: false\n    };\n  },\n  methods: {\n    toggleCollapse() {\n      this.collapsed = !this.collapsed;\n    },\n    async sendMessage() {\n      if (!this.inputMessage.trim() || this.loading) return;\n      \n      // 添加用户消息到聊天窗口\n      this.messages.push({\n        type: 'sent',\n        content: this.inputMessage\n      });\n      \n      const userInput = this.inputMessage;\n      this.inputMessage = '';\n      this.loading = true;\n      \n      // 添加加载消息\n      const loadingMsgIndex = this.messages.length;\n      this.messages.push({\n        type: 'received',\n        content: '正在思考中...'\n      });\n      \n      try {\n        // 调用Coze工作流API\n        const response = await executeWorkflow(userInput);\n        \n        // 在控制台输出完整的响应对象，用于调试\n        console.log('收到的完整响应:', response);\n        console.log('响应的data字段:', response.data);\n        \n        // 处理响应数据\n        let responseContent = '';\n        if (response && response.data && response.data.code === 200) {\n          // 直接使用后端返回的数据，不再尝试解析JSON\n          responseContent = response.data.data;\n          console.log('使用的响应内容:', responseContent);\n        } else if (response && response.data && response.data.message) {\n          responseContent = response.data.message;\n          console.log('使用的错误消息:', responseContent);\n        } else {\n          responseContent = '收到响应，但无法解析内容';\n          console.log('无法解析响应内容');\n        }\n        \n        // 更新加载消息为实际响应\n        this.messages.splice(loadingMsgIndex, 1, {\n          type: 'received',\n          content: responseContent\n        });\n      } catch (error) {\n        // 更新加载消息为错误信息\n        this.messages.splice(loadingMsgIndex, 1, {\n          type: 'received',\n          content: '抱歉，我遇到了一些问题：' + (error.message || '未知错误')\n        });\n        console.error('执行工作流出错:', error);\n      } finally {\n        this.loading = false;\n        this.$nextTick(() => {\n          this.scrollToBottom();\n        });\n      }\n    },\n    scrollToBottom() {\n      const container = this.$refs.messagesContainer;\n      if (container) {\n        container.scrollTop = container.scrollHeight;\n      }\n    }\n  },\n  updated() {\n    this.scrollToBottom();\n  }\n};\n</script>\n\n<style scoped lang=\"scss\">\n.chat-window {\n  position: fixed;\n  bottom: 20px;\n  right: 20px;\n  width: 350px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n  z-index: 1000;\n  transition: all 0.3s ease;\n  max-height: 500px;\n  display: flex;\n  flex-direction: column;\n  \n  &.chat-window-collapsed {\n    max-height: 50px;\n  }\n}\n\n.chat-header {\n  padding: 12px 15px;\n  background-color: #409EFF;\n  color: white;\n  border-radius: 8px 8px 0 0;\n  cursor: pointer;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.chat-body {\n  display: flex;\n  flex-direction: column;\n  height: 400px;\n}\n\n.chat-messages {\n  flex: 1;\n  padding: 15px;\n  overflow-y: auto;\n}\n\n.message {\n  margin-bottom: 10px;\n  max-width: 80%;\n  \n  &.sent {\n    margin-left: auto;\n    \n    .message-content {\n      background-color: #409EFF;\n      color: white;\n      border-radius: 18px 18px 0 18px;\n    }\n  }\n  \n  &.received {\n    margin-right: auto;\n    \n    .message-content {\n      background-color: #f2f2f2;\n      color: #333;\n      border-radius: 18px 18px 18px 0;\n    }\n  }\n}\n\n.message-content {\n  padding: 10px 15px;\n  word-break: break-word;\n  white-space: pre-wrap;\n}\n\n.chat-input {\n  padding: 10px;\n  display: flex;\n  border-top: 1px solid #eee;\n  \n  .el-input {\n    margin-right: 10px;\n  }\n}\n</style>"]}]}